{"ast":null,"code":"function _typeof(obj) {\n  \"@babel/helpers - typeof\";\n\n  if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") {\n    _typeof = function _typeof(obj) {\n      return typeof obj;\n    };\n  } else {\n    _typeof = function _typeof(obj) {\n      return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n    };\n  }\n\n  return _typeof(obj);\n}\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  return Constructor;\n}\n\nfunction _inherits(subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function\");\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      writable: true,\n      configurable: true\n    }\n  });\n  if (superClass) _setPrototypeOf(subClass, superClass);\n}\n\nfunction _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n\n  return _setPrototypeOf(o, p);\n}\n\nfunction _createSuper(Derived) {\n  var hasNativeReflectConstruct = _isNativeReflectConstruct();\n\n  return function _createSuperInternal() {\n    var Super = _getPrototypeOf(Derived),\n        result;\n\n    if (hasNativeReflectConstruct) {\n      var NewTarget = _getPrototypeOf(this).constructor;\n\n      result = Reflect.construct(Super, arguments, NewTarget);\n    } else {\n      result = Super.apply(this, arguments);\n    }\n\n    return _possibleConstructorReturn(this, result);\n  };\n}\n\nfunction _possibleConstructorReturn(self, call) {\n  if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) {\n    return call;\n  }\n\n  return _assertThisInitialized(self);\n}\n\nfunction _assertThisInitialized(self) {\n  if (self === void 0) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return self;\n}\n\nfunction _isNativeReflectConstruct() {\n  if (typeof Reflect === \"undefined\" || !Reflect.construct) return false;\n  if (Reflect.construct.sham) return false;\n  if (typeof Proxy === \"function\") return true;\n\n  try {\n    Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));\n    return true;\n  } catch (e) {\n    return false;\n  }\n}\n\nfunction _getPrototypeOf(o) {\n  _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) {\n    return o.__proto__ || Object.getPrototypeOf(o);\n  };\n  return _getPrototypeOf(o);\n}\n\nfunction _toConsumableArray(arr) {\n  return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread();\n}\n\nfunction _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\n\nfunction _iterableToArray(iter) {\n  if (typeof Symbol !== \"undefined\" && iter[Symbol.iterator] != null || iter[\"@@iterator\"] != null) return Array.from(iter);\n}\n\nfunction _arrayWithoutHoles(arr) {\n  if (Array.isArray(arr)) return _arrayLikeToArray(arr);\n}\n\nfunction _slicedToArray(arr, i) {\n  return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest();\n}\n\nfunction _nonIterableRest() {\n  throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\n\nfunction _unsupportedIterableToArray(o, minLen) {\n  if (!o) return;\n  if (typeof o === \"string\") return _arrayLikeToArray(o, minLen);\n  var n = Object.prototype.toString.call(o).slice(8, -1);\n  if (n === \"Object\" && o.constructor) n = o.constructor.name;\n  if (n === \"Map\" || n === \"Set\") return Array.from(o);\n  if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);\n}\n\nfunction _arrayLikeToArray(arr, len) {\n  if (len == null || len > arr.length) len = arr.length;\n\n  for (var i = 0, arr2 = new Array(len); i < len; i++) {\n    arr2[i] = arr[i];\n  }\n\n  return arr2;\n}\n\nfunction _iterableToArrayLimit(arr, i) {\n  var _i = arr && (typeof Symbol !== \"undefined\" && arr[Symbol.iterator] || arr[\"@@iterator\"]);\n\n  if (_i == null) return;\n  var _arr = [];\n  var _n = true;\n  var _d = false;\n\n  var _s, _e;\n\n  try {\n    for (_i = _i.call(arr); !(_n = (_s = _i.next()).done); _n = true) {\n      _arr.push(_s.value);\n\n      if (i && _arr.length === i) break;\n    }\n  } catch (err) {\n    _d = true;\n    _e = err;\n  } finally {\n    try {\n      if (!_n && _i[\"return\"] != null) _i[\"return\"]();\n    } finally {\n      if (_d) throw _e;\n    }\n  }\n\n  return _arr;\n}\n\nfunction _arrayWithHoles(arr) {\n  if (Array.isArray(arr)) return arr;\n}\n\nimport Hooks from \"../../pluginHooks.mjs\";\nimport { arrayMap, arrayEach } from \"../../helpers/array.mjs\";\nimport { rangeEach } from \"../../helpers/number.mjs\";\nimport { inherit, deepClone } from \"../../helpers/object.mjs\";\nimport { stopImmediatePropagation, isImmediatePropagationStopped } from \"../../helpers/dom/event.mjs\";\nimport { align } from \"../contextMenu/utils.mjs\";\nexport var PLUGIN_KEY = 'undoRedo';\n/**\r\n * @description\r\n * Handsontable UndoRedo plugin allows to undo and redo certain actions done in the table.\r\n *\r\n * __Note__, that not all actions are currently undo-able. The UndoRedo plugin is enabled by default.\r\n * @example\r\n * ```js\r\n * undo: true\r\n * ```\r\n * @class UndoRedo\r\n * @plugin UndoRedo\r\n * @param {Core} instance The Handsontable instance.\r\n */\n\nfunction UndoRedo(instance) {\n  var plugin = this;\n  this.instance = instance;\n  this.doneActions = [];\n  this.undoneActions = [];\n  this.ignoreNewActions = false;\n  this.enabled = false;\n  instance.addHook('afterChange', function (changes, source) {\n    var _this = this;\n\n    var changesLen = changes && changes.length;\n\n    if (!changesLen) {\n      return;\n    }\n\n    var hasDifferences = changes.find(function (change) {\n      var _change = _slicedToArray(change, 4),\n          oldValue = _change[2],\n          newValue = _change[3];\n\n      return oldValue !== newValue;\n    });\n\n    if (!hasDifferences) {\n      return;\n    }\n\n    var wrappedAction = function wrappedAction() {\n      var clonedChanges = changes.reduce(function (arr, change) {\n        arr.push(_toConsumableArray(change));\n        return arr;\n      }, []);\n      arrayEach(clonedChanges, function (change) {\n        change[1] = instance.propToCol(change[1]);\n      });\n      var selected = changesLen > 1 ? _this.getSelected() : [[clonedChanges[0][0], clonedChanges[0][1]]];\n      return new UndoRedo.ChangeAction(clonedChanges, selected);\n    };\n\n    plugin.done(wrappedAction, source);\n  });\n  instance.addHook('afterCreateRow', function (index, amount, source) {\n    plugin.done(function () {\n      return new UndoRedo.CreateRowAction(index, amount);\n    }, source);\n  });\n  instance.addHook('beforeRemoveRow', function (index, amount, logicRows, source) {\n    var wrappedAction = function wrappedAction() {\n      var originalData = plugin.instance.getSourceDataArray();\n      var rowIndex = (originalData.length + index) % originalData.length;\n      var physicalRowIndex = instance.toPhysicalRow(rowIndex);\n      var removedData = deepClone(originalData.slice(physicalRowIndex, physicalRowIndex + amount));\n      return new UndoRedo.RemoveRowAction(rowIndex, removedData, instance.getSettings().fixedRowsBottom, instance.getSettings().fixedRowsTop);\n    };\n\n    plugin.done(wrappedAction, source);\n  });\n  instance.addHook('afterCreateCol', function (index, amount, source) {\n    plugin.done(function () {\n      return new UndoRedo.CreateColumnAction(index, amount);\n    }, source);\n  });\n  instance.addHook('beforeRemoveCol', function (index, amount, logicColumns, source) {\n    var wrappedAction = function wrappedAction() {\n      var originalData = plugin.instance.getSourceDataArray();\n      var columnIndex = (plugin.instance.countCols() + index) % plugin.instance.countCols();\n      var removedData = [];\n      var headers = [];\n      var indexes = [];\n      rangeEach(originalData.length - 1, function (i) {\n        var column = [];\n        var origRow = originalData[i];\n        rangeEach(columnIndex, columnIndex + (amount - 1), function (j) {\n          column.push(origRow[instance.toPhysicalColumn(j)]);\n        });\n        removedData.push(column);\n      });\n      rangeEach(amount - 1, function (i) {\n        indexes.push(instance.toPhysicalColumn(columnIndex + i));\n      });\n\n      if (Array.isArray(instance.getSettings().colHeaders)) {\n        rangeEach(amount - 1, function (i) {\n          headers.push(instance.getSettings().colHeaders[instance.toPhysicalColumn(columnIndex + i)] || null);\n        });\n      }\n\n      var columnsMap = instance.columnIndexMapper.getIndexesSequence();\n      var rowsMap = instance.rowIndexMapper.getIndexesSequence();\n      return new UndoRedo.RemoveColumnAction(columnIndex, indexes, removedData, headers, columnsMap, rowsMap, instance.getSettings().fixedColumnsLeft);\n    };\n\n    plugin.done(wrappedAction, source);\n  });\n  instance.addHook('beforeCellAlignment', function (stateBefore, range, type, alignment) {\n    plugin.done(function () {\n      return new UndoRedo.CellAlignmentAction(stateBefore, range, type, alignment);\n    });\n  });\n  instance.addHook('beforeFilter', function (conditionsStack) {\n    plugin.done(function () {\n      return new UndoRedo.FiltersAction(conditionsStack);\n    });\n  });\n  instance.addHook('beforeRowMove', function (rows, finalIndex) {\n    if (rows === false) {\n      return;\n    }\n\n    plugin.done(function () {\n      return new UndoRedo.RowMoveAction(rows, finalIndex);\n    });\n  });\n  instance.addHook('beforeMergeCells', function (cellRange, auto) {\n    if (auto) {\n      return;\n    }\n\n    plugin.done(function () {\n      return new UndoRedo.MergeCellsAction(instance, cellRange);\n    });\n  });\n  instance.addHook('afterUnmergeCells', function (cellRange, auto) {\n    if (auto) {\n      return;\n    }\n\n    plugin.done(function () {\n      return new UndoRedo.UnmergeCellsAction(instance, cellRange);\n    });\n  }); // TODO: Why this callback is needed? One test doesn't pass after calling method right after plugin creation (outside the callback).\n\n  instance.addHook('afterInit', function () {\n    plugin.init();\n  });\n}\n/**\r\n * Stash information about performed actions.\r\n *\r\n * @function done\r\n * @memberof UndoRedo#\r\n * @fires Hooks#beforeUndoStackChange\r\n * @fires Hooks#afterUndoStackChange\r\n * @fires Hooks#beforeRedoStackChange\r\n * @fires Hooks#afterRedoStackChange\r\n * @param {Function} wrappedAction The action descriptor wrapped in a closure.\r\n * @param {string} [source] Source of the action. It is defined just for more general actions (not related to plugins).\r\n */\n\n\nUndoRedo.prototype.done = function (wrappedAction, source) {\n  if (this.ignoreNewActions) {\n    return;\n  }\n\n  var isBlockedByDefault = source === 'UndoRedo.undo' || source === 'UndoRedo.redo' || source === 'auto';\n\n  if (isBlockedByDefault) {\n    return;\n  }\n\n  var doneActionsCopy = this.doneActions.slice();\n  var continueAction = this.instance.runHooks('beforeUndoStackChange', doneActionsCopy, source);\n\n  if (continueAction === false) {\n    return;\n  }\n\n  var newAction = wrappedAction();\n  var undoneActionsCopy = this.undoneActions.slice();\n  this.doneActions.push(newAction);\n  this.instance.runHooks('afterUndoStackChange', doneActionsCopy, this.doneActions.slice());\n  this.instance.runHooks('beforeRedoStackChange', undoneActionsCopy);\n  this.undoneActions.length = 0;\n  this.instance.runHooks('afterRedoStackChange', undoneActionsCopy, this.undoneActions.slice());\n};\n/**\r\n * Undo the last action performed to the table.\r\n *\r\n * @function undo\r\n * @memberof UndoRedo#\r\n * @fires Hooks#beforeUndoStackChange\r\n * @fires Hooks#afterUndoStackChange\r\n * @fires Hooks#beforeRedoStackChange\r\n * @fires Hooks#afterRedoStackChange\r\n * @fires Hooks#beforeUndo\r\n * @fires Hooks#afterUndo\r\n */\n\n\nUndoRedo.prototype.undo = function () {\n  if (this.isUndoAvailable()) {\n    var doneActionsCopy = this.doneActions.slice();\n    this.instance.runHooks('beforeUndoStackChange', doneActionsCopy);\n    var action = this.doneActions.pop();\n    this.instance.runHooks('afterUndoStackChange', doneActionsCopy, this.doneActions.slice());\n    var actionClone = deepClone(action);\n    var continueAction = this.instance.runHooks('beforeUndo', actionClone);\n\n    if (continueAction === false) {\n      return;\n    }\n\n    this.ignoreNewActions = true;\n    var that = this;\n    var undoneActionsCopy = this.undoneActions.slice();\n    this.instance.runHooks('beforeRedoStackChange', undoneActionsCopy);\n    action.undo(this.instance, function () {\n      that.ignoreNewActions = false;\n      that.undoneActions.push(action);\n    });\n    this.instance.runHooks('afterRedoStackChange', undoneActionsCopy, this.undoneActions.slice());\n    this.instance.runHooks('afterUndo', actionClone);\n  }\n};\n/**\r\n * Redo the previous action performed to the table (used to reverse an undo).\r\n *\r\n * @function redo\r\n * @memberof UndoRedo#\r\n * @fires Hooks#beforeUndoStackChange\r\n * @fires Hooks#afterUndoStackChange\r\n * @fires Hooks#beforeRedoStackChange\r\n * @fires Hooks#afterRedoStackChange\r\n * @fires Hooks#beforeRedo\r\n * @fires Hooks#afterRedo\r\n */\n\n\nUndoRedo.prototype.redo = function () {\n  if (this.isRedoAvailable()) {\n    var undoneActionsCopy = this.undoneActions.slice();\n    this.instance.runHooks('beforeRedoStackChange', undoneActionsCopy);\n    var action = this.undoneActions.pop();\n    this.instance.runHooks('afterRedoStackChange', undoneActionsCopy, this.undoneActions.slice());\n    var actionClone = deepClone(action);\n    var continueAction = this.instance.runHooks('beforeRedo', actionClone);\n\n    if (continueAction === false) {\n      return;\n    }\n\n    this.ignoreNewActions = true;\n    var that = this;\n    var doneActionsCopy = this.doneActions.slice();\n    this.instance.runHooks('beforeUndoStackChange', doneActionsCopy);\n    action.redo(this.instance, function () {\n      that.ignoreNewActions = false;\n      that.doneActions.push(action);\n    });\n    this.instance.runHooks('afterUndoStackChange', doneActionsCopy, this.doneActions.slice());\n    this.instance.runHooks('afterRedo', actionClone);\n  }\n};\n/**\r\n * Checks if undo action is available.\r\n *\r\n * @function isUndoAvailable\r\n * @memberof UndoRedo#\r\n * @returns {boolean} Return `true` if undo can be performed, `false` otherwise.\r\n */\n\n\nUndoRedo.prototype.isUndoAvailable = function () {\n  return this.doneActions.length > 0;\n};\n/**\r\n * Checks if redo action is available.\r\n *\r\n * @function isRedoAvailable\r\n * @memberof UndoRedo#\r\n * @returns {boolean} Return `true` if redo can be performed, `false` otherwise.\r\n */\n\n\nUndoRedo.prototype.isRedoAvailable = function () {\n  return this.undoneActions.length > 0;\n};\n/**\r\n * Clears undo history.\r\n *\r\n * @function clear\r\n * @memberof UndoRedo#\r\n */\n\n\nUndoRedo.prototype.clear = function () {\n  this.doneActions.length = 0;\n  this.undoneActions.length = 0;\n};\n/**\r\n * Checks if the plugin is enabled.\r\n *\r\n * @function isEnabled\r\n * @memberof UndoRedo#\r\n * @returns {boolean}\r\n */\n\n\nUndoRedo.prototype.isEnabled = function () {\n  return this.enabled;\n};\n/**\r\n * Enables the plugin.\r\n *\r\n * @function enable\r\n * @memberof UndoRedo#\r\n */\n\n\nUndoRedo.prototype.enable = function () {\n  if (this.isEnabled()) {\n    return;\n  }\n\n  var hot = this.instance;\n  this.enabled = true;\n  exposeUndoRedoMethods(hot);\n  hot.addHook('beforeKeyDown', onBeforeKeyDown);\n  hot.addHook('afterChange', onAfterChange);\n};\n/**\r\n * Disables the plugin.\r\n *\r\n * @function disable\r\n * @memberof UndoRedo#\r\n */\n\n\nUndoRedo.prototype.disable = function () {\n  if (!this.isEnabled()) {\n    return;\n  }\n\n  var hot = this.instance;\n  this.enabled = false;\n  removeExposedUndoRedoMethods(hot);\n  hot.removeHook('beforeKeyDown', onBeforeKeyDown);\n  hot.removeHook('afterChange', onAfterChange);\n};\n/**\r\n * Destroys the instance.\r\n *\r\n * @function destroy\r\n * @memberof UndoRedo#\r\n */\n\n\nUndoRedo.prototype.destroy = function () {\n  this.clear();\n  this.instance = null;\n  this.doneActions = null;\n  this.undoneActions = null;\n};\n\nUndoRedo.Action = function () {};\n\nUndoRedo.Action.prototype.undo = function () {};\n\nUndoRedo.Action.prototype.redo = function () {};\n/**\r\n * Change action.\r\n *\r\n * @private\r\n * @param {Array} changes 2D array containing information about each of the edited cells.\r\n * @param {number[]} selected The cell selection.\r\n */\n\n\nUndoRedo.ChangeAction = function (changes, selected) {\n  this.changes = changes;\n  this.selected = selected;\n  this.actionType = 'change';\n};\n\ninherit(UndoRedo.ChangeAction, UndoRedo.Action);\n\nUndoRedo.ChangeAction.prototype.undo = function (instance, undoneCallback) {\n  var data = deepClone(this.changes);\n  var emptyRowsAtTheEnd = instance.countEmptyRows(true);\n  var emptyColsAtTheEnd = instance.countEmptyCols(true);\n\n  for (var i = 0, len = data.length; i < len; i++) {\n    data[i].splice(3, 1);\n  }\n\n  instance.addHookOnce('afterChange', undoneCallback);\n  instance.setDataAtCell(data, null, null, 'UndoRedo.undo');\n\n  for (var _i2 = 0, _len = data.length; _i2 < _len; _i2++) {\n    var _data$_i = _slicedToArray(data[_i2], 2),\n        row = _data$_i[0],\n        column = _data$_i[1];\n\n    if (instance.getSettings().minSpareRows && row + 1 + instance.getSettings().minSpareRows === instance.countRows() && emptyRowsAtTheEnd === instance.getSettings().minSpareRows) {\n      instance.alter('remove_row', parseInt(row + 1, 10), instance.getSettings().minSpareRows);\n      instance.undoRedo.doneActions.pop();\n    }\n\n    if (instance.getSettings().minSpareCols && column + 1 + instance.getSettings().minSpareCols === instance.countCols() && emptyColsAtTheEnd === instance.getSettings().minSpareCols) {\n      instance.alter('remove_col', parseInt(column + 1, 10), instance.getSettings().minSpareCols);\n      instance.undoRedo.doneActions.pop();\n    }\n  }\n\n  instance.selectCells(this.selected, false, false);\n};\n\nUndoRedo.ChangeAction.prototype.redo = function (instance, onFinishCallback) {\n  var data = deepClone(this.changes);\n\n  for (var i = 0, len = data.length; i < len; i++) {\n    data[i].splice(2, 1);\n  }\n\n  instance.addHookOnce('afterChange', onFinishCallback);\n  instance.setDataAtCell(data, null, null, 'UndoRedo.redo');\n\n  if (this.selected) {\n    instance.selectCells(this.selected, false, false);\n  }\n};\n/**\r\n * Create row action.\r\n *\r\n * @private\r\n * @param {number} index The visual row index.\r\n * @param {number} amount The number of created rows.\r\n */\n\n\nUndoRedo.CreateRowAction = function (index, amount) {\n  this.index = index;\n  this.amount = amount;\n  this.actionType = 'insert_row';\n};\n\ninherit(UndoRedo.CreateRowAction, UndoRedo.Action);\n\nUndoRedo.CreateRowAction.prototype.undo = function (instance, undoneCallback) {\n  var rowCount = instance.countRows();\n  var minSpareRows = instance.getSettings().minSpareRows;\n\n  if (this.index >= rowCount && this.index - minSpareRows < rowCount) {\n    this.index -= minSpareRows; // work around the situation where the needed row was removed due to an 'undo' of a made change\n  }\n\n  instance.addHookOnce('afterRemoveRow', undoneCallback);\n  instance.alter('remove_row', this.index, this.amount, 'UndoRedo.undo');\n};\n\nUndoRedo.CreateRowAction.prototype.redo = function (instance, redoneCallback) {\n  instance.addHookOnce('afterCreateRow', redoneCallback);\n  instance.alter('insert_row', this.index, this.amount, 'UndoRedo.redo');\n};\n/**\r\n * Remove row action.\r\n *\r\n * @private\r\n * @param {number} index The visual row index.\r\n * @param {Array} data The removed data.\r\n * @param {number} fixedRowsBottom Number of fixed rows on the bottom. Remove row action change it sometimes.\r\n * @param {number} fixedRowsTop Number of fixed rows on the top. Remove row action change it sometimes.\r\n */\n\n\nUndoRedo.RemoveRowAction = function (index, data, fixedRowsBottom, fixedRowsTop) {\n  this.index = index;\n  this.data = data;\n  this.actionType = 'remove_row';\n  this.fixedRowsBottom = fixedRowsBottom;\n  this.fixedRowsTop = fixedRowsTop;\n};\n\ninherit(UndoRedo.RemoveRowAction, UndoRedo.Action);\n\nUndoRedo.RemoveRowAction.prototype.undo = function (instance, undoneCallback) {\n  var settings = instance.getSettings(); // Changing by the reference as `updateSettings` doesn't work the best.\n\n  settings.fixedRowsBottom = this.fixedRowsBottom;\n  settings.fixedRowsTop = this.fixedRowsTop;\n  instance.alter('insert_row', this.index, this.data.length, 'UndoRedo.undo');\n  instance.addHookOnce('afterRender', undoneCallback);\n  instance.populateFromArray(this.index, 0, this.data, void 0, void 0, 'UndoRedo.undo');\n};\n\nUndoRedo.RemoveRowAction.prototype.redo = function (instance, redoneCallback) {\n  instance.addHookOnce('afterRemoveRow', redoneCallback);\n  instance.alter('remove_row', this.index, this.data.length, 'UndoRedo.redo');\n};\n/**\r\n * Create column action.\r\n *\r\n * @private\r\n * @param {number} index The visual column index.\r\n * @param {number} amount The number of created columns.\r\n */\n\n\nUndoRedo.CreateColumnAction = function (index, amount) {\n  this.index = index;\n  this.amount = amount;\n  this.actionType = 'insert_col';\n};\n\ninherit(UndoRedo.CreateColumnAction, UndoRedo.Action);\n\nUndoRedo.CreateColumnAction.prototype.undo = function (instance, undoneCallback) {\n  instance.addHookOnce('afterRemoveCol', undoneCallback);\n  instance.alter('remove_col', this.index, this.amount, 'UndoRedo.undo');\n};\n\nUndoRedo.CreateColumnAction.prototype.redo = function (instance, redoneCallback) {\n  instance.addHookOnce('afterCreateCol', redoneCallback);\n  instance.alter('insert_col', this.index, this.amount, 'UndoRedo.redo');\n};\n/**\r\n * Remove column action.\r\n *\r\n * @private\r\n * @param {number} index The visual column index.\r\n * @param {number[]} indexes The visual column indexes.\r\n * @param {Array} data The removed data.\r\n * @param {Array} headers The header values.\r\n * @param {number[]} columnPositions The column position.\r\n * @param {number[]} rowPositions The row position.\r\n * @param {number} fixedColumnsLeft Number of fixed columns on the left. Remove column action change it sometimes.\r\n */\n\n\nUndoRedo.RemoveColumnAction = function (index, indexes, data, headers, columnPositions, rowPositions, fixedColumnsLeft) {\n  this.index = index;\n  this.indexes = indexes;\n  this.data = data;\n  this.amount = this.data[0].length;\n  this.headers = headers;\n  this.columnPositions = columnPositions.slice(0);\n  this.rowPositions = rowPositions.slice(0);\n  this.actionType = 'remove_col';\n  this.fixedColumnsLeft = fixedColumnsLeft;\n};\n\ninherit(UndoRedo.RemoveColumnAction, UndoRedo.Action);\n\nUndoRedo.RemoveColumnAction.prototype.undo = function (instance, undoneCallback) {\n  var _this2 = this;\n\n  var settings = instance.getSettings(); // Changing by the reference as `updateSettings` doesn't work the best.\n\n  settings.fixedColumnsLeft = this.fixedColumnsLeft;\n  var ascendingIndexes = this.indexes.slice(0).sort();\n\n  var sortByIndexes = function sortByIndexes(elem, j, arr) {\n    return arr[_this2.indexes.indexOf(ascendingIndexes[j])];\n  };\n\n  var removedDataLength = this.data.length;\n  var sortedData = [];\n\n  for (var rowIndex = 0; rowIndex < removedDataLength; rowIndex++) {\n    sortedData.push(arrayMap(this.data[rowIndex], sortByIndexes));\n  }\n\n  var sortedHeaders = arrayMap(this.headers, sortByIndexes);\n  var changes = [];\n  instance.alter('insert_col', this.indexes[0], this.indexes.length, 'UndoRedo.undo');\n  arrayEach(instance.getSourceDataArray(), function (rowData, rowIndex) {\n    arrayEach(ascendingIndexes, function (changedIndex, contiquesIndex) {\n      rowData[changedIndex] = sortedData[rowIndex][contiquesIndex];\n      changes.push([rowIndex, changedIndex, rowData[changedIndex]]);\n    });\n  });\n  instance.setSourceDataAtCell(changes);\n  instance.columnIndexMapper.insertIndexes(ascendingIndexes[0], ascendingIndexes.length);\n\n  if (typeof this.headers !== 'undefined') {\n    arrayEach(sortedHeaders, function (headerData, columnIndex) {\n      instance.getSettings().colHeaders[ascendingIndexes[columnIndex]] = headerData;\n    });\n  }\n\n  instance.batchExecution(function () {\n    // Restore row sequence in a case when all columns are removed. the original\n    // row sequence is lost in that case.\n    instance.rowIndexMapper.setIndexesSequence(_this2.rowPositions);\n    instance.columnIndexMapper.setIndexesSequence(_this2.columnPositions);\n  }, true);\n  instance.addHookOnce('afterRender', undoneCallback);\n  instance.render();\n};\n\nUndoRedo.RemoveColumnAction.prototype.redo = function (instance, redoneCallback) {\n  instance.addHookOnce('afterRemoveCol', redoneCallback);\n  instance.alter('remove_col', this.index, this.amount, 'UndoRedo.redo');\n};\n/**\r\n * Cell alignment action.\r\n *\r\n * @private\r\n * @param {Array} stateBefore The previous state.\r\n * @param {object} range The cell range.\r\n * @param {string} type The type of the alignment (\"top\", \"left\", \"bottom\" or \"right\").\r\n * @param {string} alignment The alignment CSS class.\r\n */\n\n\nUndoRedo.CellAlignmentAction = function (stateBefore, range, type, alignment) {\n  this.stateBefore = stateBefore;\n  this.range = range;\n  this.type = type;\n  this.alignment = alignment;\n};\n\nUndoRedo.CellAlignmentAction.prototype.undo = function (instance, undoneCallback) {\n  var _this3 = this;\n\n  arrayEach(this.range, function (range) {\n    range.forAll(function (row, col) {\n      // Alignment classes should only collected within cell ranges. We skip header coordinates.\n      if (row >= 0 && col >= 0) {\n        instance.setCellMeta(row, col, 'className', _this3.stateBefore[row][col] || ' htLeft');\n      }\n    });\n  });\n  instance.addHookOnce('afterRender', undoneCallback);\n  instance.render();\n};\n\nUndoRedo.CellAlignmentAction.prototype.redo = function (instance, undoneCallback) {\n  align(this.range, this.type, this.alignment, function (row, col) {\n    return instance.getCellMeta(row, col);\n  }, function (row, col, key, value) {\n    return instance.setCellMeta(row, col, key, value);\n  });\n  instance.addHookOnce('afterRender', undoneCallback);\n  instance.render();\n};\n/**\r\n * Filters action.\r\n *\r\n * @private\r\n * @param {Array} conditionsStack An array of the filter condition.\r\n */\n\n\nUndoRedo.FiltersAction = function (conditionsStack) {\n  this.conditionsStack = conditionsStack;\n  this.actionType = 'filter';\n};\n\ninherit(UndoRedo.FiltersAction, UndoRedo.Action);\n\nUndoRedo.FiltersAction.prototype.undo = function (instance, undoneCallback) {\n  var filters = instance.getPlugin('filters');\n  instance.addHookOnce('afterRender', undoneCallback);\n  filters.conditionCollection.importAllConditions(this.conditionsStack.slice(0, this.conditionsStack.length - 1));\n  filters.filter();\n};\n\nUndoRedo.FiltersAction.prototype.redo = function (instance, redoneCallback) {\n  var filters = instance.getPlugin('filters');\n  instance.addHookOnce('afterRender', redoneCallback);\n  filters.conditionCollection.importAllConditions(this.conditionsStack);\n  filters.filter();\n};\n/**\r\n * Merge Cells action.\r\n *\r\n * @util\r\n */\n\n\nvar MergeCellsAction = /*#__PURE__*/function (_UndoRedo$Action) {\n  _inherits(MergeCellsAction, _UndoRedo$Action);\n\n  var _super = _createSuper(MergeCellsAction);\n\n  function MergeCellsAction(instance, cellRange) {\n    var _this4;\n\n    _classCallCheck(this, MergeCellsAction);\n\n    _this4 = _super.call(this);\n    _this4.cellRange = cellRange;\n\n    var topLeftCorner = _this4.cellRange.getTopLeftCorner();\n\n    var bottomRightCorner = _this4.cellRange.getBottomRightCorner();\n\n    _this4.rangeData = instance.getData(topLeftCorner.row, topLeftCorner.col, bottomRightCorner.row, bottomRightCorner.col);\n    return _this4;\n  }\n\n  _createClass(MergeCellsAction, [{\n    key: \"undo\",\n    value: function undo(instance, undoneCallback) {\n      var mergeCellsPlugin = instance.getPlugin('mergeCells');\n      instance.addHookOnce('afterRender', undoneCallback);\n      mergeCellsPlugin.unmergeRange(this.cellRange, true);\n      var topLeftCorner = this.cellRange.getTopLeftCorner();\n      instance.populateFromArray(topLeftCorner.row, topLeftCorner.col, this.rangeData, void 0, void 0, 'MergeCells');\n    }\n  }, {\n    key: \"redo\",\n    value: function redo(instance, redoneCallback) {\n      var mergeCellsPlugin = instance.getPlugin('mergeCells');\n      instance.addHookOnce('afterRender', redoneCallback);\n      mergeCellsPlugin.mergeRange(this.cellRange);\n    }\n  }]);\n\n  return MergeCellsAction;\n}(UndoRedo.Action);\n\nUndoRedo.MergeCellsAction = MergeCellsAction;\n/**\r\n * Unmerge Cells action.\r\n *\r\n * @util\r\n */\n\nvar UnmergeCellsAction = /*#__PURE__*/function (_UndoRedo$Action2) {\n  _inherits(UnmergeCellsAction, _UndoRedo$Action2);\n\n  var _super2 = _createSuper(UnmergeCellsAction);\n\n  function UnmergeCellsAction(instance, cellRange) {\n    var _this5;\n\n    _classCallCheck(this, UnmergeCellsAction);\n\n    _this5 = _super2.call(this);\n    _this5.cellRange = cellRange;\n    return _this5;\n  }\n\n  _createClass(UnmergeCellsAction, [{\n    key: \"undo\",\n    value: function undo(instance, undoneCallback) {\n      var mergeCellsPlugin = instance.getPlugin('mergeCells');\n      instance.addHookOnce('afterRender', undoneCallback);\n      mergeCellsPlugin.mergeRange(this.cellRange, true);\n    }\n  }, {\n    key: \"redo\",\n    value: function redo(instance, redoneCallback) {\n      var mergeCellsPlugin = instance.getPlugin('mergeCells');\n      instance.addHookOnce('afterRender', redoneCallback);\n      mergeCellsPlugin.unmergeRange(this.cellRange, true);\n      instance.render();\n    }\n  }]);\n\n  return UnmergeCellsAction;\n}(UndoRedo.Action);\n\nUndoRedo.UnmergeCellsAction = UnmergeCellsAction;\n/**\r\n * ManualRowMove action.\r\n *\r\n * @TODO removeRow undo should works on logical index\r\n * @private\r\n * @param {number[]} rows An array with moved rows.\r\n * @param {number} finalIndex The destination index.\r\n */\n\nUndoRedo.RowMoveAction = function (rows, finalIndex) {\n  this.rows = rows.slice();\n  this.finalIndex = finalIndex;\n};\n\ninherit(UndoRedo.RowMoveAction, UndoRedo.Action);\n\nUndoRedo.RowMoveAction.prototype.undo = function (instance, undoneCallback) {\n  var _this6 = this;\n\n  var manualRowMove = instance.getPlugin('manualRowMove');\n  var copyOfRows = [].concat(this.rows);\n  var rowsMovedUp = copyOfRows.filter(function (a) {\n    return a > _this6.finalIndex;\n  });\n  var rowsMovedDown = copyOfRows.filter(function (a) {\n    return a <= _this6.finalIndex;\n  });\n  var allMovedRows = rowsMovedUp.sort(function (a, b) {\n    return b - a;\n  }).concat(rowsMovedDown.sort(function (a, b) {\n    return a - b;\n  }));\n  instance.addHookOnce('afterRender', undoneCallback); // Moving rows from those with higher indexes to those with lower indexes when action was performed from bottom to top\n  // Moving rows from those with lower indexes to those with higher indexes when action was performed from top to bottom\n\n  for (var i = 0; i < allMovedRows.length; i += 1) {\n    var newPhysicalRow = instance.toVisualRow(allMovedRows[i]);\n    manualRowMove.moveRow(newPhysicalRow, allMovedRows[i]);\n  }\n\n  instance.render();\n  instance.deselectCell();\n  instance.selectRows(this.rows[0], this.rows[0] + this.rows.length - 1);\n};\n\nUndoRedo.RowMoveAction.prototype.redo = function (instance, redoneCallback) {\n  var manualRowMove = instance.getPlugin('manualRowMove');\n  instance.addHookOnce('afterRender', redoneCallback);\n  manualRowMove.moveRows(this.rows.slice(), this.finalIndex);\n  instance.render();\n  instance.deselectCell();\n  instance.selectRows(this.finalIndex, this.finalIndex + this.rows.length - 1);\n};\n/**\r\n * Enabling and disabling plugin and attaching its to an instance.\r\n *\r\n * @private\r\n */\n\n\nUndoRedo.prototype.init = function () {\n  var settings = this.instance.getSettings().undo;\n  var pluginEnabled = typeof settings === 'undefined' || settings;\n\n  if (!this.instance.undoRedo) {\n    /**\r\n     * Instance of Handsontable.UndoRedo Plugin {@link Handsontable.UndoRedo}.\r\n     *\r\n     * @alias undoRedo\r\n     * @memberof! Handsontable.Core#\r\n     * @type {UndoRedo}\r\n     */\n    this.instance.undoRedo = this;\n  }\n\n  if (pluginEnabled) {\n    this.instance.undoRedo.enable();\n  } else {\n    this.instance.undoRedo.disable();\n  }\n};\n/**\r\n * @param {Event} event The keyboard event object.\r\n */\n\n\nfunction onBeforeKeyDown(event) {\n  if (isImmediatePropagationStopped(event)) {\n    return;\n  }\n\n  var instance = this;\n  var editor = instance.getActiveEditor();\n\n  if (editor && editor.isOpened()) {\n    return;\n  }\n\n  var altKey = event.altKey,\n      ctrlKey = event.ctrlKey,\n      keyCode = event.keyCode,\n      metaKey = event.metaKey,\n      shiftKey = event.shiftKey;\n  var isCtrlDown = (ctrlKey || metaKey) && !altKey;\n\n  if (!isCtrlDown) {\n    return;\n  }\n\n  var isRedoHotkey = keyCode === 89 || shiftKey && keyCode === 90;\n\n  if (isRedoHotkey) {\n    // CTRL + Y or CTRL + SHIFT + Z\n    instance.undoRedo.redo();\n    stopImmediatePropagation(event);\n  } else if (keyCode === 90) {\n    // CTRL + Z\n    instance.undoRedo.undo();\n    stopImmediatePropagation(event);\n  }\n}\n/**\r\n * @param {Array} changes 2D array containing information about each of the edited cells.\r\n * @param {string} source String that identifies source of hook call.\r\n * @returns {boolean}\r\n */\n\n\nfunction onAfterChange(changes, source) {\n  var instance = this;\n\n  if (source === 'loadData') {\n    return instance.undoRedo.clear();\n  }\n}\n/**\r\n * @param {Core} instance The Handsontable instance.\r\n */\n\n\nfunction exposeUndoRedoMethods(instance) {\n  /**\r\n   * {@link UndoRedo#undo}.\r\n   *\r\n   * @alias undo\r\n   * @memberof! Handsontable.Core#\r\n   * @returns {boolean}\r\n   */\n  instance.undo = function () {\n    return instance.undoRedo.undo();\n  };\n  /**\r\n   * {@link UndoRedo#redo}.\r\n   *\r\n   * @alias redo\r\n   * @memberof! Handsontable.Core#\r\n   * @returns {boolean}\r\n   */\n\n\n  instance.redo = function () {\n    return instance.undoRedo.redo();\n  };\n  /**\r\n   * {@link UndoRedo#isUndoAvailable}.\r\n   *\r\n   * @alias isUndoAvailable\r\n   * @memberof! Handsontable.Core#\r\n   * @returns {boolean}\r\n   */\n\n\n  instance.isUndoAvailable = function () {\n    return instance.undoRedo.isUndoAvailable();\n  };\n  /**\r\n   * {@link UndoRedo#isRedoAvailable}.\r\n   *\r\n   * @alias isRedoAvailable\r\n   * @memberof! Handsontable.Core#\r\n   * @returns {boolean}\r\n   */\n\n\n  instance.isRedoAvailable = function () {\n    return instance.undoRedo.isRedoAvailable();\n  };\n  /**\r\n   * {@link UndoRedo#clear}.\r\n   *\r\n   * @alias clearUndo\r\n   * @memberof! Handsontable.Core#\r\n   * @returns {boolean}\r\n   */\n\n\n  instance.clearUndo = function () {\n    return instance.undoRedo.clear();\n  };\n}\n/**\r\n * @param {Core} instance The Handsontable instance.\r\n */\n\n\nfunction removeExposedUndoRedoMethods(instance) {\n  delete instance.undo;\n  delete instance.redo;\n  delete instance.isUndoAvailable;\n  delete instance.isRedoAvailable;\n  delete instance.clearUndo;\n}\n\nvar hook = Hooks.getSingleton();\nhook.add('afterUpdateSettings', function () {\n  this.getPlugin('undoRedo').init();\n});\nhook.register('beforeUndo');\nhook.register('afterUndo');\nhook.register('beforeRedo');\nhook.register('afterRedo');\nUndoRedo.PLUGIN_KEY = PLUGIN_KEY;\nexport default UndoRedo;","map":{"version":3,"sources":["C:/xampp/htdocs/isotracker-dev/isotracker-react/node_modules/handsontable/plugins/undoRedo/undoRedo.mjs"],"names":["_typeof","obj","Symbol","iterator","constructor","prototype","_classCallCheck","instance","Constructor","TypeError","_defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","Object","defineProperty","key","_createClass","protoProps","staticProps","_inherits","subClass","superClass","create","value","_setPrototypeOf","o","p","setPrototypeOf","__proto__","_createSuper","Derived","hasNativeReflectConstruct","_isNativeReflectConstruct","_createSuperInternal","Super","_getPrototypeOf","result","NewTarget","Reflect","construct","arguments","apply","_possibleConstructorReturn","self","call","_assertThisInitialized","ReferenceError","sham","Proxy","Boolean","valueOf","e","getPrototypeOf","_toConsumableArray","arr","_arrayWithoutHoles","_iterableToArray","_unsupportedIterableToArray","_nonIterableSpread","iter","Array","from","isArray","_arrayLikeToArray","_slicedToArray","_arrayWithHoles","_iterableToArrayLimit","_nonIterableRest","minLen","n","toString","slice","name","test","len","arr2","_i","_arr","_n","_d","_s","_e","next","done","push","err","Hooks","arrayMap","arrayEach","rangeEach","inherit","deepClone","stopImmediatePropagation","isImmediatePropagationStopped","align","PLUGIN_KEY","UndoRedo","plugin","doneActions","undoneActions","ignoreNewActions","enabled","addHook","changes","source","_this","changesLen","hasDifferences","find","change","_change","oldValue","newValue","wrappedAction","clonedChanges","reduce","propToCol","selected","getSelected","ChangeAction","index","amount","CreateRowAction","logicRows","originalData","getSourceDataArray","rowIndex","physicalRowIndex","toPhysicalRow","removedData","RemoveRowAction","getSettings","fixedRowsBottom","fixedRowsTop","CreateColumnAction","logicColumns","columnIndex","countCols","headers","indexes","column","origRow","j","toPhysicalColumn","colHeaders","columnsMap","columnIndexMapper","getIndexesSequence","rowsMap","rowIndexMapper","RemoveColumnAction","fixedColumnsLeft","stateBefore","range","type","alignment","CellAlignmentAction","conditionsStack","FiltersAction","rows","finalIndex","RowMoveAction","cellRange","auto","MergeCellsAction","UnmergeCellsAction","init","isBlockedByDefault","doneActionsCopy","continueAction","runHooks","newAction","undoneActionsCopy","undo","isUndoAvailable","action","pop","actionClone","that","redo","isRedoAvailable","clear","isEnabled","enable","hot","exposeUndoRedoMethods","onBeforeKeyDown","onAfterChange","disable","removeExposedUndoRedoMethods","removeHook","destroy","Action","actionType","undoneCallback","data","emptyRowsAtTheEnd","countEmptyRows","emptyColsAtTheEnd","countEmptyCols","splice","addHookOnce","setDataAtCell","_i2","_len","_data$_i","row","minSpareRows","countRows","alter","parseInt","undoRedo","minSpareCols","selectCells","onFinishCallback","rowCount","redoneCallback","settings","populateFromArray","columnPositions","rowPositions","_this2","ascendingIndexes","sort","sortByIndexes","elem","indexOf","removedDataLength","sortedData","sortedHeaders","rowData","changedIndex","contiquesIndex","setSourceDataAtCell","insertIndexes","headerData","batchExecution","setIndexesSequence","render","_this3","forAll","col","setCellMeta","getCellMeta","filters","getPlugin","conditionCollection","importAllConditions","filter","_UndoRedo$Action","_super","_this4","topLeftCorner","getTopLeftCorner","bottomRightCorner","getBottomRightCorner","rangeData","getData","mergeCellsPlugin","unmergeRange","mergeRange","_UndoRedo$Action2","_super2","_this5","_this6","manualRowMove","copyOfRows","concat","rowsMovedUp","a","rowsMovedDown","allMovedRows","b","newPhysicalRow","toVisualRow","moveRow","deselectCell","selectRows","moveRows","pluginEnabled","event","editor","getActiveEditor","isOpened","altKey","ctrlKey","keyCode","metaKey","shiftKey","isCtrlDown","isRedoHotkey","clearUndo","hook","getSingleton","add","register"],"mappings":"AAAA,SAASA,OAAT,CAAiBC,GAAjB,EAAsB;AAAE;;AAA2B,MAAI,OAAOC,MAAP,KAAkB,UAAlB,IAAgC,OAAOA,MAAM,CAACC,QAAd,KAA2B,QAA/D,EAAyE;AAAEH,IAAAA,OAAO,GAAG,SAASA,OAAT,CAAiBC,GAAjB,EAAsB;AAAE,aAAO,OAAOA,GAAd;AAAoB,KAAtD;AAAyD,GAApI,MAA0I;AAAED,IAAAA,OAAO,GAAG,SAASA,OAAT,CAAiBC,GAAjB,EAAsB;AAAE,aAAOA,GAAG,IAAI,OAAOC,MAAP,KAAkB,UAAzB,IAAuCD,GAAG,CAACG,WAAJ,KAAoBF,MAA3D,IAAqED,GAAG,KAAKC,MAAM,CAACG,SAApF,GAAgG,QAAhG,GAA2G,OAAOJ,GAAzH;AAA+H,KAAjK;AAAoK;;AAAC,SAAOD,OAAO,CAACC,GAAD,CAAd;AAAsB;;AAE1X,SAASK,eAAT,CAAyBC,QAAzB,EAAmCC,WAAnC,EAAgD;AAAE,MAAI,EAAED,QAAQ,YAAYC,WAAtB,CAAJ,EAAwC;AAAE,UAAM,IAAIC,SAAJ,CAAc,mCAAd,CAAN;AAA2D;AAAE;;AAEzJ,SAASC,iBAAT,CAA2BC,MAA3B,EAAmCC,KAAnC,EAA0C;AAAE,OAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGD,KAAK,CAACE,MAA1B,EAAkCD,CAAC,EAAnC,EAAuC;AAAE,QAAIE,UAAU,GAAGH,KAAK,CAACC,CAAD,CAAtB;AAA2BE,IAAAA,UAAU,CAACC,UAAX,GAAwBD,UAAU,CAACC,UAAX,IAAyB,KAAjD;AAAwDD,IAAAA,UAAU,CAACE,YAAX,GAA0B,IAA1B;AAAgC,QAAI,WAAWF,UAAf,EAA2BA,UAAU,CAACG,QAAX,GAAsB,IAAtB;AAA4BC,IAAAA,MAAM,CAACC,cAAP,CAAsBT,MAAtB,EAA8BI,UAAU,CAACM,GAAzC,EAA8CN,UAA9C;AAA4D;AAAE;;AAE7T,SAASO,YAAT,CAAsBd,WAAtB,EAAmCe,UAAnC,EAA+CC,WAA/C,EAA4D;AAAE,MAAID,UAAJ,EAAgBb,iBAAiB,CAACF,WAAW,CAACH,SAAb,EAAwBkB,UAAxB,CAAjB;AAAsD,MAAIC,WAAJ,EAAiBd,iBAAiB,CAACF,WAAD,EAAcgB,WAAd,CAAjB;AAA6C,SAAOhB,WAAP;AAAqB;;AAEvN,SAASiB,SAAT,CAAmBC,QAAnB,EAA6BC,UAA7B,EAAyC;AAAE,MAAI,OAAOA,UAAP,KAAsB,UAAtB,IAAoCA,UAAU,KAAK,IAAvD,EAA6D;AAAE,UAAM,IAAIlB,SAAJ,CAAc,oDAAd,CAAN;AAA4E;;AAACiB,EAAAA,QAAQ,CAACrB,SAAT,GAAqBc,MAAM,CAACS,MAAP,CAAcD,UAAU,IAAIA,UAAU,CAACtB,SAAvC,EAAkD;AAAED,IAAAA,WAAW,EAAE;AAAEyB,MAAAA,KAAK,EAAEH,QAAT;AAAmBR,MAAAA,QAAQ,EAAE,IAA7B;AAAmCD,MAAAA,YAAY,EAAE;AAAjD;AAAf,GAAlD,CAArB;AAAkJ,MAAIU,UAAJ,EAAgBG,eAAe,CAACJ,QAAD,EAAWC,UAAX,CAAf;AAAwC;;AAEjY,SAASG,eAAT,CAAyBC,CAAzB,EAA4BC,CAA5B,EAA+B;AAAEF,EAAAA,eAAe,GAAGX,MAAM,CAACc,cAAP,IAAyB,SAASH,eAAT,CAAyBC,CAAzB,EAA4BC,CAA5B,EAA+B;AAAED,IAAAA,CAAC,CAACG,SAAF,GAAcF,CAAd;AAAiB,WAAOD,CAAP;AAAW,GAAxG;;AAA0G,SAAOD,eAAe,CAACC,CAAD,EAAIC,CAAJ,CAAtB;AAA+B;;AAE1K,SAASG,YAAT,CAAsBC,OAAtB,EAA+B;AAAE,MAAIC,yBAAyB,GAAGC,yBAAyB,EAAzD;;AAA6D,SAAO,SAASC,oBAAT,GAAgC;AAAE,QAAIC,KAAK,GAAGC,eAAe,CAACL,OAAD,CAA3B;AAAA,QAAsCM,MAAtC;;AAA8C,QAAIL,yBAAJ,EAA+B;AAAE,UAAIM,SAAS,GAAGF,eAAe,CAAC,IAAD,CAAf,CAAsBrC,WAAtC;;AAAmDsC,MAAAA,MAAM,GAAGE,OAAO,CAACC,SAAR,CAAkBL,KAAlB,EAAyBM,SAAzB,EAAoCH,SAApC,CAAT;AAA0D,KAA9I,MAAoJ;AAAED,MAAAA,MAAM,GAAGF,KAAK,CAACO,KAAN,CAAY,IAAZ,EAAkBD,SAAlB,CAAT;AAAwC;;AAAC,WAAOE,0BAA0B,CAAC,IAAD,EAAON,MAAP,CAAjC;AAAkD,GAAxU;AAA2U;;AAEza,SAASM,0BAAT,CAAoCC,IAApC,EAA0CC,IAA1C,EAAgD;AAAE,MAAIA,IAAI,KAAKlD,OAAO,CAACkD,IAAD,CAAP,KAAkB,QAAlB,IAA8B,OAAOA,IAAP,KAAgB,UAAnD,CAAR,EAAwE;AAAE,WAAOA,IAAP;AAAc;;AAAC,SAAOC,sBAAsB,CAACF,IAAD,CAA7B;AAAsC;;AAEjL,SAASE,sBAAT,CAAgCF,IAAhC,EAAsC;AAAE,MAAIA,IAAI,KAAK,KAAK,CAAlB,EAAqB;AAAE,UAAM,IAAIG,cAAJ,CAAmB,2DAAnB,CAAN;AAAwF;;AAAC,SAAOH,IAAP;AAAc;;AAEtK,SAASX,yBAAT,GAAqC;AAAE,MAAI,OAAOM,OAAP,KAAmB,WAAnB,IAAkC,CAACA,OAAO,CAACC,SAA/C,EAA0D,OAAO,KAAP;AAAc,MAAID,OAAO,CAACC,SAAR,CAAkBQ,IAAtB,EAA4B,OAAO,KAAP;AAAc,MAAI,OAAOC,KAAP,KAAiB,UAArB,EAAiC,OAAO,IAAP;;AAAa,MAAI;AAAEC,IAAAA,OAAO,CAAClD,SAAR,CAAkBmD,OAAlB,CAA0BN,IAA1B,CAA+BN,OAAO,CAACC,SAAR,CAAkBU,OAAlB,EAA2B,EAA3B,EAA+B,YAAY,CAAE,CAA7C,CAA/B;AAAgF,WAAO,IAAP;AAAc,GAApG,CAAqG,OAAOE,CAAP,EAAU;AAAE,WAAO,KAAP;AAAe;AAAE;;AAEzU,SAAShB,eAAT,CAAyBV,CAAzB,EAA4B;AAAEU,EAAAA,eAAe,GAAGtB,MAAM,CAACc,cAAP,GAAwBd,MAAM,CAACuC,cAA/B,GAAgD,SAASjB,eAAT,CAAyBV,CAAzB,EAA4B;AAAE,WAAOA,CAAC,CAACG,SAAF,IAAef,MAAM,CAACuC,cAAP,CAAsB3B,CAAtB,CAAtB;AAAiD,GAAjJ;AAAmJ,SAAOU,eAAe,CAACV,CAAD,CAAtB;AAA4B;;AAE7M,SAAS4B,kBAAT,CAA4BC,GAA5B,EAAiC;AAAE,SAAOC,kBAAkB,CAACD,GAAD,CAAlB,IAA2BE,gBAAgB,CAACF,GAAD,CAA3C,IAAoDG,2BAA2B,CAACH,GAAD,CAA/E,IAAwFI,kBAAkB,EAAjH;AAAsH;;AAEzJ,SAASA,kBAAT,GAA8B;AAAE,QAAM,IAAIvD,SAAJ,CAAc,sIAAd,CAAN;AAA8J;;AAE9L,SAASqD,gBAAT,CAA0BG,IAA1B,EAAgC;AAAE,MAAI,OAAO/D,MAAP,KAAkB,WAAlB,IAAiC+D,IAAI,CAAC/D,MAAM,CAACC,QAAR,CAAJ,IAAyB,IAA1D,IAAkE8D,IAAI,CAAC,YAAD,CAAJ,IAAsB,IAA5F,EAAkG,OAAOC,KAAK,CAACC,IAAN,CAAWF,IAAX,CAAP;AAA0B;;AAE9J,SAASJ,kBAAT,CAA4BD,GAA5B,EAAiC;AAAE,MAAIM,KAAK,CAACE,OAAN,CAAcR,GAAd,CAAJ,EAAwB,OAAOS,iBAAiB,CAACT,GAAD,CAAxB;AAAgC;;AAE3F,SAASU,cAAT,CAAwBV,GAAxB,EAA6B/C,CAA7B,EAAgC;AAAE,SAAO0D,eAAe,CAACX,GAAD,CAAf,IAAwBY,qBAAqB,CAACZ,GAAD,EAAM/C,CAAN,CAA7C,IAAyDkD,2BAA2B,CAACH,GAAD,EAAM/C,CAAN,CAApF,IAAgG4D,gBAAgB,EAAvH;AAA4H;;AAE9J,SAASA,gBAAT,GAA4B;AAAE,QAAM,IAAIhE,SAAJ,CAAc,2IAAd,CAAN;AAAmK;;AAEjM,SAASsD,2BAAT,CAAqChC,CAArC,EAAwC2C,MAAxC,EAAgD;AAAE,MAAI,CAAC3C,CAAL,EAAQ;AAAQ,MAAI,OAAOA,CAAP,KAAa,QAAjB,EAA2B,OAAOsC,iBAAiB,CAACtC,CAAD,EAAI2C,MAAJ,CAAxB;AAAqC,MAAIC,CAAC,GAAGxD,MAAM,CAACd,SAAP,CAAiBuE,QAAjB,CAA0B1B,IAA1B,CAA+BnB,CAA/B,EAAkC8C,KAAlC,CAAwC,CAAxC,EAA2C,CAAC,CAA5C,CAAR;AAAwD,MAAIF,CAAC,KAAK,QAAN,IAAkB5C,CAAC,CAAC3B,WAAxB,EAAqCuE,CAAC,GAAG5C,CAAC,CAAC3B,WAAF,CAAc0E,IAAlB;AAAwB,MAAIH,CAAC,KAAK,KAAN,IAAeA,CAAC,KAAK,KAAzB,EAAgC,OAAOT,KAAK,CAACC,IAAN,CAAWpC,CAAX,CAAP;AAAsB,MAAI4C,CAAC,KAAK,WAAN,IAAqB,2CAA2CI,IAA3C,CAAgDJ,CAAhD,CAAzB,EAA6E,OAAON,iBAAiB,CAACtC,CAAD,EAAI2C,MAAJ,CAAxB;AAAsC;;AAEha,SAASL,iBAAT,CAA2BT,GAA3B,EAAgCoB,GAAhC,EAAqC;AAAE,MAAIA,GAAG,IAAI,IAAP,IAAeA,GAAG,GAAGpB,GAAG,CAAC9C,MAA7B,EAAqCkE,GAAG,GAAGpB,GAAG,CAAC9C,MAAV;;AAAkB,OAAK,IAAID,CAAC,GAAG,CAAR,EAAWoE,IAAI,GAAG,IAAIf,KAAJ,CAAUc,GAAV,CAAvB,EAAuCnE,CAAC,GAAGmE,GAA3C,EAAgDnE,CAAC,EAAjD,EAAqD;AAAEoE,IAAAA,IAAI,CAACpE,CAAD,CAAJ,GAAU+C,GAAG,CAAC/C,CAAD,CAAb;AAAmB;;AAAC,SAAOoE,IAAP;AAAc;;AAEvL,SAAST,qBAAT,CAA+BZ,GAA/B,EAAoC/C,CAApC,EAAuC;AAAE,MAAIqE,EAAE,GAAGtB,GAAG,KAAK,OAAO1D,MAAP,KAAkB,WAAlB,IAAiC0D,GAAG,CAAC1D,MAAM,CAACC,QAAR,CAApC,IAAyDyD,GAAG,CAAC,YAAD,CAAjE,CAAZ;;AAA8F,MAAIsB,EAAE,IAAI,IAAV,EAAgB;AAAQ,MAAIC,IAAI,GAAG,EAAX;AAAe,MAAIC,EAAE,GAAG,IAAT;AAAe,MAAIC,EAAE,GAAG,KAAT;;AAAgB,MAAIC,EAAJ,EAAQC,EAAR;;AAAY,MAAI;AAAE,SAAKL,EAAE,GAAGA,EAAE,CAAChC,IAAH,CAAQU,GAAR,CAAV,EAAwB,EAAEwB,EAAE,GAAG,CAACE,EAAE,GAAGJ,EAAE,CAACM,IAAH,EAAN,EAAiBC,IAAxB,CAAxB,EAAuDL,EAAE,GAAG,IAA5D,EAAkE;AAAED,MAAAA,IAAI,CAACO,IAAL,CAAUJ,EAAE,CAACzD,KAAb;;AAAqB,UAAIhB,CAAC,IAAIsE,IAAI,CAACrE,MAAL,KAAgBD,CAAzB,EAA4B;AAAQ;AAAE,GAArI,CAAsI,OAAO8E,GAAP,EAAY;AAAEN,IAAAA,EAAE,GAAG,IAAL;AAAWE,IAAAA,EAAE,GAAGI,GAAL;AAAW,GAA1K,SAAmL;AAAE,QAAI;AAAE,UAAI,CAACP,EAAD,IAAOF,EAAE,CAAC,QAAD,CAAF,IAAgB,IAA3B,EAAiCA,EAAE,CAAC,QAAD,CAAF;AAAiB,KAAxD,SAAiE;AAAE,UAAIG,EAAJ,EAAQ,MAAME,EAAN;AAAW;AAAE;;AAAC,SAAOJ,IAAP;AAAc;;AAErf,SAASZ,eAAT,CAAyBX,GAAzB,EAA8B;AAAE,MAAIM,KAAK,CAACE,OAAN,CAAcR,GAAd,CAAJ,EAAwB,OAAOA,GAAP;AAAa;;AAsBrE,OAAOgC,KAAP,MAAkB,uBAAlB;AACA,SAASC,QAAT,EAAmBC,SAAnB,QAAoC,yBAApC;AACA,SAASC,SAAT,QAA0B,0BAA1B;AACA,SAASC,OAAT,EAAkBC,SAAlB,QAAmC,0BAAnC;AACA,SAASC,wBAAT,EAAmCC,6BAAnC,QAAwE,6BAAxE;AACA,SAASC,KAAT,QAAsB,0BAAtB;AACA,OAAO,IAAIC,UAAU,GAAG,UAAjB;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,SAASC,QAAT,CAAkB/F,QAAlB,EAA4B;AAC1B,MAAIgG,MAAM,GAAG,IAAb;AACA,OAAKhG,QAAL,GAAgBA,QAAhB;AACA,OAAKiG,WAAL,GAAmB,EAAnB;AACA,OAAKC,aAAL,GAAqB,EAArB;AACA,OAAKC,gBAAL,GAAwB,KAAxB;AACA,OAAKC,OAAL,GAAe,KAAf;AACApG,EAAAA,QAAQ,CAACqG,OAAT,CAAiB,aAAjB,EAAgC,UAAUC,OAAV,EAAmBC,MAAnB,EAA2B;AACzD,QAAIC,KAAK,GAAG,IAAZ;;AAEA,QAAIC,UAAU,GAAGH,OAAO,IAAIA,OAAO,CAAC/F,MAApC;;AAEA,QAAI,CAACkG,UAAL,EAAiB;AACf;AACD;;AAED,QAAIC,cAAc,GAAGJ,OAAO,CAACK,IAAR,CAAa,UAAUC,MAAV,EAAkB;AAClD,UAAIC,OAAO,GAAG9C,cAAc,CAAC6C,MAAD,EAAS,CAAT,CAA5B;AAAA,UACIE,QAAQ,GAAGD,OAAO,CAAC,CAAD,CADtB;AAAA,UAEIE,QAAQ,GAAGF,OAAO,CAAC,CAAD,CAFtB;;AAIA,aAAOC,QAAQ,KAAKC,QAApB;AACD,KANoB,CAArB;;AAQA,QAAI,CAACL,cAAL,EAAqB;AACnB;AACD;;AAED,QAAIM,aAAa,GAAG,SAASA,aAAT,GAAyB;AAC3C,UAAIC,aAAa,GAAGX,OAAO,CAACY,MAAR,CAAe,UAAU7D,GAAV,EAAeuD,MAAf,EAAuB;AACxDvD,QAAAA,GAAG,CAAC8B,IAAJ,CAAS/B,kBAAkB,CAACwD,MAAD,CAA3B;AACA,eAAOvD,GAAP;AACD,OAHmB,EAGjB,EAHiB,CAApB;AAIAkC,MAAAA,SAAS,CAAC0B,aAAD,EAAgB,UAAUL,MAAV,EAAkB;AACzCA,QAAAA,MAAM,CAAC,CAAD,CAAN,GAAY5G,QAAQ,CAACmH,SAAT,CAAmBP,MAAM,CAAC,CAAD,CAAzB,CAAZ;AACD,OAFQ,CAAT;AAGA,UAAIQ,QAAQ,GAAGX,UAAU,GAAG,CAAb,GAAiBD,KAAK,CAACa,WAAN,EAAjB,GAAuC,CAAC,CAACJ,aAAa,CAAC,CAAD,CAAb,CAAiB,CAAjB,CAAD,EAAsBA,aAAa,CAAC,CAAD,CAAb,CAAiB,CAAjB,CAAtB,CAAD,CAAtD;AACA,aAAO,IAAIlB,QAAQ,CAACuB,YAAb,CAA0BL,aAA1B,EAAyCG,QAAzC,CAAP;AACD,KAVD;;AAYApB,IAAAA,MAAM,CAACd,IAAP,CAAY8B,aAAZ,EAA2BT,MAA3B;AACD,GAlCD;AAmCAvG,EAAAA,QAAQ,CAACqG,OAAT,CAAiB,gBAAjB,EAAmC,UAAUkB,KAAV,EAAiBC,MAAjB,EAAyBjB,MAAzB,EAAiC;AAClEP,IAAAA,MAAM,CAACd,IAAP,CAAY,YAAY;AACtB,aAAO,IAAIa,QAAQ,CAAC0B,eAAb,CAA6BF,KAA7B,EAAoCC,MAApC,CAAP;AACD,KAFD,EAEGjB,MAFH;AAGD,GAJD;AAKAvG,EAAAA,QAAQ,CAACqG,OAAT,CAAiB,iBAAjB,EAAoC,UAAUkB,KAAV,EAAiBC,MAAjB,EAAyBE,SAAzB,EAAoCnB,MAApC,EAA4C;AAC9E,QAAIS,aAAa,GAAG,SAASA,aAAT,GAAyB;AAC3C,UAAIW,YAAY,GAAG3B,MAAM,CAAChG,QAAP,CAAgB4H,kBAAhB,EAAnB;AACA,UAAIC,QAAQ,GAAG,CAACF,YAAY,CAACpH,MAAb,GAAsBgH,KAAvB,IAAgCI,YAAY,CAACpH,MAA5D;AACA,UAAIuH,gBAAgB,GAAG9H,QAAQ,CAAC+H,aAAT,CAAuBF,QAAvB,CAAvB;AACA,UAAIG,WAAW,GAAGtC,SAAS,CAACiC,YAAY,CAACrD,KAAb,CAAmBwD,gBAAnB,EAAqCA,gBAAgB,GAAGN,MAAxD,CAAD,CAA3B;AACA,aAAO,IAAIzB,QAAQ,CAACkC,eAAb,CAA6BJ,QAA7B,EAAuCG,WAAvC,EAAoDhI,QAAQ,CAACkI,WAAT,GAAuBC,eAA3E,EAA4FnI,QAAQ,CAACkI,WAAT,GAAuBE,YAAnH,CAAP;AACD,KAND;;AAQApC,IAAAA,MAAM,CAACd,IAAP,CAAY8B,aAAZ,EAA2BT,MAA3B;AACD,GAVD;AAWAvG,EAAAA,QAAQ,CAACqG,OAAT,CAAiB,gBAAjB,EAAmC,UAAUkB,KAAV,EAAiBC,MAAjB,EAAyBjB,MAAzB,EAAiC;AAClEP,IAAAA,MAAM,CAACd,IAAP,CAAY,YAAY;AACtB,aAAO,IAAIa,QAAQ,CAACsC,kBAAb,CAAgCd,KAAhC,EAAuCC,MAAvC,CAAP;AACD,KAFD,EAEGjB,MAFH;AAGD,GAJD;AAKAvG,EAAAA,QAAQ,CAACqG,OAAT,CAAiB,iBAAjB,EAAoC,UAAUkB,KAAV,EAAiBC,MAAjB,EAAyBc,YAAzB,EAAuC/B,MAAvC,EAA+C;AACjF,QAAIS,aAAa,GAAG,SAASA,aAAT,GAAyB;AAC3C,UAAIW,YAAY,GAAG3B,MAAM,CAAChG,QAAP,CAAgB4H,kBAAhB,EAAnB;AACA,UAAIW,WAAW,GAAG,CAACvC,MAAM,CAAChG,QAAP,CAAgBwI,SAAhB,KAA8BjB,KAA/B,IAAwCvB,MAAM,CAAChG,QAAP,CAAgBwI,SAAhB,EAA1D;AACA,UAAIR,WAAW,GAAG,EAAlB;AACA,UAAIS,OAAO,GAAG,EAAd;AACA,UAAIC,OAAO,GAAG,EAAd;AACAlD,MAAAA,SAAS,CAACmC,YAAY,CAACpH,MAAb,GAAsB,CAAvB,EAA0B,UAAUD,CAAV,EAAa;AAC9C,YAAIqI,MAAM,GAAG,EAAb;AACA,YAAIC,OAAO,GAAGjB,YAAY,CAACrH,CAAD,CAA1B;AACAkF,QAAAA,SAAS,CAAC+C,WAAD,EAAcA,WAAW,IAAIf,MAAM,GAAG,CAAb,CAAzB,EAA0C,UAAUqB,CAAV,EAAa;AAC9DF,UAAAA,MAAM,CAACxD,IAAP,CAAYyD,OAAO,CAAC5I,QAAQ,CAAC8I,gBAAT,CAA0BD,CAA1B,CAAD,CAAnB;AACD,SAFQ,CAAT;AAGAb,QAAAA,WAAW,CAAC7C,IAAZ,CAAiBwD,MAAjB;AACD,OAPQ,CAAT;AAQAnD,MAAAA,SAAS,CAACgC,MAAM,GAAG,CAAV,EAAa,UAAUlH,CAAV,EAAa;AACjCoI,QAAAA,OAAO,CAACvD,IAAR,CAAanF,QAAQ,CAAC8I,gBAAT,CAA0BP,WAAW,GAAGjI,CAAxC,CAAb;AACD,OAFQ,CAAT;;AAIA,UAAIqD,KAAK,CAACE,OAAN,CAAc7D,QAAQ,CAACkI,WAAT,GAAuBa,UAArC,CAAJ,EAAsD;AACpDvD,QAAAA,SAAS,CAACgC,MAAM,GAAG,CAAV,EAAa,UAAUlH,CAAV,EAAa;AACjCmI,UAAAA,OAAO,CAACtD,IAAR,CAAanF,QAAQ,CAACkI,WAAT,GAAuBa,UAAvB,CAAkC/I,QAAQ,CAAC8I,gBAAT,CAA0BP,WAAW,GAAGjI,CAAxC,CAAlC,KAAiF,IAA9F;AACD,SAFQ,CAAT;AAGD;;AAED,UAAI0I,UAAU,GAAGhJ,QAAQ,CAACiJ,iBAAT,CAA2BC,kBAA3B,EAAjB;AACA,UAAIC,OAAO,GAAGnJ,QAAQ,CAACoJ,cAAT,CAAwBF,kBAAxB,EAAd;AACA,aAAO,IAAInD,QAAQ,CAACsD,kBAAb,CAAgCd,WAAhC,EAA6CG,OAA7C,EAAsDV,WAAtD,EAAmES,OAAnE,EAA4EO,UAA5E,EAAwFG,OAAxF,EAAiGnJ,QAAQ,CAACkI,WAAT,GAAuBoB,gBAAxH,CAAP;AACD,KA3BD;;AA6BAtD,IAAAA,MAAM,CAACd,IAAP,CAAY8B,aAAZ,EAA2BT,MAA3B;AACD,GA/BD;AAgCAvG,EAAAA,QAAQ,CAACqG,OAAT,CAAiB,qBAAjB,EAAwC,UAAUkD,WAAV,EAAuBC,KAAvB,EAA8BC,IAA9B,EAAoCC,SAApC,EAA+C;AACrF1D,IAAAA,MAAM,CAACd,IAAP,CAAY,YAAY;AACtB,aAAO,IAAIa,QAAQ,CAAC4D,mBAAb,CAAiCJ,WAAjC,EAA8CC,KAA9C,EAAqDC,IAArD,EAA2DC,SAA3D,CAAP;AACD,KAFD;AAGD,GAJD;AAKA1J,EAAAA,QAAQ,CAACqG,OAAT,CAAiB,cAAjB,EAAiC,UAAUuD,eAAV,EAA2B;AAC1D5D,IAAAA,MAAM,CAACd,IAAP,CAAY,YAAY;AACtB,aAAO,IAAIa,QAAQ,CAAC8D,aAAb,CAA2BD,eAA3B,CAAP;AACD,KAFD;AAGD,GAJD;AAKA5J,EAAAA,QAAQ,CAACqG,OAAT,CAAiB,eAAjB,EAAkC,UAAUyD,IAAV,EAAgBC,UAAhB,EAA4B;AAC5D,QAAID,IAAI,KAAK,KAAb,EAAoB;AAClB;AACD;;AAED9D,IAAAA,MAAM,CAACd,IAAP,CAAY,YAAY;AACtB,aAAO,IAAIa,QAAQ,CAACiE,aAAb,CAA2BF,IAA3B,EAAiCC,UAAjC,CAAP;AACD,KAFD;AAGD,GARD;AASA/J,EAAAA,QAAQ,CAACqG,OAAT,CAAiB,kBAAjB,EAAqC,UAAU4D,SAAV,EAAqBC,IAArB,EAA2B;AAC9D,QAAIA,IAAJ,EAAU;AACR;AACD;;AAEDlE,IAAAA,MAAM,CAACd,IAAP,CAAY,YAAY;AACtB,aAAO,IAAIa,QAAQ,CAACoE,gBAAb,CAA8BnK,QAA9B,EAAwCiK,SAAxC,CAAP;AACD,KAFD;AAGD,GARD;AASAjK,EAAAA,QAAQ,CAACqG,OAAT,CAAiB,mBAAjB,EAAsC,UAAU4D,SAAV,EAAqBC,IAArB,EAA2B;AAC/D,QAAIA,IAAJ,EAAU;AACR;AACD;;AAEDlE,IAAAA,MAAM,CAACd,IAAP,CAAY,YAAY;AACtB,aAAO,IAAIa,QAAQ,CAACqE,kBAAb,CAAgCpK,QAAhC,EAA0CiK,SAA1C,CAAP;AACD,KAFD;AAGD,GARD,EA3H0B,CAmItB;;AAEJjK,EAAAA,QAAQ,CAACqG,OAAT,CAAiB,WAAjB,EAA8B,YAAY;AACxCL,IAAAA,MAAM,CAACqE,IAAP;AACD,GAFD;AAGD;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGAtE,QAAQ,CAACjG,SAAT,CAAmBoF,IAAnB,GAA0B,UAAU8B,aAAV,EAAyBT,MAAzB,EAAiC;AACzD,MAAI,KAAKJ,gBAAT,EAA2B;AACzB;AACD;;AAED,MAAImE,kBAAkB,GAAG/D,MAAM,KAAK,eAAX,IAA8BA,MAAM,KAAK,eAAzC,IAA4DA,MAAM,KAAK,MAAhG;;AAEA,MAAI+D,kBAAJ,EAAwB;AACtB;AACD;;AAED,MAAIC,eAAe,GAAG,KAAKtE,WAAL,CAAiB3B,KAAjB,EAAtB;AACA,MAAIkG,cAAc,GAAG,KAAKxK,QAAL,CAAcyK,QAAd,CAAuB,uBAAvB,EAAgDF,eAAhD,EAAiEhE,MAAjE,CAArB;;AAEA,MAAIiE,cAAc,KAAK,KAAvB,EAA8B;AAC5B;AACD;;AAED,MAAIE,SAAS,GAAG1D,aAAa,EAA7B;AACA,MAAI2D,iBAAiB,GAAG,KAAKzE,aAAL,CAAmB5B,KAAnB,EAAxB;AACA,OAAK2B,WAAL,CAAiBd,IAAjB,CAAsBuF,SAAtB;AACA,OAAK1K,QAAL,CAAcyK,QAAd,CAAuB,sBAAvB,EAA+CF,eAA/C,EAAgE,KAAKtE,WAAL,CAAiB3B,KAAjB,EAAhE;AACA,OAAKtE,QAAL,CAAcyK,QAAd,CAAuB,uBAAvB,EAAgDE,iBAAhD;AACA,OAAKzE,aAAL,CAAmB3F,MAAnB,GAA4B,CAA5B;AACA,OAAKP,QAAL,CAAcyK,QAAd,CAAuB,sBAAvB,EAA+CE,iBAA/C,EAAkE,KAAKzE,aAAL,CAAmB5B,KAAnB,EAAlE;AACD,CAzBD;AA0BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGAyB,QAAQ,CAACjG,SAAT,CAAmB8K,IAAnB,GAA0B,YAAY;AACpC,MAAI,KAAKC,eAAL,EAAJ,EAA4B;AAC1B,QAAIN,eAAe,GAAG,KAAKtE,WAAL,CAAiB3B,KAAjB,EAAtB;AACA,SAAKtE,QAAL,CAAcyK,QAAd,CAAuB,uBAAvB,EAAgDF,eAAhD;AACA,QAAIO,MAAM,GAAG,KAAK7E,WAAL,CAAiB8E,GAAjB,EAAb;AACA,SAAK/K,QAAL,CAAcyK,QAAd,CAAuB,sBAAvB,EAA+CF,eAA/C,EAAgE,KAAKtE,WAAL,CAAiB3B,KAAjB,EAAhE;AACA,QAAI0G,WAAW,GAAGtF,SAAS,CAACoF,MAAD,CAA3B;AACA,QAAIN,cAAc,GAAG,KAAKxK,QAAL,CAAcyK,QAAd,CAAuB,YAAvB,EAAqCO,WAArC,CAArB;;AAEA,QAAIR,cAAc,KAAK,KAAvB,EAA8B;AAC5B;AACD;;AAED,SAAKrE,gBAAL,GAAwB,IAAxB;AACA,QAAI8E,IAAI,GAAG,IAAX;AACA,QAAIN,iBAAiB,GAAG,KAAKzE,aAAL,CAAmB5B,KAAnB,EAAxB;AACA,SAAKtE,QAAL,CAAcyK,QAAd,CAAuB,uBAAvB,EAAgDE,iBAAhD;AACAG,IAAAA,MAAM,CAACF,IAAP,CAAY,KAAK5K,QAAjB,EAA2B,YAAY;AACrCiL,MAAAA,IAAI,CAAC9E,gBAAL,GAAwB,KAAxB;AACA8E,MAAAA,IAAI,CAAC/E,aAAL,CAAmBf,IAAnB,CAAwB2F,MAAxB;AACD,KAHD;AAIA,SAAK9K,QAAL,CAAcyK,QAAd,CAAuB,sBAAvB,EAA+CE,iBAA/C,EAAkE,KAAKzE,aAAL,CAAmB5B,KAAnB,EAAlE;AACA,SAAKtE,QAAL,CAAcyK,QAAd,CAAuB,WAAvB,EAAoCO,WAApC;AACD;AACF,CAxBD;AAyBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGAjF,QAAQ,CAACjG,SAAT,CAAmBoL,IAAnB,GAA0B,YAAY;AACpC,MAAI,KAAKC,eAAL,EAAJ,EAA4B;AAC1B,QAAIR,iBAAiB,GAAG,KAAKzE,aAAL,CAAmB5B,KAAnB,EAAxB;AACA,SAAKtE,QAAL,CAAcyK,QAAd,CAAuB,uBAAvB,EAAgDE,iBAAhD;AACA,QAAIG,MAAM,GAAG,KAAK5E,aAAL,CAAmB6E,GAAnB,EAAb;AACA,SAAK/K,QAAL,CAAcyK,QAAd,CAAuB,sBAAvB,EAA+CE,iBAA/C,EAAkE,KAAKzE,aAAL,CAAmB5B,KAAnB,EAAlE;AACA,QAAI0G,WAAW,GAAGtF,SAAS,CAACoF,MAAD,CAA3B;AACA,QAAIN,cAAc,GAAG,KAAKxK,QAAL,CAAcyK,QAAd,CAAuB,YAAvB,EAAqCO,WAArC,CAArB;;AAEA,QAAIR,cAAc,KAAK,KAAvB,EAA8B;AAC5B;AACD;;AAED,SAAKrE,gBAAL,GAAwB,IAAxB;AACA,QAAI8E,IAAI,GAAG,IAAX;AACA,QAAIV,eAAe,GAAG,KAAKtE,WAAL,CAAiB3B,KAAjB,EAAtB;AACA,SAAKtE,QAAL,CAAcyK,QAAd,CAAuB,uBAAvB,EAAgDF,eAAhD;AACAO,IAAAA,MAAM,CAACI,IAAP,CAAY,KAAKlL,QAAjB,EAA2B,YAAY;AACrCiL,MAAAA,IAAI,CAAC9E,gBAAL,GAAwB,KAAxB;AACA8E,MAAAA,IAAI,CAAChF,WAAL,CAAiBd,IAAjB,CAAsB2F,MAAtB;AACD,KAHD;AAIA,SAAK9K,QAAL,CAAcyK,QAAd,CAAuB,sBAAvB,EAA+CF,eAA/C,EAAgE,KAAKtE,WAAL,CAAiB3B,KAAjB,EAAhE;AACA,SAAKtE,QAAL,CAAcyK,QAAd,CAAuB,WAAvB,EAAoCO,WAApC;AACD;AACF,CAxBD;AAyBA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGAjF,QAAQ,CAACjG,SAAT,CAAmB+K,eAAnB,GAAqC,YAAY;AAC/C,SAAO,KAAK5E,WAAL,CAAiB1F,MAAjB,GAA0B,CAAjC;AACD,CAFD;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGAwF,QAAQ,CAACjG,SAAT,CAAmBqL,eAAnB,GAAqC,YAAY;AAC/C,SAAO,KAAKjF,aAAL,CAAmB3F,MAAnB,GAA4B,CAAnC;AACD,CAFD;AAGA;AACA;AACA;AACA;AACA;AACA;;;AAGAwF,QAAQ,CAACjG,SAAT,CAAmBsL,KAAnB,GAA2B,YAAY;AACrC,OAAKnF,WAAL,CAAiB1F,MAAjB,GAA0B,CAA1B;AACA,OAAK2F,aAAL,CAAmB3F,MAAnB,GAA4B,CAA5B;AACD,CAHD;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGAwF,QAAQ,CAACjG,SAAT,CAAmBuL,SAAnB,GAA+B,YAAY;AACzC,SAAO,KAAKjF,OAAZ;AACD,CAFD;AAGA;AACA;AACA;AACA;AACA;AACA;;;AAGAL,QAAQ,CAACjG,SAAT,CAAmBwL,MAAnB,GAA4B,YAAY;AACtC,MAAI,KAAKD,SAAL,EAAJ,EAAsB;AACpB;AACD;;AAED,MAAIE,GAAG,GAAG,KAAKvL,QAAf;AACA,OAAKoG,OAAL,GAAe,IAAf;AACAoF,EAAAA,qBAAqB,CAACD,GAAD,CAArB;AACAA,EAAAA,GAAG,CAAClF,OAAJ,CAAY,eAAZ,EAA6BoF,eAA7B;AACAF,EAAAA,GAAG,CAAClF,OAAJ,CAAY,aAAZ,EAA2BqF,aAA3B;AACD,CAVD;AAWA;AACA;AACA;AACA;AACA;AACA;;;AAGA3F,QAAQ,CAACjG,SAAT,CAAmB6L,OAAnB,GAA6B,YAAY;AACvC,MAAI,CAAC,KAAKN,SAAL,EAAL,EAAuB;AACrB;AACD;;AAED,MAAIE,GAAG,GAAG,KAAKvL,QAAf;AACA,OAAKoG,OAAL,GAAe,KAAf;AACAwF,EAAAA,4BAA4B,CAACL,GAAD,CAA5B;AACAA,EAAAA,GAAG,CAACM,UAAJ,CAAe,eAAf,EAAgCJ,eAAhC;AACAF,EAAAA,GAAG,CAACM,UAAJ,CAAe,aAAf,EAA8BH,aAA9B;AACD,CAVD;AAWA;AACA;AACA;AACA;AACA;AACA;;;AAGA3F,QAAQ,CAACjG,SAAT,CAAmBgM,OAAnB,GAA6B,YAAY;AACvC,OAAKV,KAAL;AACA,OAAKpL,QAAL,GAAgB,IAAhB;AACA,OAAKiG,WAAL,GAAmB,IAAnB;AACA,OAAKC,aAAL,GAAqB,IAArB;AACD,CALD;;AAOAH,QAAQ,CAACgG,MAAT,GAAkB,YAAY,CAAE,CAAhC;;AAEAhG,QAAQ,CAACgG,MAAT,CAAgBjM,SAAhB,CAA0B8K,IAA1B,GAAiC,YAAY,CAAE,CAA/C;;AAEA7E,QAAQ,CAACgG,MAAT,CAAgBjM,SAAhB,CAA0BoL,IAA1B,GAAiC,YAAY,CAAE,CAA/C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGAnF,QAAQ,CAACuB,YAAT,GAAwB,UAAUhB,OAAV,EAAmBc,QAAnB,EAA6B;AACnD,OAAKd,OAAL,GAAeA,OAAf;AACA,OAAKc,QAAL,GAAgBA,QAAhB;AACA,OAAK4E,UAAL,GAAkB,QAAlB;AACD,CAJD;;AAMAvG,OAAO,CAACM,QAAQ,CAACuB,YAAV,EAAwBvB,QAAQ,CAACgG,MAAjC,CAAP;;AAEAhG,QAAQ,CAACuB,YAAT,CAAsBxH,SAAtB,CAAgC8K,IAAhC,GAAuC,UAAU5K,QAAV,EAAoBiM,cAApB,EAAoC;AACzE,MAAIC,IAAI,GAAGxG,SAAS,CAAC,KAAKY,OAAN,CAApB;AACA,MAAI6F,iBAAiB,GAAGnM,QAAQ,CAACoM,cAAT,CAAwB,IAAxB,CAAxB;AACA,MAAIC,iBAAiB,GAAGrM,QAAQ,CAACsM,cAAT,CAAwB,IAAxB,CAAxB;;AAEA,OAAK,IAAIhM,CAAC,GAAG,CAAR,EAAWmE,GAAG,GAAGyH,IAAI,CAAC3L,MAA3B,EAAmCD,CAAC,GAAGmE,GAAvC,EAA4CnE,CAAC,EAA7C,EAAiD;AAC/C4L,IAAAA,IAAI,CAAC5L,CAAD,CAAJ,CAAQiM,MAAR,CAAe,CAAf,EAAkB,CAAlB;AACD;;AAEDvM,EAAAA,QAAQ,CAACwM,WAAT,CAAqB,aAArB,EAAoCP,cAApC;AACAjM,EAAAA,QAAQ,CAACyM,aAAT,CAAuBP,IAAvB,EAA6B,IAA7B,EAAmC,IAAnC,EAAyC,eAAzC;;AAEA,OAAK,IAAIQ,GAAG,GAAG,CAAV,EAAaC,IAAI,GAAGT,IAAI,CAAC3L,MAA9B,EAAsCmM,GAAG,GAAGC,IAA5C,EAAkDD,GAAG,EAArD,EAAyD;AACvD,QAAIE,QAAQ,GAAG7I,cAAc,CAACmI,IAAI,CAACQ,GAAD,CAAL,EAAY,CAAZ,CAA7B;AAAA,QACIG,GAAG,GAAGD,QAAQ,CAAC,CAAD,CADlB;AAAA,QAEIjE,MAAM,GAAGiE,QAAQ,CAAC,CAAD,CAFrB;;AAIA,QAAI5M,QAAQ,CAACkI,WAAT,GAAuB4E,YAAvB,IAAuCD,GAAG,GAAG,CAAN,GAAU7M,QAAQ,CAACkI,WAAT,GAAuB4E,YAAjC,KAAkD9M,QAAQ,CAAC+M,SAAT,EAAzF,IAAiHZ,iBAAiB,KAAKnM,QAAQ,CAACkI,WAAT,GAAuB4E,YAAlK,EAAgL;AAC9K9M,MAAAA,QAAQ,CAACgN,KAAT,CAAe,YAAf,EAA6BC,QAAQ,CAACJ,GAAG,GAAG,CAAP,EAAU,EAAV,CAArC,EAAoD7M,QAAQ,CAACkI,WAAT,GAAuB4E,YAA3E;AACA9M,MAAAA,QAAQ,CAACkN,QAAT,CAAkBjH,WAAlB,CAA8B8E,GAA9B;AACD;;AAED,QAAI/K,QAAQ,CAACkI,WAAT,GAAuBiF,YAAvB,IAAuCxE,MAAM,GAAG,CAAT,GAAa3I,QAAQ,CAACkI,WAAT,GAAuBiF,YAApC,KAAqDnN,QAAQ,CAACwI,SAAT,EAA5F,IAAoH6D,iBAAiB,KAAKrM,QAAQ,CAACkI,WAAT,GAAuBiF,YAArK,EAAmL;AACjLnN,MAAAA,QAAQ,CAACgN,KAAT,CAAe,YAAf,EAA6BC,QAAQ,CAACtE,MAAM,GAAG,CAAV,EAAa,EAAb,CAArC,EAAuD3I,QAAQ,CAACkI,WAAT,GAAuBiF,YAA9E;AACAnN,MAAAA,QAAQ,CAACkN,QAAT,CAAkBjH,WAAlB,CAA8B8E,GAA9B;AACD;AACF;;AAED/K,EAAAA,QAAQ,CAACoN,WAAT,CAAqB,KAAKhG,QAA1B,EAAoC,KAApC,EAA2C,KAA3C;AACD,CA7BD;;AA+BArB,QAAQ,CAACuB,YAAT,CAAsBxH,SAAtB,CAAgCoL,IAAhC,GAAuC,UAAUlL,QAAV,EAAoBqN,gBAApB,EAAsC;AAC3E,MAAInB,IAAI,GAAGxG,SAAS,CAAC,KAAKY,OAAN,CAApB;;AAEA,OAAK,IAAIhG,CAAC,GAAG,CAAR,EAAWmE,GAAG,GAAGyH,IAAI,CAAC3L,MAA3B,EAAmCD,CAAC,GAAGmE,GAAvC,EAA4CnE,CAAC,EAA7C,EAAiD;AAC/C4L,IAAAA,IAAI,CAAC5L,CAAD,CAAJ,CAAQiM,MAAR,CAAe,CAAf,EAAkB,CAAlB;AACD;;AAEDvM,EAAAA,QAAQ,CAACwM,WAAT,CAAqB,aAArB,EAAoCa,gBAApC;AACArN,EAAAA,QAAQ,CAACyM,aAAT,CAAuBP,IAAvB,EAA6B,IAA7B,EAAmC,IAAnC,EAAyC,eAAzC;;AAEA,MAAI,KAAK9E,QAAT,EAAmB;AACjBpH,IAAAA,QAAQ,CAACoN,WAAT,CAAqB,KAAKhG,QAA1B,EAAoC,KAApC,EAA2C,KAA3C;AACD;AACF,CAbD;AAcA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGArB,QAAQ,CAAC0B,eAAT,GAA2B,UAAUF,KAAV,EAAiBC,MAAjB,EAAyB;AAClD,OAAKD,KAAL,GAAaA,KAAb;AACA,OAAKC,MAAL,GAAcA,MAAd;AACA,OAAKwE,UAAL,GAAkB,YAAlB;AACD,CAJD;;AAMAvG,OAAO,CAACM,QAAQ,CAAC0B,eAAV,EAA2B1B,QAAQ,CAACgG,MAApC,CAAP;;AAEAhG,QAAQ,CAAC0B,eAAT,CAAyB3H,SAAzB,CAAmC8K,IAAnC,GAA0C,UAAU5K,QAAV,EAAoBiM,cAApB,EAAoC;AAC5E,MAAIqB,QAAQ,GAAGtN,QAAQ,CAAC+M,SAAT,EAAf;AACA,MAAID,YAAY,GAAG9M,QAAQ,CAACkI,WAAT,GAAuB4E,YAA1C;;AAEA,MAAI,KAAKvF,KAAL,IAAc+F,QAAd,IAA0B,KAAK/F,KAAL,GAAauF,YAAb,GAA4BQ,QAA1D,EAAoE;AAClE,SAAK/F,KAAL,IAAcuF,YAAd,CADkE,CACtC;AAC7B;;AAED9M,EAAAA,QAAQ,CAACwM,WAAT,CAAqB,gBAArB,EAAuCP,cAAvC;AACAjM,EAAAA,QAAQ,CAACgN,KAAT,CAAe,YAAf,EAA6B,KAAKzF,KAAlC,EAAyC,KAAKC,MAA9C,EAAsD,eAAtD;AACD,CAVD;;AAYAzB,QAAQ,CAAC0B,eAAT,CAAyB3H,SAAzB,CAAmCoL,IAAnC,GAA0C,UAAUlL,QAAV,EAAoBuN,cAApB,EAAoC;AAC5EvN,EAAAA,QAAQ,CAACwM,WAAT,CAAqB,gBAArB,EAAuCe,cAAvC;AACAvN,EAAAA,QAAQ,CAACgN,KAAT,CAAe,YAAf,EAA6B,KAAKzF,KAAlC,EAAyC,KAAKC,MAA9C,EAAsD,eAAtD;AACD,CAHD;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGAzB,QAAQ,CAACkC,eAAT,GAA2B,UAAUV,KAAV,EAAiB2E,IAAjB,EAAuB/D,eAAvB,EAAwCC,YAAxC,EAAsD;AAC/E,OAAKb,KAAL,GAAaA,KAAb;AACA,OAAK2E,IAAL,GAAYA,IAAZ;AACA,OAAKF,UAAL,GAAkB,YAAlB;AACA,OAAK7D,eAAL,GAAuBA,eAAvB;AACA,OAAKC,YAAL,GAAoBA,YAApB;AACD,CAND;;AAQA3C,OAAO,CAACM,QAAQ,CAACkC,eAAV,EAA2BlC,QAAQ,CAACgG,MAApC,CAAP;;AAEAhG,QAAQ,CAACkC,eAAT,CAAyBnI,SAAzB,CAAmC8K,IAAnC,GAA0C,UAAU5K,QAAV,EAAoBiM,cAApB,EAAoC;AAC5E,MAAIuB,QAAQ,GAAGxN,QAAQ,CAACkI,WAAT,EAAf,CAD4E,CACrC;;AAEvCsF,EAAAA,QAAQ,CAACrF,eAAT,GAA2B,KAAKA,eAAhC;AACAqF,EAAAA,QAAQ,CAACpF,YAAT,GAAwB,KAAKA,YAA7B;AACApI,EAAAA,QAAQ,CAACgN,KAAT,CAAe,YAAf,EAA6B,KAAKzF,KAAlC,EAAyC,KAAK2E,IAAL,CAAU3L,MAAnD,EAA2D,eAA3D;AACAP,EAAAA,QAAQ,CAACwM,WAAT,CAAqB,aAArB,EAAoCP,cAApC;AACAjM,EAAAA,QAAQ,CAACyN,iBAAT,CAA2B,KAAKlG,KAAhC,EAAuC,CAAvC,EAA0C,KAAK2E,IAA/C,EAAqD,KAAK,CAA1D,EAA6D,KAAK,CAAlE,EAAqE,eAArE;AACD,CARD;;AAUAnG,QAAQ,CAACkC,eAAT,CAAyBnI,SAAzB,CAAmCoL,IAAnC,GAA0C,UAAUlL,QAAV,EAAoBuN,cAApB,EAAoC;AAC5EvN,EAAAA,QAAQ,CAACwM,WAAT,CAAqB,gBAArB,EAAuCe,cAAvC;AACAvN,EAAAA,QAAQ,CAACgN,KAAT,CAAe,YAAf,EAA6B,KAAKzF,KAAlC,EAAyC,KAAK2E,IAAL,CAAU3L,MAAnD,EAA2D,eAA3D;AACD,CAHD;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGAwF,QAAQ,CAACsC,kBAAT,GAA8B,UAAUd,KAAV,EAAiBC,MAAjB,EAAyB;AACrD,OAAKD,KAAL,GAAaA,KAAb;AACA,OAAKC,MAAL,GAAcA,MAAd;AACA,OAAKwE,UAAL,GAAkB,YAAlB;AACD,CAJD;;AAMAvG,OAAO,CAACM,QAAQ,CAACsC,kBAAV,EAA8BtC,QAAQ,CAACgG,MAAvC,CAAP;;AAEAhG,QAAQ,CAACsC,kBAAT,CAA4BvI,SAA5B,CAAsC8K,IAAtC,GAA6C,UAAU5K,QAAV,EAAoBiM,cAApB,EAAoC;AAC/EjM,EAAAA,QAAQ,CAACwM,WAAT,CAAqB,gBAArB,EAAuCP,cAAvC;AACAjM,EAAAA,QAAQ,CAACgN,KAAT,CAAe,YAAf,EAA6B,KAAKzF,KAAlC,EAAyC,KAAKC,MAA9C,EAAsD,eAAtD;AACD,CAHD;;AAKAzB,QAAQ,CAACsC,kBAAT,CAA4BvI,SAA5B,CAAsCoL,IAAtC,GAA6C,UAAUlL,QAAV,EAAoBuN,cAApB,EAAoC;AAC/EvN,EAAAA,QAAQ,CAACwM,WAAT,CAAqB,gBAArB,EAAuCe,cAAvC;AACAvN,EAAAA,QAAQ,CAACgN,KAAT,CAAe,YAAf,EAA6B,KAAKzF,KAAlC,EAAyC,KAAKC,MAA9C,EAAsD,eAAtD;AACD,CAHD;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGAzB,QAAQ,CAACsD,kBAAT,GAA8B,UAAU9B,KAAV,EAAiBmB,OAAjB,EAA0BwD,IAA1B,EAAgCzD,OAAhC,EAAyCiF,eAAzC,EAA0DC,YAA1D,EAAwErE,gBAAxE,EAA0F;AACtH,OAAK/B,KAAL,GAAaA,KAAb;AACA,OAAKmB,OAAL,GAAeA,OAAf;AACA,OAAKwD,IAAL,GAAYA,IAAZ;AACA,OAAK1E,MAAL,GAAc,KAAK0E,IAAL,CAAU,CAAV,EAAa3L,MAA3B;AACA,OAAKkI,OAAL,GAAeA,OAAf;AACA,OAAKiF,eAAL,GAAuBA,eAAe,CAACpJ,KAAhB,CAAsB,CAAtB,CAAvB;AACA,OAAKqJ,YAAL,GAAoBA,YAAY,CAACrJ,KAAb,CAAmB,CAAnB,CAApB;AACA,OAAK0H,UAAL,GAAkB,YAAlB;AACA,OAAK1C,gBAAL,GAAwBA,gBAAxB;AACD,CAVD;;AAYA7D,OAAO,CAACM,QAAQ,CAACsD,kBAAV,EAA8BtD,QAAQ,CAACgG,MAAvC,CAAP;;AAEAhG,QAAQ,CAACsD,kBAAT,CAA4BvJ,SAA5B,CAAsC8K,IAAtC,GAA6C,UAAU5K,QAAV,EAAoBiM,cAApB,EAAoC;AAC/E,MAAI2B,MAAM,GAAG,IAAb;;AAEA,MAAIJ,QAAQ,GAAGxN,QAAQ,CAACkI,WAAT,EAAf,CAH+E,CAGxC;;AAEvCsF,EAAAA,QAAQ,CAAClE,gBAAT,GAA4B,KAAKA,gBAAjC;AACA,MAAIuE,gBAAgB,GAAG,KAAKnF,OAAL,CAAapE,KAAb,CAAmB,CAAnB,EAAsBwJ,IAAtB,EAAvB;;AAEA,MAAIC,aAAa,GAAG,SAASA,aAAT,CAAuBC,IAAvB,EAA6BnF,CAA7B,EAAgCxF,GAAhC,EAAqC;AACvD,WAAOA,GAAG,CAACuK,MAAM,CAAClF,OAAP,CAAeuF,OAAf,CAAuBJ,gBAAgB,CAAChF,CAAD,CAAvC,CAAD,CAAV;AACD,GAFD;;AAIA,MAAIqF,iBAAiB,GAAG,KAAKhC,IAAL,CAAU3L,MAAlC;AACA,MAAI4N,UAAU,GAAG,EAAjB;;AAEA,OAAK,IAAItG,QAAQ,GAAG,CAApB,EAAuBA,QAAQ,GAAGqG,iBAAlC,EAAqDrG,QAAQ,EAA7D,EAAiE;AAC/DsG,IAAAA,UAAU,CAAChJ,IAAX,CAAgBG,QAAQ,CAAC,KAAK4G,IAAL,CAAUrE,QAAV,CAAD,EAAsBkG,aAAtB,CAAxB;AACD;;AAED,MAAIK,aAAa,GAAG9I,QAAQ,CAAC,KAAKmD,OAAN,EAAesF,aAAf,CAA5B;AACA,MAAIzH,OAAO,GAAG,EAAd;AACAtG,EAAAA,QAAQ,CAACgN,KAAT,CAAe,YAAf,EAA6B,KAAKtE,OAAL,CAAa,CAAb,CAA7B,EAA8C,KAAKA,OAAL,CAAanI,MAA3D,EAAmE,eAAnE;AACAgF,EAAAA,SAAS,CAACvF,QAAQ,CAAC4H,kBAAT,EAAD,EAAgC,UAAUyG,OAAV,EAAmBxG,QAAnB,EAA6B;AACpEtC,IAAAA,SAAS,CAACsI,gBAAD,EAAmB,UAAUS,YAAV,EAAwBC,cAAxB,EAAwC;AAClEF,MAAAA,OAAO,CAACC,YAAD,CAAP,GAAwBH,UAAU,CAACtG,QAAD,CAAV,CAAqB0G,cAArB,CAAxB;AACAjI,MAAAA,OAAO,CAACnB,IAAR,CAAa,CAAC0C,QAAD,EAAWyG,YAAX,EAAyBD,OAAO,CAACC,YAAD,CAAhC,CAAb;AACD,KAHQ,CAAT;AAID,GALQ,CAAT;AAMAtO,EAAAA,QAAQ,CAACwO,mBAAT,CAA6BlI,OAA7B;AACAtG,EAAAA,QAAQ,CAACiJ,iBAAT,CAA2BwF,aAA3B,CAAyCZ,gBAAgB,CAAC,CAAD,CAAzD,EAA8DA,gBAAgB,CAACtN,MAA/E;;AAEA,MAAI,OAAO,KAAKkI,OAAZ,KAAwB,WAA5B,EAAyC;AACvClD,IAAAA,SAAS,CAAC6I,aAAD,EAAgB,UAAUM,UAAV,EAAsBnG,WAAtB,EAAmC;AAC1DvI,MAAAA,QAAQ,CAACkI,WAAT,GAAuBa,UAAvB,CAAkC8E,gBAAgB,CAACtF,WAAD,CAAlD,IAAmEmG,UAAnE;AACD,KAFQ,CAAT;AAGD;;AAED1O,EAAAA,QAAQ,CAAC2O,cAAT,CAAwB,YAAY;AAClC;AACA;AACA3O,IAAAA,QAAQ,CAACoJ,cAAT,CAAwBwF,kBAAxB,CAA2ChB,MAAM,CAACD,YAAlD;AACA3N,IAAAA,QAAQ,CAACiJ,iBAAT,CAA2B2F,kBAA3B,CAA8ChB,MAAM,CAACF,eAArD;AACD,GALD,EAKG,IALH;AAMA1N,EAAAA,QAAQ,CAACwM,WAAT,CAAqB,aAArB,EAAoCP,cAApC;AACAjM,EAAAA,QAAQ,CAAC6O,MAAT;AACD,CA7CD;;AA+CA9I,QAAQ,CAACsD,kBAAT,CAA4BvJ,SAA5B,CAAsCoL,IAAtC,GAA6C,UAAUlL,QAAV,EAAoBuN,cAApB,EAAoC;AAC/EvN,EAAAA,QAAQ,CAACwM,WAAT,CAAqB,gBAArB,EAAuCe,cAAvC;AACAvN,EAAAA,QAAQ,CAACgN,KAAT,CAAe,YAAf,EAA6B,KAAKzF,KAAlC,EAAyC,KAAKC,MAA9C,EAAsD,eAAtD;AACD,CAHD;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGAzB,QAAQ,CAAC4D,mBAAT,GAA+B,UAAUJ,WAAV,EAAuBC,KAAvB,EAA8BC,IAA9B,EAAoCC,SAApC,EAA+C;AAC5E,OAAKH,WAAL,GAAmBA,WAAnB;AACA,OAAKC,KAAL,GAAaA,KAAb;AACA,OAAKC,IAAL,GAAYA,IAAZ;AACA,OAAKC,SAAL,GAAiBA,SAAjB;AACD,CALD;;AAOA3D,QAAQ,CAAC4D,mBAAT,CAA6B7J,SAA7B,CAAuC8K,IAAvC,GAA8C,UAAU5K,QAAV,EAAoBiM,cAApB,EAAoC;AAChF,MAAI6C,MAAM,GAAG,IAAb;;AAEAvJ,EAAAA,SAAS,CAAC,KAAKiE,KAAN,EAAa,UAAUA,KAAV,EAAiB;AACrCA,IAAAA,KAAK,CAACuF,MAAN,CAAa,UAAUlC,GAAV,EAAemC,GAAf,EAAoB;AAC/B;AACA,UAAInC,GAAG,IAAI,CAAP,IAAYmC,GAAG,IAAI,CAAvB,EAA0B;AACxBhP,QAAAA,QAAQ,CAACiP,WAAT,CAAqBpC,GAArB,EAA0BmC,GAA1B,EAA+B,WAA/B,EAA4CF,MAAM,CAACvF,WAAP,CAAmBsD,GAAnB,EAAwBmC,GAAxB,KAAgC,SAA5E;AACD;AACF,KALD;AAMD,GAPQ,CAAT;AAQAhP,EAAAA,QAAQ,CAACwM,WAAT,CAAqB,aAArB,EAAoCP,cAApC;AACAjM,EAAAA,QAAQ,CAAC6O,MAAT;AACD,CAbD;;AAeA9I,QAAQ,CAAC4D,mBAAT,CAA6B7J,SAA7B,CAAuCoL,IAAvC,GAA8C,UAAUlL,QAAV,EAAoBiM,cAApB,EAAoC;AAChFpG,EAAAA,KAAK,CAAC,KAAK2D,KAAN,EAAa,KAAKC,IAAlB,EAAwB,KAAKC,SAA7B,EAAwC,UAAUmD,GAAV,EAAemC,GAAf,EAAoB;AAC/D,WAAOhP,QAAQ,CAACkP,WAAT,CAAqBrC,GAArB,EAA0BmC,GAA1B,CAAP;AACD,GAFI,EAEF,UAAUnC,GAAV,EAAemC,GAAf,EAAoBlO,GAApB,EAAyBQ,KAAzB,EAAgC;AACjC,WAAOtB,QAAQ,CAACiP,WAAT,CAAqBpC,GAArB,EAA0BmC,GAA1B,EAA+BlO,GAA/B,EAAoCQ,KAApC,CAAP;AACD,GAJI,CAAL;AAKAtB,EAAAA,QAAQ,CAACwM,WAAT,CAAqB,aAArB,EAAoCP,cAApC;AACAjM,EAAAA,QAAQ,CAAC6O,MAAT;AACD,CARD;AASA;AACA;AACA;AACA;AACA;AACA;;;AAGA9I,QAAQ,CAAC8D,aAAT,GAAyB,UAAUD,eAAV,EAA2B;AAClD,OAAKA,eAAL,GAAuBA,eAAvB;AACA,OAAKoC,UAAL,GAAkB,QAAlB;AACD,CAHD;;AAKAvG,OAAO,CAACM,QAAQ,CAAC8D,aAAV,EAAyB9D,QAAQ,CAACgG,MAAlC,CAAP;;AAEAhG,QAAQ,CAAC8D,aAAT,CAAuB/J,SAAvB,CAAiC8K,IAAjC,GAAwC,UAAU5K,QAAV,EAAoBiM,cAApB,EAAoC;AAC1E,MAAIkD,OAAO,GAAGnP,QAAQ,CAACoP,SAAT,CAAmB,SAAnB,CAAd;AACApP,EAAAA,QAAQ,CAACwM,WAAT,CAAqB,aAArB,EAAoCP,cAApC;AACAkD,EAAAA,OAAO,CAACE,mBAAR,CAA4BC,mBAA5B,CAAgD,KAAK1F,eAAL,CAAqBtF,KAArB,CAA2B,CAA3B,EAA8B,KAAKsF,eAAL,CAAqBrJ,MAArB,GAA8B,CAA5D,CAAhD;AACA4O,EAAAA,OAAO,CAACI,MAAR;AACD,CALD;;AAOAxJ,QAAQ,CAAC8D,aAAT,CAAuB/J,SAAvB,CAAiCoL,IAAjC,GAAwC,UAAUlL,QAAV,EAAoBuN,cAApB,EAAoC;AAC1E,MAAI4B,OAAO,GAAGnP,QAAQ,CAACoP,SAAT,CAAmB,SAAnB,CAAd;AACApP,EAAAA,QAAQ,CAACwM,WAAT,CAAqB,aAArB,EAAoCe,cAApC;AACA4B,EAAAA,OAAO,CAACE,mBAAR,CAA4BC,mBAA5B,CAAgD,KAAK1F,eAArD;AACAuF,EAAAA,OAAO,CAACI,MAAR;AACD,CALD;AAMA;AACA;AACA;AACA;AACA;;;AAGA,IAAIpF,gBAAgB,GAAG,aAAa,UAAUqF,gBAAV,EAA4B;AAC9DtO,EAAAA,SAAS,CAACiJ,gBAAD,EAAmBqF,gBAAnB,CAAT;;AAEA,MAAIC,MAAM,GAAG7N,YAAY,CAACuI,gBAAD,CAAzB;;AAEA,WAASA,gBAAT,CAA0BnK,QAA1B,EAAoCiK,SAApC,EAA+C;AAC7C,QAAIyF,MAAJ;;AAEA3P,IAAAA,eAAe,CAAC,IAAD,EAAOoK,gBAAP,CAAf;;AAEAuF,IAAAA,MAAM,GAAGD,MAAM,CAAC9M,IAAP,CAAY,IAAZ,CAAT;AACA+M,IAAAA,MAAM,CAACzF,SAAP,GAAmBA,SAAnB;;AAEA,QAAI0F,aAAa,GAAGD,MAAM,CAACzF,SAAP,CAAiB2F,gBAAjB,EAApB;;AAEA,QAAIC,iBAAiB,GAAGH,MAAM,CAACzF,SAAP,CAAiB6F,oBAAjB,EAAxB;;AAEAJ,IAAAA,MAAM,CAACK,SAAP,GAAmB/P,QAAQ,CAACgQ,OAAT,CAAiBL,aAAa,CAAC9C,GAA/B,EAAoC8C,aAAa,CAACX,GAAlD,EAAuDa,iBAAiB,CAAChD,GAAzE,EAA8EgD,iBAAiB,CAACb,GAAhG,CAAnB;AACA,WAAOU,MAAP;AACD;;AAED3O,EAAAA,YAAY,CAACoJ,gBAAD,EAAmB,CAAC;AAC9BrJ,IAAAA,GAAG,EAAE,MADyB;AAE9BQ,IAAAA,KAAK,EAAE,SAASsJ,IAAT,CAAc5K,QAAd,EAAwBiM,cAAxB,EAAwC;AAC7C,UAAIgE,gBAAgB,GAAGjQ,QAAQ,CAACoP,SAAT,CAAmB,YAAnB,CAAvB;AACApP,MAAAA,QAAQ,CAACwM,WAAT,CAAqB,aAArB,EAAoCP,cAApC;AACAgE,MAAAA,gBAAgB,CAACC,YAAjB,CAA8B,KAAKjG,SAAnC,EAA8C,IAA9C;AACA,UAAI0F,aAAa,GAAG,KAAK1F,SAAL,CAAe2F,gBAAf,EAApB;AACA5P,MAAAA,QAAQ,CAACyN,iBAAT,CAA2BkC,aAAa,CAAC9C,GAAzC,EAA8C8C,aAAa,CAACX,GAA5D,EAAiE,KAAKe,SAAtE,EAAiF,KAAK,CAAtF,EAAyF,KAAK,CAA9F,EAAiG,YAAjG;AACD;AAR6B,GAAD,EAS5B;AACDjP,IAAAA,GAAG,EAAE,MADJ;AAEDQ,IAAAA,KAAK,EAAE,SAAS4J,IAAT,CAAclL,QAAd,EAAwBuN,cAAxB,EAAwC;AAC7C,UAAI0C,gBAAgB,GAAGjQ,QAAQ,CAACoP,SAAT,CAAmB,YAAnB,CAAvB;AACApP,MAAAA,QAAQ,CAACwM,WAAT,CAAqB,aAArB,EAAoCe,cAApC;AACA0C,MAAAA,gBAAgB,CAACE,UAAjB,CAA4B,KAAKlG,SAAjC;AACD;AANA,GAT4B,CAAnB,CAAZ;;AAkBA,SAAOE,gBAAP;AACD,CAxCmC,CAwClCpE,QAAQ,CAACgG,MAxCyB,CAApC;;AA0CAhG,QAAQ,CAACoE,gBAAT,GAA4BA,gBAA5B;AACA;AACA;AACA;AACA;AACA;;AAEA,IAAIC,kBAAkB,GAAG,aAAa,UAAUgG,iBAAV,EAA6B;AACjElP,EAAAA,SAAS,CAACkJ,kBAAD,EAAqBgG,iBAArB,CAAT;;AAEA,MAAIC,OAAO,GAAGzO,YAAY,CAACwI,kBAAD,CAA1B;;AAEA,WAASA,kBAAT,CAA4BpK,QAA5B,EAAsCiK,SAAtC,EAAiD;AAC/C,QAAIqG,MAAJ;;AAEAvQ,IAAAA,eAAe,CAAC,IAAD,EAAOqK,kBAAP,CAAf;;AAEAkG,IAAAA,MAAM,GAAGD,OAAO,CAAC1N,IAAR,CAAa,IAAb,CAAT;AACA2N,IAAAA,MAAM,CAACrG,SAAP,GAAmBA,SAAnB;AACA,WAAOqG,MAAP;AACD;;AAEDvP,EAAAA,YAAY,CAACqJ,kBAAD,EAAqB,CAAC;AAChCtJ,IAAAA,GAAG,EAAE,MAD2B;AAEhCQ,IAAAA,KAAK,EAAE,SAASsJ,IAAT,CAAc5K,QAAd,EAAwBiM,cAAxB,EAAwC;AAC7C,UAAIgE,gBAAgB,GAAGjQ,QAAQ,CAACoP,SAAT,CAAmB,YAAnB,CAAvB;AACApP,MAAAA,QAAQ,CAACwM,WAAT,CAAqB,aAArB,EAAoCP,cAApC;AACAgE,MAAAA,gBAAgB,CAACE,UAAjB,CAA4B,KAAKlG,SAAjC,EAA4C,IAA5C;AACD;AAN+B,GAAD,EAO9B;AACDnJ,IAAAA,GAAG,EAAE,MADJ;AAEDQ,IAAAA,KAAK,EAAE,SAAS4J,IAAT,CAAclL,QAAd,EAAwBuN,cAAxB,EAAwC;AAC7C,UAAI0C,gBAAgB,GAAGjQ,QAAQ,CAACoP,SAAT,CAAmB,YAAnB,CAAvB;AACApP,MAAAA,QAAQ,CAACwM,WAAT,CAAqB,aAArB,EAAoCe,cAApC;AACA0C,MAAAA,gBAAgB,CAACC,YAAjB,CAA8B,KAAKjG,SAAnC,EAA8C,IAA9C;AACAjK,MAAAA,QAAQ,CAAC6O,MAAT;AACD;AAPA,GAP8B,CAArB,CAAZ;;AAiBA,SAAOzE,kBAAP;AACD,CAjCqC,CAiCpCrE,QAAQ,CAACgG,MAjC2B,CAAtC;;AAmCAhG,QAAQ,CAACqE,kBAAT,GAA8BA,kBAA9B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEArE,QAAQ,CAACiE,aAAT,GAAyB,UAAUF,IAAV,EAAgBC,UAAhB,EAA4B;AACnD,OAAKD,IAAL,GAAYA,IAAI,CAACxF,KAAL,EAAZ;AACA,OAAKyF,UAAL,GAAkBA,UAAlB;AACD,CAHD;;AAKAtE,OAAO,CAACM,QAAQ,CAACiE,aAAV,EAAyBjE,QAAQ,CAACgG,MAAlC,CAAP;;AAEAhG,QAAQ,CAACiE,aAAT,CAAuBlK,SAAvB,CAAiC8K,IAAjC,GAAwC,UAAU5K,QAAV,EAAoBiM,cAApB,EAAoC;AAC1E,MAAIsE,MAAM,GAAG,IAAb;;AAEA,MAAIC,aAAa,GAAGxQ,QAAQ,CAACoP,SAAT,CAAmB,eAAnB,CAApB;AACA,MAAIqB,UAAU,GAAG,GAAGC,MAAH,CAAU,KAAK5G,IAAf,CAAjB;AACA,MAAI6G,WAAW,GAAGF,UAAU,CAAClB,MAAX,CAAkB,UAAUqB,CAAV,EAAa;AAC/C,WAAOA,CAAC,GAAGL,MAAM,CAACxG,UAAlB;AACD,GAFiB,CAAlB;AAGA,MAAI8G,aAAa,GAAGJ,UAAU,CAAClB,MAAX,CAAkB,UAAUqB,CAAV,EAAa;AACjD,WAAOA,CAAC,IAAIL,MAAM,CAACxG,UAAnB;AACD,GAFmB,CAApB;AAGA,MAAI+G,YAAY,GAAGH,WAAW,CAAC7C,IAAZ,CAAiB,UAAU8C,CAAV,EAAaG,CAAb,EAAgB;AAClD,WAAOA,CAAC,GAAGH,CAAX;AACD,GAFkB,EAEhBF,MAFgB,CAETG,aAAa,CAAC/C,IAAd,CAAmB,UAAU8C,CAAV,EAAaG,CAAb,EAAgB;AAC3C,WAAOH,CAAC,GAAGG,CAAX;AACD,GAFS,CAFS,CAAnB;AAKA/Q,EAAAA,QAAQ,CAACwM,WAAT,CAAqB,aAArB,EAAoCP,cAApC,EAhB0E,CAgBrB;AACrD;;AAEA,OAAK,IAAI3L,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGwQ,YAAY,CAACvQ,MAAjC,EAAyCD,CAAC,IAAI,CAA9C,EAAiD;AAC/C,QAAI0Q,cAAc,GAAGhR,QAAQ,CAACiR,WAAT,CAAqBH,YAAY,CAACxQ,CAAD,CAAjC,CAArB;AACAkQ,IAAAA,aAAa,CAACU,OAAd,CAAsBF,cAAtB,EAAsCF,YAAY,CAACxQ,CAAD,CAAlD;AACD;;AAEDN,EAAAA,QAAQ,CAAC6O,MAAT;AACA7O,EAAAA,QAAQ,CAACmR,YAAT;AACAnR,EAAAA,QAAQ,CAACoR,UAAT,CAAoB,KAAKtH,IAAL,CAAU,CAAV,CAApB,EAAkC,KAAKA,IAAL,CAAU,CAAV,IAAe,KAAKA,IAAL,CAAUvJ,MAAzB,GAAkC,CAApE;AACD,CA3BD;;AA6BAwF,QAAQ,CAACiE,aAAT,CAAuBlK,SAAvB,CAAiCoL,IAAjC,GAAwC,UAAUlL,QAAV,EAAoBuN,cAApB,EAAoC;AAC1E,MAAIiD,aAAa,GAAGxQ,QAAQ,CAACoP,SAAT,CAAmB,eAAnB,CAApB;AACApP,EAAAA,QAAQ,CAACwM,WAAT,CAAqB,aAArB,EAAoCe,cAApC;AACAiD,EAAAA,aAAa,CAACa,QAAd,CAAuB,KAAKvH,IAAL,CAAUxF,KAAV,EAAvB,EAA0C,KAAKyF,UAA/C;AACA/J,EAAAA,QAAQ,CAAC6O,MAAT;AACA7O,EAAAA,QAAQ,CAACmR,YAAT;AACAnR,EAAAA,QAAQ,CAACoR,UAAT,CAAoB,KAAKrH,UAAzB,EAAqC,KAAKA,UAAL,GAAkB,KAAKD,IAAL,CAAUvJ,MAA5B,GAAqC,CAA1E;AACD,CAPD;AAQA;AACA;AACA;AACA;AACA;;;AAGAwF,QAAQ,CAACjG,SAAT,CAAmBuK,IAAnB,GAA0B,YAAY;AACpC,MAAImD,QAAQ,GAAG,KAAKxN,QAAL,CAAckI,WAAd,GAA4B0C,IAA3C;AACA,MAAI0G,aAAa,GAAG,OAAO9D,QAAP,KAAoB,WAApB,IAAmCA,QAAvD;;AAEA,MAAI,CAAC,KAAKxN,QAAL,CAAckN,QAAnB,EAA6B;AAC3B;AACJ;AACA;AACA;AACA;AACA;AACA;AACI,SAAKlN,QAAL,CAAckN,QAAd,GAAyB,IAAzB;AACD;;AAED,MAAIoE,aAAJ,EAAmB;AACjB,SAAKtR,QAAL,CAAckN,QAAd,CAAuB5B,MAAvB;AACD,GAFD,MAEO;AACL,SAAKtL,QAAL,CAAckN,QAAd,CAAuBvB,OAAvB;AACD;AACF,CApBD;AAqBA;AACA;AACA;;;AAGA,SAASF,eAAT,CAAyB8F,KAAzB,EAAgC;AAC9B,MAAI3L,6BAA6B,CAAC2L,KAAD,CAAjC,EAA0C;AACxC;AACD;;AAED,MAAIvR,QAAQ,GAAG,IAAf;AACA,MAAIwR,MAAM,GAAGxR,QAAQ,CAACyR,eAAT,EAAb;;AAEA,MAAID,MAAM,IAAIA,MAAM,CAACE,QAAP,EAAd,EAAiC;AAC/B;AACD;;AAED,MAAIC,MAAM,GAAGJ,KAAK,CAACI,MAAnB;AAAA,MACIC,OAAO,GAAGL,KAAK,CAACK,OADpB;AAAA,MAEIC,OAAO,GAAGN,KAAK,CAACM,OAFpB;AAAA,MAGIC,OAAO,GAAGP,KAAK,CAACO,OAHpB;AAAA,MAIIC,QAAQ,GAAGR,KAAK,CAACQ,QAJrB;AAKA,MAAIC,UAAU,GAAG,CAACJ,OAAO,IAAIE,OAAZ,KAAwB,CAACH,MAA1C;;AAEA,MAAI,CAACK,UAAL,EAAiB;AACf;AACD;;AAED,MAAIC,YAAY,GAAGJ,OAAO,KAAK,EAAZ,IAAkBE,QAAQ,IAAIF,OAAO,KAAK,EAA7D;;AAEA,MAAII,YAAJ,EAAkB;AAChB;AACAjS,IAAAA,QAAQ,CAACkN,QAAT,CAAkBhC,IAAlB;AACAvF,IAAAA,wBAAwB,CAAC4L,KAAD,CAAxB;AACD,GAJD,MAIO,IAAIM,OAAO,KAAK,EAAhB,EAAoB;AACzB;AACA7R,IAAAA,QAAQ,CAACkN,QAAT,CAAkBtC,IAAlB;AACAjF,IAAAA,wBAAwB,CAAC4L,KAAD,CAAxB;AACD;AACF;AACD;AACA;AACA;AACA;AACA;;;AAGA,SAAS7F,aAAT,CAAuBpF,OAAvB,EAAgCC,MAAhC,EAAwC;AACtC,MAAIvG,QAAQ,GAAG,IAAf;;AAEA,MAAIuG,MAAM,KAAK,UAAf,EAA2B;AACzB,WAAOvG,QAAQ,CAACkN,QAAT,CAAkB9B,KAAlB,EAAP;AACD;AACF;AACD;AACA;AACA;;;AAGA,SAASI,qBAAT,CAA+BxL,QAA/B,EAAyC;AACvC;AACF;AACA;AACA;AACA;AACA;AACA;AACEA,EAAAA,QAAQ,CAAC4K,IAAT,GAAgB,YAAY;AAC1B,WAAO5K,QAAQ,CAACkN,QAAT,CAAkBtC,IAAlB,EAAP;AACD,GAFD;AAGA;AACF;AACA;AACA;AACA;AACA;AACA;;;AAGE5K,EAAAA,QAAQ,CAACkL,IAAT,GAAgB,YAAY;AAC1B,WAAOlL,QAAQ,CAACkN,QAAT,CAAkBhC,IAAlB,EAAP;AACD,GAFD;AAGA;AACF;AACA;AACA;AACA;AACA;AACA;;;AAGElL,EAAAA,QAAQ,CAAC6K,eAAT,GAA2B,YAAY;AACrC,WAAO7K,QAAQ,CAACkN,QAAT,CAAkBrC,eAAlB,EAAP;AACD,GAFD;AAGA;AACF;AACA;AACA;AACA;AACA;AACA;;;AAGE7K,EAAAA,QAAQ,CAACmL,eAAT,GAA2B,YAAY;AACrC,WAAOnL,QAAQ,CAACkN,QAAT,CAAkB/B,eAAlB,EAAP;AACD,GAFD;AAGA;AACF;AACA;AACA;AACA;AACA;AACA;;;AAGEnL,EAAAA,QAAQ,CAACkS,SAAT,GAAqB,YAAY;AAC/B,WAAOlS,QAAQ,CAACkN,QAAT,CAAkB9B,KAAlB,EAAP;AACD,GAFD;AAGD;AACD;AACA;AACA;;;AAGA,SAASQ,4BAAT,CAAsC5L,QAAtC,EAAgD;AAC9C,SAAOA,QAAQ,CAAC4K,IAAhB;AACA,SAAO5K,QAAQ,CAACkL,IAAhB;AACA,SAAOlL,QAAQ,CAAC6K,eAAhB;AACA,SAAO7K,QAAQ,CAACmL,eAAhB;AACA,SAAOnL,QAAQ,CAACkS,SAAhB;AACD;;AAED,IAAIC,IAAI,GAAG9M,KAAK,CAAC+M,YAAN,EAAX;AACAD,IAAI,CAACE,GAAL,CAAS,qBAAT,EAAgC,YAAY;AAC1C,OAAKjD,SAAL,CAAe,UAAf,EAA2B/E,IAA3B;AACD,CAFD;AAGA8H,IAAI,CAACG,QAAL,CAAc,YAAd;AACAH,IAAI,CAACG,QAAL,CAAc,WAAd;AACAH,IAAI,CAACG,QAAL,CAAc,YAAd;AACAH,IAAI,CAACG,QAAL,CAAc,WAAd;AACAvM,QAAQ,CAACD,UAAT,GAAsBA,UAAtB;AACA,eAAeC,QAAf","sourcesContent":["function _typeof(obj) { \"@babel/helpers - typeof\"; if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\r\n\r\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\r\n\r\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\r\n\r\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\r\n\r\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function\"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); if (superClass) _setPrototypeOf(subClass, superClass); }\r\n\r\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\r\n\r\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\r\n\r\nfunction _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) { return call; } return _assertThisInitialized(self); }\r\n\r\nfunction _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return self; }\r\n\r\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\r\n\r\nfunction _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }\r\n\r\nfunction _toConsumableArray(arr) { return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread(); }\r\n\r\nfunction _nonIterableSpread() { throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\r\n\r\nfunction _iterableToArray(iter) { if (typeof Symbol !== \"undefined\" && iter[Symbol.iterator] != null || iter[\"@@iterator\"] != null) return Array.from(iter); }\r\n\r\nfunction _arrayWithoutHoles(arr) { if (Array.isArray(arr)) return _arrayLikeToArray(arr); }\r\n\r\nfunction _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest(); }\r\n\r\nfunction _nonIterableRest() { throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\r\n\r\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\r\n\r\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }\r\n\r\nfunction _iterableToArrayLimit(arr, i) { var _i = arr && (typeof Symbol !== \"undefined\" && arr[Symbol.iterator] || arr[\"@@iterator\"]); if (_i == null) return; var _arr = []; var _n = true; var _d = false; var _s, _e; try { for (_i = _i.call(arr); !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"] != null) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; }\r\n\r\nfunction _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }\r\n\r\nimport \"core-js/modules/es.array.find.js\";\r\nimport \"core-js/modules/es.array.reduce.js\";\r\nimport \"core-js/modules/es.array.slice.js\";\r\nimport \"core-js/modules/es.array.splice.js\";\r\nimport \"core-js/modules/es.array.sort.js\";\r\nimport \"core-js/modules/es.array.index-of.js\";\r\nimport \"core-js/modules/es.array.filter.js\";\r\nimport \"core-js/modules/es.array.concat.js\";\r\nimport \"core-js/modules/es.symbol.js\";\r\nimport \"core-js/modules/es.symbol.description.js\";\r\nimport \"core-js/modules/es.object.to-string.js\";\r\nimport \"core-js/modules/es.symbol.iterator.js\";\r\nimport \"core-js/modules/es.array.iterator.js\";\r\nimport \"core-js/modules/es.string.iterator.js\";\r\nimport \"core-js/modules/web.dom-collections.iterator.js\";\r\nimport \"core-js/modules/es.function.name.js\";\r\nimport \"core-js/modules/es.array.from.js\";\r\nimport \"core-js/modules/es.object.set-prototype-of.js\";\r\nimport \"core-js/modules/es.object.get-prototype-of.js\";\r\nimport \"core-js/modules/es.reflect.construct.js\";\r\nimport Hooks from \"../../pluginHooks.mjs\";\r\nimport { arrayMap, arrayEach } from \"../../helpers/array.mjs\";\r\nimport { rangeEach } from \"../../helpers/number.mjs\";\r\nimport { inherit, deepClone } from \"../../helpers/object.mjs\";\r\nimport { stopImmediatePropagation, isImmediatePropagationStopped } from \"../../helpers/dom/event.mjs\";\r\nimport { align } from \"../contextMenu/utils.mjs\";\r\nexport var PLUGIN_KEY = 'undoRedo';\r\n/**\r\n * @description\r\n * Handsontable UndoRedo plugin allows to undo and redo certain actions done in the table.\r\n *\r\n * __Note__, that not all actions are currently undo-able. The UndoRedo plugin is enabled by default.\r\n * @example\r\n * ```js\r\n * undo: true\r\n * ```\r\n * @class UndoRedo\r\n * @plugin UndoRedo\r\n * @param {Core} instance The Handsontable instance.\r\n */\r\n\r\nfunction UndoRedo(instance) {\r\n  var plugin = this;\r\n  this.instance = instance;\r\n  this.doneActions = [];\r\n  this.undoneActions = [];\r\n  this.ignoreNewActions = false;\r\n  this.enabled = false;\r\n  instance.addHook('afterChange', function (changes, source) {\r\n    var _this = this;\r\n\r\n    var changesLen = changes && changes.length;\r\n\r\n    if (!changesLen) {\r\n      return;\r\n    }\r\n\r\n    var hasDifferences = changes.find(function (change) {\r\n      var _change = _slicedToArray(change, 4),\r\n          oldValue = _change[2],\r\n          newValue = _change[3];\r\n\r\n      return oldValue !== newValue;\r\n    });\r\n\r\n    if (!hasDifferences) {\r\n      return;\r\n    }\r\n\r\n    var wrappedAction = function wrappedAction() {\r\n      var clonedChanges = changes.reduce(function (arr, change) {\r\n        arr.push(_toConsumableArray(change));\r\n        return arr;\r\n      }, []);\r\n      arrayEach(clonedChanges, function (change) {\r\n        change[1] = instance.propToCol(change[1]);\r\n      });\r\n      var selected = changesLen > 1 ? _this.getSelected() : [[clonedChanges[0][0], clonedChanges[0][1]]];\r\n      return new UndoRedo.ChangeAction(clonedChanges, selected);\r\n    };\r\n\r\n    plugin.done(wrappedAction, source);\r\n  });\r\n  instance.addHook('afterCreateRow', function (index, amount, source) {\r\n    plugin.done(function () {\r\n      return new UndoRedo.CreateRowAction(index, amount);\r\n    }, source);\r\n  });\r\n  instance.addHook('beforeRemoveRow', function (index, amount, logicRows, source) {\r\n    var wrappedAction = function wrappedAction() {\r\n      var originalData = plugin.instance.getSourceDataArray();\r\n      var rowIndex = (originalData.length + index) % originalData.length;\r\n      var physicalRowIndex = instance.toPhysicalRow(rowIndex);\r\n      var removedData = deepClone(originalData.slice(physicalRowIndex, physicalRowIndex + amount));\r\n      return new UndoRedo.RemoveRowAction(rowIndex, removedData, instance.getSettings().fixedRowsBottom, instance.getSettings().fixedRowsTop);\r\n    };\r\n\r\n    plugin.done(wrappedAction, source);\r\n  });\r\n  instance.addHook('afterCreateCol', function (index, amount, source) {\r\n    plugin.done(function () {\r\n      return new UndoRedo.CreateColumnAction(index, amount);\r\n    }, source);\r\n  });\r\n  instance.addHook('beforeRemoveCol', function (index, amount, logicColumns, source) {\r\n    var wrappedAction = function wrappedAction() {\r\n      var originalData = plugin.instance.getSourceDataArray();\r\n      var columnIndex = (plugin.instance.countCols() + index) % plugin.instance.countCols();\r\n      var removedData = [];\r\n      var headers = [];\r\n      var indexes = [];\r\n      rangeEach(originalData.length - 1, function (i) {\r\n        var column = [];\r\n        var origRow = originalData[i];\r\n        rangeEach(columnIndex, columnIndex + (amount - 1), function (j) {\r\n          column.push(origRow[instance.toPhysicalColumn(j)]);\r\n        });\r\n        removedData.push(column);\r\n      });\r\n      rangeEach(amount - 1, function (i) {\r\n        indexes.push(instance.toPhysicalColumn(columnIndex + i));\r\n      });\r\n\r\n      if (Array.isArray(instance.getSettings().colHeaders)) {\r\n        rangeEach(amount - 1, function (i) {\r\n          headers.push(instance.getSettings().colHeaders[instance.toPhysicalColumn(columnIndex + i)] || null);\r\n        });\r\n      }\r\n\r\n      var columnsMap = instance.columnIndexMapper.getIndexesSequence();\r\n      var rowsMap = instance.rowIndexMapper.getIndexesSequence();\r\n      return new UndoRedo.RemoveColumnAction(columnIndex, indexes, removedData, headers, columnsMap, rowsMap, instance.getSettings().fixedColumnsLeft);\r\n    };\r\n\r\n    plugin.done(wrappedAction, source);\r\n  });\r\n  instance.addHook('beforeCellAlignment', function (stateBefore, range, type, alignment) {\r\n    plugin.done(function () {\r\n      return new UndoRedo.CellAlignmentAction(stateBefore, range, type, alignment);\r\n    });\r\n  });\r\n  instance.addHook('beforeFilter', function (conditionsStack) {\r\n    plugin.done(function () {\r\n      return new UndoRedo.FiltersAction(conditionsStack);\r\n    });\r\n  });\r\n  instance.addHook('beforeRowMove', function (rows, finalIndex) {\r\n    if (rows === false) {\r\n      return;\r\n    }\r\n\r\n    plugin.done(function () {\r\n      return new UndoRedo.RowMoveAction(rows, finalIndex);\r\n    });\r\n  });\r\n  instance.addHook('beforeMergeCells', function (cellRange, auto) {\r\n    if (auto) {\r\n      return;\r\n    }\r\n\r\n    plugin.done(function () {\r\n      return new UndoRedo.MergeCellsAction(instance, cellRange);\r\n    });\r\n  });\r\n  instance.addHook('afterUnmergeCells', function (cellRange, auto) {\r\n    if (auto) {\r\n      return;\r\n    }\r\n\r\n    plugin.done(function () {\r\n      return new UndoRedo.UnmergeCellsAction(instance, cellRange);\r\n    });\r\n  }); // TODO: Why this callback is needed? One test doesn't pass after calling method right after plugin creation (outside the callback).\r\n\r\n  instance.addHook('afterInit', function () {\r\n    plugin.init();\r\n  });\r\n}\r\n/**\r\n * Stash information about performed actions.\r\n *\r\n * @function done\r\n * @memberof UndoRedo#\r\n * @fires Hooks#beforeUndoStackChange\r\n * @fires Hooks#afterUndoStackChange\r\n * @fires Hooks#beforeRedoStackChange\r\n * @fires Hooks#afterRedoStackChange\r\n * @param {Function} wrappedAction The action descriptor wrapped in a closure.\r\n * @param {string} [source] Source of the action. It is defined just for more general actions (not related to plugins).\r\n */\r\n\r\n\r\nUndoRedo.prototype.done = function (wrappedAction, source) {\r\n  if (this.ignoreNewActions) {\r\n    return;\r\n  }\r\n\r\n  var isBlockedByDefault = source === 'UndoRedo.undo' || source === 'UndoRedo.redo' || source === 'auto';\r\n\r\n  if (isBlockedByDefault) {\r\n    return;\r\n  }\r\n\r\n  var doneActionsCopy = this.doneActions.slice();\r\n  var continueAction = this.instance.runHooks('beforeUndoStackChange', doneActionsCopy, source);\r\n\r\n  if (continueAction === false) {\r\n    return;\r\n  }\r\n\r\n  var newAction = wrappedAction();\r\n  var undoneActionsCopy = this.undoneActions.slice();\r\n  this.doneActions.push(newAction);\r\n  this.instance.runHooks('afterUndoStackChange', doneActionsCopy, this.doneActions.slice());\r\n  this.instance.runHooks('beforeRedoStackChange', undoneActionsCopy);\r\n  this.undoneActions.length = 0;\r\n  this.instance.runHooks('afterRedoStackChange', undoneActionsCopy, this.undoneActions.slice());\r\n};\r\n/**\r\n * Undo the last action performed to the table.\r\n *\r\n * @function undo\r\n * @memberof UndoRedo#\r\n * @fires Hooks#beforeUndoStackChange\r\n * @fires Hooks#afterUndoStackChange\r\n * @fires Hooks#beforeRedoStackChange\r\n * @fires Hooks#afterRedoStackChange\r\n * @fires Hooks#beforeUndo\r\n * @fires Hooks#afterUndo\r\n */\r\n\r\n\r\nUndoRedo.prototype.undo = function () {\r\n  if (this.isUndoAvailable()) {\r\n    var doneActionsCopy = this.doneActions.slice();\r\n    this.instance.runHooks('beforeUndoStackChange', doneActionsCopy);\r\n    var action = this.doneActions.pop();\r\n    this.instance.runHooks('afterUndoStackChange', doneActionsCopy, this.doneActions.slice());\r\n    var actionClone = deepClone(action);\r\n    var continueAction = this.instance.runHooks('beforeUndo', actionClone);\r\n\r\n    if (continueAction === false) {\r\n      return;\r\n    }\r\n\r\n    this.ignoreNewActions = true;\r\n    var that = this;\r\n    var undoneActionsCopy = this.undoneActions.slice();\r\n    this.instance.runHooks('beforeRedoStackChange', undoneActionsCopy);\r\n    action.undo(this.instance, function () {\r\n      that.ignoreNewActions = false;\r\n      that.undoneActions.push(action);\r\n    });\r\n    this.instance.runHooks('afterRedoStackChange', undoneActionsCopy, this.undoneActions.slice());\r\n    this.instance.runHooks('afterUndo', actionClone);\r\n  }\r\n};\r\n/**\r\n * Redo the previous action performed to the table (used to reverse an undo).\r\n *\r\n * @function redo\r\n * @memberof UndoRedo#\r\n * @fires Hooks#beforeUndoStackChange\r\n * @fires Hooks#afterUndoStackChange\r\n * @fires Hooks#beforeRedoStackChange\r\n * @fires Hooks#afterRedoStackChange\r\n * @fires Hooks#beforeRedo\r\n * @fires Hooks#afterRedo\r\n */\r\n\r\n\r\nUndoRedo.prototype.redo = function () {\r\n  if (this.isRedoAvailable()) {\r\n    var undoneActionsCopy = this.undoneActions.slice();\r\n    this.instance.runHooks('beforeRedoStackChange', undoneActionsCopy);\r\n    var action = this.undoneActions.pop();\r\n    this.instance.runHooks('afterRedoStackChange', undoneActionsCopy, this.undoneActions.slice());\r\n    var actionClone = deepClone(action);\r\n    var continueAction = this.instance.runHooks('beforeRedo', actionClone);\r\n\r\n    if (continueAction === false) {\r\n      return;\r\n    }\r\n\r\n    this.ignoreNewActions = true;\r\n    var that = this;\r\n    var doneActionsCopy = this.doneActions.slice();\r\n    this.instance.runHooks('beforeUndoStackChange', doneActionsCopy);\r\n    action.redo(this.instance, function () {\r\n      that.ignoreNewActions = false;\r\n      that.doneActions.push(action);\r\n    });\r\n    this.instance.runHooks('afterUndoStackChange', doneActionsCopy, this.doneActions.slice());\r\n    this.instance.runHooks('afterRedo', actionClone);\r\n  }\r\n};\r\n/**\r\n * Checks if undo action is available.\r\n *\r\n * @function isUndoAvailable\r\n * @memberof UndoRedo#\r\n * @returns {boolean} Return `true` if undo can be performed, `false` otherwise.\r\n */\r\n\r\n\r\nUndoRedo.prototype.isUndoAvailable = function () {\r\n  return this.doneActions.length > 0;\r\n};\r\n/**\r\n * Checks if redo action is available.\r\n *\r\n * @function isRedoAvailable\r\n * @memberof UndoRedo#\r\n * @returns {boolean} Return `true` if redo can be performed, `false` otherwise.\r\n */\r\n\r\n\r\nUndoRedo.prototype.isRedoAvailable = function () {\r\n  return this.undoneActions.length > 0;\r\n};\r\n/**\r\n * Clears undo history.\r\n *\r\n * @function clear\r\n * @memberof UndoRedo#\r\n */\r\n\r\n\r\nUndoRedo.prototype.clear = function () {\r\n  this.doneActions.length = 0;\r\n  this.undoneActions.length = 0;\r\n};\r\n/**\r\n * Checks if the plugin is enabled.\r\n *\r\n * @function isEnabled\r\n * @memberof UndoRedo#\r\n * @returns {boolean}\r\n */\r\n\r\n\r\nUndoRedo.prototype.isEnabled = function () {\r\n  return this.enabled;\r\n};\r\n/**\r\n * Enables the plugin.\r\n *\r\n * @function enable\r\n * @memberof UndoRedo#\r\n */\r\n\r\n\r\nUndoRedo.prototype.enable = function () {\r\n  if (this.isEnabled()) {\r\n    return;\r\n  }\r\n\r\n  var hot = this.instance;\r\n  this.enabled = true;\r\n  exposeUndoRedoMethods(hot);\r\n  hot.addHook('beforeKeyDown', onBeforeKeyDown);\r\n  hot.addHook('afterChange', onAfterChange);\r\n};\r\n/**\r\n * Disables the plugin.\r\n *\r\n * @function disable\r\n * @memberof UndoRedo#\r\n */\r\n\r\n\r\nUndoRedo.prototype.disable = function () {\r\n  if (!this.isEnabled()) {\r\n    return;\r\n  }\r\n\r\n  var hot = this.instance;\r\n  this.enabled = false;\r\n  removeExposedUndoRedoMethods(hot);\r\n  hot.removeHook('beforeKeyDown', onBeforeKeyDown);\r\n  hot.removeHook('afterChange', onAfterChange);\r\n};\r\n/**\r\n * Destroys the instance.\r\n *\r\n * @function destroy\r\n * @memberof UndoRedo#\r\n */\r\n\r\n\r\nUndoRedo.prototype.destroy = function () {\r\n  this.clear();\r\n  this.instance = null;\r\n  this.doneActions = null;\r\n  this.undoneActions = null;\r\n};\r\n\r\nUndoRedo.Action = function () {};\r\n\r\nUndoRedo.Action.prototype.undo = function () {};\r\n\r\nUndoRedo.Action.prototype.redo = function () {};\r\n/**\r\n * Change action.\r\n *\r\n * @private\r\n * @param {Array} changes 2D array containing information about each of the edited cells.\r\n * @param {number[]} selected The cell selection.\r\n */\r\n\r\n\r\nUndoRedo.ChangeAction = function (changes, selected) {\r\n  this.changes = changes;\r\n  this.selected = selected;\r\n  this.actionType = 'change';\r\n};\r\n\r\ninherit(UndoRedo.ChangeAction, UndoRedo.Action);\r\n\r\nUndoRedo.ChangeAction.prototype.undo = function (instance, undoneCallback) {\r\n  var data = deepClone(this.changes);\r\n  var emptyRowsAtTheEnd = instance.countEmptyRows(true);\r\n  var emptyColsAtTheEnd = instance.countEmptyCols(true);\r\n\r\n  for (var i = 0, len = data.length; i < len; i++) {\r\n    data[i].splice(3, 1);\r\n  }\r\n\r\n  instance.addHookOnce('afterChange', undoneCallback);\r\n  instance.setDataAtCell(data, null, null, 'UndoRedo.undo');\r\n\r\n  for (var _i2 = 0, _len = data.length; _i2 < _len; _i2++) {\r\n    var _data$_i = _slicedToArray(data[_i2], 2),\r\n        row = _data$_i[0],\r\n        column = _data$_i[1];\r\n\r\n    if (instance.getSettings().minSpareRows && row + 1 + instance.getSettings().minSpareRows === instance.countRows() && emptyRowsAtTheEnd === instance.getSettings().minSpareRows) {\r\n      instance.alter('remove_row', parseInt(row + 1, 10), instance.getSettings().minSpareRows);\r\n      instance.undoRedo.doneActions.pop();\r\n    }\r\n\r\n    if (instance.getSettings().minSpareCols && column + 1 + instance.getSettings().minSpareCols === instance.countCols() && emptyColsAtTheEnd === instance.getSettings().minSpareCols) {\r\n      instance.alter('remove_col', parseInt(column + 1, 10), instance.getSettings().minSpareCols);\r\n      instance.undoRedo.doneActions.pop();\r\n    }\r\n  }\r\n\r\n  instance.selectCells(this.selected, false, false);\r\n};\r\n\r\nUndoRedo.ChangeAction.prototype.redo = function (instance, onFinishCallback) {\r\n  var data = deepClone(this.changes);\r\n\r\n  for (var i = 0, len = data.length; i < len; i++) {\r\n    data[i].splice(2, 1);\r\n  }\r\n\r\n  instance.addHookOnce('afterChange', onFinishCallback);\r\n  instance.setDataAtCell(data, null, null, 'UndoRedo.redo');\r\n\r\n  if (this.selected) {\r\n    instance.selectCells(this.selected, false, false);\r\n  }\r\n};\r\n/**\r\n * Create row action.\r\n *\r\n * @private\r\n * @param {number} index The visual row index.\r\n * @param {number} amount The number of created rows.\r\n */\r\n\r\n\r\nUndoRedo.CreateRowAction = function (index, amount) {\r\n  this.index = index;\r\n  this.amount = amount;\r\n  this.actionType = 'insert_row';\r\n};\r\n\r\ninherit(UndoRedo.CreateRowAction, UndoRedo.Action);\r\n\r\nUndoRedo.CreateRowAction.prototype.undo = function (instance, undoneCallback) {\r\n  var rowCount = instance.countRows();\r\n  var minSpareRows = instance.getSettings().minSpareRows;\r\n\r\n  if (this.index >= rowCount && this.index - minSpareRows < rowCount) {\r\n    this.index -= minSpareRows; // work around the situation where the needed row was removed due to an 'undo' of a made change\r\n  }\r\n\r\n  instance.addHookOnce('afterRemoveRow', undoneCallback);\r\n  instance.alter('remove_row', this.index, this.amount, 'UndoRedo.undo');\r\n};\r\n\r\nUndoRedo.CreateRowAction.prototype.redo = function (instance, redoneCallback) {\r\n  instance.addHookOnce('afterCreateRow', redoneCallback);\r\n  instance.alter('insert_row', this.index, this.amount, 'UndoRedo.redo');\r\n};\r\n/**\r\n * Remove row action.\r\n *\r\n * @private\r\n * @param {number} index The visual row index.\r\n * @param {Array} data The removed data.\r\n * @param {number} fixedRowsBottom Number of fixed rows on the bottom. Remove row action change it sometimes.\r\n * @param {number} fixedRowsTop Number of fixed rows on the top. Remove row action change it sometimes.\r\n */\r\n\r\n\r\nUndoRedo.RemoveRowAction = function (index, data, fixedRowsBottom, fixedRowsTop) {\r\n  this.index = index;\r\n  this.data = data;\r\n  this.actionType = 'remove_row';\r\n  this.fixedRowsBottom = fixedRowsBottom;\r\n  this.fixedRowsTop = fixedRowsTop;\r\n};\r\n\r\ninherit(UndoRedo.RemoveRowAction, UndoRedo.Action);\r\n\r\nUndoRedo.RemoveRowAction.prototype.undo = function (instance, undoneCallback) {\r\n  var settings = instance.getSettings(); // Changing by the reference as `updateSettings` doesn't work the best.\r\n\r\n  settings.fixedRowsBottom = this.fixedRowsBottom;\r\n  settings.fixedRowsTop = this.fixedRowsTop;\r\n  instance.alter('insert_row', this.index, this.data.length, 'UndoRedo.undo');\r\n  instance.addHookOnce('afterRender', undoneCallback);\r\n  instance.populateFromArray(this.index, 0, this.data, void 0, void 0, 'UndoRedo.undo');\r\n};\r\n\r\nUndoRedo.RemoveRowAction.prototype.redo = function (instance, redoneCallback) {\r\n  instance.addHookOnce('afterRemoveRow', redoneCallback);\r\n  instance.alter('remove_row', this.index, this.data.length, 'UndoRedo.redo');\r\n};\r\n/**\r\n * Create column action.\r\n *\r\n * @private\r\n * @param {number} index The visual column index.\r\n * @param {number} amount The number of created columns.\r\n */\r\n\r\n\r\nUndoRedo.CreateColumnAction = function (index, amount) {\r\n  this.index = index;\r\n  this.amount = amount;\r\n  this.actionType = 'insert_col';\r\n};\r\n\r\ninherit(UndoRedo.CreateColumnAction, UndoRedo.Action);\r\n\r\nUndoRedo.CreateColumnAction.prototype.undo = function (instance, undoneCallback) {\r\n  instance.addHookOnce('afterRemoveCol', undoneCallback);\r\n  instance.alter('remove_col', this.index, this.amount, 'UndoRedo.undo');\r\n};\r\n\r\nUndoRedo.CreateColumnAction.prototype.redo = function (instance, redoneCallback) {\r\n  instance.addHookOnce('afterCreateCol', redoneCallback);\r\n  instance.alter('insert_col', this.index, this.amount, 'UndoRedo.redo');\r\n};\r\n/**\r\n * Remove column action.\r\n *\r\n * @private\r\n * @param {number} index The visual column index.\r\n * @param {number[]} indexes The visual column indexes.\r\n * @param {Array} data The removed data.\r\n * @param {Array} headers The header values.\r\n * @param {number[]} columnPositions The column position.\r\n * @param {number[]} rowPositions The row position.\r\n * @param {number} fixedColumnsLeft Number of fixed columns on the left. Remove column action change it sometimes.\r\n */\r\n\r\n\r\nUndoRedo.RemoveColumnAction = function (index, indexes, data, headers, columnPositions, rowPositions, fixedColumnsLeft) {\r\n  this.index = index;\r\n  this.indexes = indexes;\r\n  this.data = data;\r\n  this.amount = this.data[0].length;\r\n  this.headers = headers;\r\n  this.columnPositions = columnPositions.slice(0);\r\n  this.rowPositions = rowPositions.slice(0);\r\n  this.actionType = 'remove_col';\r\n  this.fixedColumnsLeft = fixedColumnsLeft;\r\n};\r\n\r\ninherit(UndoRedo.RemoveColumnAction, UndoRedo.Action);\r\n\r\nUndoRedo.RemoveColumnAction.prototype.undo = function (instance, undoneCallback) {\r\n  var _this2 = this;\r\n\r\n  var settings = instance.getSettings(); // Changing by the reference as `updateSettings` doesn't work the best.\r\n\r\n  settings.fixedColumnsLeft = this.fixedColumnsLeft;\r\n  var ascendingIndexes = this.indexes.slice(0).sort();\r\n\r\n  var sortByIndexes = function sortByIndexes(elem, j, arr) {\r\n    return arr[_this2.indexes.indexOf(ascendingIndexes[j])];\r\n  };\r\n\r\n  var removedDataLength = this.data.length;\r\n  var sortedData = [];\r\n\r\n  for (var rowIndex = 0; rowIndex < removedDataLength; rowIndex++) {\r\n    sortedData.push(arrayMap(this.data[rowIndex], sortByIndexes));\r\n  }\r\n\r\n  var sortedHeaders = arrayMap(this.headers, sortByIndexes);\r\n  var changes = [];\r\n  instance.alter('insert_col', this.indexes[0], this.indexes.length, 'UndoRedo.undo');\r\n  arrayEach(instance.getSourceDataArray(), function (rowData, rowIndex) {\r\n    arrayEach(ascendingIndexes, function (changedIndex, contiquesIndex) {\r\n      rowData[changedIndex] = sortedData[rowIndex][contiquesIndex];\r\n      changes.push([rowIndex, changedIndex, rowData[changedIndex]]);\r\n    });\r\n  });\r\n  instance.setSourceDataAtCell(changes);\r\n  instance.columnIndexMapper.insertIndexes(ascendingIndexes[0], ascendingIndexes.length);\r\n\r\n  if (typeof this.headers !== 'undefined') {\r\n    arrayEach(sortedHeaders, function (headerData, columnIndex) {\r\n      instance.getSettings().colHeaders[ascendingIndexes[columnIndex]] = headerData;\r\n    });\r\n  }\r\n\r\n  instance.batchExecution(function () {\r\n    // Restore row sequence in a case when all columns are removed. the original\r\n    // row sequence is lost in that case.\r\n    instance.rowIndexMapper.setIndexesSequence(_this2.rowPositions);\r\n    instance.columnIndexMapper.setIndexesSequence(_this2.columnPositions);\r\n  }, true);\r\n  instance.addHookOnce('afterRender', undoneCallback);\r\n  instance.render();\r\n};\r\n\r\nUndoRedo.RemoveColumnAction.prototype.redo = function (instance, redoneCallback) {\r\n  instance.addHookOnce('afterRemoveCol', redoneCallback);\r\n  instance.alter('remove_col', this.index, this.amount, 'UndoRedo.redo');\r\n};\r\n/**\r\n * Cell alignment action.\r\n *\r\n * @private\r\n * @param {Array} stateBefore The previous state.\r\n * @param {object} range The cell range.\r\n * @param {string} type The type of the alignment (\"top\", \"left\", \"bottom\" or \"right\").\r\n * @param {string} alignment The alignment CSS class.\r\n */\r\n\r\n\r\nUndoRedo.CellAlignmentAction = function (stateBefore, range, type, alignment) {\r\n  this.stateBefore = stateBefore;\r\n  this.range = range;\r\n  this.type = type;\r\n  this.alignment = alignment;\r\n};\r\n\r\nUndoRedo.CellAlignmentAction.prototype.undo = function (instance, undoneCallback) {\r\n  var _this3 = this;\r\n\r\n  arrayEach(this.range, function (range) {\r\n    range.forAll(function (row, col) {\r\n      // Alignment classes should only collected within cell ranges. We skip header coordinates.\r\n      if (row >= 0 && col >= 0) {\r\n        instance.setCellMeta(row, col, 'className', _this3.stateBefore[row][col] || ' htLeft');\r\n      }\r\n    });\r\n  });\r\n  instance.addHookOnce('afterRender', undoneCallback);\r\n  instance.render();\r\n};\r\n\r\nUndoRedo.CellAlignmentAction.prototype.redo = function (instance, undoneCallback) {\r\n  align(this.range, this.type, this.alignment, function (row, col) {\r\n    return instance.getCellMeta(row, col);\r\n  }, function (row, col, key, value) {\r\n    return instance.setCellMeta(row, col, key, value);\r\n  });\r\n  instance.addHookOnce('afterRender', undoneCallback);\r\n  instance.render();\r\n};\r\n/**\r\n * Filters action.\r\n *\r\n * @private\r\n * @param {Array} conditionsStack An array of the filter condition.\r\n */\r\n\r\n\r\nUndoRedo.FiltersAction = function (conditionsStack) {\r\n  this.conditionsStack = conditionsStack;\r\n  this.actionType = 'filter';\r\n};\r\n\r\ninherit(UndoRedo.FiltersAction, UndoRedo.Action);\r\n\r\nUndoRedo.FiltersAction.prototype.undo = function (instance, undoneCallback) {\r\n  var filters = instance.getPlugin('filters');\r\n  instance.addHookOnce('afterRender', undoneCallback);\r\n  filters.conditionCollection.importAllConditions(this.conditionsStack.slice(0, this.conditionsStack.length - 1));\r\n  filters.filter();\r\n};\r\n\r\nUndoRedo.FiltersAction.prototype.redo = function (instance, redoneCallback) {\r\n  var filters = instance.getPlugin('filters');\r\n  instance.addHookOnce('afterRender', redoneCallback);\r\n  filters.conditionCollection.importAllConditions(this.conditionsStack);\r\n  filters.filter();\r\n};\r\n/**\r\n * Merge Cells action.\r\n *\r\n * @util\r\n */\r\n\r\n\r\nvar MergeCellsAction = /*#__PURE__*/function (_UndoRedo$Action) {\r\n  _inherits(MergeCellsAction, _UndoRedo$Action);\r\n\r\n  var _super = _createSuper(MergeCellsAction);\r\n\r\n  function MergeCellsAction(instance, cellRange) {\r\n    var _this4;\r\n\r\n    _classCallCheck(this, MergeCellsAction);\r\n\r\n    _this4 = _super.call(this);\r\n    _this4.cellRange = cellRange;\r\n\r\n    var topLeftCorner = _this4.cellRange.getTopLeftCorner();\r\n\r\n    var bottomRightCorner = _this4.cellRange.getBottomRightCorner();\r\n\r\n    _this4.rangeData = instance.getData(topLeftCorner.row, topLeftCorner.col, bottomRightCorner.row, bottomRightCorner.col);\r\n    return _this4;\r\n  }\r\n\r\n  _createClass(MergeCellsAction, [{\r\n    key: \"undo\",\r\n    value: function undo(instance, undoneCallback) {\r\n      var mergeCellsPlugin = instance.getPlugin('mergeCells');\r\n      instance.addHookOnce('afterRender', undoneCallback);\r\n      mergeCellsPlugin.unmergeRange(this.cellRange, true);\r\n      var topLeftCorner = this.cellRange.getTopLeftCorner();\r\n      instance.populateFromArray(topLeftCorner.row, topLeftCorner.col, this.rangeData, void 0, void 0, 'MergeCells');\r\n    }\r\n  }, {\r\n    key: \"redo\",\r\n    value: function redo(instance, redoneCallback) {\r\n      var mergeCellsPlugin = instance.getPlugin('mergeCells');\r\n      instance.addHookOnce('afterRender', redoneCallback);\r\n      mergeCellsPlugin.mergeRange(this.cellRange);\r\n    }\r\n  }]);\r\n\r\n  return MergeCellsAction;\r\n}(UndoRedo.Action);\r\n\r\nUndoRedo.MergeCellsAction = MergeCellsAction;\r\n/**\r\n * Unmerge Cells action.\r\n *\r\n * @util\r\n */\r\n\r\nvar UnmergeCellsAction = /*#__PURE__*/function (_UndoRedo$Action2) {\r\n  _inherits(UnmergeCellsAction, _UndoRedo$Action2);\r\n\r\n  var _super2 = _createSuper(UnmergeCellsAction);\r\n\r\n  function UnmergeCellsAction(instance, cellRange) {\r\n    var _this5;\r\n\r\n    _classCallCheck(this, UnmergeCellsAction);\r\n\r\n    _this5 = _super2.call(this);\r\n    _this5.cellRange = cellRange;\r\n    return _this5;\r\n  }\r\n\r\n  _createClass(UnmergeCellsAction, [{\r\n    key: \"undo\",\r\n    value: function undo(instance, undoneCallback) {\r\n      var mergeCellsPlugin = instance.getPlugin('mergeCells');\r\n      instance.addHookOnce('afterRender', undoneCallback);\r\n      mergeCellsPlugin.mergeRange(this.cellRange, true);\r\n    }\r\n  }, {\r\n    key: \"redo\",\r\n    value: function redo(instance, redoneCallback) {\r\n      var mergeCellsPlugin = instance.getPlugin('mergeCells');\r\n      instance.addHookOnce('afterRender', redoneCallback);\r\n      mergeCellsPlugin.unmergeRange(this.cellRange, true);\r\n      instance.render();\r\n    }\r\n  }]);\r\n\r\n  return UnmergeCellsAction;\r\n}(UndoRedo.Action);\r\n\r\nUndoRedo.UnmergeCellsAction = UnmergeCellsAction;\r\n/**\r\n * ManualRowMove action.\r\n *\r\n * @TODO removeRow undo should works on logical index\r\n * @private\r\n * @param {number[]} rows An array with moved rows.\r\n * @param {number} finalIndex The destination index.\r\n */\r\n\r\nUndoRedo.RowMoveAction = function (rows, finalIndex) {\r\n  this.rows = rows.slice();\r\n  this.finalIndex = finalIndex;\r\n};\r\n\r\ninherit(UndoRedo.RowMoveAction, UndoRedo.Action);\r\n\r\nUndoRedo.RowMoveAction.prototype.undo = function (instance, undoneCallback) {\r\n  var _this6 = this;\r\n\r\n  var manualRowMove = instance.getPlugin('manualRowMove');\r\n  var copyOfRows = [].concat(this.rows);\r\n  var rowsMovedUp = copyOfRows.filter(function (a) {\r\n    return a > _this6.finalIndex;\r\n  });\r\n  var rowsMovedDown = copyOfRows.filter(function (a) {\r\n    return a <= _this6.finalIndex;\r\n  });\r\n  var allMovedRows = rowsMovedUp.sort(function (a, b) {\r\n    return b - a;\r\n  }).concat(rowsMovedDown.sort(function (a, b) {\r\n    return a - b;\r\n  }));\r\n  instance.addHookOnce('afterRender', undoneCallback); // Moving rows from those with higher indexes to those with lower indexes when action was performed from bottom to top\r\n  // Moving rows from those with lower indexes to those with higher indexes when action was performed from top to bottom\r\n\r\n  for (var i = 0; i < allMovedRows.length; i += 1) {\r\n    var newPhysicalRow = instance.toVisualRow(allMovedRows[i]);\r\n    manualRowMove.moveRow(newPhysicalRow, allMovedRows[i]);\r\n  }\r\n\r\n  instance.render();\r\n  instance.deselectCell();\r\n  instance.selectRows(this.rows[0], this.rows[0] + this.rows.length - 1);\r\n};\r\n\r\nUndoRedo.RowMoveAction.prototype.redo = function (instance, redoneCallback) {\r\n  var manualRowMove = instance.getPlugin('manualRowMove');\r\n  instance.addHookOnce('afterRender', redoneCallback);\r\n  manualRowMove.moveRows(this.rows.slice(), this.finalIndex);\r\n  instance.render();\r\n  instance.deselectCell();\r\n  instance.selectRows(this.finalIndex, this.finalIndex + this.rows.length - 1);\r\n};\r\n/**\r\n * Enabling and disabling plugin and attaching its to an instance.\r\n *\r\n * @private\r\n */\r\n\r\n\r\nUndoRedo.prototype.init = function () {\r\n  var settings = this.instance.getSettings().undo;\r\n  var pluginEnabled = typeof settings === 'undefined' || settings;\r\n\r\n  if (!this.instance.undoRedo) {\r\n    /**\r\n     * Instance of Handsontable.UndoRedo Plugin {@link Handsontable.UndoRedo}.\r\n     *\r\n     * @alias undoRedo\r\n     * @memberof! Handsontable.Core#\r\n     * @type {UndoRedo}\r\n     */\r\n    this.instance.undoRedo = this;\r\n  }\r\n\r\n  if (pluginEnabled) {\r\n    this.instance.undoRedo.enable();\r\n  } else {\r\n    this.instance.undoRedo.disable();\r\n  }\r\n};\r\n/**\r\n * @param {Event} event The keyboard event object.\r\n */\r\n\r\n\r\nfunction onBeforeKeyDown(event) {\r\n  if (isImmediatePropagationStopped(event)) {\r\n    return;\r\n  }\r\n\r\n  var instance = this;\r\n  var editor = instance.getActiveEditor();\r\n\r\n  if (editor && editor.isOpened()) {\r\n    return;\r\n  }\r\n\r\n  var altKey = event.altKey,\r\n      ctrlKey = event.ctrlKey,\r\n      keyCode = event.keyCode,\r\n      metaKey = event.metaKey,\r\n      shiftKey = event.shiftKey;\r\n  var isCtrlDown = (ctrlKey || metaKey) && !altKey;\r\n\r\n  if (!isCtrlDown) {\r\n    return;\r\n  }\r\n\r\n  var isRedoHotkey = keyCode === 89 || shiftKey && keyCode === 90;\r\n\r\n  if (isRedoHotkey) {\r\n    // CTRL + Y or CTRL + SHIFT + Z\r\n    instance.undoRedo.redo();\r\n    stopImmediatePropagation(event);\r\n  } else if (keyCode === 90) {\r\n    // CTRL + Z\r\n    instance.undoRedo.undo();\r\n    stopImmediatePropagation(event);\r\n  }\r\n}\r\n/**\r\n * @param {Array} changes 2D array containing information about each of the edited cells.\r\n * @param {string} source String that identifies source of hook call.\r\n * @returns {boolean}\r\n */\r\n\r\n\r\nfunction onAfterChange(changes, source) {\r\n  var instance = this;\r\n\r\n  if (source === 'loadData') {\r\n    return instance.undoRedo.clear();\r\n  }\r\n}\r\n/**\r\n * @param {Core} instance The Handsontable instance.\r\n */\r\n\r\n\r\nfunction exposeUndoRedoMethods(instance) {\r\n  /**\r\n   * {@link UndoRedo#undo}.\r\n   *\r\n   * @alias undo\r\n   * @memberof! Handsontable.Core#\r\n   * @returns {boolean}\r\n   */\r\n  instance.undo = function () {\r\n    return instance.undoRedo.undo();\r\n  };\r\n  /**\r\n   * {@link UndoRedo#redo}.\r\n   *\r\n   * @alias redo\r\n   * @memberof! Handsontable.Core#\r\n   * @returns {boolean}\r\n   */\r\n\r\n\r\n  instance.redo = function () {\r\n    return instance.undoRedo.redo();\r\n  };\r\n  /**\r\n   * {@link UndoRedo#isUndoAvailable}.\r\n   *\r\n   * @alias isUndoAvailable\r\n   * @memberof! Handsontable.Core#\r\n   * @returns {boolean}\r\n   */\r\n\r\n\r\n  instance.isUndoAvailable = function () {\r\n    return instance.undoRedo.isUndoAvailable();\r\n  };\r\n  /**\r\n   * {@link UndoRedo#isRedoAvailable}.\r\n   *\r\n   * @alias isRedoAvailable\r\n   * @memberof! Handsontable.Core#\r\n   * @returns {boolean}\r\n   */\r\n\r\n\r\n  instance.isRedoAvailable = function () {\r\n    return instance.undoRedo.isRedoAvailable();\r\n  };\r\n  /**\r\n   * {@link UndoRedo#clear}.\r\n   *\r\n   * @alias clearUndo\r\n   * @memberof! Handsontable.Core#\r\n   * @returns {boolean}\r\n   */\r\n\r\n\r\n  instance.clearUndo = function () {\r\n    return instance.undoRedo.clear();\r\n  };\r\n}\r\n/**\r\n * @param {Core} instance The Handsontable instance.\r\n */\r\n\r\n\r\nfunction removeExposedUndoRedoMethods(instance) {\r\n  delete instance.undo;\r\n  delete instance.redo;\r\n  delete instance.isUndoAvailable;\r\n  delete instance.isRedoAvailable;\r\n  delete instance.clearUndo;\r\n}\r\n\r\nvar hook = Hooks.getSingleton();\r\nhook.add('afterUpdateSettings', function () {\r\n  this.getPlugin('undoRedo').init();\r\n});\r\nhook.register('beforeUndo');\r\nhook.register('afterUndo');\r\nhook.register('beforeRedo');\r\nhook.register('afterRedo');\r\nUndoRedo.PLUGIN_KEY = PLUGIN_KEY;\r\nexport default UndoRedo;"]},"metadata":{},"sourceType":"module"}