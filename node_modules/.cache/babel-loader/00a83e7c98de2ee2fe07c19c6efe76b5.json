{"ast":null,"code":"function _typeof(obj) {\n  \"@babel/helpers - typeof\";\n\n  if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") {\n    _typeof = function _typeof(obj) {\n      return typeof obj;\n    };\n  } else {\n    _typeof = function _typeof(obj) {\n      return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n    };\n  }\n\n  return _typeof(obj);\n}\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  return Constructor;\n}\n\nfunction _get(target, property, receiver) {\n  if (typeof Reflect !== \"undefined\" && Reflect.get) {\n    _get = Reflect.get;\n  } else {\n    _get = function _get(target, property, receiver) {\n      var base = _superPropBase(target, property);\n\n      if (!base) return;\n      var desc = Object.getOwnPropertyDescriptor(base, property);\n\n      if (desc.get) {\n        return desc.get.call(receiver);\n      }\n\n      return desc.value;\n    };\n  }\n\n  return _get(target, property, receiver || target);\n}\n\nfunction _superPropBase(object, property) {\n  while (!Object.prototype.hasOwnProperty.call(object, property)) {\n    object = _getPrototypeOf(object);\n    if (object === null) break;\n  }\n\n  return object;\n}\n\nfunction _inherits(subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function\");\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      writable: true,\n      configurable: true\n    }\n  });\n  if (superClass) _setPrototypeOf(subClass, superClass);\n}\n\nfunction _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n\n  return _setPrototypeOf(o, p);\n}\n\nfunction _createSuper(Derived) {\n  var hasNativeReflectConstruct = _isNativeReflectConstruct();\n\n  return function _createSuperInternal() {\n    var Super = _getPrototypeOf(Derived),\n        result;\n\n    if (hasNativeReflectConstruct) {\n      var NewTarget = _getPrototypeOf(this).constructor;\n\n      result = Reflect.construct(Super, arguments, NewTarget);\n    } else {\n      result = Super.apply(this, arguments);\n    }\n\n    return _possibleConstructorReturn(this, result);\n  };\n}\n\nfunction _possibleConstructorReturn(self, call) {\n  if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) {\n    return call;\n  }\n\n  return _assertThisInitialized(self);\n}\n\nfunction _assertThisInitialized(self) {\n  if (self === void 0) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return self;\n}\n\nfunction _isNativeReflectConstruct() {\n  if (typeof Reflect === \"undefined\" || !Reflect.construct) return false;\n  if (Reflect.construct.sham) return false;\n  if (typeof Proxy === \"function\") return true;\n\n  try {\n    Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));\n    return true;\n  } catch (e) {\n    return false;\n  }\n}\n\nfunction _getPrototypeOf(o) {\n  _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) {\n    return o.__proto__ || Object.getPrototypeOf(o);\n  };\n  return _getPrototypeOf(o);\n}\n\nimport { addClass, closest, isChildOf, hasClass, offset, outerWidth, outerHeight } from \"../../helpers/dom/element.mjs\";\nimport { deepClone, deepExtend, isObject } from \"../../helpers/object.mjs\";\nimport EventManager from \"../../eventManager.mjs\";\nimport { CellCoords } from \"../../3rdparty/walkontable/src/index.mjs\";\nimport { BasePlugin } from \"../base/index.mjs\";\nimport CommentEditor from \"./commentEditor.mjs\";\nimport { checkSelectionConsistency, markLabelAsSelected } from \"../contextMenu/utils.mjs\";\nimport DisplaySwitch from \"./displaySwitch.mjs\";\nimport * as C from \"../../i18n/constants.mjs\";\nexport var PLUGIN_KEY = 'comments';\nexport var PLUGIN_PRIORITY = 60;\nvar privatePool = new WeakMap();\nvar META_COMMENT = 'comment';\nvar META_COMMENT_VALUE = 'value';\nvar META_STYLE = 'style';\nvar META_READONLY = 'readOnly';\n/* eslint-disable jsdoc/require-description-complete-sentence */\n\n/**\r\n * @class Comments\r\n * @plugin Comments\r\n *\r\n * @description\r\n * This plugin allows setting and managing cell comments by either an option in the context menu or with the use of\r\n * the API.\r\n *\r\n * To enable the plugin, you'll need to set the comments property of the config object to `true`:\r\n * ```js\r\n * comments: true\r\n * ```\r\n *\r\n * or an object with extra predefined plugin config:\r\n *\r\n * ```js\r\n * comments: {\r\n *   displayDelay: 1000\r\n * }\r\n * ```\r\n *\r\n * To add comments at the table initialization, define the `comment` property in the `cell` config array as in an example below.\r\n *\r\n * @example\r\n *\r\n * ```js\r\n * const hot = new Handsontable(document.getElementById('example'), {\r\n *   data: getData(),\r\n *   comments: true,\r\n *   cell: [\r\n *     {row: 1, col: 1, comment: {value: 'Foo'}},\r\n *     {row: 2, col: 2, comment: {value: 'Bar'}}\r\n *   ]\r\n * });\r\n *\r\n * // Access to the Comments plugin instance:\r\n * const commentsPlugin = hot.getPlugin('comments');\r\n *\r\n * // Manage comments programmatically:\r\n * commentsPlugin.setCommentAtCell(1, 6, 'Comment contents');\r\n * commentsPlugin.showAtCell(1, 6);\r\n * commentsPlugin.removeCommentAtCell(1, 6);\r\n *\r\n * // You can also set range once and use proper methods:\r\n * commentsPlugin.setRange({from: {row: 1, col: 6}});\r\n * commentsPlugin.setComment('Comment contents');\r\n * commentsPlugin.show();\r\n * commentsPlugin.removeComment();\r\n * ```\r\n */\n\n/* eslint-enable jsdoc/require-description-complete-sentence */\n\nexport var Comments = /*#__PURE__*/function (_BasePlugin) {\n  _inherits(Comments, _BasePlugin);\n\n  var _super = _createSuper(Comments);\n\n  function Comments(hotInstance) {\n    var _this;\n\n    _classCallCheck(this, Comments);\n\n    _this = _super.call(this, hotInstance);\n    /**\r\n     * Instance of {@link CommentEditor}.\r\n     *\r\n     * @private\r\n     * @type {CommentEditor}\r\n     */\n\n    _this.editor = null;\n    /**\r\n     * Instance of {@link DisplaySwitch}.\r\n     *\r\n     * @private\r\n     * @type {DisplaySwitch}\r\n     */\n\n    _this.displaySwitch = null;\n    /**\r\n     * Instance of {@link EventManager}.\r\n     *\r\n     * @private\r\n     * @type {EventManager}\r\n     */\n\n    _this.eventManager = null;\n    /**\r\n     * Current cell range, an object with `from` property, with `row` and `col` properties (e.q. `{from: {row: 1, col: 6}}`).\r\n     *\r\n     * @type {object}\r\n     */\n\n    _this.range = {};\n    /**\r\n     * @private\r\n     * @type {boolean}\r\n     */\n\n    _this.mouseDown = false;\n    /**\r\n     * @private\r\n     * @type {boolean}\r\n     */\n\n    _this.contextMenuEvent = false;\n    /**\r\n     * @private\r\n     * @type {*}\r\n     */\n\n    _this.timer = null;\n    privatePool.set(_assertThisInitialized(_this), {\n      tempEditorDimensions: {},\n      cellBelowCursor: null\n    });\n    return _this;\n  }\n  /**\r\n   * Checks if the plugin is enabled in the handsontable settings. This method is executed in {@link Hooks#beforeInit}\r\n   * hook and if it returns `true` than the {@link Comments#enablePlugin} method is called.\r\n   *\r\n   * @returns {boolean}\r\n   */\n\n\n  _createClass(Comments, [{\n    key: \"isEnabled\",\n    value: function isEnabled() {\n      return !!this.hot.getSettings()[PLUGIN_KEY];\n    }\n    /**\r\n     * Enables the plugin functionality for this Handsontable instance.\r\n     */\n\n  }, {\n    key: \"enablePlugin\",\n    value: function enablePlugin() {\n      var _this2 = this;\n\n      if (this.enabled) {\n        return;\n      }\n\n      if (!this.editor) {\n        this.editor = new CommentEditor(this.hot.rootDocument);\n      }\n\n      if (!this.eventManager) {\n        this.eventManager = new EventManager(this);\n      }\n\n      if (!this.displaySwitch) {\n        this.displaySwitch = new DisplaySwitch(this.getDisplayDelaySetting());\n      }\n\n      this.addHook('afterContextMenuDefaultOptions', function (options) {\n        return _this2.addToContextMenu(options);\n      });\n      this.addHook('afterRenderer', function (TD, row, col, prop, value, cellProperties) {\n        return _this2.onAfterRenderer(TD, cellProperties);\n      });\n      this.addHook('afterScrollHorizontally', function () {\n        return _this2.hide();\n      });\n      this.addHook('afterScrollVertically', function () {\n        return _this2.hide();\n      });\n      this.addHook('afterBeginEditing', function () {\n        return _this2.onAfterBeginEditing();\n      });\n      this.displaySwitch.addLocalHook('hide', function () {\n        return _this2.hide();\n      });\n      this.displaySwitch.addLocalHook('show', function (row, col) {\n        return _this2.showAtCell(row, col);\n      });\n      this.registerListeners();\n\n      _get(_getPrototypeOf(Comments.prototype), \"enablePlugin\", this).call(this);\n    }\n    /**\r\n     * Updates the plugin state. This method is executed when {@link Core#updateSettings} is invoked.\r\n     */\n\n  }, {\n    key: \"updatePlugin\",\n    value: function updatePlugin() {\n      this.disablePlugin();\n      this.enablePlugin();\n\n      _get(_getPrototypeOf(Comments.prototype), \"updatePlugin\", this).call(this);\n\n      this.displaySwitch.updateDelay(this.getDisplayDelaySetting());\n    }\n    /**\r\n     * Disables the plugin functionality for this Handsontable instance.\r\n     */\n\n  }, {\n    key: \"disablePlugin\",\n    value: function disablePlugin() {\n      _get(_getPrototypeOf(Comments.prototype), \"disablePlugin\", this).call(this);\n    }\n    /**\r\n     * Registers all necessary DOM listeners.\r\n     *\r\n     * @private\r\n     */\n\n  }, {\n    key: \"registerListeners\",\n    value: function registerListeners() {\n      var _this3 = this;\n\n      var rootDocument = this.hot.rootDocument;\n      this.eventManager.addEventListener(rootDocument, 'mouseover', function (event) {\n        return _this3.onMouseOver(event);\n      });\n      this.eventManager.addEventListener(rootDocument, 'mousedown', function (event) {\n        return _this3.onMouseDown(event);\n      });\n      this.eventManager.addEventListener(rootDocument, 'mouseup', function () {\n        return _this3.onMouseUp();\n      });\n      this.eventManager.addEventListener(this.editor.getInputElement(), 'blur', function () {\n        return _this3.onEditorBlur();\n      });\n      this.eventManager.addEventListener(this.editor.getInputElement(), 'mousedown', function (event) {\n        return _this3.onEditorMouseDown(event);\n      });\n      this.eventManager.addEventListener(this.editor.getInputElement(), 'mouseup', function (event) {\n        return _this3.onEditorMouseUp(event);\n      });\n    }\n    /**\r\n     * Sets the current cell range to be able to use general methods like {@link Comments#setComment}, {@link Comments#removeComment}, {@link Comments#show}.\r\n     *\r\n     * @param {object} range Object with `from` property, each with `row` and `col` properties.\r\n     */\n\n  }, {\n    key: \"setRange\",\n    value: function setRange(range) {\n      this.range = range;\n    }\n    /**\r\n     * Clears the currently selected cell.\r\n     */\n\n  }, {\n    key: \"clearRange\",\n    value: function clearRange() {\n      this.range = {};\n    }\n    /**\r\n     * Checks if the event target is a cell containing a comment.\r\n     *\r\n     * @private\r\n     * @param {Event} event DOM event.\r\n     * @returns {boolean}\r\n     */\n\n  }, {\n    key: \"targetIsCellWithComment\",\n    value: function targetIsCellWithComment(event) {\n      var closestCell = closest(event.target, 'TD', 'TBODY');\n      return !!(closestCell && hasClass(closestCell, 'htCommentCell') && closest(closestCell, [this.hot.rootElement]));\n    }\n    /**\r\n     * Checks if the event target is a comment textarea.\r\n     *\r\n     * @private\r\n     * @param {Event} event DOM event.\r\n     * @returns {boolean}\r\n     */\n\n  }, {\n    key: \"targetIsCommentTextArea\",\n    value: function targetIsCommentTextArea(event) {\n      return this.editor.getInputElement() === event.target;\n    }\n    /**\r\n     * Sets a comment for a cell according to the previously set range (see {@link Comments#setRange}).\r\n     *\r\n     * @param {string} value Comment contents.\r\n     */\n\n  }, {\n    key: \"setComment\",\n    value: function setComment(value) {\n      if (!this.range.from) {\n        throw new Error('Before using this method, first set cell range (hot.getPlugin(\"comment\").setRange())');\n      }\n\n      var editorValue = this.editor.getValue();\n      var comment = '';\n\n      if (value !== null && value !== void 0) {\n        comment = value;\n      } else if (editorValue !== null && editorValue !== void 0) {\n        comment = editorValue;\n      }\n\n      var row = this.range.from.row;\n      var col = this.range.from.col;\n      this.updateCommentMeta(row, col, _defineProperty({}, META_COMMENT_VALUE, comment));\n      this.hot.render();\n    }\n    /**\r\n     * Sets a comment for a specified cell.\r\n     *\r\n     * @param {number} row Visual row index.\r\n     * @param {number} column Visual column index.\r\n     * @param {string} value Comment contents.\r\n     */\n\n  }, {\n    key: \"setCommentAtCell\",\n    value: function setCommentAtCell(row, column, value) {\n      this.setRange({\n        from: new CellCoords(row, column)\n      });\n      this.setComment(value);\n    }\n    /**\r\n     * Removes a comment from a cell according to previously set range (see {@link Comments#setRange}).\r\n     *\r\n     * @param {boolean} [forceRender=true] If set to `true`, the table will be re-rendered at the end of the operation.\r\n     */\n\n  }, {\n    key: \"removeComment\",\n    value: function removeComment() {\n      var forceRender = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : true;\n\n      if (!this.range.from) {\n        throw new Error('Before using this method, first set cell range (hot.getPlugin(\"comment\").setRange())');\n      }\n\n      this.hot.setCellMeta(this.range.from.row, this.range.from.col, META_COMMENT, void 0);\n\n      if (forceRender) {\n        this.hot.render();\n      }\n\n      this.hide();\n    }\n    /**\r\n     * Removes a comment from a specified cell.\r\n     *\r\n     * @param {number} row Visual row index.\r\n     * @param {number} column Visual column index.\r\n     * @param {boolean} [forceRender=true] If `true`, the table will be re-rendered at the end of the operation.\r\n     */\n\n  }, {\n    key: \"removeCommentAtCell\",\n    value: function removeCommentAtCell(row, column) {\n      var forceRender = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : true;\n      this.setRange({\n        from: new CellCoords(row, column)\n      });\n      this.removeComment(forceRender);\n    }\n    /**\r\n     * Gets comment from a cell according to previously set range (see {@link Comments#setRange}).\r\n     *\r\n     * @returns {string|undefined} Returns a content of the comment.\r\n     */\n\n  }, {\n    key: \"getComment\",\n    value: function getComment() {\n      var row = this.range.from.row;\n      var column = this.range.from.col;\n      return this.getCommentMeta(row, column, META_COMMENT_VALUE);\n    }\n    /**\r\n     * Gets comment from a cell at the provided coordinates.\r\n     *\r\n     * @param {number} row Visual row index.\r\n     * @param {number} column Visual column index.\r\n     * @returns {string|undefined} Returns a content of the comment.\r\n     */\n\n  }, {\n    key: \"getCommentAtCell\",\n    value: function getCommentAtCell(row, column) {\n      return this.getCommentMeta(row, column, META_COMMENT_VALUE);\n    }\n    /**\r\n     * Shows the comment editor accordingly to the previously set range (see {@link Comments#setRange}).\r\n     *\r\n     * @returns {boolean} Returns `true` if comment editor was shown.\r\n     */\n\n  }, {\n    key: \"show\",\n    value: function show() {\n      if (!this.range.from) {\n        throw new Error('Before using this method, first set cell range (hot.getPlugin(\"comment\").setRange())');\n      }\n\n      var _this$range$from = this.range.from,\n          row = _this$range$from.row,\n          col = _this$range$from.col;\n\n      if (row < 0 || row > this.hot.countSourceRows() - 1 || col < 0 || col > this.hot.countSourceCols() - 1) {\n        return false;\n      }\n\n      var meta = this.hot.getCellMeta(this.range.from.row, this.range.from.col);\n      this.refreshEditor(true);\n      this.editor.setValue(meta[META_COMMENT] ? meta[META_COMMENT][META_COMMENT_VALUE] : null || '');\n\n      if (this.editor.hidden) {\n        this.editor.show();\n      }\n\n      return true;\n    }\n    /**\r\n     * Shows comment editor according to cell coordinates.\r\n     *\r\n     * @param {number} row Visual row index.\r\n     * @param {number} column Visual column index.\r\n     * @returns {boolean} Returns `true` if comment editor was shown.\r\n     */\n\n  }, {\n    key: \"showAtCell\",\n    value: function showAtCell(row, column) {\n      this.setRange({\n        from: new CellCoords(row, column)\n      });\n      return this.show();\n    }\n    /**\r\n     * Hides the comment editor.\r\n     */\n\n  }, {\n    key: \"hide\",\n    value: function hide() {\n      if (!this.editor.hidden) {\n        this.editor.hide();\n      }\n    }\n    /**\r\n     * Refreshes comment editor position and styling.\r\n     *\r\n     * @param {boolean} [force=false] If `true` then recalculation will be forced.\r\n     */\n\n  }, {\n    key: \"refreshEditor\",\n    value: function refreshEditor() {\n      var _renderableRow, _renderableColumn;\n\n      var force = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;\n\n      if (!force && (!this.range.from || !this.editor.isVisible())) {\n        return;\n      }\n\n      var _this$hot = this.hot,\n          rowIndexMapper = _this$hot.rowIndexMapper,\n          columnIndexMapper = _this$hot.columnIndexMapper;\n      var _this$range$from2 = this.range.from,\n          visualRow = _this$range$from2.row,\n          visualColumn = _this$range$from2.col;\n      var renderableRow = rowIndexMapper.getRenderableFromVisualIndex(visualRow);\n      var renderableColumn = columnIndexMapper.getRenderableFromVisualIndex(visualColumn); // Used when the requested row is hidden, and the editor needs to be positioned on the previous row's coords.\n\n      var targetingPreviousRow = renderableRow === null;\n\n      if (renderableRow === null) {\n        renderableRow = rowIndexMapper.getRenderableFromVisualIndex(rowIndexMapper.getFirstNotHiddenIndex(visualRow, -1));\n      }\n\n      if (renderableColumn === null) {\n        renderableColumn = columnIndexMapper.getRenderableFromVisualIndex(columnIndexMapper.getFirstNotHiddenIndex(visualColumn, -1));\n      }\n\n      var isBeforeRenderedRows = renderableRow === null;\n      var isBeforeRenderedColumns = renderableColumn === null;\n      renderableRow = (_renderableRow = renderableRow) !== null && _renderableRow !== void 0 ? _renderableRow : 0;\n      renderableColumn = (_renderableColumn = renderableColumn) !== null && _renderableColumn !== void 0 ? _renderableColumn : 0;\n      var _this$hot2 = this.hot,\n          rootWindow = _this$hot2.rootWindow,\n          wt = _this$hot2.view.wt;\n      var wtTable = wt.wtTable,\n          wtOverlays = wt.wtOverlays,\n          wtViewport = wt.wtViewport;\n      var scrollableElement = wtOverlays.scrollableElement;\n      var TD = wtTable.getCell({\n        row: renderableRow,\n        col: renderableColumn\n      });\n      var cellOffset = offset(TD);\n      var lastColWidth = isBeforeRenderedColumns ? 0 : wtTable.getStretchedColumnWidth(renderableColumn);\n      var lastRowHeight = targetingPreviousRow && !isBeforeRenderedRows ? outerHeight(TD) : 0;\n      var cellTopOffset = cellOffset.top;\n      var cellLeftOffset = cellOffset.left;\n\n      if (wtViewport.hasVerticalScroll() && scrollableElement !== rootWindow) {\n        cellTopOffset -= wtOverlays.topOverlay.getScrollPosition();\n      }\n\n      if (wtViewport.hasHorizontalScroll() && scrollableElement !== rootWindow) {\n        cellLeftOffset -= wtOverlays.leftOverlay.getScrollPosition();\n      }\n\n      var x = cellLeftOffset + lastColWidth;\n      var y = cellTopOffset + lastRowHeight;\n      var commentStyle = this.getCommentMeta(visualRow, visualColumn, META_STYLE);\n      var readOnly = this.getCommentMeta(visualRow, visualColumn, META_READONLY);\n\n      if (commentStyle) {\n        this.editor.setSize(commentStyle.width, commentStyle.height);\n      } else {\n        this.editor.resetSize();\n      }\n\n      this.editor.setReadOnlyState(readOnly);\n      this.editor.setPosition(x, y);\n    }\n    /**\r\n     * Checks if there is a comment for selected range.\r\n     *\r\n     * @private\r\n     * @returns {boolean}\r\n     */\n\n  }, {\n    key: \"checkSelectionCommentsConsistency\",\n    value: function checkSelectionCommentsConsistency() {\n      var selected = this.hot.getSelectedRangeLast();\n\n      if (!selected) {\n        return false;\n      }\n\n      var hasComment = false;\n      var cell = selected.getTopLeftCorner(); // IN EXCEL THERE IS COMMENT ONLY FOR TOP LEFT CELL IN SELECTION\n\n      if (this.getCommentMeta(cell.row, cell.col, META_COMMENT_VALUE)) {\n        hasComment = true;\n      }\n\n      return hasComment;\n    }\n    /**\r\n     * Sets or update the comment-related cell meta.\r\n     *\r\n     * @param {number} row Visual row index.\r\n     * @param {number} column Visual column index.\r\n     * @param {object} metaObject Object defining all the comment-related meta information.\r\n     */\n\n  }, {\n    key: \"updateCommentMeta\",\n    value: function updateCommentMeta(row, column, metaObject) {\n      var oldComment = this.hot.getCellMeta(row, column)[META_COMMENT];\n      var newComment;\n\n      if (oldComment) {\n        newComment = deepClone(oldComment);\n        deepExtend(newComment, metaObject);\n      } else {\n        newComment = metaObject;\n      }\n\n      this.hot.setCellMeta(row, column, META_COMMENT, newComment);\n    }\n    /**\r\n     * Gets the comment related meta information.\r\n     *\r\n     * @param {number} row Visual row index.\r\n     * @param {number} column Visual column index.\r\n     * @param {string} property Cell meta property.\r\n     * @returns {Mixed}\r\n     */\n\n  }, {\n    key: \"getCommentMeta\",\n    value: function getCommentMeta(row, column, property) {\n      var cellMeta = this.hot.getCellMeta(row, column);\n\n      if (!cellMeta[META_COMMENT]) {\n        return void 0;\n      }\n\n      return cellMeta[META_COMMENT][property];\n    }\n    /**\r\n     * `mousedown` event callback.\r\n     *\r\n     * @private\r\n     * @param {MouseEvent} event The `mousedown` event.\r\n     */\n\n  }, {\n    key: \"onMouseDown\",\n    value: function onMouseDown(event) {\n      this.mouseDown = true;\n\n      if (!this.hot.view || !this.hot.view.wt) {\n        return;\n      }\n\n      if (!this.contextMenuEvent && !this.targetIsCommentTextArea(event)) {\n        var eventCell = closest(event.target, 'TD', 'TBODY');\n        var coordinates = null;\n\n        if (eventCell) {\n          coordinates = this.hot.view.wt.wtTable.getCoords(eventCell);\n          coordinates = {\n            row: this.hot.rowIndexMapper.getVisualFromRenderableIndex(coordinates.row),\n            col: this.hot.columnIndexMapper.getVisualFromRenderableIndex(coordinates.col)\n          };\n        }\n\n        if (!eventCell || this.range.from && coordinates && (this.range.from.row !== coordinates.row || this.range.from.col !== coordinates.col)) {\n          this.hide();\n        }\n      }\n\n      this.contextMenuEvent = false;\n    }\n    /**\r\n     * `mouseover` event callback.\r\n     *\r\n     * @private\r\n     * @param {MouseEvent} event The `mouseover` event.\r\n     */\n\n  }, {\n    key: \"onMouseOver\",\n    value: function onMouseOver(event) {\n      var priv = privatePool.get(this);\n      var rootDocument = this.hot.rootDocument;\n      priv.cellBelowCursor = rootDocument.elementFromPoint(event.clientX, event.clientY);\n\n      if (this.mouseDown || this.editor.isFocused() || hasClass(event.target, 'wtBorder') || priv.cellBelowCursor !== event.target || !this.editor) {\n        return;\n      }\n\n      if (this.targetIsCellWithComment(event)) {\n        var coordinates = this.hot.view.wt.wtTable.getCoords(event.target);\n        var range = {\n          from: new CellCoords(this.hot.rowIndexMapper.getVisualFromRenderableIndex(coordinates.row), this.hot.columnIndexMapper.getVisualFromRenderableIndex(coordinates.col))\n        };\n        this.displaySwitch.show(range);\n      } else if (isChildOf(event.target, rootDocument) && !this.targetIsCommentTextArea(event)) {\n        this.displaySwitch.hide();\n      }\n    }\n    /**\r\n     * `mouseup` event callback.\r\n     *\r\n     * @private\r\n     */\n\n  }, {\n    key: \"onMouseUp\",\n    value: function onMouseUp() {\n      this.mouseDown = false;\n    }\n    /**\r\n     * The `afterRenderer` hook callback.\r\n     *\r\n     * @private\r\n     * @param {HTMLTableCellElement} TD The rendered `TD` element.\r\n     * @param {object} cellProperties The rendered cell's property object.\r\n     */\n\n  }, {\n    key: \"onAfterRenderer\",\n    value: function onAfterRenderer(TD, cellProperties) {\n      if (cellProperties[META_COMMENT] && cellProperties[META_COMMENT][META_COMMENT_VALUE]) {\n        addClass(TD, cellProperties.commentedCellClassName);\n      }\n    }\n    /**\r\n     * `blur` event callback for the comment editor.\r\n     *\r\n     * @private\r\n     */\n\n  }, {\n    key: \"onEditorBlur\",\n    value: function onEditorBlur() {\n      this.setComment();\n    }\n    /**\r\n     * `mousedown` hook. Along with `onEditorMouseUp` used to simulate the textarea resizing event.\r\n     *\r\n     * @private\r\n     * @param {MouseEvent} event The `mousedown` event.\r\n     */\n\n  }, {\n    key: \"onEditorMouseDown\",\n    value: function onEditorMouseDown(event) {\n      var priv = privatePool.get(this);\n      priv.tempEditorDimensions = {\n        width: outerWidth(event.target),\n        height: outerHeight(event.target)\n      };\n    }\n    /**\r\n     * `mouseup` hook. Along with `onEditorMouseDown` used to simulate the textarea resizing event.\r\n     *\r\n     * @private\r\n     * @param {MouseEvent} event The `mouseup` event.\r\n     */\n\n  }, {\n    key: \"onEditorMouseUp\",\n    value: function onEditorMouseUp(event) {\n      var priv = privatePool.get(this);\n      var currentWidth = outerWidth(event.target);\n      var currentHeight = outerHeight(event.target);\n\n      if (currentWidth !== priv.tempEditorDimensions.width + 1 || currentHeight !== priv.tempEditorDimensions.height + 2) {\n        this.updateCommentMeta(this.range.from.row, this.range.from.col, _defineProperty({}, META_STYLE, {\n          width: currentWidth,\n          height: currentHeight\n        }));\n      }\n    }\n    /**\r\n     * Context Menu's \"Add comment\" callback. Results in showing the comment editor.\r\n     *\r\n     * @private\r\n     */\n\n  }, {\n    key: \"onContextMenuAddComment\",\n    value: function onContextMenuAddComment() {\n      var _this4 = this;\n\n      this.displaySwitch.cancelHiding();\n      var coords = this.hot.getSelectedRangeLast();\n      this.contextMenuEvent = true;\n      this.setRange({\n        from: coords.highlight\n      });\n      this.show();\n      setTimeout(function () {\n        if (_this4.hot) {\n          _this4.hot.deselectCell();\n\n          _this4.editor.focus();\n        }\n      }, 10);\n    }\n    /**\r\n     * Context Menu's \"remove comment\" callback.\r\n     *\r\n     * @private\r\n     */\n\n  }, {\n    key: \"onContextMenuRemoveComment\",\n    value: function onContextMenuRemoveComment() {\n      var _this5 = this;\n\n      var coords = this.hot.getSelectedRangeLast();\n      this.contextMenuEvent = true;\n      coords.forAll(function (row, column) {\n        if (row >= 0 && column >= 0) {\n          _this5.removeCommentAtCell(row, column, false);\n        }\n      });\n      this.hot.render();\n    }\n    /**\r\n     * Context Menu's \"make comment read-only\" callback.\r\n     *\r\n     * @private\r\n     */\n\n  }, {\n    key: \"onContextMenuMakeReadOnly\",\n    value: function onContextMenuMakeReadOnly() {\n      var _this6 = this;\n\n      var coords = this.hot.getSelectedRangeLast();\n      this.contextMenuEvent = true;\n      coords.forAll(function (row, column) {\n        if (row >= 0 && column >= 0) {\n          var currentState = !!_this6.getCommentMeta(row, column, META_READONLY);\n\n          _this6.updateCommentMeta(row, column, _defineProperty({}, META_READONLY, !currentState));\n        }\n      });\n    }\n    /**\r\n     * Add Comments plugin options to the Context Menu.\r\n     *\r\n     * @private\r\n     * @param {object} defaultOptions The menu options.\r\n     */\n\n  }, {\n    key: \"addToContextMenu\",\n    value: function addToContextMenu(defaultOptions) {\n      var _this7 = this;\n\n      var isThereAnyCellRendered = function isThereAnyCellRendered() {\n        return _this7.hot.rowIndexMapper.getRenderableIndexesLength() > 0 && _this7.hot.columnIndexMapper.getRenderableIndexesLength() > 0;\n      };\n\n      defaultOptions.items.push({\n        name: '---------'\n      }, {\n        key: 'commentsAddEdit',\n        name: function name() {\n          if (_this7.checkSelectionCommentsConsistency()) {\n            return _this7.hot.getTranslatedPhrase(C.CONTEXTMENU_ITEMS_EDIT_COMMENT);\n          }\n\n          return _this7.hot.getTranslatedPhrase(C.CONTEXTMENU_ITEMS_ADD_COMMENT);\n        },\n        callback: function callback() {\n          return _this7.onContextMenuAddComment();\n        },\n        disabled: function disabled() {\n          if (!isThereAnyCellRendered()) {\n            return true;\n          }\n\n          return !(_this7.hot.getSelectedLast() && !_this7.hot.selection.isSelectedByCorner());\n        }\n      }, {\n        key: 'commentsRemove',\n        name: function name() {\n          return this.getTranslatedPhrase(C.CONTEXTMENU_ITEMS_REMOVE_COMMENT);\n        },\n        callback: function callback() {\n          return _this7.onContextMenuRemoveComment();\n        },\n        disabled: function disabled() {\n          if (!isThereAnyCellRendered()) {\n            return true;\n          }\n\n          return !(_this7.hot.getSelectedLast() && !_this7.hot.selection.isSelectedByCorner());\n        }\n      }, {\n        key: 'commentsReadOnly',\n        name: function name() {\n          var _this8 = this;\n\n          var label = this.getTranslatedPhrase(C.CONTEXTMENU_ITEMS_READ_ONLY_COMMENT);\n          var hasProperty = checkSelectionConsistency(this.getSelectedRangeLast(), function (row, col) {\n            var readOnlyProperty = _this8.getCellMeta(row, col)[META_COMMENT];\n\n            if (readOnlyProperty) {\n              readOnlyProperty = readOnlyProperty[META_READONLY];\n            }\n\n            if (readOnlyProperty) {\n              return true;\n            }\n          });\n\n          if (hasProperty) {\n            label = markLabelAsSelected(label);\n          }\n\n          return label;\n        },\n        callback: function callback() {\n          return _this7.onContextMenuMakeReadOnly();\n        },\n        disabled: function disabled() {\n          if (!isThereAnyCellRendered()) {\n            return true;\n          }\n\n          return !(_this7.hot.getSelectedLast() && !_this7.hot.selection.isSelectedByCorner()) || !_this7.checkSelectionCommentsConsistency();\n        }\n      });\n    }\n    /**\r\n     * Get `displayDelay` setting of comment plugin.\r\n     *\r\n     * @private\r\n     * @returns {number|undefined}\r\n     */\n\n  }, {\n    key: \"getDisplayDelaySetting\",\n    value: function getDisplayDelaySetting() {\n      var commentSetting = this.hot.getSettings()[PLUGIN_KEY];\n\n      if (isObject(commentSetting)) {\n        return commentSetting.displayDelay;\n      }\n\n      return void 0;\n    }\n    /**\r\n     * `afterBeginEditing` hook callback.\r\n     *\r\n     * @private\r\n     */\n\n  }, {\n    key: \"onAfterBeginEditing\",\n    value: function onAfterBeginEditing() {\n      this.hide();\n    }\n    /**\r\n     * Destroys the plugin instance.\r\n     */\n\n  }, {\n    key: \"destroy\",\n    value: function destroy() {\n      if (this.editor) {\n        this.editor.destroy();\n      }\n\n      if (this.displaySwitch) {\n        this.displaySwitch.destroy();\n      }\n\n      _get(_getPrototypeOf(Comments.prototype), \"destroy\", this).call(this);\n    }\n  }], [{\n    key: \"PLUGIN_KEY\",\n    get: function get() {\n      return PLUGIN_KEY;\n    }\n  }, {\n    key: \"PLUGIN_PRIORITY\",\n    get: function get() {\n      return PLUGIN_PRIORITY;\n    }\n  }]);\n\n  return Comments;\n}(BasePlugin);","map":{"version":3,"sources":["C:/xampp/htdocs/isotracker-dev/isotracker-react/node_modules/handsontable/plugins/comments/comments.mjs"],"names":["_typeof","obj","Symbol","iterator","constructor","prototype","_defineProperty","key","value","Object","defineProperty","enumerable","configurable","writable","_classCallCheck","instance","Constructor","TypeError","_defineProperties","target","props","i","length","descriptor","_createClass","protoProps","staticProps","_get","property","receiver","Reflect","get","base","_superPropBase","desc","getOwnPropertyDescriptor","call","object","hasOwnProperty","_getPrototypeOf","_inherits","subClass","superClass","create","_setPrototypeOf","o","p","setPrototypeOf","__proto__","_createSuper","Derived","hasNativeReflectConstruct","_isNativeReflectConstruct","_createSuperInternal","Super","result","NewTarget","construct","arguments","apply","_possibleConstructorReturn","self","_assertThisInitialized","ReferenceError","sham","Proxy","Boolean","valueOf","e","getPrototypeOf","addClass","closest","isChildOf","hasClass","offset","outerWidth","outerHeight","deepClone","deepExtend","isObject","EventManager","CellCoords","BasePlugin","CommentEditor","checkSelectionConsistency","markLabelAsSelected","DisplaySwitch","C","PLUGIN_KEY","PLUGIN_PRIORITY","privatePool","WeakMap","META_COMMENT","META_COMMENT_VALUE","META_STYLE","META_READONLY","Comments","_BasePlugin","_super","hotInstance","_this","editor","displaySwitch","eventManager","range","mouseDown","contextMenuEvent","timer","set","tempEditorDimensions","cellBelowCursor","isEnabled","hot","getSettings","enablePlugin","_this2","enabled","rootDocument","getDisplayDelaySetting","addHook","options","addToContextMenu","TD","row","col","prop","cellProperties","onAfterRenderer","hide","onAfterBeginEditing","addLocalHook","showAtCell","registerListeners","updatePlugin","disablePlugin","updateDelay","_this3","addEventListener","event","onMouseOver","onMouseDown","onMouseUp","getInputElement","onEditorBlur","onEditorMouseDown","onEditorMouseUp","setRange","clearRange","targetIsCellWithComment","closestCell","rootElement","targetIsCommentTextArea","setComment","from","Error","editorValue","getValue","comment","updateCommentMeta","render","setCommentAtCell","column","removeComment","forceRender","undefined","setCellMeta","removeCommentAtCell","getComment","getCommentMeta","getCommentAtCell","show","_this$range$from","countSourceRows","countSourceCols","meta","getCellMeta","refreshEditor","setValue","hidden","_renderableRow","_renderableColumn","force","isVisible","_this$hot","rowIndexMapper","columnIndexMapper","_this$range$from2","visualRow","visualColumn","renderableRow","getRenderableFromVisualIndex","renderableColumn","targetingPreviousRow","getFirstNotHiddenIndex","isBeforeRenderedRows","isBeforeRenderedColumns","_this$hot2","rootWindow","wt","view","wtTable","wtOverlays","wtViewport","scrollableElement","getCell","cellOffset","lastColWidth","getStretchedColumnWidth","lastRowHeight","cellTopOffset","top","cellLeftOffset","left","hasVerticalScroll","topOverlay","getScrollPosition","hasHorizontalScroll","leftOverlay","x","y","commentStyle","readOnly","setSize","width","height","resetSize","setReadOnlyState","setPosition","checkSelectionCommentsConsistency","selected","getSelectedRangeLast","hasComment","cell","getTopLeftCorner","metaObject","oldComment","newComment","cellMeta","eventCell","coordinates","getCoords","getVisualFromRenderableIndex","priv","elementFromPoint","clientX","clientY","isFocused","commentedCellClassName","currentWidth","currentHeight","onContextMenuAddComment","_this4","cancelHiding","coords","highlight","setTimeout","deselectCell","focus","onContextMenuRemoveComment","_this5","forAll","onContextMenuMakeReadOnly","_this6","currentState","defaultOptions","_this7","isThereAnyCellRendered","getRenderableIndexesLength","items","push","name","getTranslatedPhrase","CONTEXTMENU_ITEMS_EDIT_COMMENT","CONTEXTMENU_ITEMS_ADD_COMMENT","callback","disabled","getSelectedLast","selection","isSelectedByCorner","CONTEXTMENU_ITEMS_REMOVE_COMMENT","_this8","label","CONTEXTMENU_ITEMS_READ_ONLY_COMMENT","hasProperty","readOnlyProperty","commentSetting","displayDelay","destroy"],"mappings":"AAAA,SAASA,OAAT,CAAiBC,GAAjB,EAAsB;AAAE;;AAA2B,MAAI,OAAOC,MAAP,KAAkB,UAAlB,IAAgC,OAAOA,MAAM,CAACC,QAAd,KAA2B,QAA/D,EAAyE;AAAEH,IAAAA,OAAO,GAAG,SAASA,OAAT,CAAiBC,GAAjB,EAAsB;AAAE,aAAO,OAAOA,GAAd;AAAoB,KAAtD;AAAyD,GAApI,MAA0I;AAAED,IAAAA,OAAO,GAAG,SAASA,OAAT,CAAiBC,GAAjB,EAAsB;AAAE,aAAOA,GAAG,IAAI,OAAOC,MAAP,KAAkB,UAAzB,IAAuCD,GAAG,CAACG,WAAJ,KAAoBF,MAA3D,IAAqED,GAAG,KAAKC,MAAM,CAACG,SAApF,GAAgG,QAAhG,GAA2G,OAAOJ,GAAzH;AAA+H,KAAjK;AAAoK;;AAAC,SAAOD,OAAO,CAACC,GAAD,CAAd;AAAsB;;AAE1X,SAASK,eAAT,CAAyBL,GAAzB,EAA8BM,GAA9B,EAAmCC,KAAnC,EAA0C;AAAE,MAAID,GAAG,IAAIN,GAAX,EAAgB;AAAEQ,IAAAA,MAAM,CAACC,cAAP,CAAsBT,GAAtB,EAA2BM,GAA3B,EAAgC;AAAEC,MAAAA,KAAK,EAAEA,KAAT;AAAgBG,MAAAA,UAAU,EAAE,IAA5B;AAAkCC,MAAAA,YAAY,EAAE,IAAhD;AAAsDC,MAAAA,QAAQ,EAAE;AAAhE,KAAhC;AAA0G,GAA5H,MAAkI;AAAEZ,IAAAA,GAAG,CAACM,GAAD,CAAH,GAAWC,KAAX;AAAmB;;AAAC,SAAOP,GAAP;AAAa;;AAEjN,SAASa,eAAT,CAAyBC,QAAzB,EAAmCC,WAAnC,EAAgD;AAAE,MAAI,EAAED,QAAQ,YAAYC,WAAtB,CAAJ,EAAwC;AAAE,UAAM,IAAIC,SAAJ,CAAc,mCAAd,CAAN;AAA2D;AAAE;;AAEzJ,SAASC,iBAAT,CAA2BC,MAA3B,EAAmCC,KAAnC,EAA0C;AAAE,OAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGD,KAAK,CAACE,MAA1B,EAAkCD,CAAC,EAAnC,EAAuC;AAAE,QAAIE,UAAU,GAAGH,KAAK,CAACC,CAAD,CAAtB;AAA2BE,IAAAA,UAAU,CAACZ,UAAX,GAAwBY,UAAU,CAACZ,UAAX,IAAyB,KAAjD;AAAwDY,IAAAA,UAAU,CAACX,YAAX,GAA0B,IAA1B;AAAgC,QAAI,WAAWW,UAAf,EAA2BA,UAAU,CAACV,QAAX,GAAsB,IAAtB;AAA4BJ,IAAAA,MAAM,CAACC,cAAP,CAAsBS,MAAtB,EAA8BI,UAAU,CAAChB,GAAzC,EAA8CgB,UAA9C;AAA4D;AAAE;;AAE7T,SAASC,YAAT,CAAsBR,WAAtB,EAAmCS,UAAnC,EAA+CC,WAA/C,EAA4D;AAAE,MAAID,UAAJ,EAAgBP,iBAAiB,CAACF,WAAW,CAACX,SAAb,EAAwBoB,UAAxB,CAAjB;AAAsD,MAAIC,WAAJ,EAAiBR,iBAAiB,CAACF,WAAD,EAAcU,WAAd,CAAjB;AAA6C,SAAOV,WAAP;AAAqB;;AAEvN,SAASW,IAAT,CAAcR,MAAd,EAAsBS,QAAtB,EAAgCC,QAAhC,EAA0C;AAAE,MAAI,OAAOC,OAAP,KAAmB,WAAnB,IAAkCA,OAAO,CAACC,GAA9C,EAAmD;AAAEJ,IAAAA,IAAI,GAAGG,OAAO,CAACC,GAAf;AAAqB,GAA1E,MAAgF;AAAEJ,IAAAA,IAAI,GAAG,SAASA,IAAT,CAAcR,MAAd,EAAsBS,QAAtB,EAAgCC,QAAhC,EAA0C;AAAE,UAAIG,IAAI,GAAGC,cAAc,CAACd,MAAD,EAASS,QAAT,CAAzB;;AAA6C,UAAI,CAACI,IAAL,EAAW;AAAQ,UAAIE,IAAI,GAAGzB,MAAM,CAAC0B,wBAAP,CAAgCH,IAAhC,EAAsCJ,QAAtC,CAAX;;AAA4D,UAAIM,IAAI,CAACH,GAAT,EAAc;AAAE,eAAOG,IAAI,CAACH,GAAL,CAASK,IAAT,CAAcP,QAAd,CAAP;AAAiC;;AAAC,aAAOK,IAAI,CAAC1B,KAAZ;AAAoB,KAArP;AAAwP;;AAAC,SAAOmB,IAAI,CAACR,MAAD,EAASS,QAAT,EAAmBC,QAAQ,IAAIV,MAA/B,CAAX;AAAoD;;AAE3a,SAASc,cAAT,CAAwBI,MAAxB,EAAgCT,QAAhC,EAA0C;AAAE,SAAO,CAACnB,MAAM,CAACJ,SAAP,CAAiBiC,cAAjB,CAAgCF,IAAhC,CAAqCC,MAArC,EAA6CT,QAA7C,CAAR,EAAgE;AAAES,IAAAA,MAAM,GAAGE,eAAe,CAACF,MAAD,CAAxB;AAAkC,QAAIA,MAAM,KAAK,IAAf,EAAqB;AAAQ;;AAAC,SAAOA,MAAP;AAAgB;;AAE9L,SAASG,SAAT,CAAmBC,QAAnB,EAA6BC,UAA7B,EAAyC;AAAE,MAAI,OAAOA,UAAP,KAAsB,UAAtB,IAAoCA,UAAU,KAAK,IAAvD,EAA6D;AAAE,UAAM,IAAIzB,SAAJ,CAAc,oDAAd,CAAN;AAA4E;;AAACwB,EAAAA,QAAQ,CAACpC,SAAT,GAAqBI,MAAM,CAACkC,MAAP,CAAcD,UAAU,IAAIA,UAAU,CAACrC,SAAvC,EAAkD;AAAED,IAAAA,WAAW,EAAE;AAAEI,MAAAA,KAAK,EAAEiC,QAAT;AAAmB5B,MAAAA,QAAQ,EAAE,IAA7B;AAAmCD,MAAAA,YAAY,EAAE;AAAjD;AAAf,GAAlD,CAArB;AAAkJ,MAAI8B,UAAJ,EAAgBE,eAAe,CAACH,QAAD,EAAWC,UAAX,CAAf;AAAwC;;AAEjY,SAASE,eAAT,CAAyBC,CAAzB,EAA4BC,CAA5B,EAA+B;AAAEF,EAAAA,eAAe,GAAGnC,MAAM,CAACsC,cAAP,IAAyB,SAASH,eAAT,CAAyBC,CAAzB,EAA4BC,CAA5B,EAA+B;AAAED,IAAAA,CAAC,CAACG,SAAF,GAAcF,CAAd;AAAiB,WAAOD,CAAP;AAAW,GAAxG;;AAA0G,SAAOD,eAAe,CAACC,CAAD,EAAIC,CAAJ,CAAtB;AAA+B;;AAE1K,SAASG,YAAT,CAAsBC,OAAtB,EAA+B;AAAE,MAAIC,yBAAyB,GAAGC,yBAAyB,EAAzD;;AAA6D,SAAO,SAASC,oBAAT,GAAgC;AAAE,QAAIC,KAAK,GAAGf,eAAe,CAACW,OAAD,CAA3B;AAAA,QAAsCK,MAAtC;;AAA8C,QAAIJ,yBAAJ,EAA+B;AAAE,UAAIK,SAAS,GAAGjB,eAAe,CAAC,IAAD,CAAf,CAAsBnC,WAAtC;;AAAmDmD,MAAAA,MAAM,GAAGzB,OAAO,CAAC2B,SAAR,CAAkBH,KAAlB,EAAyBI,SAAzB,EAAoCF,SAApC,CAAT;AAA0D,KAA9I,MAAoJ;AAAED,MAAAA,MAAM,GAAGD,KAAK,CAACK,KAAN,CAAY,IAAZ,EAAkBD,SAAlB,CAAT;AAAwC;;AAAC,WAAOE,0BAA0B,CAAC,IAAD,EAAOL,MAAP,CAAjC;AAAkD,GAAxU;AAA2U;;AAEza,SAASK,0BAAT,CAAoCC,IAApC,EAA0CzB,IAA1C,EAAgD;AAAE,MAAIA,IAAI,KAAKpC,OAAO,CAACoC,IAAD,CAAP,KAAkB,QAAlB,IAA8B,OAAOA,IAAP,KAAgB,UAAnD,CAAR,EAAwE;AAAE,WAAOA,IAAP;AAAc;;AAAC,SAAO0B,sBAAsB,CAACD,IAAD,CAA7B;AAAsC;;AAEjL,SAASC,sBAAT,CAAgCD,IAAhC,EAAsC;AAAE,MAAIA,IAAI,KAAK,KAAK,CAAlB,EAAqB;AAAE,UAAM,IAAIE,cAAJ,CAAmB,2DAAnB,CAAN;AAAwF;;AAAC,SAAOF,IAAP;AAAc;;AAEtK,SAAST,yBAAT,GAAqC;AAAE,MAAI,OAAOtB,OAAP,KAAmB,WAAnB,IAAkC,CAACA,OAAO,CAAC2B,SAA/C,EAA0D,OAAO,KAAP;AAAc,MAAI3B,OAAO,CAAC2B,SAAR,CAAkBO,IAAtB,EAA4B,OAAO,KAAP;AAAc,MAAI,OAAOC,KAAP,KAAiB,UAArB,EAAiC,OAAO,IAAP;;AAAa,MAAI;AAAEC,IAAAA,OAAO,CAAC7D,SAAR,CAAkB8D,OAAlB,CAA0B/B,IAA1B,CAA+BN,OAAO,CAAC2B,SAAR,CAAkBS,OAAlB,EAA2B,EAA3B,EAA+B,YAAY,CAAE,CAA7C,CAA/B;AAAgF,WAAO,IAAP;AAAc,GAApG,CAAqG,OAAOE,CAAP,EAAU;AAAE,WAAO,KAAP;AAAe;AAAE;;AAEzU,SAAS7B,eAAT,CAAyBM,CAAzB,EAA4B;AAAEN,EAAAA,eAAe,GAAG9B,MAAM,CAACsC,cAAP,GAAwBtC,MAAM,CAAC4D,cAA/B,GAAgD,SAAS9B,eAAT,CAAyBM,CAAzB,EAA4B;AAAE,WAAOA,CAAC,CAACG,SAAF,IAAevC,MAAM,CAAC4D,cAAP,CAAsBxB,CAAtB,CAAtB;AAAiD,GAAjJ;AAAmJ,SAAON,eAAe,CAACM,CAAD,CAAtB;AAA4B;;AAgB7M,SAASyB,QAAT,EAAmBC,OAAnB,EAA4BC,SAA5B,EAAuCC,QAAvC,EAAiDC,MAAjD,EAAyDC,UAAzD,EAAqEC,WAArE,QAAwF,+BAAxF;AACA,SAASC,SAAT,EAAoBC,UAApB,EAAgCC,QAAhC,QAAgD,0BAAhD;AACA,OAAOC,YAAP,MAAyB,wBAAzB;AACA,SAASC,UAAT,QAA2B,0CAA3B;AACA,SAASC,UAAT,QAA2B,mBAA3B;AACA,OAAOC,aAAP,MAA0B,qBAA1B;AACA,SAASC,yBAAT,EAAoCC,mBAApC,QAA+D,0BAA/D;AACA,OAAOC,aAAP,MAA0B,qBAA1B;AACA,OAAO,KAAKC,CAAZ,MAAmB,0BAAnB;AACA,OAAO,IAAIC,UAAU,GAAG,UAAjB;AACP,OAAO,IAAIC,eAAe,GAAG,EAAtB;AACP,IAAIC,WAAW,GAAG,IAAIC,OAAJ,EAAlB;AACA,IAAIC,YAAY,GAAG,SAAnB;AACA,IAAIC,kBAAkB,GAAG,OAAzB;AACA,IAAIC,UAAU,GAAG,OAAjB;AACA,IAAIC,aAAa,GAAG,UAApB;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA,OAAO,IAAIC,QAAQ,GAAG,aAAa,UAAUC,WAAV,EAAuB;AACxDzD,EAAAA,SAAS,CAACwD,QAAD,EAAWC,WAAX,CAAT;;AAEA,MAAIC,MAAM,GAAGjD,YAAY,CAAC+C,QAAD,CAAzB;;AAEA,WAASA,QAAT,CAAkBG,WAAlB,EAA+B;AAC7B,QAAIC,KAAJ;;AAEAtF,IAAAA,eAAe,CAAC,IAAD,EAAOkF,QAAP,CAAf;;AAEAI,IAAAA,KAAK,GAAGF,MAAM,CAAC9D,IAAP,CAAY,IAAZ,EAAkB+D,WAAlB,CAAR;AACA;AACJ;AACA;AACA;AACA;AACA;;AAEIC,IAAAA,KAAK,CAACC,MAAN,GAAe,IAAf;AACA;AACJ;AACA;AACA;AACA;AACA;;AAEID,IAAAA,KAAK,CAACE,aAAN,GAAsB,IAAtB;AACA;AACJ;AACA;AACA;AACA;AACA;;AAEIF,IAAAA,KAAK,CAACG,YAAN,GAAqB,IAArB;AACA;AACJ;AACA;AACA;AACA;;AAEIH,IAAAA,KAAK,CAACI,KAAN,GAAc,EAAd;AACA;AACJ;AACA;AACA;;AAEIJ,IAAAA,KAAK,CAACK,SAAN,GAAkB,KAAlB;AACA;AACJ;AACA;AACA;;AAEIL,IAAAA,KAAK,CAACM,gBAAN,GAAyB,KAAzB;AACA;AACJ;AACA;AACA;;AAEIN,IAAAA,KAAK,CAACO,KAAN,GAAc,IAAd;AACAjB,IAAAA,WAAW,CAACkB,GAAZ,CAAgB9C,sBAAsB,CAACsC,KAAD,CAAtC,EAA+C;AAC7CS,MAAAA,oBAAoB,EAAE,EADuB;AAE7CC,MAAAA,eAAe,EAAE;AAF4B,KAA/C;AAIA,WAAOV,KAAP;AACD;AACD;AACF;AACA;AACA;AACA;AACA;;;AAGE5E,EAAAA,YAAY,CAACwE,QAAD,EAAW,CAAC;AACtBzF,IAAAA,GAAG,EAAE,WADiB;AAEtBC,IAAAA,KAAK,EAAE,SAASuG,SAAT,GAAqB;AAC1B,aAAO,CAAC,CAAC,KAAKC,GAAL,CAASC,WAAT,GAAuBzB,UAAvB,CAAT;AACD;AACD;AACJ;AACA;;AAP0B,GAAD,EASpB;AACDjF,IAAAA,GAAG,EAAE,cADJ;AAEDC,IAAAA,KAAK,EAAE,SAAS0G,YAAT,GAAwB;AAC7B,UAAIC,MAAM,GAAG,IAAb;;AAEA,UAAI,KAAKC,OAAT,EAAkB;AAChB;AACD;;AAED,UAAI,CAAC,KAAKf,MAAV,EAAkB;AAChB,aAAKA,MAAL,GAAc,IAAIlB,aAAJ,CAAkB,KAAK6B,GAAL,CAASK,YAA3B,CAAd;AACD;;AAED,UAAI,CAAC,KAAKd,YAAV,EAAwB;AACtB,aAAKA,YAAL,GAAoB,IAAIvB,YAAJ,CAAiB,IAAjB,CAApB;AACD;;AAED,UAAI,CAAC,KAAKsB,aAAV,EAAyB;AACvB,aAAKA,aAAL,GAAqB,IAAIhB,aAAJ,CAAkB,KAAKgC,sBAAL,EAAlB,CAArB;AACD;;AAED,WAAKC,OAAL,CAAa,gCAAb,EAA+C,UAAUC,OAAV,EAAmB;AAChE,eAAOL,MAAM,CAACM,gBAAP,CAAwBD,OAAxB,CAAP;AACD,OAFD;AAGA,WAAKD,OAAL,CAAa,eAAb,EAA8B,UAAUG,EAAV,EAAcC,GAAd,EAAmBC,GAAnB,EAAwBC,IAAxB,EAA8BrH,KAA9B,EAAqCsH,cAArC,EAAqD;AACjF,eAAOX,MAAM,CAACY,eAAP,CAAuBL,EAAvB,EAA2BI,cAA3B,CAAP;AACD,OAFD;AAGA,WAAKP,OAAL,CAAa,yBAAb,EAAwC,YAAY;AAClD,eAAOJ,MAAM,CAACa,IAAP,EAAP;AACD,OAFD;AAGA,WAAKT,OAAL,CAAa,uBAAb,EAAsC,YAAY;AAChD,eAAOJ,MAAM,CAACa,IAAP,EAAP;AACD,OAFD;AAGA,WAAKT,OAAL,CAAa,mBAAb,EAAkC,YAAY;AAC5C,eAAOJ,MAAM,CAACc,mBAAP,EAAP;AACD,OAFD;AAGA,WAAK3B,aAAL,CAAmB4B,YAAnB,CAAgC,MAAhC,EAAwC,YAAY;AAClD,eAAOf,MAAM,CAACa,IAAP,EAAP;AACD,OAFD;AAGA,WAAK1B,aAAL,CAAmB4B,YAAnB,CAAgC,MAAhC,EAAwC,UAAUP,GAAV,EAAeC,GAAf,EAAoB;AAC1D,eAAOT,MAAM,CAACgB,UAAP,CAAkBR,GAAlB,EAAuBC,GAAvB,CAAP;AACD,OAFD;AAGA,WAAKQ,iBAAL;;AAEAzG,MAAAA,IAAI,CAACY,eAAe,CAACyD,QAAQ,CAAC3F,SAAV,CAAhB,EAAsC,cAAtC,EAAsD,IAAtD,CAAJ,CAAgE+B,IAAhE,CAAqE,IAArE;AACD;AACD;AACJ;AACA;;AAhDK,GAToB,EA2DpB;AACD7B,IAAAA,GAAG,EAAE,cADJ;AAEDC,IAAAA,KAAK,EAAE,SAAS6H,YAAT,GAAwB;AAC7B,WAAKC,aAAL;AACA,WAAKpB,YAAL;;AAEAvF,MAAAA,IAAI,CAACY,eAAe,CAACyD,QAAQ,CAAC3F,SAAV,CAAhB,EAAsC,cAAtC,EAAsD,IAAtD,CAAJ,CAAgE+B,IAAhE,CAAqE,IAArE;;AAEA,WAAKkE,aAAL,CAAmBiC,WAAnB,CAA+B,KAAKjB,sBAAL,EAA/B;AACD;AACD;AACJ;AACA;;AAZK,GA3DoB,EAyEpB;AACD/G,IAAAA,GAAG,EAAE,eADJ;AAEDC,IAAAA,KAAK,EAAE,SAAS8H,aAAT,GAAyB;AAC9B3G,MAAAA,IAAI,CAACY,eAAe,CAACyD,QAAQ,CAAC3F,SAAV,CAAhB,EAAsC,eAAtC,EAAuD,IAAvD,CAAJ,CAAiE+B,IAAjE,CAAsE,IAAtE;AACD;AACD;AACJ;AACA;AACA;AACA;;AATK,GAzEoB,EAoFpB;AACD7B,IAAAA,GAAG,EAAE,mBADJ;AAEDC,IAAAA,KAAK,EAAE,SAAS4H,iBAAT,GAA6B;AAClC,UAAII,MAAM,GAAG,IAAb;;AAEA,UAAInB,YAAY,GAAG,KAAKL,GAAL,CAASK,YAA5B;AACA,WAAKd,YAAL,CAAkBkC,gBAAlB,CAAmCpB,YAAnC,EAAiD,WAAjD,EAA8D,UAAUqB,KAAV,EAAiB;AAC7E,eAAOF,MAAM,CAACG,WAAP,CAAmBD,KAAnB,CAAP;AACD,OAFD;AAGA,WAAKnC,YAAL,CAAkBkC,gBAAlB,CAAmCpB,YAAnC,EAAiD,WAAjD,EAA8D,UAAUqB,KAAV,EAAiB;AAC7E,eAAOF,MAAM,CAACI,WAAP,CAAmBF,KAAnB,CAAP;AACD,OAFD;AAGA,WAAKnC,YAAL,CAAkBkC,gBAAlB,CAAmCpB,YAAnC,EAAiD,SAAjD,EAA4D,YAAY;AACtE,eAAOmB,MAAM,CAACK,SAAP,EAAP;AACD,OAFD;AAGA,WAAKtC,YAAL,CAAkBkC,gBAAlB,CAAmC,KAAKpC,MAAL,CAAYyC,eAAZ,EAAnC,EAAkE,MAAlE,EAA0E,YAAY;AACpF,eAAON,MAAM,CAACO,YAAP,EAAP;AACD,OAFD;AAGA,WAAKxC,YAAL,CAAkBkC,gBAAlB,CAAmC,KAAKpC,MAAL,CAAYyC,eAAZ,EAAnC,EAAkE,WAAlE,EAA+E,UAAUJ,KAAV,EAAiB;AAC9F,eAAOF,MAAM,CAACQ,iBAAP,CAAyBN,KAAzB,CAAP;AACD,OAFD;AAGA,WAAKnC,YAAL,CAAkBkC,gBAAlB,CAAmC,KAAKpC,MAAL,CAAYyC,eAAZ,EAAnC,EAAkE,SAAlE,EAA6E,UAAUJ,KAAV,EAAiB;AAC5F,eAAOF,MAAM,CAACS,eAAP,CAAuBP,KAAvB,CAAP;AACD,OAFD;AAGD;AACD;AACJ;AACA;AACA;AACA;;AA7BK,GApFoB,EAmHpB;AACDnI,IAAAA,GAAG,EAAE,UADJ;AAEDC,IAAAA,KAAK,EAAE,SAAS0I,QAAT,CAAkB1C,KAAlB,EAAyB;AAC9B,WAAKA,KAAL,GAAaA,KAAb;AACD;AACD;AACJ;AACA;;AAPK,GAnHoB,EA4HpB;AACDjG,IAAAA,GAAG,EAAE,YADJ;AAEDC,IAAAA,KAAK,EAAE,SAAS2I,UAAT,GAAsB;AAC3B,WAAK3C,KAAL,GAAa,EAAb;AACD;AACD;AACJ;AACA;AACA;AACA;AACA;AACA;;AAXK,GA5HoB,EAyIpB;AACDjG,IAAAA,GAAG,EAAE,yBADJ;AAEDC,IAAAA,KAAK,EAAE,SAAS4I,uBAAT,CAAiCV,KAAjC,EAAwC;AAC7C,UAAIW,WAAW,GAAG9E,OAAO,CAACmE,KAAK,CAACvH,MAAP,EAAe,IAAf,EAAqB,OAArB,CAAzB;AACA,aAAO,CAAC,EAAEkI,WAAW,IAAI5E,QAAQ,CAAC4E,WAAD,EAAc,eAAd,CAAvB,IAAyD9E,OAAO,CAAC8E,WAAD,EAAc,CAAC,KAAKrC,GAAL,CAASsC,WAAV,CAAd,CAAlE,CAAR;AACD;AACD;AACJ;AACA;AACA;AACA;AACA;AACA;;AAZK,GAzIoB,EAuJpB;AACD/I,IAAAA,GAAG,EAAE,yBADJ;AAEDC,IAAAA,KAAK,EAAE,SAAS+I,uBAAT,CAAiCb,KAAjC,EAAwC;AAC7C,aAAO,KAAKrC,MAAL,CAAYyC,eAAZ,OAAkCJ,KAAK,CAACvH,MAA/C;AACD;AACD;AACJ;AACA;AACA;AACA;;AATK,GAvJoB,EAkKpB;AACDZ,IAAAA,GAAG,EAAE,YADJ;AAEDC,IAAAA,KAAK,EAAE,SAASgJ,UAAT,CAAoBhJ,KAApB,EAA2B;AAChC,UAAI,CAAC,KAAKgG,KAAL,CAAWiD,IAAhB,EAAsB;AACpB,cAAM,IAAIC,KAAJ,CAAU,sFAAV,CAAN;AACD;;AAED,UAAIC,WAAW,GAAG,KAAKtD,MAAL,CAAYuD,QAAZ,EAAlB;AACA,UAAIC,OAAO,GAAG,EAAd;;AAEA,UAAIrJ,KAAK,KAAK,IAAV,IAAkBA,KAAK,KAAK,KAAK,CAArC,EAAwC;AACtCqJ,QAAAA,OAAO,GAAGrJ,KAAV;AACD,OAFD,MAEO,IAAImJ,WAAW,KAAK,IAAhB,IAAwBA,WAAW,KAAK,KAAK,CAAjD,EAAoD;AACzDE,QAAAA,OAAO,GAAGF,WAAV;AACD;;AAED,UAAIhC,GAAG,GAAG,KAAKnB,KAAL,CAAWiD,IAAX,CAAgB9B,GAA1B;AACA,UAAIC,GAAG,GAAG,KAAKpB,KAAL,CAAWiD,IAAX,CAAgB7B,GAA1B;AACA,WAAKkC,iBAAL,CAAuBnC,GAAvB,EAA4BC,GAA5B,EAAiCtH,eAAe,CAAC,EAAD,EAAKuF,kBAAL,EAAyBgE,OAAzB,CAAhD;AACA,WAAK7C,GAAL,CAAS+C,MAAT;AACD;AACD;AACJ;AACA;AACA;AACA;AACA;AACA;;AA3BK,GAlKoB,EA+LpB;AACDxJ,IAAAA,GAAG,EAAE,kBADJ;AAEDC,IAAAA,KAAK,EAAE,SAASwJ,gBAAT,CAA0BrC,GAA1B,EAA+BsC,MAA/B,EAAuCzJ,KAAvC,EAA8C;AACnD,WAAK0I,QAAL,CAAc;AACZO,QAAAA,IAAI,EAAE,IAAIxE,UAAJ,CAAe0C,GAAf,EAAoBsC,MAApB;AADM,OAAd;AAGA,WAAKT,UAAL,CAAgBhJ,KAAhB;AACD;AACD;AACJ;AACA;AACA;AACA;;AAZK,GA/LoB,EA6MpB;AACDD,IAAAA,GAAG,EAAE,eADJ;AAEDC,IAAAA,KAAK,EAAE,SAAS0J,aAAT,GAAyB;AAC9B,UAAIC,WAAW,GAAGzG,SAAS,CAACpC,MAAV,GAAmB,CAAnB,IAAwBoC,SAAS,CAAC,CAAD,CAAT,KAAiB0G,SAAzC,GAAqD1G,SAAS,CAAC,CAAD,CAA9D,GAAoE,IAAtF;;AAEA,UAAI,CAAC,KAAK8C,KAAL,CAAWiD,IAAhB,EAAsB;AACpB,cAAM,IAAIC,KAAJ,CAAU,sFAAV,CAAN;AACD;;AAED,WAAK1C,GAAL,CAASqD,WAAT,CAAqB,KAAK7D,KAAL,CAAWiD,IAAX,CAAgB9B,GAArC,EAA0C,KAAKnB,KAAL,CAAWiD,IAAX,CAAgB7B,GAA1D,EAA+DhC,YAA/D,EAA6E,KAAK,CAAlF;;AAEA,UAAIuE,WAAJ,EAAiB;AACf,aAAKnD,GAAL,CAAS+C,MAAT;AACD;;AAED,WAAK/B,IAAL;AACD;AACD;AACJ;AACA;AACA;AACA;AACA;AACA;;AAvBK,GA7MoB,EAsOpB;AACDzH,IAAAA,GAAG,EAAE,qBADJ;AAEDC,IAAAA,KAAK,EAAE,SAAS8J,mBAAT,CAA6B3C,GAA7B,EAAkCsC,MAAlC,EAA0C;AAC/C,UAAIE,WAAW,GAAGzG,SAAS,CAACpC,MAAV,GAAmB,CAAnB,IAAwBoC,SAAS,CAAC,CAAD,CAAT,KAAiB0G,SAAzC,GAAqD1G,SAAS,CAAC,CAAD,CAA9D,GAAoE,IAAtF;AACA,WAAKwF,QAAL,CAAc;AACZO,QAAAA,IAAI,EAAE,IAAIxE,UAAJ,CAAe0C,GAAf,EAAoBsC,MAApB;AADM,OAAd;AAGA,WAAKC,aAAL,CAAmBC,WAAnB;AACD;AACD;AACJ;AACA;AACA;AACA;;AAbK,GAtOoB,EAqPpB;AACD5J,IAAAA,GAAG,EAAE,YADJ;AAEDC,IAAAA,KAAK,EAAE,SAAS+J,UAAT,GAAsB;AAC3B,UAAI5C,GAAG,GAAG,KAAKnB,KAAL,CAAWiD,IAAX,CAAgB9B,GAA1B;AACA,UAAIsC,MAAM,GAAG,KAAKzD,KAAL,CAAWiD,IAAX,CAAgB7B,GAA7B;AACA,aAAO,KAAK4C,cAAL,CAAoB7C,GAApB,EAAyBsC,MAAzB,EAAiCpE,kBAAjC,CAAP;AACD;AACD;AACJ;AACA;AACA;AACA;AACA;AACA;;AAbK,GArPoB,EAoQpB;AACDtF,IAAAA,GAAG,EAAE,kBADJ;AAEDC,IAAAA,KAAK,EAAE,SAASiK,gBAAT,CAA0B9C,GAA1B,EAA+BsC,MAA/B,EAAuC;AAC5C,aAAO,KAAKO,cAAL,CAAoB7C,GAApB,EAAyBsC,MAAzB,EAAiCpE,kBAAjC,CAAP;AACD;AACD;AACJ;AACA;AACA;AACA;;AATK,GApQoB,EA+QpB;AACDtF,IAAAA,GAAG,EAAE,MADJ;AAEDC,IAAAA,KAAK,EAAE,SAASkK,IAAT,GAAgB;AACrB,UAAI,CAAC,KAAKlE,KAAL,CAAWiD,IAAhB,EAAsB;AACpB,cAAM,IAAIC,KAAJ,CAAU,sFAAV,CAAN;AACD;;AAED,UAAIiB,gBAAgB,GAAG,KAAKnE,KAAL,CAAWiD,IAAlC;AAAA,UACI9B,GAAG,GAAGgD,gBAAgB,CAAChD,GAD3B;AAAA,UAEIC,GAAG,GAAG+C,gBAAgB,CAAC/C,GAF3B;;AAIA,UAAID,GAAG,GAAG,CAAN,IAAWA,GAAG,GAAG,KAAKX,GAAL,CAAS4D,eAAT,KAA6B,CAA9C,IAAmDhD,GAAG,GAAG,CAAzD,IAA8DA,GAAG,GAAG,KAAKZ,GAAL,CAAS6D,eAAT,KAA6B,CAArG,EAAwG;AACtG,eAAO,KAAP;AACD;;AAED,UAAIC,IAAI,GAAG,KAAK9D,GAAL,CAAS+D,WAAT,CAAqB,KAAKvE,KAAL,CAAWiD,IAAX,CAAgB9B,GAArC,EAA0C,KAAKnB,KAAL,CAAWiD,IAAX,CAAgB7B,GAA1D,CAAX;AACA,WAAKoD,aAAL,CAAmB,IAAnB;AACA,WAAK3E,MAAL,CAAY4E,QAAZ,CAAqBH,IAAI,CAAClF,YAAD,CAAJ,GAAqBkF,IAAI,CAAClF,YAAD,CAAJ,CAAmBC,kBAAnB,CAArB,GAA8D,QAAQ,EAA3F;;AAEA,UAAI,KAAKQ,MAAL,CAAY6E,MAAhB,EAAwB;AACtB,aAAK7E,MAAL,CAAYqE,IAAZ;AACD;;AAED,aAAO,IAAP;AACD;AACD;AACJ;AACA;AACA;AACA;AACA;AACA;;AA/BK,GA/QoB,EAgTpB;AACDnK,IAAAA,GAAG,EAAE,YADJ;AAEDC,IAAAA,KAAK,EAAE,SAAS2H,UAAT,CAAoBR,GAApB,EAAyBsC,MAAzB,EAAiC;AACtC,WAAKf,QAAL,CAAc;AACZO,QAAAA,IAAI,EAAE,IAAIxE,UAAJ,CAAe0C,GAAf,EAAoBsC,MAApB;AADM,OAAd;AAGA,aAAO,KAAKS,IAAL,EAAP;AACD;AACD;AACJ;AACA;;AAVK,GAhToB,EA4TpB;AACDnK,IAAAA,GAAG,EAAE,MADJ;AAEDC,IAAAA,KAAK,EAAE,SAASwH,IAAT,GAAgB;AACrB,UAAI,CAAC,KAAK3B,MAAL,CAAY6E,MAAjB,EAAyB;AACvB,aAAK7E,MAAL,CAAY2B,IAAZ;AACD;AACF;AACD;AACJ;AACA;AACA;AACA;;AAXK,GA5ToB,EAyUpB;AACDzH,IAAAA,GAAG,EAAE,eADJ;AAEDC,IAAAA,KAAK,EAAE,SAASwK,aAAT,GAAyB;AAC9B,UAAIG,cAAJ,EAAoBC,iBAApB;;AAEA,UAAIC,KAAK,GAAG3H,SAAS,CAACpC,MAAV,GAAmB,CAAnB,IAAwBoC,SAAS,CAAC,CAAD,CAAT,KAAiB0G,SAAzC,GAAqD1G,SAAS,CAAC,CAAD,CAA9D,GAAoE,KAAhF;;AAEA,UAAI,CAAC2H,KAAD,KAAW,CAAC,KAAK7E,KAAL,CAAWiD,IAAZ,IAAoB,CAAC,KAAKpD,MAAL,CAAYiF,SAAZ,EAAhC,CAAJ,EAA8D;AAC5D;AACD;;AAED,UAAIC,SAAS,GAAG,KAAKvE,GAArB;AAAA,UACIwE,cAAc,GAAGD,SAAS,CAACC,cAD/B;AAAA,UAEIC,iBAAiB,GAAGF,SAAS,CAACE,iBAFlC;AAGA,UAAIC,iBAAiB,GAAG,KAAKlF,KAAL,CAAWiD,IAAnC;AAAA,UACIkC,SAAS,GAAGD,iBAAiB,CAAC/D,GADlC;AAAA,UAEIiE,YAAY,GAAGF,iBAAiB,CAAC9D,GAFrC;AAGA,UAAIiE,aAAa,GAAGL,cAAc,CAACM,4BAAf,CAA4CH,SAA5C,CAApB;AACA,UAAII,gBAAgB,GAAGN,iBAAiB,CAACK,4BAAlB,CAA+CF,YAA/C,CAAvB,CAhB8B,CAgBuD;;AAErF,UAAII,oBAAoB,GAAGH,aAAa,KAAK,IAA7C;;AAEA,UAAIA,aAAa,KAAK,IAAtB,EAA4B;AAC1BA,QAAAA,aAAa,GAAGL,cAAc,CAACM,4BAAf,CAA4CN,cAAc,CAACS,sBAAf,CAAsCN,SAAtC,EAAiD,CAAC,CAAlD,CAA5C,CAAhB;AACD;;AAED,UAAII,gBAAgB,KAAK,IAAzB,EAA+B;AAC7BA,QAAAA,gBAAgB,GAAGN,iBAAiB,CAACK,4BAAlB,CAA+CL,iBAAiB,CAACQ,sBAAlB,CAAyCL,YAAzC,EAAuD,CAAC,CAAxD,CAA/C,CAAnB;AACD;;AAED,UAAIM,oBAAoB,GAAGL,aAAa,KAAK,IAA7C;AACA,UAAIM,uBAAuB,GAAGJ,gBAAgB,KAAK,IAAnD;AACAF,MAAAA,aAAa,GAAG,CAACV,cAAc,GAAGU,aAAlB,MAAqC,IAArC,IAA6CV,cAAc,KAAK,KAAK,CAArE,GAAyEA,cAAzE,GAA0F,CAA1G;AACAY,MAAAA,gBAAgB,GAAG,CAACX,iBAAiB,GAAGW,gBAArB,MAA2C,IAA3C,IAAmDX,iBAAiB,KAAK,KAAK,CAA9E,GAAkFA,iBAAlF,GAAsG,CAAzH;AACA,UAAIgB,UAAU,GAAG,KAAKpF,GAAtB;AAAA,UACIqF,UAAU,GAAGD,UAAU,CAACC,UAD5B;AAAA,UAEIC,EAAE,GAAGF,UAAU,CAACG,IAAX,CAAgBD,EAFzB;AAGA,UAAIE,OAAO,GAAGF,EAAE,CAACE,OAAjB;AAAA,UACIC,UAAU,GAAGH,EAAE,CAACG,UADpB;AAAA,UAEIC,UAAU,GAAGJ,EAAE,CAACI,UAFpB;AAGA,UAAIC,iBAAiB,GAAGF,UAAU,CAACE,iBAAnC;AACA,UAAIjF,EAAE,GAAG8E,OAAO,CAACI,OAAR,CAAgB;AACvBjF,QAAAA,GAAG,EAAEkE,aADkB;AAEvBjE,QAAAA,GAAG,EAAEmE;AAFkB,OAAhB,CAAT;AAIA,UAAIc,UAAU,GAAGnI,MAAM,CAACgD,EAAD,CAAvB;AACA,UAAIoF,YAAY,GAAGX,uBAAuB,GAAG,CAAH,GAAOK,OAAO,CAACO,uBAAR,CAAgChB,gBAAhC,CAAjD;AACA,UAAIiB,aAAa,GAAGhB,oBAAoB,IAAI,CAACE,oBAAzB,GAAgDtH,WAAW,CAAC8C,EAAD,CAA3D,GAAkE,CAAtF;AACA,UAAIuF,aAAa,GAAGJ,UAAU,CAACK,GAA/B;AACA,UAAIC,cAAc,GAAGN,UAAU,CAACO,IAAhC;;AAEA,UAAIV,UAAU,CAACW,iBAAX,MAAkCV,iBAAiB,KAAKN,UAA5D,EAAwE;AACtEY,QAAAA,aAAa,IAAIR,UAAU,CAACa,UAAX,CAAsBC,iBAAtB,EAAjB;AACD;;AAED,UAAIb,UAAU,CAACc,mBAAX,MAAoCb,iBAAiB,KAAKN,UAA9D,EAA0E;AACxEc,QAAAA,cAAc,IAAIV,UAAU,CAACgB,WAAX,CAAuBF,iBAAvB,EAAlB;AACD;;AAED,UAAIG,CAAC,GAAGP,cAAc,GAAGL,YAAzB;AACA,UAAIa,CAAC,GAAGV,aAAa,GAAGD,aAAxB;AACA,UAAIY,YAAY,GAAG,KAAKpD,cAAL,CAAoBmB,SAApB,EAA+BC,YAA/B,EAA6C9F,UAA7C,CAAnB;AACA,UAAI+H,QAAQ,GAAG,KAAKrD,cAAL,CAAoBmB,SAApB,EAA+BC,YAA/B,EAA6C7F,aAA7C,CAAf;;AAEA,UAAI6H,YAAJ,EAAkB;AAChB,aAAKvH,MAAL,CAAYyH,OAAZ,CAAoBF,YAAY,CAACG,KAAjC,EAAwCH,YAAY,CAACI,MAArD;AACD,OAFD,MAEO;AACL,aAAK3H,MAAL,CAAY4H,SAAZ;AACD;;AAED,WAAK5H,MAAL,CAAY6H,gBAAZ,CAA6BL,QAA7B;AACA,WAAKxH,MAAL,CAAY8H,WAAZ,CAAwBT,CAAxB,EAA2BC,CAA3B;AACD;AACD;AACJ;AACA;AACA;AACA;AACA;;AA9EK,GAzUoB,EAyZpB;AACDpN,IAAAA,GAAG,EAAE,mCADJ;AAEDC,IAAAA,KAAK,EAAE,SAAS4N,iCAAT,GAA6C;AAClD,UAAIC,QAAQ,GAAG,KAAKrH,GAAL,CAASsH,oBAAT,EAAf;;AAEA,UAAI,CAACD,QAAL,EAAe;AACb,eAAO,KAAP;AACD;;AAED,UAAIE,UAAU,GAAG,KAAjB;AACA,UAAIC,IAAI,GAAGH,QAAQ,CAACI,gBAAT,EAAX,CARkD,CAQV;;AAExC,UAAI,KAAKjE,cAAL,CAAoBgE,IAAI,CAAC7G,GAAzB,EAA8B6G,IAAI,CAAC5G,GAAnC,EAAwC/B,kBAAxC,CAAJ,EAAiE;AAC/D0I,QAAAA,UAAU,GAAG,IAAb;AACD;;AAED,aAAOA,UAAP;AACD;AACD;AACJ;AACA;AACA;AACA;AACA;AACA;;AAxBK,GAzZoB,EAmbpB;AACDhO,IAAAA,GAAG,EAAE,mBADJ;AAEDC,IAAAA,KAAK,EAAE,SAASsJ,iBAAT,CAA2BnC,GAA3B,EAAgCsC,MAAhC,EAAwCyE,UAAxC,EAAoD;AACzD,UAAIC,UAAU,GAAG,KAAK3H,GAAL,CAAS+D,WAAT,CAAqBpD,GAArB,EAA0BsC,MAA1B,EAAkCrE,YAAlC,CAAjB;AACA,UAAIgJ,UAAJ;;AAEA,UAAID,UAAJ,EAAgB;AACdC,QAAAA,UAAU,GAAG/J,SAAS,CAAC8J,UAAD,CAAtB;AACA7J,QAAAA,UAAU,CAAC8J,UAAD,EAAaF,UAAb,CAAV;AACD,OAHD,MAGO;AACLE,QAAAA,UAAU,GAAGF,UAAb;AACD;;AAED,WAAK1H,GAAL,CAASqD,WAAT,CAAqB1C,GAArB,EAA0BsC,MAA1B,EAAkCrE,YAAlC,EAAgDgJ,UAAhD;AACD;AACD;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;;AAtBK,GAnboB,EA2cpB;AACDrO,IAAAA,GAAG,EAAE,gBADJ;AAEDC,IAAAA,KAAK,EAAE,SAASgK,cAAT,CAAwB7C,GAAxB,EAA6BsC,MAA7B,EAAqCrI,QAArC,EAA+C;AACpD,UAAIiN,QAAQ,GAAG,KAAK7H,GAAL,CAAS+D,WAAT,CAAqBpD,GAArB,EAA0BsC,MAA1B,CAAf;;AAEA,UAAI,CAAC4E,QAAQ,CAACjJ,YAAD,CAAb,EAA6B;AAC3B,eAAO,KAAK,CAAZ;AACD;;AAED,aAAOiJ,QAAQ,CAACjJ,YAAD,CAAR,CAAuBhE,QAAvB,CAAP;AACD;AACD;AACJ;AACA;AACA;AACA;AACA;;AAhBK,GA3coB,EA6dpB;AACDrB,IAAAA,GAAG,EAAE,aADJ;AAEDC,IAAAA,KAAK,EAAE,SAASoI,WAAT,CAAqBF,KAArB,EAA4B;AACjC,WAAKjC,SAAL,GAAiB,IAAjB;;AAEA,UAAI,CAAC,KAAKO,GAAL,CAASuF,IAAV,IAAkB,CAAC,KAAKvF,GAAL,CAASuF,IAAT,CAAcD,EAArC,EAAyC;AACvC;AACD;;AAED,UAAI,CAAC,KAAK5F,gBAAN,IAA0B,CAAC,KAAK6C,uBAAL,CAA6Bb,KAA7B,CAA/B,EAAoE;AAClE,YAAIoG,SAAS,GAAGvK,OAAO,CAACmE,KAAK,CAACvH,MAAP,EAAe,IAAf,EAAqB,OAArB,CAAvB;AACA,YAAI4N,WAAW,GAAG,IAAlB;;AAEA,YAAID,SAAJ,EAAe;AACbC,UAAAA,WAAW,GAAG,KAAK/H,GAAL,CAASuF,IAAT,CAAcD,EAAd,CAAiBE,OAAjB,CAAyBwC,SAAzB,CAAmCF,SAAnC,CAAd;AACAC,UAAAA,WAAW,GAAG;AACZpH,YAAAA,GAAG,EAAE,KAAKX,GAAL,CAASwE,cAAT,CAAwByD,4BAAxB,CAAqDF,WAAW,CAACpH,GAAjE,CADO;AAEZC,YAAAA,GAAG,EAAE,KAAKZ,GAAL,CAASyE,iBAAT,CAA2BwD,4BAA3B,CAAwDF,WAAW,CAACnH,GAApE;AAFO,WAAd;AAID;;AAED,YAAI,CAACkH,SAAD,IAAc,KAAKtI,KAAL,CAAWiD,IAAX,IAAmBsF,WAAnB,KAAmC,KAAKvI,KAAL,CAAWiD,IAAX,CAAgB9B,GAAhB,KAAwBoH,WAAW,CAACpH,GAApC,IAA2C,KAAKnB,KAAL,CAAWiD,IAAX,CAAgB7B,GAAhB,KAAwBmH,WAAW,CAACnH,GAAlH,CAAlB,EAA0I;AACxI,eAAKI,IAAL;AACD;AACF;;AAED,WAAKtB,gBAAL,GAAwB,KAAxB;AACD;AACD;AACJ;AACA;AACA;AACA;AACA;;AAjCK,GA7doB,EAggBpB;AACDnG,IAAAA,GAAG,EAAE,aADJ;AAEDC,IAAAA,KAAK,EAAE,SAASmI,WAAT,CAAqBD,KAArB,EAA4B;AACjC,UAAIwG,IAAI,GAAGxJ,WAAW,CAAC3D,GAAZ,CAAgB,IAAhB,CAAX;AACA,UAAIsF,YAAY,GAAG,KAAKL,GAAL,CAASK,YAA5B;AACA6H,MAAAA,IAAI,CAACpI,eAAL,GAAuBO,YAAY,CAAC8H,gBAAb,CAA8BzG,KAAK,CAAC0G,OAApC,EAA6C1G,KAAK,CAAC2G,OAAnD,CAAvB;;AAEA,UAAI,KAAK5I,SAAL,IAAkB,KAAKJ,MAAL,CAAYiJ,SAAZ,EAAlB,IAA6C7K,QAAQ,CAACiE,KAAK,CAACvH,MAAP,EAAe,UAAf,CAArD,IAAmF+N,IAAI,CAACpI,eAAL,KAAyB4B,KAAK,CAACvH,MAAlH,IAA4H,CAAC,KAAKkF,MAAtI,EAA8I;AAC5I;AACD;;AAED,UAAI,KAAK+C,uBAAL,CAA6BV,KAA7B,CAAJ,EAAyC;AACvC,YAAIqG,WAAW,GAAG,KAAK/H,GAAL,CAASuF,IAAT,CAAcD,EAAd,CAAiBE,OAAjB,CAAyBwC,SAAzB,CAAmCtG,KAAK,CAACvH,MAAzC,CAAlB;AACA,YAAIqF,KAAK,GAAG;AACViD,UAAAA,IAAI,EAAE,IAAIxE,UAAJ,CAAe,KAAK+B,GAAL,CAASwE,cAAT,CAAwByD,4BAAxB,CAAqDF,WAAW,CAACpH,GAAjE,CAAf,EAAsF,KAAKX,GAAL,CAASyE,iBAAT,CAA2BwD,4BAA3B,CAAwDF,WAAW,CAACnH,GAApE,CAAtF;AADI,SAAZ;AAGA,aAAKtB,aAAL,CAAmBoE,IAAnB,CAAwBlE,KAAxB;AACD,OAND,MAMO,IAAIhC,SAAS,CAACkE,KAAK,CAACvH,MAAP,EAAekG,YAAf,CAAT,IAAyC,CAAC,KAAKkC,uBAAL,CAA6Bb,KAA7B,CAA9C,EAAmF;AACxF,aAAKpC,aAAL,CAAmB0B,IAAnB;AACD;AACF;AACD;AACJ;AACA;AACA;AACA;;AAzBK,GAhgBoB,EA2hBpB;AACDzH,IAAAA,GAAG,EAAE,WADJ;AAEDC,IAAAA,KAAK,EAAE,SAASqI,SAAT,GAAqB;AAC1B,WAAKpC,SAAL,GAAiB,KAAjB;AACD;AACD;AACJ;AACA;AACA;AACA;AACA;AACA;;AAXK,GA3hBoB,EAwiBpB;AACDlG,IAAAA,GAAG,EAAE,iBADJ;AAEDC,IAAAA,KAAK,EAAE,SAASuH,eAAT,CAAyBL,EAAzB,EAA6BI,cAA7B,EAA6C;AAClD,UAAIA,cAAc,CAAClC,YAAD,CAAd,IAAgCkC,cAAc,CAAClC,YAAD,CAAd,CAA6BC,kBAA7B,CAApC,EAAsF;AACpFvB,QAAAA,QAAQ,CAACoD,EAAD,EAAKI,cAAc,CAACyH,sBAApB,CAAR;AACD;AACF;AACD;AACJ;AACA;AACA;AACA;;AAXK,GAxiBoB,EAqjBpB;AACDhP,IAAAA,GAAG,EAAE,cADJ;AAEDC,IAAAA,KAAK,EAAE,SAASuI,YAAT,GAAwB;AAC7B,WAAKS,UAAL;AACD;AACD;AACJ;AACA;AACA;AACA;AACA;;AAVK,GArjBoB,EAikBpB;AACDjJ,IAAAA,GAAG,EAAE,mBADJ;AAEDC,IAAAA,KAAK,EAAE,SAASwI,iBAAT,CAA2BN,KAA3B,EAAkC;AACvC,UAAIwG,IAAI,GAAGxJ,WAAW,CAAC3D,GAAZ,CAAgB,IAAhB,CAAX;AACAmN,MAAAA,IAAI,CAACrI,oBAAL,GAA4B;AAC1BkH,QAAAA,KAAK,EAAEpJ,UAAU,CAAC+D,KAAK,CAACvH,MAAP,CADS;AAE1B6M,QAAAA,MAAM,EAAEpJ,WAAW,CAAC8D,KAAK,CAACvH,MAAP;AAFO,OAA5B;AAID;AACD;AACJ;AACA;AACA;AACA;AACA;;AAdK,GAjkBoB,EAilBpB;AACDZ,IAAAA,GAAG,EAAE,iBADJ;AAEDC,IAAAA,KAAK,EAAE,SAASyI,eAAT,CAAyBP,KAAzB,EAAgC;AACrC,UAAIwG,IAAI,GAAGxJ,WAAW,CAAC3D,GAAZ,CAAgB,IAAhB,CAAX;AACA,UAAIyN,YAAY,GAAG7K,UAAU,CAAC+D,KAAK,CAACvH,MAAP,CAA7B;AACA,UAAIsO,aAAa,GAAG7K,WAAW,CAAC8D,KAAK,CAACvH,MAAP,CAA/B;;AAEA,UAAIqO,YAAY,KAAKN,IAAI,CAACrI,oBAAL,CAA0BkH,KAA1B,GAAkC,CAAnD,IAAwD0B,aAAa,KAAKP,IAAI,CAACrI,oBAAL,CAA0BmH,MAA1B,GAAmC,CAAjH,EAAoH;AAClH,aAAKlE,iBAAL,CAAuB,KAAKtD,KAAL,CAAWiD,IAAX,CAAgB9B,GAAvC,EAA4C,KAAKnB,KAAL,CAAWiD,IAAX,CAAgB7B,GAA5D,EAAiEtH,eAAe,CAAC,EAAD,EAAKwF,UAAL,EAAiB;AAC/FiI,UAAAA,KAAK,EAAEyB,YADwF;AAE/FxB,UAAAA,MAAM,EAAEyB;AAFuF,SAAjB,CAAhF;AAID;AACF;AACD;AACJ;AACA;AACA;AACA;;AAlBK,GAjlBoB,EAqmBpB;AACDlP,IAAAA,GAAG,EAAE,yBADJ;AAEDC,IAAAA,KAAK,EAAE,SAASkP,uBAAT,GAAmC;AACxC,UAAIC,MAAM,GAAG,IAAb;;AAEA,WAAKrJ,aAAL,CAAmBsJ,YAAnB;AACA,UAAIC,MAAM,GAAG,KAAK7I,GAAL,CAASsH,oBAAT,EAAb;AACA,WAAK5H,gBAAL,GAAwB,IAAxB;AACA,WAAKwC,QAAL,CAAc;AACZO,QAAAA,IAAI,EAAEoG,MAAM,CAACC;AADD,OAAd;AAGA,WAAKpF,IAAL;AACAqF,MAAAA,UAAU,CAAC,YAAY;AACrB,YAAIJ,MAAM,CAAC3I,GAAX,EAAgB;AACd2I,UAAAA,MAAM,CAAC3I,GAAP,CAAWgJ,YAAX;;AAEAL,UAAAA,MAAM,CAACtJ,MAAP,CAAc4J,KAAd;AACD;AACF,OANS,EAMP,EANO,CAAV;AAOD;AACD;AACJ;AACA;AACA;AACA;;AAxBK,GArmBoB,EA+nBpB;AACD1P,IAAAA,GAAG,EAAE,4BADJ;AAEDC,IAAAA,KAAK,EAAE,SAAS0P,0BAAT,GAAsC;AAC3C,UAAIC,MAAM,GAAG,IAAb;;AAEA,UAAIN,MAAM,GAAG,KAAK7I,GAAL,CAASsH,oBAAT,EAAb;AACA,WAAK5H,gBAAL,GAAwB,IAAxB;AACAmJ,MAAAA,MAAM,CAACO,MAAP,CAAc,UAAUzI,GAAV,EAAesC,MAAf,EAAuB;AACnC,YAAItC,GAAG,IAAI,CAAP,IAAYsC,MAAM,IAAI,CAA1B,EAA6B;AAC3BkG,UAAAA,MAAM,CAAC7F,mBAAP,CAA2B3C,GAA3B,EAAgCsC,MAAhC,EAAwC,KAAxC;AACD;AACF,OAJD;AAKA,WAAKjD,GAAL,CAAS+C,MAAT;AACD;AACD;AACJ;AACA;AACA;AACA;;AAlBK,GA/nBoB,EAmpBpB;AACDxJ,IAAAA,GAAG,EAAE,2BADJ;AAEDC,IAAAA,KAAK,EAAE,SAAS6P,yBAAT,GAAqC;AAC1C,UAAIC,MAAM,GAAG,IAAb;;AAEA,UAAIT,MAAM,GAAG,KAAK7I,GAAL,CAASsH,oBAAT,EAAb;AACA,WAAK5H,gBAAL,GAAwB,IAAxB;AACAmJ,MAAAA,MAAM,CAACO,MAAP,CAAc,UAAUzI,GAAV,EAAesC,MAAf,EAAuB;AACnC,YAAItC,GAAG,IAAI,CAAP,IAAYsC,MAAM,IAAI,CAA1B,EAA6B;AAC3B,cAAIsG,YAAY,GAAG,CAAC,CAACD,MAAM,CAAC9F,cAAP,CAAsB7C,GAAtB,EAA2BsC,MAA3B,EAAmClE,aAAnC,CAArB;;AAEAuK,UAAAA,MAAM,CAACxG,iBAAP,CAAyBnC,GAAzB,EAA8BsC,MAA9B,EAAsC3J,eAAe,CAAC,EAAD,EAAKyF,aAAL,EAAoB,CAACwK,YAArB,CAArD;AACD;AACF,OAND;AAOD;AACD;AACJ;AACA;AACA;AACA;AACA;;AApBK,GAnpBoB,EAyqBpB;AACDhQ,IAAAA,GAAG,EAAE,kBADJ;AAEDC,IAAAA,KAAK,EAAE,SAASiH,gBAAT,CAA0B+I,cAA1B,EAA0C;AAC/C,UAAIC,MAAM,GAAG,IAAb;;AAEA,UAAIC,sBAAsB,GAAG,SAASA,sBAAT,GAAkC;AAC7D,eAAOD,MAAM,CAACzJ,GAAP,CAAWwE,cAAX,CAA0BmF,0BAA1B,KAAyD,CAAzD,IAA8DF,MAAM,CAACzJ,GAAP,CAAWyE,iBAAX,CAA6BkF,0BAA7B,KAA4D,CAAjI;AACD,OAFD;;AAIAH,MAAAA,cAAc,CAACI,KAAf,CAAqBC,IAArB,CAA0B;AACxBC,QAAAA,IAAI,EAAE;AADkB,OAA1B,EAEG;AACDvQ,QAAAA,GAAG,EAAE,iBADJ;AAEDuQ,QAAAA,IAAI,EAAE,SAASA,IAAT,GAAgB;AACpB,cAAIL,MAAM,CAACrC,iCAAP,EAAJ,EAAgD;AAC9C,mBAAOqC,MAAM,CAACzJ,GAAP,CAAW+J,mBAAX,CAA+BxL,CAAC,CAACyL,8BAAjC,CAAP;AACD;;AAED,iBAAOP,MAAM,CAACzJ,GAAP,CAAW+J,mBAAX,CAA+BxL,CAAC,CAAC0L,6BAAjC,CAAP;AACD,SARA;AASDC,QAAAA,QAAQ,EAAE,SAASA,QAAT,GAAoB;AAC5B,iBAAOT,MAAM,CAACf,uBAAP,EAAP;AACD,SAXA;AAYDyB,QAAAA,QAAQ,EAAE,SAASA,QAAT,GAAoB;AAC5B,cAAI,CAACT,sBAAsB,EAA3B,EAA+B;AAC7B,mBAAO,IAAP;AACD;;AAED,iBAAO,EAAED,MAAM,CAACzJ,GAAP,CAAWoK,eAAX,MAAgC,CAACX,MAAM,CAACzJ,GAAP,CAAWqK,SAAX,CAAqBC,kBAArB,EAAnC,CAAP;AACD;AAlBA,OAFH,EAqBG;AACD/Q,QAAAA,GAAG,EAAE,gBADJ;AAEDuQ,QAAAA,IAAI,EAAE,SAASA,IAAT,GAAgB;AACpB,iBAAO,KAAKC,mBAAL,CAAyBxL,CAAC,CAACgM,gCAA3B,CAAP;AACD,SAJA;AAKDL,QAAAA,QAAQ,EAAE,SAASA,QAAT,GAAoB;AAC5B,iBAAOT,MAAM,CAACP,0BAAP,EAAP;AACD,SAPA;AAQDiB,QAAAA,QAAQ,EAAE,SAASA,QAAT,GAAoB;AAC5B,cAAI,CAACT,sBAAsB,EAA3B,EAA+B;AAC7B,mBAAO,IAAP;AACD;;AAED,iBAAO,EAAED,MAAM,CAACzJ,GAAP,CAAWoK,eAAX,MAAgC,CAACX,MAAM,CAACzJ,GAAP,CAAWqK,SAAX,CAAqBC,kBAArB,EAAnC,CAAP;AACD;AAdA,OArBH,EAoCG;AACD/Q,QAAAA,GAAG,EAAE,kBADJ;AAEDuQ,QAAAA,IAAI,EAAE,SAASA,IAAT,GAAgB;AACpB,cAAIU,MAAM,GAAG,IAAb;;AAEA,cAAIC,KAAK,GAAG,KAAKV,mBAAL,CAAyBxL,CAAC,CAACmM,mCAA3B,CAAZ;AACA,cAAIC,WAAW,GAAGvM,yBAAyB,CAAC,KAAKkJ,oBAAL,EAAD,EAA8B,UAAU3G,GAAV,EAAeC,GAAf,EAAoB;AAC3F,gBAAIgK,gBAAgB,GAAGJ,MAAM,CAACzG,WAAP,CAAmBpD,GAAnB,EAAwBC,GAAxB,EAA6BhC,YAA7B,CAAvB;;AAEA,gBAAIgM,gBAAJ,EAAsB;AACpBA,cAAAA,gBAAgB,GAAGA,gBAAgB,CAAC7L,aAAD,CAAnC;AACD;;AAED,gBAAI6L,gBAAJ,EAAsB;AACpB,qBAAO,IAAP;AACD;AACF,WAV0C,CAA3C;;AAYA,cAAID,WAAJ,EAAiB;AACfF,YAAAA,KAAK,GAAGpM,mBAAmB,CAACoM,KAAD,CAA3B;AACD;;AAED,iBAAOA,KAAP;AACD,SAvBA;AAwBDP,QAAAA,QAAQ,EAAE,SAASA,QAAT,GAAoB;AAC5B,iBAAOT,MAAM,CAACJ,yBAAP,EAAP;AACD,SA1BA;AA2BDc,QAAAA,QAAQ,EAAE,SAASA,QAAT,GAAoB;AAC5B,cAAI,CAACT,sBAAsB,EAA3B,EAA+B;AAC7B,mBAAO,IAAP;AACD;;AAED,iBAAO,EAAED,MAAM,CAACzJ,GAAP,CAAWoK,eAAX,MAAgC,CAACX,MAAM,CAACzJ,GAAP,CAAWqK,SAAX,CAAqBC,kBAArB,EAAnC,KAAiF,CAACb,MAAM,CAACrC,iCAAP,EAAzF;AACD;AAjCA,OApCH;AAuED;AACD;AACJ;AACA;AACA;AACA;AACA;;AAtFK,GAzqBoB,EAiwBpB;AACD7N,IAAAA,GAAG,EAAE,wBADJ;AAEDC,IAAAA,KAAK,EAAE,SAAS8G,sBAAT,GAAkC;AACvC,UAAIuK,cAAc,GAAG,KAAK7K,GAAL,CAASC,WAAT,GAAuBzB,UAAvB,CAArB;;AAEA,UAAIT,QAAQ,CAAC8M,cAAD,CAAZ,EAA8B;AAC5B,eAAOA,cAAc,CAACC,YAAtB;AACD;;AAED,aAAO,KAAK,CAAZ;AACD;AACD;AACJ;AACA;AACA;AACA;;AAfK,GAjwBoB,EAkxBpB;AACDvR,IAAAA,GAAG,EAAE,qBADJ;AAEDC,IAAAA,KAAK,EAAE,SAASyH,mBAAT,GAA+B;AACpC,WAAKD,IAAL;AACD;AACD;AACJ;AACA;;AAPK,GAlxBoB,EA2xBpB;AACDzH,IAAAA,GAAG,EAAE,SADJ;AAEDC,IAAAA,KAAK,EAAE,SAASuR,OAAT,GAAmB;AACxB,UAAI,KAAK1L,MAAT,EAAiB;AACf,aAAKA,MAAL,CAAY0L,OAAZ;AACD;;AAED,UAAI,KAAKzL,aAAT,EAAwB;AACtB,aAAKA,aAAL,CAAmByL,OAAnB;AACD;;AAEDpQ,MAAAA,IAAI,CAACY,eAAe,CAACyD,QAAQ,CAAC3F,SAAV,CAAhB,EAAsC,SAAtC,EAAiD,IAAjD,CAAJ,CAA2D+B,IAA3D,CAAgE,IAAhE;AACD;AAZA,GA3xBoB,CAAX,EAwyBR,CAAC;AACH7B,IAAAA,GAAG,EAAE,YADF;AAEHwB,IAAAA,GAAG,EAAE,SAASA,GAAT,GAAe;AAClB,aAAOyD,UAAP;AACD;AAJE,GAAD,EAKD;AACDjF,IAAAA,GAAG,EAAE,iBADJ;AAEDwB,IAAAA,GAAG,EAAE,SAASA,GAAT,GAAe;AAClB,aAAO0D,eAAP;AACD;AAJA,GALC,CAxyBQ,CAAZ;;AAozBA,SAAOO,QAAP;AACD,CA/3BkC,CA+3BjCd,UA/3BiC,CAA5B","sourcesContent":["function _typeof(obj) { \"@babel/helpers - typeof\"; if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\r\n\r\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\r\n\r\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\r\n\r\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\r\n\r\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\r\n\r\nfunction _get(target, property, receiver) { if (typeof Reflect !== \"undefined\" && Reflect.get) { _get = Reflect.get; } else { _get = function _get(target, property, receiver) { var base = _superPropBase(target, property); if (!base) return; var desc = Object.getOwnPropertyDescriptor(base, property); if (desc.get) { return desc.get.call(receiver); } return desc.value; }; } return _get(target, property, receiver || target); }\r\n\r\nfunction _superPropBase(object, property) { while (!Object.prototype.hasOwnProperty.call(object, property)) { object = _getPrototypeOf(object); if (object === null) break; } return object; }\r\n\r\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function\"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); if (superClass) _setPrototypeOf(subClass, superClass); }\r\n\r\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\r\n\r\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\r\n\r\nfunction _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) { return call; } return _assertThisInitialized(self); }\r\n\r\nfunction _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return self; }\r\n\r\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\r\n\r\nfunction _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }\r\n\r\nimport \"core-js/modules/es.array.iterator.js\";\r\nimport \"core-js/modules/es.object.to-string.js\";\r\nimport \"core-js/modules/es.string.iterator.js\";\r\nimport \"core-js/modules/es.weak-map.js\";\r\nimport \"core-js/modules/web.dom-collections.iterator.js\";\r\nimport \"core-js/modules/web.timers.js\";\r\nimport \"core-js/modules/es.object.set-prototype-of.js\";\r\nimport \"core-js/modules/es.object.get-prototype-of.js\";\r\nimport \"core-js/modules/es.reflect.construct.js\";\r\nimport \"core-js/modules/es.reflect.get.js\";\r\nimport \"core-js/modules/es.object.get-own-property-descriptor.js\";\r\nimport \"core-js/modules/es.symbol.js\";\r\nimport \"core-js/modules/es.symbol.description.js\";\r\nimport \"core-js/modules/es.symbol.iterator.js\";\r\nimport { addClass, closest, isChildOf, hasClass, offset, outerWidth, outerHeight } from \"../../helpers/dom/element.mjs\";\r\nimport { deepClone, deepExtend, isObject } from \"../../helpers/object.mjs\";\r\nimport EventManager from \"../../eventManager.mjs\";\r\nimport { CellCoords } from \"../../3rdparty/walkontable/src/index.mjs\";\r\nimport { BasePlugin } from \"../base/index.mjs\";\r\nimport CommentEditor from \"./commentEditor.mjs\";\r\nimport { checkSelectionConsistency, markLabelAsSelected } from \"../contextMenu/utils.mjs\";\r\nimport DisplaySwitch from \"./displaySwitch.mjs\";\r\nimport * as C from \"../../i18n/constants.mjs\";\r\nexport var PLUGIN_KEY = 'comments';\r\nexport var PLUGIN_PRIORITY = 60;\r\nvar privatePool = new WeakMap();\r\nvar META_COMMENT = 'comment';\r\nvar META_COMMENT_VALUE = 'value';\r\nvar META_STYLE = 'style';\r\nvar META_READONLY = 'readOnly';\r\n/* eslint-disable jsdoc/require-description-complete-sentence */\r\n\r\n/**\r\n * @class Comments\r\n * @plugin Comments\r\n *\r\n * @description\r\n * This plugin allows setting and managing cell comments by either an option in the context menu or with the use of\r\n * the API.\r\n *\r\n * To enable the plugin, you'll need to set the comments property of the config object to `true`:\r\n * ```js\r\n * comments: true\r\n * ```\r\n *\r\n * or an object with extra predefined plugin config:\r\n *\r\n * ```js\r\n * comments: {\r\n *   displayDelay: 1000\r\n * }\r\n * ```\r\n *\r\n * To add comments at the table initialization, define the `comment` property in the `cell` config array as in an example below.\r\n *\r\n * @example\r\n *\r\n * ```js\r\n * const hot = new Handsontable(document.getElementById('example'), {\r\n *   data: getData(),\r\n *   comments: true,\r\n *   cell: [\r\n *     {row: 1, col: 1, comment: {value: 'Foo'}},\r\n *     {row: 2, col: 2, comment: {value: 'Bar'}}\r\n *   ]\r\n * });\r\n *\r\n * // Access to the Comments plugin instance:\r\n * const commentsPlugin = hot.getPlugin('comments');\r\n *\r\n * // Manage comments programmatically:\r\n * commentsPlugin.setCommentAtCell(1, 6, 'Comment contents');\r\n * commentsPlugin.showAtCell(1, 6);\r\n * commentsPlugin.removeCommentAtCell(1, 6);\r\n *\r\n * // You can also set range once and use proper methods:\r\n * commentsPlugin.setRange({from: {row: 1, col: 6}});\r\n * commentsPlugin.setComment('Comment contents');\r\n * commentsPlugin.show();\r\n * commentsPlugin.removeComment();\r\n * ```\r\n */\r\n\r\n/* eslint-enable jsdoc/require-description-complete-sentence */\r\n\r\nexport var Comments = /*#__PURE__*/function (_BasePlugin) {\r\n  _inherits(Comments, _BasePlugin);\r\n\r\n  var _super = _createSuper(Comments);\r\n\r\n  function Comments(hotInstance) {\r\n    var _this;\r\n\r\n    _classCallCheck(this, Comments);\r\n\r\n    _this = _super.call(this, hotInstance);\r\n    /**\r\n     * Instance of {@link CommentEditor}.\r\n     *\r\n     * @private\r\n     * @type {CommentEditor}\r\n     */\r\n\r\n    _this.editor = null;\r\n    /**\r\n     * Instance of {@link DisplaySwitch}.\r\n     *\r\n     * @private\r\n     * @type {DisplaySwitch}\r\n     */\r\n\r\n    _this.displaySwitch = null;\r\n    /**\r\n     * Instance of {@link EventManager}.\r\n     *\r\n     * @private\r\n     * @type {EventManager}\r\n     */\r\n\r\n    _this.eventManager = null;\r\n    /**\r\n     * Current cell range, an object with `from` property, with `row` and `col` properties (e.q. `{from: {row: 1, col: 6}}`).\r\n     *\r\n     * @type {object}\r\n     */\r\n\r\n    _this.range = {};\r\n    /**\r\n     * @private\r\n     * @type {boolean}\r\n     */\r\n\r\n    _this.mouseDown = false;\r\n    /**\r\n     * @private\r\n     * @type {boolean}\r\n     */\r\n\r\n    _this.contextMenuEvent = false;\r\n    /**\r\n     * @private\r\n     * @type {*}\r\n     */\r\n\r\n    _this.timer = null;\r\n    privatePool.set(_assertThisInitialized(_this), {\r\n      tempEditorDimensions: {},\r\n      cellBelowCursor: null\r\n    });\r\n    return _this;\r\n  }\r\n  /**\r\n   * Checks if the plugin is enabled in the handsontable settings. This method is executed in {@link Hooks#beforeInit}\r\n   * hook and if it returns `true` than the {@link Comments#enablePlugin} method is called.\r\n   *\r\n   * @returns {boolean}\r\n   */\r\n\r\n\r\n  _createClass(Comments, [{\r\n    key: \"isEnabled\",\r\n    value: function isEnabled() {\r\n      return !!this.hot.getSettings()[PLUGIN_KEY];\r\n    }\r\n    /**\r\n     * Enables the plugin functionality for this Handsontable instance.\r\n     */\r\n\r\n  }, {\r\n    key: \"enablePlugin\",\r\n    value: function enablePlugin() {\r\n      var _this2 = this;\r\n\r\n      if (this.enabled) {\r\n        return;\r\n      }\r\n\r\n      if (!this.editor) {\r\n        this.editor = new CommentEditor(this.hot.rootDocument);\r\n      }\r\n\r\n      if (!this.eventManager) {\r\n        this.eventManager = new EventManager(this);\r\n      }\r\n\r\n      if (!this.displaySwitch) {\r\n        this.displaySwitch = new DisplaySwitch(this.getDisplayDelaySetting());\r\n      }\r\n\r\n      this.addHook('afterContextMenuDefaultOptions', function (options) {\r\n        return _this2.addToContextMenu(options);\r\n      });\r\n      this.addHook('afterRenderer', function (TD, row, col, prop, value, cellProperties) {\r\n        return _this2.onAfterRenderer(TD, cellProperties);\r\n      });\r\n      this.addHook('afterScrollHorizontally', function () {\r\n        return _this2.hide();\r\n      });\r\n      this.addHook('afterScrollVertically', function () {\r\n        return _this2.hide();\r\n      });\r\n      this.addHook('afterBeginEditing', function () {\r\n        return _this2.onAfterBeginEditing();\r\n      });\r\n      this.displaySwitch.addLocalHook('hide', function () {\r\n        return _this2.hide();\r\n      });\r\n      this.displaySwitch.addLocalHook('show', function (row, col) {\r\n        return _this2.showAtCell(row, col);\r\n      });\r\n      this.registerListeners();\r\n\r\n      _get(_getPrototypeOf(Comments.prototype), \"enablePlugin\", this).call(this);\r\n    }\r\n    /**\r\n     * Updates the plugin state. This method is executed when {@link Core#updateSettings} is invoked.\r\n     */\r\n\r\n  }, {\r\n    key: \"updatePlugin\",\r\n    value: function updatePlugin() {\r\n      this.disablePlugin();\r\n      this.enablePlugin();\r\n\r\n      _get(_getPrototypeOf(Comments.prototype), \"updatePlugin\", this).call(this);\r\n\r\n      this.displaySwitch.updateDelay(this.getDisplayDelaySetting());\r\n    }\r\n    /**\r\n     * Disables the plugin functionality for this Handsontable instance.\r\n     */\r\n\r\n  }, {\r\n    key: \"disablePlugin\",\r\n    value: function disablePlugin() {\r\n      _get(_getPrototypeOf(Comments.prototype), \"disablePlugin\", this).call(this);\r\n    }\r\n    /**\r\n     * Registers all necessary DOM listeners.\r\n     *\r\n     * @private\r\n     */\r\n\r\n  }, {\r\n    key: \"registerListeners\",\r\n    value: function registerListeners() {\r\n      var _this3 = this;\r\n\r\n      var rootDocument = this.hot.rootDocument;\r\n      this.eventManager.addEventListener(rootDocument, 'mouseover', function (event) {\r\n        return _this3.onMouseOver(event);\r\n      });\r\n      this.eventManager.addEventListener(rootDocument, 'mousedown', function (event) {\r\n        return _this3.onMouseDown(event);\r\n      });\r\n      this.eventManager.addEventListener(rootDocument, 'mouseup', function () {\r\n        return _this3.onMouseUp();\r\n      });\r\n      this.eventManager.addEventListener(this.editor.getInputElement(), 'blur', function () {\r\n        return _this3.onEditorBlur();\r\n      });\r\n      this.eventManager.addEventListener(this.editor.getInputElement(), 'mousedown', function (event) {\r\n        return _this3.onEditorMouseDown(event);\r\n      });\r\n      this.eventManager.addEventListener(this.editor.getInputElement(), 'mouseup', function (event) {\r\n        return _this3.onEditorMouseUp(event);\r\n      });\r\n    }\r\n    /**\r\n     * Sets the current cell range to be able to use general methods like {@link Comments#setComment}, {@link Comments#removeComment}, {@link Comments#show}.\r\n     *\r\n     * @param {object} range Object with `from` property, each with `row` and `col` properties.\r\n     */\r\n\r\n  }, {\r\n    key: \"setRange\",\r\n    value: function setRange(range) {\r\n      this.range = range;\r\n    }\r\n    /**\r\n     * Clears the currently selected cell.\r\n     */\r\n\r\n  }, {\r\n    key: \"clearRange\",\r\n    value: function clearRange() {\r\n      this.range = {};\r\n    }\r\n    /**\r\n     * Checks if the event target is a cell containing a comment.\r\n     *\r\n     * @private\r\n     * @param {Event} event DOM event.\r\n     * @returns {boolean}\r\n     */\r\n\r\n  }, {\r\n    key: \"targetIsCellWithComment\",\r\n    value: function targetIsCellWithComment(event) {\r\n      var closestCell = closest(event.target, 'TD', 'TBODY');\r\n      return !!(closestCell && hasClass(closestCell, 'htCommentCell') && closest(closestCell, [this.hot.rootElement]));\r\n    }\r\n    /**\r\n     * Checks if the event target is a comment textarea.\r\n     *\r\n     * @private\r\n     * @param {Event} event DOM event.\r\n     * @returns {boolean}\r\n     */\r\n\r\n  }, {\r\n    key: \"targetIsCommentTextArea\",\r\n    value: function targetIsCommentTextArea(event) {\r\n      return this.editor.getInputElement() === event.target;\r\n    }\r\n    /**\r\n     * Sets a comment for a cell according to the previously set range (see {@link Comments#setRange}).\r\n     *\r\n     * @param {string} value Comment contents.\r\n     */\r\n\r\n  }, {\r\n    key: \"setComment\",\r\n    value: function setComment(value) {\r\n      if (!this.range.from) {\r\n        throw new Error('Before using this method, first set cell range (hot.getPlugin(\"comment\").setRange())');\r\n      }\r\n\r\n      var editorValue = this.editor.getValue();\r\n      var comment = '';\r\n\r\n      if (value !== null && value !== void 0) {\r\n        comment = value;\r\n      } else if (editorValue !== null && editorValue !== void 0) {\r\n        comment = editorValue;\r\n      }\r\n\r\n      var row = this.range.from.row;\r\n      var col = this.range.from.col;\r\n      this.updateCommentMeta(row, col, _defineProperty({}, META_COMMENT_VALUE, comment));\r\n      this.hot.render();\r\n    }\r\n    /**\r\n     * Sets a comment for a specified cell.\r\n     *\r\n     * @param {number} row Visual row index.\r\n     * @param {number} column Visual column index.\r\n     * @param {string} value Comment contents.\r\n     */\r\n\r\n  }, {\r\n    key: \"setCommentAtCell\",\r\n    value: function setCommentAtCell(row, column, value) {\r\n      this.setRange({\r\n        from: new CellCoords(row, column)\r\n      });\r\n      this.setComment(value);\r\n    }\r\n    /**\r\n     * Removes a comment from a cell according to previously set range (see {@link Comments#setRange}).\r\n     *\r\n     * @param {boolean} [forceRender=true] If set to `true`, the table will be re-rendered at the end of the operation.\r\n     */\r\n\r\n  }, {\r\n    key: \"removeComment\",\r\n    value: function removeComment() {\r\n      var forceRender = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : true;\r\n\r\n      if (!this.range.from) {\r\n        throw new Error('Before using this method, first set cell range (hot.getPlugin(\"comment\").setRange())');\r\n      }\r\n\r\n      this.hot.setCellMeta(this.range.from.row, this.range.from.col, META_COMMENT, void 0);\r\n\r\n      if (forceRender) {\r\n        this.hot.render();\r\n      }\r\n\r\n      this.hide();\r\n    }\r\n    /**\r\n     * Removes a comment from a specified cell.\r\n     *\r\n     * @param {number} row Visual row index.\r\n     * @param {number} column Visual column index.\r\n     * @param {boolean} [forceRender=true] If `true`, the table will be re-rendered at the end of the operation.\r\n     */\r\n\r\n  }, {\r\n    key: \"removeCommentAtCell\",\r\n    value: function removeCommentAtCell(row, column) {\r\n      var forceRender = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : true;\r\n      this.setRange({\r\n        from: new CellCoords(row, column)\r\n      });\r\n      this.removeComment(forceRender);\r\n    }\r\n    /**\r\n     * Gets comment from a cell according to previously set range (see {@link Comments#setRange}).\r\n     *\r\n     * @returns {string|undefined} Returns a content of the comment.\r\n     */\r\n\r\n  }, {\r\n    key: \"getComment\",\r\n    value: function getComment() {\r\n      var row = this.range.from.row;\r\n      var column = this.range.from.col;\r\n      return this.getCommentMeta(row, column, META_COMMENT_VALUE);\r\n    }\r\n    /**\r\n     * Gets comment from a cell at the provided coordinates.\r\n     *\r\n     * @param {number} row Visual row index.\r\n     * @param {number} column Visual column index.\r\n     * @returns {string|undefined} Returns a content of the comment.\r\n     */\r\n\r\n  }, {\r\n    key: \"getCommentAtCell\",\r\n    value: function getCommentAtCell(row, column) {\r\n      return this.getCommentMeta(row, column, META_COMMENT_VALUE);\r\n    }\r\n    /**\r\n     * Shows the comment editor accordingly to the previously set range (see {@link Comments#setRange}).\r\n     *\r\n     * @returns {boolean} Returns `true` if comment editor was shown.\r\n     */\r\n\r\n  }, {\r\n    key: \"show\",\r\n    value: function show() {\r\n      if (!this.range.from) {\r\n        throw new Error('Before using this method, first set cell range (hot.getPlugin(\"comment\").setRange())');\r\n      }\r\n\r\n      var _this$range$from = this.range.from,\r\n          row = _this$range$from.row,\r\n          col = _this$range$from.col;\r\n\r\n      if (row < 0 || row > this.hot.countSourceRows() - 1 || col < 0 || col > this.hot.countSourceCols() - 1) {\r\n        return false;\r\n      }\r\n\r\n      var meta = this.hot.getCellMeta(this.range.from.row, this.range.from.col);\r\n      this.refreshEditor(true);\r\n      this.editor.setValue(meta[META_COMMENT] ? meta[META_COMMENT][META_COMMENT_VALUE] : null || '');\r\n\r\n      if (this.editor.hidden) {\r\n        this.editor.show();\r\n      }\r\n\r\n      return true;\r\n    }\r\n    /**\r\n     * Shows comment editor according to cell coordinates.\r\n     *\r\n     * @param {number} row Visual row index.\r\n     * @param {number} column Visual column index.\r\n     * @returns {boolean} Returns `true` if comment editor was shown.\r\n     */\r\n\r\n  }, {\r\n    key: \"showAtCell\",\r\n    value: function showAtCell(row, column) {\r\n      this.setRange({\r\n        from: new CellCoords(row, column)\r\n      });\r\n      return this.show();\r\n    }\r\n    /**\r\n     * Hides the comment editor.\r\n     */\r\n\r\n  }, {\r\n    key: \"hide\",\r\n    value: function hide() {\r\n      if (!this.editor.hidden) {\r\n        this.editor.hide();\r\n      }\r\n    }\r\n    /**\r\n     * Refreshes comment editor position and styling.\r\n     *\r\n     * @param {boolean} [force=false] If `true` then recalculation will be forced.\r\n     */\r\n\r\n  }, {\r\n    key: \"refreshEditor\",\r\n    value: function refreshEditor() {\r\n      var _renderableRow, _renderableColumn;\r\n\r\n      var force = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;\r\n\r\n      if (!force && (!this.range.from || !this.editor.isVisible())) {\r\n        return;\r\n      }\r\n\r\n      var _this$hot = this.hot,\r\n          rowIndexMapper = _this$hot.rowIndexMapper,\r\n          columnIndexMapper = _this$hot.columnIndexMapper;\r\n      var _this$range$from2 = this.range.from,\r\n          visualRow = _this$range$from2.row,\r\n          visualColumn = _this$range$from2.col;\r\n      var renderableRow = rowIndexMapper.getRenderableFromVisualIndex(visualRow);\r\n      var renderableColumn = columnIndexMapper.getRenderableFromVisualIndex(visualColumn); // Used when the requested row is hidden, and the editor needs to be positioned on the previous row's coords.\r\n\r\n      var targetingPreviousRow = renderableRow === null;\r\n\r\n      if (renderableRow === null) {\r\n        renderableRow = rowIndexMapper.getRenderableFromVisualIndex(rowIndexMapper.getFirstNotHiddenIndex(visualRow, -1));\r\n      }\r\n\r\n      if (renderableColumn === null) {\r\n        renderableColumn = columnIndexMapper.getRenderableFromVisualIndex(columnIndexMapper.getFirstNotHiddenIndex(visualColumn, -1));\r\n      }\r\n\r\n      var isBeforeRenderedRows = renderableRow === null;\r\n      var isBeforeRenderedColumns = renderableColumn === null;\r\n      renderableRow = (_renderableRow = renderableRow) !== null && _renderableRow !== void 0 ? _renderableRow : 0;\r\n      renderableColumn = (_renderableColumn = renderableColumn) !== null && _renderableColumn !== void 0 ? _renderableColumn : 0;\r\n      var _this$hot2 = this.hot,\r\n          rootWindow = _this$hot2.rootWindow,\r\n          wt = _this$hot2.view.wt;\r\n      var wtTable = wt.wtTable,\r\n          wtOverlays = wt.wtOverlays,\r\n          wtViewport = wt.wtViewport;\r\n      var scrollableElement = wtOverlays.scrollableElement;\r\n      var TD = wtTable.getCell({\r\n        row: renderableRow,\r\n        col: renderableColumn\r\n      });\r\n      var cellOffset = offset(TD);\r\n      var lastColWidth = isBeforeRenderedColumns ? 0 : wtTable.getStretchedColumnWidth(renderableColumn);\r\n      var lastRowHeight = targetingPreviousRow && !isBeforeRenderedRows ? outerHeight(TD) : 0;\r\n      var cellTopOffset = cellOffset.top;\r\n      var cellLeftOffset = cellOffset.left;\r\n\r\n      if (wtViewport.hasVerticalScroll() && scrollableElement !== rootWindow) {\r\n        cellTopOffset -= wtOverlays.topOverlay.getScrollPosition();\r\n      }\r\n\r\n      if (wtViewport.hasHorizontalScroll() && scrollableElement !== rootWindow) {\r\n        cellLeftOffset -= wtOverlays.leftOverlay.getScrollPosition();\r\n      }\r\n\r\n      var x = cellLeftOffset + lastColWidth;\r\n      var y = cellTopOffset + lastRowHeight;\r\n      var commentStyle = this.getCommentMeta(visualRow, visualColumn, META_STYLE);\r\n      var readOnly = this.getCommentMeta(visualRow, visualColumn, META_READONLY);\r\n\r\n      if (commentStyle) {\r\n        this.editor.setSize(commentStyle.width, commentStyle.height);\r\n      } else {\r\n        this.editor.resetSize();\r\n      }\r\n\r\n      this.editor.setReadOnlyState(readOnly);\r\n      this.editor.setPosition(x, y);\r\n    }\r\n    /**\r\n     * Checks if there is a comment for selected range.\r\n     *\r\n     * @private\r\n     * @returns {boolean}\r\n     */\r\n\r\n  }, {\r\n    key: \"checkSelectionCommentsConsistency\",\r\n    value: function checkSelectionCommentsConsistency() {\r\n      var selected = this.hot.getSelectedRangeLast();\r\n\r\n      if (!selected) {\r\n        return false;\r\n      }\r\n\r\n      var hasComment = false;\r\n      var cell = selected.getTopLeftCorner(); // IN EXCEL THERE IS COMMENT ONLY FOR TOP LEFT CELL IN SELECTION\r\n\r\n      if (this.getCommentMeta(cell.row, cell.col, META_COMMENT_VALUE)) {\r\n        hasComment = true;\r\n      }\r\n\r\n      return hasComment;\r\n    }\r\n    /**\r\n     * Sets or update the comment-related cell meta.\r\n     *\r\n     * @param {number} row Visual row index.\r\n     * @param {number} column Visual column index.\r\n     * @param {object} metaObject Object defining all the comment-related meta information.\r\n     */\r\n\r\n  }, {\r\n    key: \"updateCommentMeta\",\r\n    value: function updateCommentMeta(row, column, metaObject) {\r\n      var oldComment = this.hot.getCellMeta(row, column)[META_COMMENT];\r\n      var newComment;\r\n\r\n      if (oldComment) {\r\n        newComment = deepClone(oldComment);\r\n        deepExtend(newComment, metaObject);\r\n      } else {\r\n        newComment = metaObject;\r\n      }\r\n\r\n      this.hot.setCellMeta(row, column, META_COMMENT, newComment);\r\n    }\r\n    /**\r\n     * Gets the comment related meta information.\r\n     *\r\n     * @param {number} row Visual row index.\r\n     * @param {number} column Visual column index.\r\n     * @param {string} property Cell meta property.\r\n     * @returns {Mixed}\r\n     */\r\n\r\n  }, {\r\n    key: \"getCommentMeta\",\r\n    value: function getCommentMeta(row, column, property) {\r\n      var cellMeta = this.hot.getCellMeta(row, column);\r\n\r\n      if (!cellMeta[META_COMMENT]) {\r\n        return void 0;\r\n      }\r\n\r\n      return cellMeta[META_COMMENT][property];\r\n    }\r\n    /**\r\n     * `mousedown` event callback.\r\n     *\r\n     * @private\r\n     * @param {MouseEvent} event The `mousedown` event.\r\n     */\r\n\r\n  }, {\r\n    key: \"onMouseDown\",\r\n    value: function onMouseDown(event) {\r\n      this.mouseDown = true;\r\n\r\n      if (!this.hot.view || !this.hot.view.wt) {\r\n        return;\r\n      }\r\n\r\n      if (!this.contextMenuEvent && !this.targetIsCommentTextArea(event)) {\r\n        var eventCell = closest(event.target, 'TD', 'TBODY');\r\n        var coordinates = null;\r\n\r\n        if (eventCell) {\r\n          coordinates = this.hot.view.wt.wtTable.getCoords(eventCell);\r\n          coordinates = {\r\n            row: this.hot.rowIndexMapper.getVisualFromRenderableIndex(coordinates.row),\r\n            col: this.hot.columnIndexMapper.getVisualFromRenderableIndex(coordinates.col)\r\n          };\r\n        }\r\n\r\n        if (!eventCell || this.range.from && coordinates && (this.range.from.row !== coordinates.row || this.range.from.col !== coordinates.col)) {\r\n          this.hide();\r\n        }\r\n      }\r\n\r\n      this.contextMenuEvent = false;\r\n    }\r\n    /**\r\n     * `mouseover` event callback.\r\n     *\r\n     * @private\r\n     * @param {MouseEvent} event The `mouseover` event.\r\n     */\r\n\r\n  }, {\r\n    key: \"onMouseOver\",\r\n    value: function onMouseOver(event) {\r\n      var priv = privatePool.get(this);\r\n      var rootDocument = this.hot.rootDocument;\r\n      priv.cellBelowCursor = rootDocument.elementFromPoint(event.clientX, event.clientY);\r\n\r\n      if (this.mouseDown || this.editor.isFocused() || hasClass(event.target, 'wtBorder') || priv.cellBelowCursor !== event.target || !this.editor) {\r\n        return;\r\n      }\r\n\r\n      if (this.targetIsCellWithComment(event)) {\r\n        var coordinates = this.hot.view.wt.wtTable.getCoords(event.target);\r\n        var range = {\r\n          from: new CellCoords(this.hot.rowIndexMapper.getVisualFromRenderableIndex(coordinates.row), this.hot.columnIndexMapper.getVisualFromRenderableIndex(coordinates.col))\r\n        };\r\n        this.displaySwitch.show(range);\r\n      } else if (isChildOf(event.target, rootDocument) && !this.targetIsCommentTextArea(event)) {\r\n        this.displaySwitch.hide();\r\n      }\r\n    }\r\n    /**\r\n     * `mouseup` event callback.\r\n     *\r\n     * @private\r\n     */\r\n\r\n  }, {\r\n    key: \"onMouseUp\",\r\n    value: function onMouseUp() {\r\n      this.mouseDown = false;\r\n    }\r\n    /**\r\n     * The `afterRenderer` hook callback.\r\n     *\r\n     * @private\r\n     * @param {HTMLTableCellElement} TD The rendered `TD` element.\r\n     * @param {object} cellProperties The rendered cell's property object.\r\n     */\r\n\r\n  }, {\r\n    key: \"onAfterRenderer\",\r\n    value: function onAfterRenderer(TD, cellProperties) {\r\n      if (cellProperties[META_COMMENT] && cellProperties[META_COMMENT][META_COMMENT_VALUE]) {\r\n        addClass(TD, cellProperties.commentedCellClassName);\r\n      }\r\n    }\r\n    /**\r\n     * `blur` event callback for the comment editor.\r\n     *\r\n     * @private\r\n     */\r\n\r\n  }, {\r\n    key: \"onEditorBlur\",\r\n    value: function onEditorBlur() {\r\n      this.setComment();\r\n    }\r\n    /**\r\n     * `mousedown` hook. Along with `onEditorMouseUp` used to simulate the textarea resizing event.\r\n     *\r\n     * @private\r\n     * @param {MouseEvent} event The `mousedown` event.\r\n     */\r\n\r\n  }, {\r\n    key: \"onEditorMouseDown\",\r\n    value: function onEditorMouseDown(event) {\r\n      var priv = privatePool.get(this);\r\n      priv.tempEditorDimensions = {\r\n        width: outerWidth(event.target),\r\n        height: outerHeight(event.target)\r\n      };\r\n    }\r\n    /**\r\n     * `mouseup` hook. Along with `onEditorMouseDown` used to simulate the textarea resizing event.\r\n     *\r\n     * @private\r\n     * @param {MouseEvent} event The `mouseup` event.\r\n     */\r\n\r\n  }, {\r\n    key: \"onEditorMouseUp\",\r\n    value: function onEditorMouseUp(event) {\r\n      var priv = privatePool.get(this);\r\n      var currentWidth = outerWidth(event.target);\r\n      var currentHeight = outerHeight(event.target);\r\n\r\n      if (currentWidth !== priv.tempEditorDimensions.width + 1 || currentHeight !== priv.tempEditorDimensions.height + 2) {\r\n        this.updateCommentMeta(this.range.from.row, this.range.from.col, _defineProperty({}, META_STYLE, {\r\n          width: currentWidth,\r\n          height: currentHeight\r\n        }));\r\n      }\r\n    }\r\n    /**\r\n     * Context Menu's \"Add comment\" callback. Results in showing the comment editor.\r\n     *\r\n     * @private\r\n     */\r\n\r\n  }, {\r\n    key: \"onContextMenuAddComment\",\r\n    value: function onContextMenuAddComment() {\r\n      var _this4 = this;\r\n\r\n      this.displaySwitch.cancelHiding();\r\n      var coords = this.hot.getSelectedRangeLast();\r\n      this.contextMenuEvent = true;\r\n      this.setRange({\r\n        from: coords.highlight\r\n      });\r\n      this.show();\r\n      setTimeout(function () {\r\n        if (_this4.hot) {\r\n          _this4.hot.deselectCell();\r\n\r\n          _this4.editor.focus();\r\n        }\r\n      }, 10);\r\n    }\r\n    /**\r\n     * Context Menu's \"remove comment\" callback.\r\n     *\r\n     * @private\r\n     */\r\n\r\n  }, {\r\n    key: \"onContextMenuRemoveComment\",\r\n    value: function onContextMenuRemoveComment() {\r\n      var _this5 = this;\r\n\r\n      var coords = this.hot.getSelectedRangeLast();\r\n      this.contextMenuEvent = true;\r\n      coords.forAll(function (row, column) {\r\n        if (row >= 0 && column >= 0) {\r\n          _this5.removeCommentAtCell(row, column, false);\r\n        }\r\n      });\r\n      this.hot.render();\r\n    }\r\n    /**\r\n     * Context Menu's \"make comment read-only\" callback.\r\n     *\r\n     * @private\r\n     */\r\n\r\n  }, {\r\n    key: \"onContextMenuMakeReadOnly\",\r\n    value: function onContextMenuMakeReadOnly() {\r\n      var _this6 = this;\r\n\r\n      var coords = this.hot.getSelectedRangeLast();\r\n      this.contextMenuEvent = true;\r\n      coords.forAll(function (row, column) {\r\n        if (row >= 0 && column >= 0) {\r\n          var currentState = !!_this6.getCommentMeta(row, column, META_READONLY);\r\n\r\n          _this6.updateCommentMeta(row, column, _defineProperty({}, META_READONLY, !currentState));\r\n        }\r\n      });\r\n    }\r\n    /**\r\n     * Add Comments plugin options to the Context Menu.\r\n     *\r\n     * @private\r\n     * @param {object} defaultOptions The menu options.\r\n     */\r\n\r\n  }, {\r\n    key: \"addToContextMenu\",\r\n    value: function addToContextMenu(defaultOptions) {\r\n      var _this7 = this;\r\n\r\n      var isThereAnyCellRendered = function isThereAnyCellRendered() {\r\n        return _this7.hot.rowIndexMapper.getRenderableIndexesLength() > 0 && _this7.hot.columnIndexMapper.getRenderableIndexesLength() > 0;\r\n      };\r\n\r\n      defaultOptions.items.push({\r\n        name: '---------'\r\n      }, {\r\n        key: 'commentsAddEdit',\r\n        name: function name() {\r\n          if (_this7.checkSelectionCommentsConsistency()) {\r\n            return _this7.hot.getTranslatedPhrase(C.CONTEXTMENU_ITEMS_EDIT_COMMENT);\r\n          }\r\n\r\n          return _this7.hot.getTranslatedPhrase(C.CONTEXTMENU_ITEMS_ADD_COMMENT);\r\n        },\r\n        callback: function callback() {\r\n          return _this7.onContextMenuAddComment();\r\n        },\r\n        disabled: function disabled() {\r\n          if (!isThereAnyCellRendered()) {\r\n            return true;\r\n          }\r\n\r\n          return !(_this7.hot.getSelectedLast() && !_this7.hot.selection.isSelectedByCorner());\r\n        }\r\n      }, {\r\n        key: 'commentsRemove',\r\n        name: function name() {\r\n          return this.getTranslatedPhrase(C.CONTEXTMENU_ITEMS_REMOVE_COMMENT);\r\n        },\r\n        callback: function callback() {\r\n          return _this7.onContextMenuRemoveComment();\r\n        },\r\n        disabled: function disabled() {\r\n          if (!isThereAnyCellRendered()) {\r\n            return true;\r\n          }\r\n\r\n          return !(_this7.hot.getSelectedLast() && !_this7.hot.selection.isSelectedByCorner());\r\n        }\r\n      }, {\r\n        key: 'commentsReadOnly',\r\n        name: function name() {\r\n          var _this8 = this;\r\n\r\n          var label = this.getTranslatedPhrase(C.CONTEXTMENU_ITEMS_READ_ONLY_COMMENT);\r\n          var hasProperty = checkSelectionConsistency(this.getSelectedRangeLast(), function (row, col) {\r\n            var readOnlyProperty = _this8.getCellMeta(row, col)[META_COMMENT];\r\n\r\n            if (readOnlyProperty) {\r\n              readOnlyProperty = readOnlyProperty[META_READONLY];\r\n            }\r\n\r\n            if (readOnlyProperty) {\r\n              return true;\r\n            }\r\n          });\r\n\r\n          if (hasProperty) {\r\n            label = markLabelAsSelected(label);\r\n          }\r\n\r\n          return label;\r\n        },\r\n        callback: function callback() {\r\n          return _this7.onContextMenuMakeReadOnly();\r\n        },\r\n        disabled: function disabled() {\r\n          if (!isThereAnyCellRendered()) {\r\n            return true;\r\n          }\r\n\r\n          return !(_this7.hot.getSelectedLast() && !_this7.hot.selection.isSelectedByCorner()) || !_this7.checkSelectionCommentsConsistency();\r\n        }\r\n      });\r\n    }\r\n    /**\r\n     * Get `displayDelay` setting of comment plugin.\r\n     *\r\n     * @private\r\n     * @returns {number|undefined}\r\n     */\r\n\r\n  }, {\r\n    key: \"getDisplayDelaySetting\",\r\n    value: function getDisplayDelaySetting() {\r\n      var commentSetting = this.hot.getSettings()[PLUGIN_KEY];\r\n\r\n      if (isObject(commentSetting)) {\r\n        return commentSetting.displayDelay;\r\n      }\r\n\r\n      return void 0;\r\n    }\r\n    /**\r\n     * `afterBeginEditing` hook callback.\r\n     *\r\n     * @private\r\n     */\r\n\r\n  }, {\r\n    key: \"onAfterBeginEditing\",\r\n    value: function onAfterBeginEditing() {\r\n      this.hide();\r\n    }\r\n    /**\r\n     * Destroys the plugin instance.\r\n     */\r\n\r\n  }, {\r\n    key: \"destroy\",\r\n    value: function destroy() {\r\n      if (this.editor) {\r\n        this.editor.destroy();\r\n      }\r\n\r\n      if (this.displaySwitch) {\r\n        this.displaySwitch.destroy();\r\n      }\r\n\r\n      _get(_getPrototypeOf(Comments.prototype), \"destroy\", this).call(this);\r\n    }\r\n  }], [{\r\n    key: \"PLUGIN_KEY\",\r\n    get: function get() {\r\n      return PLUGIN_KEY;\r\n    }\r\n  }, {\r\n    key: \"PLUGIN_PRIORITY\",\r\n    get: function get() {\r\n      return PLUGIN_PRIORITY;\r\n    }\r\n  }]);\r\n\r\n  return Comments;\r\n}(BasePlugin);"]},"metadata":{},"sourceType":"module"}