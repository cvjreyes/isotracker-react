{"ast":null,"code":"function _typeof(obj) {\n  \"@babel/helpers - typeof\";\n\n  if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") {\n    _typeof = function _typeof(obj) {\n      return typeof obj;\n    };\n  } else {\n    _typeof = function _typeof(obj) {\n      return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n    };\n  }\n\n  return _typeof(obj);\n}\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  return Constructor;\n}\n\nfunction _get(target, property, receiver) {\n  if (typeof Reflect !== \"undefined\" && Reflect.get) {\n    _get = Reflect.get;\n  } else {\n    _get = function _get(target, property, receiver) {\n      var base = _superPropBase(target, property);\n\n      if (!base) return;\n      var desc = Object.getOwnPropertyDescriptor(base, property);\n\n      if (desc.get) {\n        return desc.get.call(receiver);\n      }\n\n      return desc.value;\n    };\n  }\n\n  return _get(target, property, receiver || target);\n}\n\nfunction _superPropBase(object, property) {\n  while (!Object.prototype.hasOwnProperty.call(object, property)) {\n    object = _getPrototypeOf(object);\n    if (object === null) break;\n  }\n\n  return object;\n}\n\nfunction _inherits(subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function\");\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      writable: true,\n      configurable: true\n    }\n  });\n  if (superClass) _setPrototypeOf(subClass, superClass);\n}\n\nfunction _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n\n  return _setPrototypeOf(o, p);\n}\n\nfunction _createSuper(Derived) {\n  var hasNativeReflectConstruct = _isNativeReflectConstruct();\n\n  return function _createSuperInternal() {\n    var Super = _getPrototypeOf(Derived),\n        result;\n\n    if (hasNativeReflectConstruct) {\n      var NewTarget = _getPrototypeOf(this).constructor;\n\n      result = Reflect.construct(Super, arguments, NewTarget);\n    } else {\n      result = Super.apply(this, arguments);\n    }\n\n    return _possibleConstructorReturn(this, result);\n  };\n}\n\nfunction _possibleConstructorReturn(self, call) {\n  if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) {\n    return call;\n  }\n\n  return _assertThisInitialized(self);\n}\n\nfunction _assertThisInitialized(self) {\n  if (self === void 0) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return self;\n}\n\nfunction _isNativeReflectConstruct() {\n  if (typeof Reflect === \"undefined\" || !Reflect.construct) return false;\n  if (Reflect.construct.sham) return false;\n  if (typeof Proxy === \"function\") return true;\n\n  try {\n    Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));\n    return true;\n  } catch (e) {\n    return false;\n  }\n}\n\nfunction _getPrototypeOf(o) {\n  _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) {\n    return o.__proto__ || Object.getPrototypeOf(o);\n  };\n  return _getPrototypeOf(o);\n}\n\nimport { BasePlugin } from \"../base/index.mjs\";\nimport Hooks from \"../../pluginHooks.mjs\";\nimport { arrayReduce } from \"../../helpers/array.mjs\";\nimport { addClass, removeClass, offset, hasClass } from \"../../helpers/dom/element.mjs\";\nimport { rangeEach } from \"../../helpers/number.mjs\";\nimport EventManager from \"../../eventManager.mjs\";\nimport BacklightUI from \"./ui/backlight.mjs\";\nimport GuidelineUI from \"./ui/guideline.mjs\";\nHooks.getSingleton().register('beforeColumnMove');\nHooks.getSingleton().register('afterColumnMove');\nexport var PLUGIN_KEY = 'manualColumnMove';\nexport var PLUGIN_PRIORITY = 120;\nvar privatePool = new WeakMap();\nvar CSS_PLUGIN = 'ht__manualColumnMove';\nvar CSS_SHOW_UI = 'show-ui';\nvar CSS_ON_MOVING = 'on-moving--columns';\nvar CSS_AFTER_SELECTION = 'after-selection--columns';\n/**\r\n * @plugin ManualColumnMove\r\n *\r\n * @description\r\n * This plugin allows to change columns order. To make columns order persistent the {@link Options#persistentState}\r\n * plugin should be enabled.\r\n *\r\n * API:\r\n * - `moveColumn` - move single column to the new position.\r\n * - `moveColumns` - move many columns (as an array of indexes) to the new position.\r\n * - `dragColumn` - drag single column to the new position.\r\n * - `dragColumns` - drag many columns (as an array of indexes) to the new position.\r\n *\r\n * [Documentation](/demo-moving.html#manualColumnMove) explain differences between drag and move actions. Please keep in mind that if you want apply visual changes,\r\n * you have to call manually the `render` method on the instance of Handsontable.\r\n *\r\n * The plugin creates additional components to make moving possibly using user interface:\r\n * - backlight - highlight of selected columns.\r\n * - guideline - line which shows where columns has been moved.\r\n *\r\n * @class ManualColumnMove\r\n * @plugin ManualColumnMove\r\n */\n\nexport var ManualColumnMove = /*#__PURE__*/function (_BasePlugin) {\n  _inherits(ManualColumnMove, _BasePlugin);\n\n  var _super = _createSuper(ManualColumnMove);\n\n  function ManualColumnMove(hotInstance) {\n    var _this;\n\n    _classCallCheck(this, ManualColumnMove);\n\n    _this = _super.call(this, hotInstance);\n    /**\r\n     * Set up WeakMap of plugin to sharing private parameters;.\r\n     */\n\n    privatePool.set(_assertThisInitialized(_this), {\n      columnsToMove: [],\n      countCols: 0,\n      fixedColumns: 0,\n      pressed: void 0,\n      target: {\n        eventPageX: void 0,\n        coords: void 0,\n        TD: void 0,\n        col: void 0\n      },\n      cachedDropIndex: void 0\n    });\n    /**\r\n     * Event Manager object.\r\n     *\r\n     * @private\r\n     * @type {object}\r\n     */\n\n    _this.eventManager = new EventManager(_assertThisInitialized(_this));\n    /**\r\n     * Backlight UI object.\r\n     *\r\n     * @private\r\n     * @type {object}\r\n     */\n\n    _this.backlight = new BacklightUI(hotInstance);\n    /**\r\n     * Guideline UI object.\r\n     *\r\n     * @private\r\n     * @type {object}\r\n     */\n\n    _this.guideline = new GuidelineUI(hotInstance);\n    return _this;\n  }\n  /**\r\n   * Checks if the plugin is enabled in the handsontable settings. This method is executed in {@link Hooks#beforeInit}\r\n   * hook and if it returns `true` than the {@link ManualColumnMove#enablePlugin} method is called.\r\n   *\r\n   * @returns {boolean}\r\n   */\n\n\n  _createClass(ManualColumnMove, [{\n    key: \"isEnabled\",\n    value: function isEnabled() {\n      return !!this.hot.getSettings()[PLUGIN_KEY];\n    }\n    /**\r\n     * Enables the plugin functionality for this Handsontable instance.\r\n     */\n\n  }, {\n    key: \"enablePlugin\",\n    value: function enablePlugin() {\n      var _this2 = this;\n\n      if (this.enabled) {\n        return;\n      }\n\n      this.addHook('beforeOnCellMouseDown', function (event, coords, TD, blockCalculations) {\n        return _this2.onBeforeOnCellMouseDown(event, coords, TD, blockCalculations);\n      });\n      this.addHook('beforeOnCellMouseOver', function (event, coords, TD, blockCalculations) {\n        return _this2.onBeforeOnCellMouseOver(event, coords, TD, blockCalculations);\n      });\n      this.addHook('afterScrollVertically', function () {\n        return _this2.onAfterScrollVertically();\n      });\n      this.addHook('afterLoadData', function () {\n        return _this2.onAfterLoadData();\n      });\n      this.buildPluginUI();\n      this.registerEvents(); // TODO: move adding plugin classname to BasePlugin.\n\n      addClass(this.hot.rootElement, CSS_PLUGIN);\n\n      _get(_getPrototypeOf(ManualColumnMove.prototype), \"enablePlugin\", this).call(this);\n    }\n    /**\r\n     * Updates the plugin state. This method is executed when {@link Core#updateSettings} is invoked.\r\n     */\n\n  }, {\n    key: \"updatePlugin\",\n    value: function updatePlugin() {\n      this.disablePlugin();\n      this.enablePlugin();\n      this.moveBySettingsOrLoad();\n\n      _get(_getPrototypeOf(ManualColumnMove.prototype), \"updatePlugin\", this).call(this);\n    }\n    /**\r\n     * Disables the plugin functionality for this Handsontable instance.\r\n     */\n\n  }, {\n    key: \"disablePlugin\",\n    value: function disablePlugin() {\n      removeClass(this.hot.rootElement, CSS_PLUGIN);\n      this.unregisterEvents();\n      this.backlight.destroy();\n      this.guideline.destroy();\n\n      _get(_getPrototypeOf(ManualColumnMove.prototype), \"disablePlugin\", this).call(this);\n    }\n    /**\r\n     * Moves a single column.\r\n     *\r\n     * @param {number} column Visual column index to be moved.\r\n     * @param {number} finalIndex Visual column index, being a start index for the moved columns. Points to where the elements will be placed after the moving action.\r\n     * To check the visualization of the final index, please take a look at [documentation](/demo-moving.html#manualColumnMove).\r\n     * @fires Hooks#beforeColumnMove\r\n     * @fires Hooks#afterColumnMove\r\n     * @returns {boolean}\r\n     */\n\n  }, {\n    key: \"moveColumn\",\n    value: function moveColumn(column, finalIndex) {\n      return this.moveColumns([column], finalIndex);\n    }\n    /**\r\n     * Moves a multiple columns.\r\n     *\r\n     * @param {Array} columns Array of visual column indexes to be moved.\r\n     * @param {number} finalIndex Visual column index, being a start index for the moved columns. Points to where the elements will be placed after the moving action.\r\n     * To check the visualization of the final index, please take a look at [documentation](/demo-moving.html#manualColumnMove).\r\n     * @fires Hooks#beforeColumnMove\r\n     * @fires Hooks#afterColumnMove\r\n     * @returns {boolean}\r\n     */\n\n  }, {\n    key: \"moveColumns\",\n    value: function moveColumns(columns, finalIndex) {\n      var priv = privatePool.get(this);\n      var dropIndex = priv.cachedDropIndex;\n      var movePossible = this.isMovePossible(columns, finalIndex);\n      var beforeMoveHook = this.hot.runHooks('beforeColumnMove', columns, finalIndex, dropIndex, movePossible);\n      priv.cachedDropIndex = void 0;\n\n      if (beforeMoveHook === false) {\n        return;\n      }\n\n      if (movePossible) {\n        this.hot.columnIndexMapper.moveIndexes(columns, finalIndex);\n      }\n\n      var movePerformed = movePossible && this.isColumnOrderChanged(columns, finalIndex);\n      this.hot.runHooks('afterColumnMove', columns, finalIndex, dropIndex, movePossible, movePerformed);\n      return movePerformed;\n    }\n    /**\r\n     * Drag a single column to drop index position.\r\n     *\r\n     * @param {number} column Visual column index to be dragged.\r\n     * @param {number} dropIndex Visual column index, being a drop index for the moved columns. Points to where we are going to drop the moved elements.\r\n     * To check visualization of drop index please take a look at [documentation](/demo-moving.html#manualColumnMove).\r\n     * @fires Hooks#beforeColumnMove\r\n     * @fires Hooks#afterColumnMove\r\n     * @returns {boolean}\r\n     */\n\n  }, {\n    key: \"dragColumn\",\n    value: function dragColumn(column, dropIndex) {\n      return this.dragColumns([column], dropIndex);\n    }\n    /**\r\n     * Drag multiple columns to drop index position.\r\n     *\r\n     * @param {Array} columns Array of visual column indexes to be dragged.\r\n     * @param {number} dropIndex Visual column index, being a drop index for the moved columns. Points to where we are going to drop the moved elements.\r\n     * To check visualization of drop index please take a look at [documentation](/demo-moving.html#manualColumnMove).\r\n     * @fires Hooks#beforeColumnMove\r\n     * @fires Hooks#afterColumnMove\r\n     * @returns {boolean}\r\n     */\n\n  }, {\n    key: \"dragColumns\",\n    value: function dragColumns(columns, dropIndex) {\n      var finalIndex = this.countFinalIndex(columns, dropIndex);\n      var priv = privatePool.get(this);\n      priv.cachedDropIndex = dropIndex;\n      return this.moveColumns(columns, finalIndex);\n    }\n    /**\r\n     * Indicates if it's possible to move columns to the desired position. Some of the actions aren't possible, i.e. You canâ€™t move more than one element to the last position.\r\n     *\r\n     * @param {Array} movedColumns Array of visual column indexes to be moved.\r\n     * @param {number} finalIndex Visual column index, being a start index for the moved columns. Points to where the elements will be placed after the moving action.\r\n     * To check the visualization of the final index, please take a look at [documentation](/demo-moving.html#manualColumnMove).\r\n     * @returns {boolean}\r\n     */\n\n  }, {\n    key: \"isMovePossible\",\n    value: function isMovePossible(movedColumns, finalIndex) {\n      var length = this.hot.columnIndexMapper.getNotTrimmedIndexesLength(); // An attempt to transfer more columns to start destination than is possible (only when moving from the top to the bottom).\n\n      var tooHighDestinationIndex = movedColumns.length + finalIndex > length;\n      var tooLowDestinationIndex = finalIndex < 0;\n      var tooLowMovedColumnIndex = movedColumns.some(function (movedColumn) {\n        return movedColumn < 0;\n      });\n      var tooHighMovedColumnIndex = movedColumns.some(function (movedColumn) {\n        return movedColumn >= length;\n      });\n\n      if (tooHighDestinationIndex || tooLowDestinationIndex || tooLowMovedColumnIndex || tooHighMovedColumnIndex) {\n        return false;\n      }\n\n      return true;\n    }\n    /**\r\n     * Indicates if order of columns was changed.\r\n     *\r\n     * @private\r\n     * @param {Array} movedColumns Array of visual column indexes to be moved.\r\n     * @param {number} finalIndex Visual column index, being a start index for the moved columns. Points to where the elements will be placed after the moving action.\r\n     * To check the visualization of the final index, please take a look at [documentation](/demo-moving.html#manualColumnMove).\r\n     * @returns {boolean}\r\n     */\n\n  }, {\n    key: \"isColumnOrderChanged\",\n    value: function isColumnOrderChanged(movedColumns, finalIndex) {\n      return movedColumns.some(function (column, nrOfMovedElement) {\n        return column - nrOfMovedElement !== finalIndex;\n      });\n    }\n    /**\r\n     * Count the final column index from the drop index.\r\n     *\r\n     * @private\r\n     * @param {Array} movedColumns Array of visual column indexes to be moved.\r\n     * @param {number} dropIndex Visual column index, being a drop index for the moved columns.\r\n     * @returns {number} Visual column index, being a start index for the moved columns.\r\n     */\n\n  }, {\n    key: \"countFinalIndex\",\n    value: function countFinalIndex(movedColumns, dropIndex) {\n      var numberOfColumnsLowerThanDropIndex = arrayReduce(movedColumns, function (numberOfColumns, currentColumnIndex) {\n        if (currentColumnIndex < dropIndex) {\n          numberOfColumns += 1;\n        }\n\n        return numberOfColumns;\n      }, 0);\n      return dropIndex - numberOfColumnsLowerThanDropIndex;\n    }\n    /**\r\n     * Gets the sum of the widths of columns in the provided range.\r\n     *\r\n     * @private\r\n     * @param {number} fromColumn Visual column index.\r\n     * @param {number} toColumn Visual column index.\r\n     * @returns {number}\r\n     */\n\n  }, {\n    key: \"getColumnsWidth\",\n    value: function getColumnsWidth(fromColumn, toColumn) {\n      var columnMapper = this.hot.columnIndexMapper;\n      var columnsWidth = 0;\n\n      for (var visualColumnIndex = fromColumn; visualColumnIndex <= toColumn; visualColumnIndex += 1) {\n        // We can't use just `getColWidth` (even without indexes translation) as it doesn't return proper values\n        // when column is stretched.\n        var renderableIndex = columnMapper.getRenderableFromVisualIndex(visualColumnIndex);\n\n        if (visualColumnIndex < 0) {\n          columnsWidth += this.hot.view.wt.wtViewport.getRowHeaderWidth() || 0;\n        } else if (renderableIndex !== null) {\n          columnsWidth += this.hot.view.wt.wtTable.getStretchedColumnWidth(renderableIndex) || 0;\n        }\n      }\n\n      return columnsWidth;\n    }\n    /**\r\n     * Loads initial settings when persistent state is saved or when plugin was initialized as an array.\r\n     *\r\n     * @private\r\n     */\n\n  }, {\n    key: \"moveBySettingsOrLoad\",\n    value: function moveBySettingsOrLoad() {\n      var pluginSettings = this.hot.getSettings()[PLUGIN_KEY];\n\n      if (Array.isArray(pluginSettings)) {\n        this.moveColumns(pluginSettings, 0);\n      } else if (pluginSettings !== void 0) {\n        var persistentState = this.persistentStateLoad();\n\n        if (persistentState.length) {\n          this.moveColumns(persistentState, 0);\n        }\n      }\n    }\n    /**\r\n     * Checks if the provided column is in the fixedColumnsTop section.\r\n     *\r\n     * @private\r\n     * @param {number} column Visual column index to check.\r\n     * @returns {boolean}\r\n     */\n\n  }, {\n    key: \"isFixedColumnsLeft\",\n    value: function isFixedColumnsLeft(column) {\n      return column < this.hot.getSettings().fixedColumnsLeft;\n    }\n    /**\r\n     * Saves the manual column positions to the persistent state (the {@link Options#persistentState} option has to be enabled).\r\n     *\r\n     * @private\r\n     * @fires Hooks#persistentStateSave\r\n     */\n\n  }, {\n    key: \"persistentStateSave\",\n    value: function persistentStateSave() {\n      this.hot.runHooks('persistentStateSave', 'manualColumnMove', this.hot.columnIndexMapper.getIndexesSequence()); // The `PersistentState` plugin should be refactored.\n    }\n    /**\r\n     * Loads the manual column positions from the persistent state (the {@link Options#persistentState} option has to be enabled).\r\n     *\r\n     * @private\r\n     * @fires Hooks#persistentStateLoad\r\n     * @returns {Array} Stored state.\r\n     */\n\n  }, {\n    key: \"persistentStateLoad\",\n    value: function persistentStateLoad() {\n      var storedState = {};\n      this.hot.runHooks('persistentStateLoad', 'manualColumnMove', storedState);\n      return storedState.value ? storedState.value : [];\n    }\n    /**\r\n     * Prepares an array of indexes based on actual selection.\r\n     *\r\n     * @private\r\n     * @param {number} start The start index.\r\n     * @param {number} end The end index.\r\n     * @returns {Array}\r\n     */\n\n  }, {\n    key: \"prepareColumnsToMoving\",\n    value: function prepareColumnsToMoving(start, end) {\n      var selectedColumns = [];\n      rangeEach(start, end, function (i) {\n        selectedColumns.push(i);\n      });\n      return selectedColumns;\n    }\n    /**\r\n     * Update the UI visual position.\r\n     *\r\n     * @private\r\n     */\n\n  }, {\n    key: \"refreshPositions\",\n    value: function refreshPositions() {\n      var priv = privatePool.get(this);\n      var firstVisible = this.hot.view.wt.wtTable.getFirstVisibleColumn();\n      var lastVisible = this.hot.view.wt.wtTable.getLastVisibleColumn();\n      var wtTable = this.hot.view.wt.wtTable;\n      var scrollableElement = this.hot.view.wt.wtOverlays.scrollableElement;\n      var scrollLeft = typeof scrollableElement.scrollX === 'number' ? scrollableElement.scrollX : scrollableElement.scrollLeft;\n      var tdOffsetLeft = this.hot.view.THEAD.offsetLeft + this.getColumnsWidth(0, priv.coords - 1);\n      var mouseOffsetLeft = priv.target.eventPageX - (priv.rootElementOffset - (scrollableElement.scrollX === void 0 ? scrollLeft : 0)); // eslint-disable-line max-len\n\n      var hiderWidth = wtTable.hider.offsetWidth;\n      var tbodyOffsetLeft = wtTable.TBODY.offsetLeft;\n      var backlightElemMarginLeft = this.backlight.getOffset().left;\n      var backlightElemWidth = this.backlight.getSize().width;\n      var rowHeaderWidth = 0;\n\n      if (priv.rootElementOffset + wtTable.holder.offsetWidth + scrollLeft < priv.target.eventPageX) {\n        if (priv.coords < priv.countCols) {\n          priv.coords += 1;\n        }\n      }\n\n      if (priv.hasRowHeaders) {\n        rowHeaderWidth = this.hot.view.wt.wtOverlays.leftOverlay.clone.wtTable.getColumnHeader(-1).offsetWidth;\n      }\n\n      if (this.isFixedColumnsLeft(priv.coords)) {\n        tdOffsetLeft += scrollLeft;\n      }\n\n      tdOffsetLeft += rowHeaderWidth;\n\n      if (priv.coords < 0) {\n        // if hover on rowHeader\n        if (priv.fixedColumns > 0) {\n          priv.target.col = 0;\n        } else {\n          priv.target.col = firstVisible > 0 ? firstVisible - 1 : firstVisible;\n        }\n      } else if (priv.target.TD.offsetWidth / 2 + tdOffsetLeft <= mouseOffsetLeft) {\n        var newCoordsCol = priv.coords >= priv.countCols ? priv.countCols - 1 : priv.coords; // if hover on right part of TD\n\n        priv.target.col = newCoordsCol + 1; // unfortunately first column is bigger than rest\n\n        tdOffsetLeft += priv.target.TD.offsetWidth;\n\n        if (priv.target.col > lastVisible && lastVisible < priv.countCols) {\n          this.hot.scrollViewportTo(void 0, lastVisible + 1, void 0, true);\n        }\n      } else {\n        // elsewhere on table\n        priv.target.col = priv.coords;\n\n        if (priv.target.col <= firstVisible && priv.target.col >= priv.fixedColumns && firstVisible > 0) {\n          this.hot.scrollViewportTo(void 0, firstVisible - 1);\n        }\n      }\n\n      if (priv.target.col <= firstVisible && priv.target.col >= priv.fixedColumns && firstVisible > 0) {\n        this.hot.scrollViewportTo(void 0, firstVisible - 1);\n      }\n\n      var backlightLeft = mouseOffsetLeft;\n      var guidelineLeft = tdOffsetLeft;\n\n      if (mouseOffsetLeft + backlightElemWidth + backlightElemMarginLeft >= hiderWidth) {\n        // prevent display backlight on the right side of the table\n        backlightLeft = hiderWidth - backlightElemWidth - backlightElemMarginLeft;\n      } else if (mouseOffsetLeft + backlightElemMarginLeft < tbodyOffsetLeft + rowHeaderWidth) {\n        // prevent display backlight on the left side of the table\n        backlightLeft = tbodyOffsetLeft + rowHeaderWidth + Math.abs(backlightElemMarginLeft);\n      }\n\n      if (tdOffsetLeft >= hiderWidth - 1) {\n        // prevent display guideline outside the table\n        guidelineLeft = hiderWidth - 1;\n      } else if (guidelineLeft === 0) {\n        // guideline has got `margin-left: -1px` as default\n        guidelineLeft = 1;\n      } else if (scrollableElement.scrollX !== void 0 && priv.coords < priv.fixedColumns) {\n        guidelineLeft -= priv.rootElementOffset <= scrollableElement.scrollX ? priv.rootElementOffset : 0;\n      }\n\n      this.backlight.setPosition(null, backlightLeft);\n      this.guideline.setPosition(null, guidelineLeft);\n    }\n    /**\r\n     * Binds the events used by the plugin.\r\n     *\r\n     * @private\r\n     */\n\n  }, {\n    key: \"registerEvents\",\n    value: function registerEvents() {\n      var _this3 = this;\n\n      var documentElement = this.hot.rootDocument.documentElement;\n      this.eventManager.addEventListener(documentElement, 'mousemove', function (event) {\n        return _this3.onMouseMove(event);\n      });\n      this.eventManager.addEventListener(documentElement, 'mouseup', function () {\n        return _this3.onMouseUp();\n      });\n    }\n    /**\r\n     * Unbinds the events used by the plugin.\r\n     *\r\n     * @private\r\n     */\n\n  }, {\n    key: \"unregisterEvents\",\n    value: function unregisterEvents() {\n      this.eventManager.clear();\n    }\n    /**\r\n     * Change the behavior of selection / dragging.\r\n     *\r\n     * @private\r\n     * @param {MouseEvent} event `mousedown` event properties.\r\n     * @param {CellCoords} coords Visual cell coordinates where was fired event.\r\n     * @param {HTMLElement} TD Cell represented as HTMLElement.\r\n     * @param {object} blockCalculations Object which contains information about blockCalculation for row, column or cells.\r\n     */\n\n  }, {\n    key: \"onBeforeOnCellMouseDown\",\n    value: function onBeforeOnCellMouseDown(event, coords, TD, blockCalculations) {\n      var wtTable = this.hot.view.wt.wtTable;\n      var isHeaderSelection = this.hot.selection.isSelectedByColumnHeader();\n      var selection = this.hot.getSelectedRangeLast();\n      var priv = privatePool.get(this); // This block action shouldn't be handled below.\n\n      var isSortingElement = hasClass(event.target, 'sortAction');\n\n      if (!selection || !isHeaderSelection || priv.pressed || event.button !== 0 || isSortingElement) {\n        priv.pressed = false;\n        priv.columnsToMove.length = 0;\n        removeClass(this.hot.rootElement, [CSS_ON_MOVING, CSS_SHOW_UI]);\n        return;\n      }\n\n      var guidelineIsNotReady = this.guideline.isBuilt() && !this.guideline.isAppended();\n      var backlightIsNotReady = this.backlight.isBuilt() && !this.backlight.isAppended();\n\n      if (guidelineIsNotReady && backlightIsNotReady) {\n        this.guideline.appendTo(wtTable.hider);\n        this.backlight.appendTo(wtTable.hider);\n      }\n\n      var from = selection.from,\n          to = selection.to;\n      var start = Math.min(from.col, to.col);\n      var end = Math.max(from.col, to.col);\n\n      if (coords.row < 0 && coords.col >= start && coords.col <= end) {\n        blockCalculations.column = true;\n        priv.pressed = true;\n        priv.target.eventPageX = event.pageX;\n        priv.coords = coords.col;\n        priv.target.TD = TD;\n        priv.target.col = coords.col;\n        priv.columnsToMove = this.prepareColumnsToMoving(start, end);\n        priv.hasRowHeaders = !!this.hot.getSettings().rowHeaders;\n        priv.countCols = this.hot.countCols();\n        priv.fixedColumns = this.hot.getSettings().fixedColumnsLeft;\n        priv.rootElementOffset = offset(this.hot.rootElement).left;\n        var countColumnsFrom = priv.hasRowHeaders ? -1 : 0;\n        var topPos = wtTable.holder.scrollTop + wtTable.getColumnHeaderHeight(0) + 1;\n        var fixedColumns = coords.col < priv.fixedColumns;\n        var scrollableElement = this.hot.view.wt.wtOverlays.scrollableElement;\n        var wrapperIsWindow = scrollableElement.scrollX ? scrollableElement.scrollX - priv.rootElementOffset : 0;\n        var mouseOffset = event.offsetX - (fixedColumns ? wrapperIsWindow : 0);\n        var leftOffset = Math.abs(this.getColumnsWidth(start, coords.col - 1) + mouseOffset);\n        this.backlight.setPosition(topPos, this.getColumnsWidth(countColumnsFrom, start - 1) + leftOffset);\n        this.backlight.setSize(this.getColumnsWidth(start, end), wtTable.hider.offsetHeight - topPos);\n        this.backlight.setOffset(null, leftOffset * -1);\n        addClass(this.hot.rootElement, CSS_ON_MOVING);\n      } else {\n        removeClass(this.hot.rootElement, CSS_AFTER_SELECTION);\n        priv.pressed = false;\n        priv.columnsToMove.length = 0;\n      }\n    }\n    /**\r\n     * 'mouseMove' event callback. Fired when pointer move on document.documentElement.\r\n     *\r\n     * @private\r\n     * @param {MouseEvent} event `mousemove` event properties.\r\n     */\n\n  }, {\n    key: \"onMouseMove\",\n    value: function onMouseMove(event) {\n      var priv = privatePool.get(this);\n\n      if (!priv.pressed) {\n        return;\n      } // callback for browser which doesn't supports CSS pointer-event: none\n\n\n      if (event.target === this.backlight.element) {\n        var width = this.backlight.getSize().width;\n        this.backlight.setSize(0);\n        setTimeout(function () {\n          this.backlight.setPosition(width);\n        });\n      }\n\n      priv.target.eventPageX = event.pageX;\n      this.refreshPositions();\n    }\n    /**\r\n     * 'beforeOnCellMouseOver' hook callback. Fired when pointer was over cell.\r\n     *\r\n     * @private\r\n     * @param {MouseEvent} event `mouseover` event properties.\r\n     * @param {CellCoords} coords Visual cell coordinates where was fired event.\r\n     * @param {HTMLElement} TD Cell represented as HTMLElement.\r\n     * @param {object} blockCalculations Object which contains information about blockCalculation for column, column or cells.\r\n     */\n\n  }, {\n    key: \"onBeforeOnCellMouseOver\",\n    value: function onBeforeOnCellMouseOver(event, coords, TD, blockCalculations) {\n      var selectedRange = this.hot.getSelectedRangeLast();\n      var priv = privatePool.get(this);\n\n      if (!selectedRange || !priv.pressed) {\n        return;\n      }\n\n      if (priv.columnsToMove.indexOf(coords.col) > -1) {\n        removeClass(this.hot.rootElement, CSS_SHOW_UI);\n      } else {\n        addClass(this.hot.rootElement, CSS_SHOW_UI);\n      }\n\n      blockCalculations.row = true;\n      blockCalculations.column = true;\n      blockCalculations.cell = true;\n      priv.coords = coords.col;\n      priv.target.TD = TD;\n    }\n    /**\r\n     * `onMouseUp` hook callback.\r\n     *\r\n     * @private\r\n     */\n\n  }, {\n    key: \"onMouseUp\",\n    value: function onMouseUp() {\n      var priv = privatePool.get(this);\n      var target = priv.target.col;\n      var columnsLen = priv.columnsToMove.length;\n      priv.coords = void 0;\n      priv.pressed = false;\n      priv.backlightWidth = 0;\n      removeClass(this.hot.rootElement, [CSS_ON_MOVING, CSS_SHOW_UI, CSS_AFTER_SELECTION]);\n\n      if (this.hot.selection.isSelectedByColumnHeader()) {\n        addClass(this.hot.rootElement, CSS_AFTER_SELECTION);\n      }\n\n      if (columnsLen < 1 || target === void 0) {\n        return;\n      }\n\n      var firstMovedVisualColumn = priv.columnsToMove[0];\n      var firstMovedPhysicalColumn = this.hot.toPhysicalColumn(firstMovedVisualColumn);\n      var movePerformed = this.dragColumns(priv.columnsToMove, target);\n      priv.columnsToMove.length = 0;\n\n      if (movePerformed === true) {\n        this.persistentStateSave();\n        this.hot.render();\n        this.hot.view.adjustElementsSize(true);\n        var selectionStart = this.hot.toVisualColumn(firstMovedPhysicalColumn);\n        var selectionEnd = selectionStart + columnsLen - 1;\n        this.hot.selectColumns(selectionStart, selectionEnd);\n      }\n    }\n    /**\r\n     * `afterScrollHorizontally` hook callback. Fired the table was scrolled horizontally.\r\n     *\r\n     * @private\r\n     */\n\n  }, {\n    key: \"onAfterScrollVertically\",\n    value: function onAfterScrollVertically() {\n      var wtTable = this.hot.view.wt.wtTable;\n      var headerHeight = wtTable.getColumnHeaderHeight(0) + 1;\n      var scrollTop = wtTable.holder.scrollTop;\n      var posTop = headerHeight + scrollTop;\n      this.backlight.setPosition(posTop);\n      this.backlight.setSize(null, wtTable.hider.offsetHeight - posTop);\n    }\n    /**\r\n     * Builds the plugin's UI.\r\n     *\r\n     * @private\r\n     */\n\n  }, {\n    key: \"buildPluginUI\",\n    value: function buildPluginUI() {\n      this.backlight.build();\n      this.guideline.build();\n    }\n    /**\r\n     * Callback for the `afterLoadData` hook.\r\n     *\r\n     * @private\r\n     */\n\n  }, {\n    key: \"onAfterLoadData\",\n    value: function onAfterLoadData() {\n      this.moveBySettingsOrLoad();\n    }\n    /**\r\n     * Destroys the plugin instance.\r\n     */\n\n  }, {\n    key: \"destroy\",\n    value: function destroy() {\n      this.backlight.destroy();\n      this.guideline.destroy();\n\n      _get(_getPrototypeOf(ManualColumnMove.prototype), \"destroy\", this).call(this);\n    }\n  }], [{\n    key: \"PLUGIN_KEY\",\n    get: function get() {\n      return PLUGIN_KEY;\n    }\n  }, {\n    key: \"PLUGIN_PRIORITY\",\n    get: function get() {\n      return PLUGIN_PRIORITY;\n    }\n  }]);\n\n  return ManualColumnMove;\n}(BasePlugin);","map":{"version":3,"sources":["C:/Users/ssaez1/technip-repositories/isotracker/isotracker-react/node_modules/handsontable/plugins/manualColumnMove/manualColumnMove.mjs"],"names":["_typeof","obj","Symbol","iterator","constructor","prototype","_classCallCheck","instance","Constructor","TypeError","_defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","Object","defineProperty","key","_createClass","protoProps","staticProps","_get","property","receiver","Reflect","get","base","_superPropBase","desc","getOwnPropertyDescriptor","call","value","object","hasOwnProperty","_getPrototypeOf","_inherits","subClass","superClass","create","_setPrototypeOf","o","p","setPrototypeOf","__proto__","_createSuper","Derived","hasNativeReflectConstruct","_isNativeReflectConstruct","_createSuperInternal","Super","result","NewTarget","construct","arguments","apply","_possibleConstructorReturn","self","_assertThisInitialized","ReferenceError","sham","Proxy","Boolean","valueOf","e","getPrototypeOf","BasePlugin","Hooks","arrayReduce","addClass","removeClass","offset","hasClass","rangeEach","EventManager","BacklightUI","GuidelineUI","getSingleton","register","PLUGIN_KEY","PLUGIN_PRIORITY","privatePool","WeakMap","CSS_PLUGIN","CSS_SHOW_UI","CSS_ON_MOVING","CSS_AFTER_SELECTION","ManualColumnMove","_BasePlugin","_super","hotInstance","_this","set","columnsToMove","countCols","fixedColumns","pressed","eventPageX","coords","TD","col","cachedDropIndex","eventManager","backlight","guideline","isEnabled","hot","getSettings","enablePlugin","_this2","enabled","addHook","event","blockCalculations","onBeforeOnCellMouseDown","onBeforeOnCellMouseOver","onAfterScrollVertically","onAfterLoadData","buildPluginUI","registerEvents","rootElement","updatePlugin","disablePlugin","moveBySettingsOrLoad","unregisterEvents","destroy","moveColumn","column","finalIndex","moveColumns","columns","priv","dropIndex","movePossible","isMovePossible","beforeMoveHook","runHooks","columnIndexMapper","moveIndexes","movePerformed","isColumnOrderChanged","dragColumn","dragColumns","countFinalIndex","movedColumns","getNotTrimmedIndexesLength","tooHighDestinationIndex","tooLowDestinationIndex","tooLowMovedColumnIndex","some","movedColumn","tooHighMovedColumnIndex","nrOfMovedElement","numberOfColumnsLowerThanDropIndex","numberOfColumns","currentColumnIndex","getColumnsWidth","fromColumn","toColumn","columnMapper","columnsWidth","visualColumnIndex","renderableIndex","getRenderableFromVisualIndex","view","wt","wtViewport","getRowHeaderWidth","wtTable","getStretchedColumnWidth","pluginSettings","Array","isArray","persistentState","persistentStateLoad","isFixedColumnsLeft","fixedColumnsLeft","persistentStateSave","getIndexesSequence","storedState","prepareColumnsToMoving","start","end","selectedColumns","push","refreshPositions","firstVisible","getFirstVisibleColumn","lastVisible","getLastVisibleColumn","scrollableElement","wtOverlays","scrollLeft","scrollX","tdOffsetLeft","THEAD","offsetLeft","mouseOffsetLeft","rootElementOffset","hiderWidth","hider","offsetWidth","tbodyOffsetLeft","TBODY","backlightElemMarginLeft","getOffset","left","backlightElemWidth","getSize","width","rowHeaderWidth","holder","hasRowHeaders","leftOverlay","clone","getColumnHeader","newCoordsCol","scrollViewportTo","backlightLeft","guidelineLeft","Math","abs","setPosition","_this3","documentElement","rootDocument","addEventListener","onMouseMove","onMouseUp","clear","isHeaderSelection","selection","isSelectedByColumnHeader","getSelectedRangeLast","isSortingElement","button","guidelineIsNotReady","isBuilt","isAppended","backlightIsNotReady","appendTo","from","to","min","max","row","pageX","rowHeaders","countColumnsFrom","topPos","scrollTop","getColumnHeaderHeight","wrapperIsWindow","mouseOffset","offsetX","leftOffset","setSize","offsetHeight","setOffset","element","setTimeout","selectedRange","indexOf","cell","columnsLen","backlightWidth","firstMovedVisualColumn","firstMovedPhysicalColumn","toPhysicalColumn","render","adjustElementsSize","selectionStart","toVisualColumn","selectionEnd","selectColumns","headerHeight","posTop","build"],"mappings":"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","sourcesContent":["function _typeof(obj) { \"@babel/helpers - typeof\"; if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\r\n\r\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\r\n\r\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\r\n\r\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\r\n\r\nfunction _get(target, property, receiver) { if (typeof Reflect !== \"undefined\" && Reflect.get) { _get = Reflect.get; } else { _get = function _get(target, property, receiver) { var base = _superPropBase(target, property); if (!base) return; var desc = Object.getOwnPropertyDescriptor(base, property); if (desc.get) { return desc.get.call(receiver); } return desc.value; }; } return _get(target, property, receiver || target); }\r\n\r\nfunction _superPropBase(object, property) { while (!Object.prototype.hasOwnProperty.call(object, property)) { object = _getPrototypeOf(object); if (object === null) break; } return object; }\r\n\r\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function\"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); if (superClass) _setPrototypeOf(subClass, superClass); }\r\n\r\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\r\n\r\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\r\n\r\nfunction _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) { return call; } return _assertThisInitialized(self); }\r\n\r\nfunction _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return self; }\r\n\r\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\r\n\r\nfunction _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }\r\n\r\nimport \"core-js/modules/es.array.iterator.js\";\r\nimport \"core-js/modules/es.object.to-string.js\";\r\nimport \"core-js/modules/es.string.iterator.js\";\r\nimport \"core-js/modules/es.weak-map.js\";\r\nimport \"core-js/modules/web.dom-collections.iterator.js\";\r\nimport \"core-js/modules/web.timers.js\";\r\nimport \"core-js/modules/es.array.index-of.js\";\r\nimport \"core-js/modules/es.object.set-prototype-of.js\";\r\nimport \"core-js/modules/es.object.get-prototype-of.js\";\r\nimport \"core-js/modules/es.reflect.construct.js\";\r\nimport \"core-js/modules/es.reflect.get.js\";\r\nimport \"core-js/modules/es.object.get-own-property-descriptor.js\";\r\nimport \"core-js/modules/es.symbol.js\";\r\nimport \"core-js/modules/es.symbol.description.js\";\r\nimport \"core-js/modules/es.symbol.iterator.js\";\r\nimport { BasePlugin } from \"../base/index.mjs\";\r\nimport Hooks from \"../../pluginHooks.mjs\";\r\nimport { arrayReduce } from \"../../helpers/array.mjs\";\r\nimport { addClass, removeClass, offset, hasClass } from \"../../helpers/dom/element.mjs\";\r\nimport { rangeEach } from \"../../helpers/number.mjs\";\r\nimport EventManager from \"../../eventManager.mjs\";\r\nimport BacklightUI from \"./ui/backlight.mjs\";\r\nimport GuidelineUI from \"./ui/guideline.mjs\";\r\nHooks.getSingleton().register('beforeColumnMove');\r\nHooks.getSingleton().register('afterColumnMove');\r\nexport var PLUGIN_KEY = 'manualColumnMove';\r\nexport var PLUGIN_PRIORITY = 120;\r\nvar privatePool = new WeakMap();\r\nvar CSS_PLUGIN = 'ht__manualColumnMove';\r\nvar CSS_SHOW_UI = 'show-ui';\r\nvar CSS_ON_MOVING = 'on-moving--columns';\r\nvar CSS_AFTER_SELECTION = 'after-selection--columns';\r\n/**\r\n * @plugin ManualColumnMove\r\n *\r\n * @description\r\n * This plugin allows to change columns order. To make columns order persistent the {@link Options#persistentState}\r\n * plugin should be enabled.\r\n *\r\n * API:\r\n * - `moveColumn` - move single column to the new position.\r\n * - `moveColumns` - move many columns (as an array of indexes) to the new position.\r\n * - `dragColumn` - drag single column to the new position.\r\n * - `dragColumns` - drag many columns (as an array of indexes) to the new position.\r\n *\r\n * [Documentation](/demo-moving.html#manualColumnMove) explain differences between drag and move actions. Please keep in mind that if you want apply visual changes,\r\n * you have to call manually the `render` method on the instance of Handsontable.\r\n *\r\n * The plugin creates additional components to make moving possibly using user interface:\r\n * - backlight - highlight of selected columns.\r\n * - guideline - line which shows where columns has been moved.\r\n *\r\n * @class ManualColumnMove\r\n * @plugin ManualColumnMove\r\n */\r\n\r\nexport var ManualColumnMove = /*#__PURE__*/function (_BasePlugin) {\r\n  _inherits(ManualColumnMove, _BasePlugin);\r\n\r\n  var _super = _createSuper(ManualColumnMove);\r\n\r\n  function ManualColumnMove(hotInstance) {\r\n    var _this;\r\n\r\n    _classCallCheck(this, ManualColumnMove);\r\n\r\n    _this = _super.call(this, hotInstance);\r\n    /**\r\n     * Set up WeakMap of plugin to sharing private parameters;.\r\n     */\r\n\r\n    privatePool.set(_assertThisInitialized(_this), {\r\n      columnsToMove: [],\r\n      countCols: 0,\r\n      fixedColumns: 0,\r\n      pressed: void 0,\r\n      target: {\r\n        eventPageX: void 0,\r\n        coords: void 0,\r\n        TD: void 0,\r\n        col: void 0\r\n      },\r\n      cachedDropIndex: void 0\r\n    });\r\n    /**\r\n     * Event Manager object.\r\n     *\r\n     * @private\r\n     * @type {object}\r\n     */\r\n\r\n    _this.eventManager = new EventManager(_assertThisInitialized(_this));\r\n    /**\r\n     * Backlight UI object.\r\n     *\r\n     * @private\r\n     * @type {object}\r\n     */\r\n\r\n    _this.backlight = new BacklightUI(hotInstance);\r\n    /**\r\n     * Guideline UI object.\r\n     *\r\n     * @private\r\n     * @type {object}\r\n     */\r\n\r\n    _this.guideline = new GuidelineUI(hotInstance);\r\n    return _this;\r\n  }\r\n  /**\r\n   * Checks if the plugin is enabled in the handsontable settings. This method is executed in {@link Hooks#beforeInit}\r\n   * hook and if it returns `true` than the {@link ManualColumnMove#enablePlugin} method is called.\r\n   *\r\n   * @returns {boolean}\r\n   */\r\n\r\n\r\n  _createClass(ManualColumnMove, [{\r\n    key: \"isEnabled\",\r\n    value: function isEnabled() {\r\n      return !!this.hot.getSettings()[PLUGIN_KEY];\r\n    }\r\n    /**\r\n     * Enables the plugin functionality for this Handsontable instance.\r\n     */\r\n\r\n  }, {\r\n    key: \"enablePlugin\",\r\n    value: function enablePlugin() {\r\n      var _this2 = this;\r\n\r\n      if (this.enabled) {\r\n        return;\r\n      }\r\n\r\n      this.addHook('beforeOnCellMouseDown', function (event, coords, TD, blockCalculations) {\r\n        return _this2.onBeforeOnCellMouseDown(event, coords, TD, blockCalculations);\r\n      });\r\n      this.addHook('beforeOnCellMouseOver', function (event, coords, TD, blockCalculations) {\r\n        return _this2.onBeforeOnCellMouseOver(event, coords, TD, blockCalculations);\r\n      });\r\n      this.addHook('afterScrollVertically', function () {\r\n        return _this2.onAfterScrollVertically();\r\n      });\r\n      this.addHook('afterLoadData', function () {\r\n        return _this2.onAfterLoadData();\r\n      });\r\n      this.buildPluginUI();\r\n      this.registerEvents(); // TODO: move adding plugin classname to BasePlugin.\r\n\r\n      addClass(this.hot.rootElement, CSS_PLUGIN);\r\n\r\n      _get(_getPrototypeOf(ManualColumnMove.prototype), \"enablePlugin\", this).call(this);\r\n    }\r\n    /**\r\n     * Updates the plugin state. This method is executed when {@link Core#updateSettings} is invoked.\r\n     */\r\n\r\n  }, {\r\n    key: \"updatePlugin\",\r\n    value: function updatePlugin() {\r\n      this.disablePlugin();\r\n      this.enablePlugin();\r\n      this.moveBySettingsOrLoad();\r\n\r\n      _get(_getPrototypeOf(ManualColumnMove.prototype), \"updatePlugin\", this).call(this);\r\n    }\r\n    /**\r\n     * Disables the plugin functionality for this Handsontable instance.\r\n     */\r\n\r\n  }, {\r\n    key: \"disablePlugin\",\r\n    value: function disablePlugin() {\r\n      removeClass(this.hot.rootElement, CSS_PLUGIN);\r\n      this.unregisterEvents();\r\n      this.backlight.destroy();\r\n      this.guideline.destroy();\r\n\r\n      _get(_getPrototypeOf(ManualColumnMove.prototype), \"disablePlugin\", this).call(this);\r\n    }\r\n    /**\r\n     * Moves a single column.\r\n     *\r\n     * @param {number} column Visual column index to be moved.\r\n     * @param {number} finalIndex Visual column index, being a start index for the moved columns. Points to where the elements will be placed after the moving action.\r\n     * To check the visualization of the final index, please take a look at [documentation](/demo-moving.html#manualColumnMove).\r\n     * @fires Hooks#beforeColumnMove\r\n     * @fires Hooks#afterColumnMove\r\n     * @returns {boolean}\r\n     */\r\n\r\n  }, {\r\n    key: \"moveColumn\",\r\n    value: function moveColumn(column, finalIndex) {\r\n      return this.moveColumns([column], finalIndex);\r\n    }\r\n    /**\r\n     * Moves a multiple columns.\r\n     *\r\n     * @param {Array} columns Array of visual column indexes to be moved.\r\n     * @param {number} finalIndex Visual column index, being a start index for the moved columns. Points to where the elements will be placed after the moving action.\r\n     * To check the visualization of the final index, please take a look at [documentation](/demo-moving.html#manualColumnMove).\r\n     * @fires Hooks#beforeColumnMove\r\n     * @fires Hooks#afterColumnMove\r\n     * @returns {boolean}\r\n     */\r\n\r\n  }, {\r\n    key: \"moveColumns\",\r\n    value: function moveColumns(columns, finalIndex) {\r\n      var priv = privatePool.get(this);\r\n      var dropIndex = priv.cachedDropIndex;\r\n      var movePossible = this.isMovePossible(columns, finalIndex);\r\n      var beforeMoveHook = this.hot.runHooks('beforeColumnMove', columns, finalIndex, dropIndex, movePossible);\r\n      priv.cachedDropIndex = void 0;\r\n\r\n      if (beforeMoveHook === false) {\r\n        return;\r\n      }\r\n\r\n      if (movePossible) {\r\n        this.hot.columnIndexMapper.moveIndexes(columns, finalIndex);\r\n      }\r\n\r\n      var movePerformed = movePossible && this.isColumnOrderChanged(columns, finalIndex);\r\n      this.hot.runHooks('afterColumnMove', columns, finalIndex, dropIndex, movePossible, movePerformed);\r\n      return movePerformed;\r\n    }\r\n    /**\r\n     * Drag a single column to drop index position.\r\n     *\r\n     * @param {number} column Visual column index to be dragged.\r\n     * @param {number} dropIndex Visual column index, being a drop index for the moved columns. Points to where we are going to drop the moved elements.\r\n     * To check visualization of drop index please take a look at [documentation](/demo-moving.html#manualColumnMove).\r\n     * @fires Hooks#beforeColumnMove\r\n     * @fires Hooks#afterColumnMove\r\n     * @returns {boolean}\r\n     */\r\n\r\n  }, {\r\n    key: \"dragColumn\",\r\n    value: function dragColumn(column, dropIndex) {\r\n      return this.dragColumns([column], dropIndex);\r\n    }\r\n    /**\r\n     * Drag multiple columns to drop index position.\r\n     *\r\n     * @param {Array} columns Array of visual column indexes to be dragged.\r\n     * @param {number} dropIndex Visual column index, being a drop index for the moved columns. Points to where we are going to drop the moved elements.\r\n     * To check visualization of drop index please take a look at [documentation](/demo-moving.html#manualColumnMove).\r\n     * @fires Hooks#beforeColumnMove\r\n     * @fires Hooks#afterColumnMove\r\n     * @returns {boolean}\r\n     */\r\n\r\n  }, {\r\n    key: \"dragColumns\",\r\n    value: function dragColumns(columns, dropIndex) {\r\n      var finalIndex = this.countFinalIndex(columns, dropIndex);\r\n      var priv = privatePool.get(this);\r\n      priv.cachedDropIndex = dropIndex;\r\n      return this.moveColumns(columns, finalIndex);\r\n    }\r\n    /**\r\n     * Indicates if it's possible to move columns to the desired position. Some of the actions aren't possible, i.e. You canâ€™t move more than one element to the last position.\r\n     *\r\n     * @param {Array} movedColumns Array of visual column indexes to be moved.\r\n     * @param {number} finalIndex Visual column index, being a start index for the moved columns. Points to where the elements will be placed after the moving action.\r\n     * To check the visualization of the final index, please take a look at [documentation](/demo-moving.html#manualColumnMove).\r\n     * @returns {boolean}\r\n     */\r\n\r\n  }, {\r\n    key: \"isMovePossible\",\r\n    value: function isMovePossible(movedColumns, finalIndex) {\r\n      var length = this.hot.columnIndexMapper.getNotTrimmedIndexesLength(); // An attempt to transfer more columns to start destination than is possible (only when moving from the top to the bottom).\r\n\r\n      var tooHighDestinationIndex = movedColumns.length + finalIndex > length;\r\n      var tooLowDestinationIndex = finalIndex < 0;\r\n      var tooLowMovedColumnIndex = movedColumns.some(function (movedColumn) {\r\n        return movedColumn < 0;\r\n      });\r\n      var tooHighMovedColumnIndex = movedColumns.some(function (movedColumn) {\r\n        return movedColumn >= length;\r\n      });\r\n\r\n      if (tooHighDestinationIndex || tooLowDestinationIndex || tooLowMovedColumnIndex || tooHighMovedColumnIndex) {\r\n        return false;\r\n      }\r\n\r\n      return true;\r\n    }\r\n    /**\r\n     * Indicates if order of columns was changed.\r\n     *\r\n     * @private\r\n     * @param {Array} movedColumns Array of visual column indexes to be moved.\r\n     * @param {number} finalIndex Visual column index, being a start index for the moved columns. Points to where the elements will be placed after the moving action.\r\n     * To check the visualization of the final index, please take a look at [documentation](/demo-moving.html#manualColumnMove).\r\n     * @returns {boolean}\r\n     */\r\n\r\n  }, {\r\n    key: \"isColumnOrderChanged\",\r\n    value: function isColumnOrderChanged(movedColumns, finalIndex) {\r\n      return movedColumns.some(function (column, nrOfMovedElement) {\r\n        return column - nrOfMovedElement !== finalIndex;\r\n      });\r\n    }\r\n    /**\r\n     * Count the final column index from the drop index.\r\n     *\r\n     * @private\r\n     * @param {Array} movedColumns Array of visual column indexes to be moved.\r\n     * @param {number} dropIndex Visual column index, being a drop index for the moved columns.\r\n     * @returns {number} Visual column index, being a start index for the moved columns.\r\n     */\r\n\r\n  }, {\r\n    key: \"countFinalIndex\",\r\n    value: function countFinalIndex(movedColumns, dropIndex) {\r\n      var numberOfColumnsLowerThanDropIndex = arrayReduce(movedColumns, function (numberOfColumns, currentColumnIndex) {\r\n        if (currentColumnIndex < dropIndex) {\r\n          numberOfColumns += 1;\r\n        }\r\n\r\n        return numberOfColumns;\r\n      }, 0);\r\n      return dropIndex - numberOfColumnsLowerThanDropIndex;\r\n    }\r\n    /**\r\n     * Gets the sum of the widths of columns in the provided range.\r\n     *\r\n     * @private\r\n     * @param {number} fromColumn Visual column index.\r\n     * @param {number} toColumn Visual column index.\r\n     * @returns {number}\r\n     */\r\n\r\n  }, {\r\n    key: \"getColumnsWidth\",\r\n    value: function getColumnsWidth(fromColumn, toColumn) {\r\n      var columnMapper = this.hot.columnIndexMapper;\r\n      var columnsWidth = 0;\r\n\r\n      for (var visualColumnIndex = fromColumn; visualColumnIndex <= toColumn; visualColumnIndex += 1) {\r\n        // We can't use just `getColWidth` (even without indexes translation) as it doesn't return proper values\r\n        // when column is stretched.\r\n        var renderableIndex = columnMapper.getRenderableFromVisualIndex(visualColumnIndex);\r\n\r\n        if (visualColumnIndex < 0) {\r\n          columnsWidth += this.hot.view.wt.wtViewport.getRowHeaderWidth() || 0;\r\n        } else if (renderableIndex !== null) {\r\n          columnsWidth += this.hot.view.wt.wtTable.getStretchedColumnWidth(renderableIndex) || 0;\r\n        }\r\n      }\r\n\r\n      return columnsWidth;\r\n    }\r\n    /**\r\n     * Loads initial settings when persistent state is saved or when plugin was initialized as an array.\r\n     *\r\n     * @private\r\n     */\r\n\r\n  }, {\r\n    key: \"moveBySettingsOrLoad\",\r\n    value: function moveBySettingsOrLoad() {\r\n      var pluginSettings = this.hot.getSettings()[PLUGIN_KEY];\r\n\r\n      if (Array.isArray(pluginSettings)) {\r\n        this.moveColumns(pluginSettings, 0);\r\n      } else if (pluginSettings !== void 0) {\r\n        var persistentState = this.persistentStateLoad();\r\n\r\n        if (persistentState.length) {\r\n          this.moveColumns(persistentState, 0);\r\n        }\r\n      }\r\n    }\r\n    /**\r\n     * Checks if the provided column is in the fixedColumnsTop section.\r\n     *\r\n     * @private\r\n     * @param {number} column Visual column index to check.\r\n     * @returns {boolean}\r\n     */\r\n\r\n  }, {\r\n    key: \"isFixedColumnsLeft\",\r\n    value: function isFixedColumnsLeft(column) {\r\n      return column < this.hot.getSettings().fixedColumnsLeft;\r\n    }\r\n    /**\r\n     * Saves the manual column positions to the persistent state (the {@link Options#persistentState} option has to be enabled).\r\n     *\r\n     * @private\r\n     * @fires Hooks#persistentStateSave\r\n     */\r\n\r\n  }, {\r\n    key: \"persistentStateSave\",\r\n    value: function persistentStateSave() {\r\n      this.hot.runHooks('persistentStateSave', 'manualColumnMove', this.hot.columnIndexMapper.getIndexesSequence()); // The `PersistentState` plugin should be refactored.\r\n    }\r\n    /**\r\n     * Loads the manual column positions from the persistent state (the {@link Options#persistentState} option has to be enabled).\r\n     *\r\n     * @private\r\n     * @fires Hooks#persistentStateLoad\r\n     * @returns {Array} Stored state.\r\n     */\r\n\r\n  }, {\r\n    key: \"persistentStateLoad\",\r\n    value: function persistentStateLoad() {\r\n      var storedState = {};\r\n      this.hot.runHooks('persistentStateLoad', 'manualColumnMove', storedState);\r\n      return storedState.value ? storedState.value : [];\r\n    }\r\n    /**\r\n     * Prepares an array of indexes based on actual selection.\r\n     *\r\n     * @private\r\n     * @param {number} start The start index.\r\n     * @param {number} end The end index.\r\n     * @returns {Array}\r\n     */\r\n\r\n  }, {\r\n    key: \"prepareColumnsToMoving\",\r\n    value: function prepareColumnsToMoving(start, end) {\r\n      var selectedColumns = [];\r\n      rangeEach(start, end, function (i) {\r\n        selectedColumns.push(i);\r\n      });\r\n      return selectedColumns;\r\n    }\r\n    /**\r\n     * Update the UI visual position.\r\n     *\r\n     * @private\r\n     */\r\n\r\n  }, {\r\n    key: \"refreshPositions\",\r\n    value: function refreshPositions() {\r\n      var priv = privatePool.get(this);\r\n      var firstVisible = this.hot.view.wt.wtTable.getFirstVisibleColumn();\r\n      var lastVisible = this.hot.view.wt.wtTable.getLastVisibleColumn();\r\n      var wtTable = this.hot.view.wt.wtTable;\r\n      var scrollableElement = this.hot.view.wt.wtOverlays.scrollableElement;\r\n      var scrollLeft = typeof scrollableElement.scrollX === 'number' ? scrollableElement.scrollX : scrollableElement.scrollLeft;\r\n      var tdOffsetLeft = this.hot.view.THEAD.offsetLeft + this.getColumnsWidth(0, priv.coords - 1);\r\n      var mouseOffsetLeft = priv.target.eventPageX - (priv.rootElementOffset - (scrollableElement.scrollX === void 0 ? scrollLeft : 0)); // eslint-disable-line max-len\r\n\r\n      var hiderWidth = wtTable.hider.offsetWidth;\r\n      var tbodyOffsetLeft = wtTable.TBODY.offsetLeft;\r\n      var backlightElemMarginLeft = this.backlight.getOffset().left;\r\n      var backlightElemWidth = this.backlight.getSize().width;\r\n      var rowHeaderWidth = 0;\r\n\r\n      if (priv.rootElementOffset + wtTable.holder.offsetWidth + scrollLeft < priv.target.eventPageX) {\r\n        if (priv.coords < priv.countCols) {\r\n          priv.coords += 1;\r\n        }\r\n      }\r\n\r\n      if (priv.hasRowHeaders) {\r\n        rowHeaderWidth = this.hot.view.wt.wtOverlays.leftOverlay.clone.wtTable.getColumnHeader(-1).offsetWidth;\r\n      }\r\n\r\n      if (this.isFixedColumnsLeft(priv.coords)) {\r\n        tdOffsetLeft += scrollLeft;\r\n      }\r\n\r\n      tdOffsetLeft += rowHeaderWidth;\r\n\r\n      if (priv.coords < 0) {\r\n        // if hover on rowHeader\r\n        if (priv.fixedColumns > 0) {\r\n          priv.target.col = 0;\r\n        } else {\r\n          priv.target.col = firstVisible > 0 ? firstVisible - 1 : firstVisible;\r\n        }\r\n      } else if (priv.target.TD.offsetWidth / 2 + tdOffsetLeft <= mouseOffsetLeft) {\r\n        var newCoordsCol = priv.coords >= priv.countCols ? priv.countCols - 1 : priv.coords; // if hover on right part of TD\r\n\r\n        priv.target.col = newCoordsCol + 1; // unfortunately first column is bigger than rest\r\n\r\n        tdOffsetLeft += priv.target.TD.offsetWidth;\r\n\r\n        if (priv.target.col > lastVisible && lastVisible < priv.countCols) {\r\n          this.hot.scrollViewportTo(void 0, lastVisible + 1, void 0, true);\r\n        }\r\n      } else {\r\n        // elsewhere on table\r\n        priv.target.col = priv.coords;\r\n\r\n        if (priv.target.col <= firstVisible && priv.target.col >= priv.fixedColumns && firstVisible > 0) {\r\n          this.hot.scrollViewportTo(void 0, firstVisible - 1);\r\n        }\r\n      }\r\n\r\n      if (priv.target.col <= firstVisible && priv.target.col >= priv.fixedColumns && firstVisible > 0) {\r\n        this.hot.scrollViewportTo(void 0, firstVisible - 1);\r\n      }\r\n\r\n      var backlightLeft = mouseOffsetLeft;\r\n      var guidelineLeft = tdOffsetLeft;\r\n\r\n      if (mouseOffsetLeft + backlightElemWidth + backlightElemMarginLeft >= hiderWidth) {\r\n        // prevent display backlight on the right side of the table\r\n        backlightLeft = hiderWidth - backlightElemWidth - backlightElemMarginLeft;\r\n      } else if (mouseOffsetLeft + backlightElemMarginLeft < tbodyOffsetLeft + rowHeaderWidth) {\r\n        // prevent display backlight on the left side of the table\r\n        backlightLeft = tbodyOffsetLeft + rowHeaderWidth + Math.abs(backlightElemMarginLeft);\r\n      }\r\n\r\n      if (tdOffsetLeft >= hiderWidth - 1) {\r\n        // prevent display guideline outside the table\r\n        guidelineLeft = hiderWidth - 1;\r\n      } else if (guidelineLeft === 0) {\r\n        // guideline has got `margin-left: -1px` as default\r\n        guidelineLeft = 1;\r\n      } else if (scrollableElement.scrollX !== void 0 && priv.coords < priv.fixedColumns) {\r\n        guidelineLeft -= priv.rootElementOffset <= scrollableElement.scrollX ? priv.rootElementOffset : 0;\r\n      }\r\n\r\n      this.backlight.setPosition(null, backlightLeft);\r\n      this.guideline.setPosition(null, guidelineLeft);\r\n    }\r\n    /**\r\n     * Binds the events used by the plugin.\r\n     *\r\n     * @private\r\n     */\r\n\r\n  }, {\r\n    key: \"registerEvents\",\r\n    value: function registerEvents() {\r\n      var _this3 = this;\r\n\r\n      var documentElement = this.hot.rootDocument.documentElement;\r\n      this.eventManager.addEventListener(documentElement, 'mousemove', function (event) {\r\n        return _this3.onMouseMove(event);\r\n      });\r\n      this.eventManager.addEventListener(documentElement, 'mouseup', function () {\r\n        return _this3.onMouseUp();\r\n      });\r\n    }\r\n    /**\r\n     * Unbinds the events used by the plugin.\r\n     *\r\n     * @private\r\n     */\r\n\r\n  }, {\r\n    key: \"unregisterEvents\",\r\n    value: function unregisterEvents() {\r\n      this.eventManager.clear();\r\n    }\r\n    /**\r\n     * Change the behavior of selection / dragging.\r\n     *\r\n     * @private\r\n     * @param {MouseEvent} event `mousedown` event properties.\r\n     * @param {CellCoords} coords Visual cell coordinates where was fired event.\r\n     * @param {HTMLElement} TD Cell represented as HTMLElement.\r\n     * @param {object} blockCalculations Object which contains information about blockCalculation for row, column or cells.\r\n     */\r\n\r\n  }, {\r\n    key: \"onBeforeOnCellMouseDown\",\r\n    value: function onBeforeOnCellMouseDown(event, coords, TD, blockCalculations) {\r\n      var wtTable = this.hot.view.wt.wtTable;\r\n      var isHeaderSelection = this.hot.selection.isSelectedByColumnHeader();\r\n      var selection = this.hot.getSelectedRangeLast();\r\n      var priv = privatePool.get(this); // This block action shouldn't be handled below.\r\n\r\n      var isSortingElement = hasClass(event.target, 'sortAction');\r\n\r\n      if (!selection || !isHeaderSelection || priv.pressed || event.button !== 0 || isSortingElement) {\r\n        priv.pressed = false;\r\n        priv.columnsToMove.length = 0;\r\n        removeClass(this.hot.rootElement, [CSS_ON_MOVING, CSS_SHOW_UI]);\r\n        return;\r\n      }\r\n\r\n      var guidelineIsNotReady = this.guideline.isBuilt() && !this.guideline.isAppended();\r\n      var backlightIsNotReady = this.backlight.isBuilt() && !this.backlight.isAppended();\r\n\r\n      if (guidelineIsNotReady && backlightIsNotReady) {\r\n        this.guideline.appendTo(wtTable.hider);\r\n        this.backlight.appendTo(wtTable.hider);\r\n      }\r\n\r\n      var from = selection.from,\r\n          to = selection.to;\r\n      var start = Math.min(from.col, to.col);\r\n      var end = Math.max(from.col, to.col);\r\n\r\n      if (coords.row < 0 && coords.col >= start && coords.col <= end) {\r\n        blockCalculations.column = true;\r\n        priv.pressed = true;\r\n        priv.target.eventPageX = event.pageX;\r\n        priv.coords = coords.col;\r\n        priv.target.TD = TD;\r\n        priv.target.col = coords.col;\r\n        priv.columnsToMove = this.prepareColumnsToMoving(start, end);\r\n        priv.hasRowHeaders = !!this.hot.getSettings().rowHeaders;\r\n        priv.countCols = this.hot.countCols();\r\n        priv.fixedColumns = this.hot.getSettings().fixedColumnsLeft;\r\n        priv.rootElementOffset = offset(this.hot.rootElement).left;\r\n        var countColumnsFrom = priv.hasRowHeaders ? -1 : 0;\r\n        var topPos = wtTable.holder.scrollTop + wtTable.getColumnHeaderHeight(0) + 1;\r\n        var fixedColumns = coords.col < priv.fixedColumns;\r\n        var scrollableElement = this.hot.view.wt.wtOverlays.scrollableElement;\r\n        var wrapperIsWindow = scrollableElement.scrollX ? scrollableElement.scrollX - priv.rootElementOffset : 0;\r\n        var mouseOffset = event.offsetX - (fixedColumns ? wrapperIsWindow : 0);\r\n        var leftOffset = Math.abs(this.getColumnsWidth(start, coords.col - 1) + mouseOffset);\r\n        this.backlight.setPosition(topPos, this.getColumnsWidth(countColumnsFrom, start - 1) + leftOffset);\r\n        this.backlight.setSize(this.getColumnsWidth(start, end), wtTable.hider.offsetHeight - topPos);\r\n        this.backlight.setOffset(null, leftOffset * -1);\r\n        addClass(this.hot.rootElement, CSS_ON_MOVING);\r\n      } else {\r\n        removeClass(this.hot.rootElement, CSS_AFTER_SELECTION);\r\n        priv.pressed = false;\r\n        priv.columnsToMove.length = 0;\r\n      }\r\n    }\r\n    /**\r\n     * 'mouseMove' event callback. Fired when pointer move on document.documentElement.\r\n     *\r\n     * @private\r\n     * @param {MouseEvent} event `mousemove` event properties.\r\n     */\r\n\r\n  }, {\r\n    key: \"onMouseMove\",\r\n    value: function onMouseMove(event) {\r\n      var priv = privatePool.get(this);\r\n\r\n      if (!priv.pressed) {\r\n        return;\r\n      } // callback for browser which doesn't supports CSS pointer-event: none\r\n\r\n\r\n      if (event.target === this.backlight.element) {\r\n        var width = this.backlight.getSize().width;\r\n        this.backlight.setSize(0);\r\n        setTimeout(function () {\r\n          this.backlight.setPosition(width);\r\n        });\r\n      }\r\n\r\n      priv.target.eventPageX = event.pageX;\r\n      this.refreshPositions();\r\n    }\r\n    /**\r\n     * 'beforeOnCellMouseOver' hook callback. Fired when pointer was over cell.\r\n     *\r\n     * @private\r\n     * @param {MouseEvent} event `mouseover` event properties.\r\n     * @param {CellCoords} coords Visual cell coordinates where was fired event.\r\n     * @param {HTMLElement} TD Cell represented as HTMLElement.\r\n     * @param {object} blockCalculations Object which contains information about blockCalculation for column, column or cells.\r\n     */\r\n\r\n  }, {\r\n    key: \"onBeforeOnCellMouseOver\",\r\n    value: function onBeforeOnCellMouseOver(event, coords, TD, blockCalculations) {\r\n      var selectedRange = this.hot.getSelectedRangeLast();\r\n      var priv = privatePool.get(this);\r\n\r\n      if (!selectedRange || !priv.pressed) {\r\n        return;\r\n      }\r\n\r\n      if (priv.columnsToMove.indexOf(coords.col) > -1) {\r\n        removeClass(this.hot.rootElement, CSS_SHOW_UI);\r\n      } else {\r\n        addClass(this.hot.rootElement, CSS_SHOW_UI);\r\n      }\r\n\r\n      blockCalculations.row = true;\r\n      blockCalculations.column = true;\r\n      blockCalculations.cell = true;\r\n      priv.coords = coords.col;\r\n      priv.target.TD = TD;\r\n    }\r\n    /**\r\n     * `onMouseUp` hook callback.\r\n     *\r\n     * @private\r\n     */\r\n\r\n  }, {\r\n    key: \"onMouseUp\",\r\n    value: function onMouseUp() {\r\n      var priv = privatePool.get(this);\r\n      var target = priv.target.col;\r\n      var columnsLen = priv.columnsToMove.length;\r\n      priv.coords = void 0;\r\n      priv.pressed = false;\r\n      priv.backlightWidth = 0;\r\n      removeClass(this.hot.rootElement, [CSS_ON_MOVING, CSS_SHOW_UI, CSS_AFTER_SELECTION]);\r\n\r\n      if (this.hot.selection.isSelectedByColumnHeader()) {\r\n        addClass(this.hot.rootElement, CSS_AFTER_SELECTION);\r\n      }\r\n\r\n      if (columnsLen < 1 || target === void 0) {\r\n        return;\r\n      }\r\n\r\n      var firstMovedVisualColumn = priv.columnsToMove[0];\r\n      var firstMovedPhysicalColumn = this.hot.toPhysicalColumn(firstMovedVisualColumn);\r\n      var movePerformed = this.dragColumns(priv.columnsToMove, target);\r\n      priv.columnsToMove.length = 0;\r\n\r\n      if (movePerformed === true) {\r\n        this.persistentStateSave();\r\n        this.hot.render();\r\n        this.hot.view.adjustElementsSize(true);\r\n        var selectionStart = this.hot.toVisualColumn(firstMovedPhysicalColumn);\r\n        var selectionEnd = selectionStart + columnsLen - 1;\r\n        this.hot.selectColumns(selectionStart, selectionEnd);\r\n      }\r\n    }\r\n    /**\r\n     * `afterScrollHorizontally` hook callback. Fired the table was scrolled horizontally.\r\n     *\r\n     * @private\r\n     */\r\n\r\n  }, {\r\n    key: \"onAfterScrollVertically\",\r\n    value: function onAfterScrollVertically() {\r\n      var wtTable = this.hot.view.wt.wtTable;\r\n      var headerHeight = wtTable.getColumnHeaderHeight(0) + 1;\r\n      var scrollTop = wtTable.holder.scrollTop;\r\n      var posTop = headerHeight + scrollTop;\r\n      this.backlight.setPosition(posTop);\r\n      this.backlight.setSize(null, wtTable.hider.offsetHeight - posTop);\r\n    }\r\n    /**\r\n     * Builds the plugin's UI.\r\n     *\r\n     * @private\r\n     */\r\n\r\n  }, {\r\n    key: \"buildPluginUI\",\r\n    value: function buildPluginUI() {\r\n      this.backlight.build();\r\n      this.guideline.build();\r\n    }\r\n    /**\r\n     * Callback for the `afterLoadData` hook.\r\n     *\r\n     * @private\r\n     */\r\n\r\n  }, {\r\n    key: \"onAfterLoadData\",\r\n    value: function onAfterLoadData() {\r\n      this.moveBySettingsOrLoad();\r\n    }\r\n    /**\r\n     * Destroys the plugin instance.\r\n     */\r\n\r\n  }, {\r\n    key: \"destroy\",\r\n    value: function destroy() {\r\n      this.backlight.destroy();\r\n      this.guideline.destroy();\r\n\r\n      _get(_getPrototypeOf(ManualColumnMove.prototype), \"destroy\", this).call(this);\r\n    }\r\n  }], [{\r\n    key: \"PLUGIN_KEY\",\r\n    get: function get() {\r\n      return PLUGIN_KEY;\r\n    }\r\n  }, {\r\n    key: \"PLUGIN_PRIORITY\",\r\n    get: function get() {\r\n      return PLUGIN_PRIORITY;\r\n    }\r\n  }]);\r\n\r\n  return ManualColumnMove;\r\n}(BasePlugin);"]},"metadata":{},"sourceType":"module"}