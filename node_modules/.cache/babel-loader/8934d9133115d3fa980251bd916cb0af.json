{"ast":null,"code":"import _regeneratorRuntime from\"C:/xampp/htdocs/isotracker-dev/isotracker-react/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"C:/xampp/htdocs/isotracker-dev/isotracker-react/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"C:/xampp/htdocs/isotracker-dev/isotracker-react/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"C:/xampp/htdocs/isotracker-dev/isotracker-react/node_modules/@babel/runtime/helpers/esm/createClass\";import _assertThisInitialized from\"C:/xampp/htdocs/isotracker-dev/isotracker-react/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";import _inherits from\"C:/xampp/htdocs/isotracker-dev/isotracker-react/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"C:/xampp/htdocs/isotracker-dev/isotracker-react/node_modules/@babel/runtime/helpers/esm/createSuper\";import React,{Component}from'react';import Modal from'react-awesome-modal';import'../uploadReportPopUp/uploadReportPopUp.css';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var CryptoJS=require(\"crypto-js\");var SecureStorage=require(\"secure-web-storage\");var SECRET_KEY='sanud2ha8shd72h';var secureStorage=new SecureStorage(localStorage,{hash:function hash(key){key=CryptoJS.SHA256(key,SECRET_KEY);return key.toString();},encrypt:function encrypt(data){data=CryptoJS.AES.encrypt(data,SECRET_KEY);data=data.toString();return data;},decrypt:function decrypt(data){data=CryptoJS.AES.decrypt(data,SECRET_KEY);data=data.toString(CryptoJS.enc.Utf8);return data;}});var UpdateDrawingPopUp=/*#__PURE__*/function(_Component){_inherits(UpdateDrawingPopUp,_Component);var _super=_createSuper(UpdateDrawingPopUp);function UpdateDrawingPopUp(props){var _this;_classCallCheck(this,UpdateDrawingPopUp);_this=_super.call(this,props);_this.state={visible:false,file:null,error:false};_this.handleChange=_this.handleChange.bind(_assertThisInitialized(_this));_this.uploadReport=_this.uploadReport.bind(_assertThisInitialized(_this));_this.id=props.id;return _this;}_createClass(UpdateDrawingPopUp,[{key:\"openModal\",value:function openModal(){this.setState({visible:true,error:false,file:null});}},{key:\"closeModal\",value:function closeModal(){document.getElementById(\"fileToUpload\").value=null;this.setState({visible:false,file:null});}},{key:\"handleChange\",value:function(){var _handleChange=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(event){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return this.setState({file:event.target.files[0]});case 2:case\"end\":return _context.stop();}}},_callee,this);}));function handleChange(_x){return _handleChange.apply(this,arguments);}return handleChange;}()},{key:\"uploadReport\",value:function(){var _uploadReport=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){var _this2=this;var extension,fileName,file,body;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:extension=this.state.file.name.split('.').pop();fileName=this.props.description_plan_code+\".\"+extension;file=new FormData();file.append('file',this.state.file,fileName);body={description_plan_code:this.props.description_plan_code,fileName:fileName,email:secureStorage.getItem(\"user\")};_context3.next=7;return fetch(\"http://\"+process.env.REACT_APP_SERVER+\":\"+process.env.REACT_APP_NODE_PORT+\"/updateDrawingDB\",{method:'POST',headers:{\"Content-Type\":\"application/json\"},body:JSON.stringify(body)}).then(function(response){return response.json();}).then(/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(json){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if(!json.success){_context2.next=5;break;}_context2.next=3;return fetch(\"http://\"+process.env.REACT_APP_SERVER+\":\"+process.env.REACT_APP_NODE_PORT+\"/updateDrawing\",{method:'POST',body:file}).then(function(response){if(response.status!==200){_this2.props.drawingUploadError();}else{_this2.props.updateDrawingSuccess();_this2.setState({file:null,error:false});}});case 3:_context2.next=6;break;case 5:console.log(\"error\");case 6:case\"end\":return _context2.stop();}}},_callee2);}));return function(_x2){return _ref.apply(this,arguments);};}());case 7:this.closeModal();case 8:case\"end\":return _context3.stop();}}},_callee3,this);}));function uploadReport(){return _uploadReport.apply(this,arguments);}return uploadReport;}()},{key:\"render\",value:function render(){var _this3=this;return/*#__PURE__*/_jsxs(\"section\",{style:{float:\"right\"},children:[/*#__PURE__*/_jsx(\"input\",{type:\"button\",value:\"UPDATE\",class:\"update__btn btn-sm btn-info\",onClick:function onClick(){return _this3.openModal();}}),/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsxs(Modal,{visible:this.state.visible,width:\"650\",height:\"180\",effect:\"fadeInUp\",onClickAway:function onClickAway(){return _this3.closeModal();},children:[/*#__PURE__*/_jsx(\"div\",{className:\"popUp__container\",children:/*#__PURE__*/_jsx(\"center\",{className:\"popUp__title\",children:/*#__PURE__*/_jsxs(\"h2\",{children:[\"Update the drawing for \",this.props.description_plan_code]})})}),/*#__PURE__*/_jsxs(\"div\",{className:\"select__container\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"file\",accept:\".pdf,.png\",name:\"fileToUpload\",id:\"fileToUpload\",onChange:this.handleChange}),/*#__PURE__*/_jsx(\"button\",{style:{marginLeft:\"10px\"},className:\"btn btn-sm btn-success\",onClick:function onClick(){return _this3.uploadReport();},children:\"Submit\"})]})]})})]});}}]);return UpdateDrawingPopUp;}(Component);export{UpdateDrawingPopUp as default};","map":{"version":3,"sources":["C:/xampp/htdocs/isotracker-dev/isotracker-react/src/components/updateDrawingPopUp/updateDrawingPopUp.js"],"names":["React","Component","Modal","CryptoJS","require","SecureStorage","SECRET_KEY","secureStorage","localStorage","hash","key","SHA256","toString","encrypt","data","AES","decrypt","enc","Utf8","UpdateDrawingPopUp","props","state","visible","file","error","handleChange","bind","uploadReport","id","setState","document","getElementById","value","event","target","files","extension","name","split","pop","fileName","description_plan_code","FormData","append","body","email","getItem","fetch","process","env","REACT_APP_SERVER","REACT_APP_NODE_PORT","method","headers","JSON","stringify","then","response","json","success","status","drawingUploadError","updateDrawingSuccess","console","log","closeModal","float","openModal","marginLeft"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\r\nimport Modal from 'react-awesome-modal';\r\nimport '../uploadReportPopUp/uploadReportPopUp.css'\r\n\r\nconst CryptoJS = require(\"crypto-js\");\r\n    const SecureStorage = require(\"secure-web-storage\");\r\n    var SECRET_KEY = 'sanud2ha8shd72h';\r\n\r\n    var secureStorage = new SecureStorage(localStorage, {\r\n        hash: function hash(key) {\r\n            key = CryptoJS.SHA256(key, SECRET_KEY);\r\n    \r\n            return key.toString();\r\n        },\r\n        encrypt: function encrypt(data) {\r\n            data = CryptoJS.AES.encrypt(data, SECRET_KEY);\r\n    \r\n            data = data.toString();\r\n    \r\n            return data;\r\n        },\r\n        decrypt: function decrypt(data) {\r\n            data = CryptoJS.AES.decrypt(data, SECRET_KEY);\r\n    \r\n            data = data.toString(CryptoJS.enc.Utf8);\r\n    \r\n            return data;\r\n        }\r\n    });\r\n\r\nexport default class UpdateDrawingPopUp extends Component {\r\n    constructor(props) {\r\n        super(props);\r\n        this.state = {\r\n            visible : false,\r\n            file: null,\r\n            error: false\r\n        }\r\n        this.handleChange = this.handleChange.bind(this);\r\n        this.uploadReport = this.uploadReport.bind(this);\r\n        this.id = props.id;\r\n        \r\n    }\r\n   \r\n\r\n    openModal() {      \r\n        this.setState({\r\n            visible : true,\r\n            error: false,\r\n            file: null\r\n        });\r\n    }\r\n\r\n    closeModal() {\r\n        document.getElementById(\"fileToUpload\").value = null\r\n        this.setState({\r\n            visible : false,\r\n            file: null,\r\n        });\r\n    }\r\n\r\n    async handleChange(event){\r\n        await this.setState({file: event.target.files[0]})\r\n    }\r\n\r\n    async uploadReport(){\r\n        const extension = this.state.file.name.split('.').pop();\r\n        const fileName = this.props.description_plan_code + \".\" + extension\r\n        const file  = new FormData(); \r\n        file.append('file', this.state.file, fileName);\r\n        \r\n        const body = {\r\n            description_plan_code: this.props.description_plan_code,\r\n            fileName: fileName,\r\n            email: secureStorage.getItem(\"user\")\r\n        }\r\n\r\n\r\n        await fetch(\"http://\"+process.env.REACT_APP_SERVER+\":\"+process.env.REACT_APP_NODE_PORT+\"/updateDrawingDB\", {\r\n            method: 'POST',\r\n            headers: {\r\n                \"Content-Type\": \"application/json\"\r\n            },\r\n            body: JSON.stringify(body)\r\n            })\r\n            .then(response => response.json())\r\n            .then(async json =>{\r\n                if(json.success){\r\n                    await fetch(\"http://\"+process.env.REACT_APP_SERVER+\":\"+process.env.REACT_APP_NODE_PORT+\"/updateDrawing\", {\r\n                        method: 'POST',\r\n                        body: file,\r\n                        })\r\n                        .then(response =>{\r\n                            if (response.status !== 200){\r\n                                this.props.drawingUploadError()\r\n                            }else{\r\n                                this.props.updateDrawingSuccess()\r\n            \r\n                                this.setState({\r\n                                    file: null,\r\n                                    error: false\r\n                                })\r\n                            }\r\n             \r\n                        })\r\n                }else{\r\n                    console.log(\"error\")\r\n                }\r\n            })\r\n\r\n        \r\n\r\n        this.closeModal()\r\n    }\r\n\r\n    render() {\r\n        return (\r\n            <section style={{float:\"right\"}}>\r\n                <input type=\"button\"  value=\"UPDATE\" class=\"update__btn btn-sm btn-info\"  onClick={() => this.openModal()} />\r\n                <div>\r\n                    <Modal visible={this.state.visible} width=\"650\" height=\"180\" effect=\"fadeInUp\" onClickAway={() => this.closeModal()}>\r\n                        <div className=\"popUp__container\" >\r\n                            <center className=\"popUp__title\"><h2>Update the drawing for {this.props.description_plan_code}</h2></center>\r\n                                \r\n                        </div>\r\n                        <div className=\"select__container\">\r\n\r\n                            <input type=\"file\" accept=\".pdf,.png\" name=\"fileToUpload\" id=\"fileToUpload\" onChange={this.handleChange}/>\r\n                            <button style={{marginLeft:\"10px\"}} className=\"btn btn-sm btn-success\" onClick={()=>this.uploadReport()}>Submit</button>\r\n                            \r\n                        </div> \r\n\r\n                        \r\n                    </Modal>\r\n                </div>\r\n            </section>\r\n        );\r\n    }\r\n}"]},"metadata":{},"sourceType":"module"}