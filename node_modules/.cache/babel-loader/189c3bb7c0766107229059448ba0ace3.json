{"ast":null,"code":"import _createForOfIteratorHelper from\"C:/xampp/htdocs/isotracker-dev/isotracker-react/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper\";import _regeneratorRuntime from\"C:/xampp/htdocs/isotracker-dev/isotracker-react/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"C:/xampp/htdocs/isotracker-dev/isotracker-react/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"C:/xampp/htdocs/isotracker-dev/isotracker-react/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"C:/xampp/htdocs/isotracker-dev/isotracker-react/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"C:/xampp/htdocs/isotracker-dev/isotracker-react/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"C:/xampp/htdocs/isotracker-dev/isotracker-react/node_modules/@babel/runtime/helpers/esm/createSuper\";import _objectSpread from\"C:/xampp/htdocs/isotracker-dev/isotracker-react/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import'react-dropzone-uploader/dist/styles.css';import Dropzone from'react-dropzone-uploader';import React from'react';import{message}from'antd';import Alert from'@material-ui/lab/Alert';import Collapse from'@material-ui/core/Collapse';import{jsxs as _jsxs}from\"react/jsx-runtime\";import{jsx as _jsx}from\"react/jsx-runtime\";var Layout=function Layout(_ref){var input=_ref.input,previews=_ref.previews,submitButton=_ref.submitButton,dropzoneProps=_ref.dropzoneProps,files=_ref.files,maxFiles=_ref.extra.maxFiles;return/*#__PURE__*/_jsxs(\"div\",{children:[submitButton,/*#__PURE__*/_jsxs(\"div\",_objectSpread(_objectSpread({},dropzoneProps),{},{children:[previews,files.length<maxFiles&&input]}))]});};var DragAndDrop=/*#__PURE__*/function(_React$Component){_inherits(DragAndDrop,_React$Component);var _super=_createSuper(DragAndDrop);function DragAndDrop(){var _this;_classCallCheck(this,DragAndDrop);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.state={fileList:[],success:false,error:false,pipeError:false,uploaded:false,errorAlerts:[],pipeErrorAlerts:[],max:0,uploadingPreview:false,uploading:false};_this.handleSubmit=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(files,allFiles){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_this.setState({success:false,uploaded:false,error:false,pipeError:false,errorAlerts:[],pipeErrorAlerts:[],counter:0,max:files.length,uploading:true});_context2.next=3;return allFiles.forEach(function(file){var formData=new FormData();formData.append('file',file.file);if(_this.props.mode===\"upload\"){if(process.env.REACT_APP_PROGRESS===\"0\"){_this.uploadFile(formData);}else{fetch('http://localhost:5000/checkPipe/'+file.file.name).then(function(response){return response.json();}).then(/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(json){var joined,max;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(json.exists){_this.uploadFile(formData);}else{joined=_this.state.pipeErrorAlerts.concat(file.file.name);_this.setState({pipeErrorAlerts:joined,pipeError:true});max=_this.state.max-1;_this.setState({max:max});if(max===0){_this.setState({uploaded:true,uploading:false});}}case 1:case\"end\":return _context.stop();}}},_callee);}));return function(_x3){return _ref3.apply(this,arguments);};}());}}else{if(String(_this.props.iso).trim()===String(file.file.name.split('.').slice(0,-1)).trim()||String(_this.props.iso+'-CL').trim()===String(file.file.name.split('.').slice(0,-1)).trim()){console.log(\"Pertenece \"+file.file.name);_this.updateFile(formData);}else{var joined=_this.state.errorAlerts.concat(file.file.name);_this.setState({errorAlerts:joined,error:true});}}file.remove();});case 3:_this.props.uploaded();case 4:case\"end\":return _context2.stop();}}},_callee2);}));return function(_x,_x2){return _ref2.apply(this,arguments);};}();return _this;}_createClass(DragAndDrop,[{key:\"uploadFile\",value:function(){var _uploadFile=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(file){var _this2=this;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return fetch('http://localhost:5000/upload',{// content-type header should not be specified!\nmethod:'POST',body:file}).then(function(response){// Do something with the successful response\nif(response.status===200){if(!_this2.state.success){_this2.setState({success:true});}var filename=null;var _iterator=_createForOfIteratorHelper(file.values()),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var value=_step.value;filename=value.name;}}catch(err){_iterator.e(err);}finally{_iterator.f();}var extension=\"\";var i=filename.lastIndexOf('.');var cl=false;if(i>0){extension=filename.substring(i+1);if(filename.substring(i-2)=='CL.pdf'){cl=true;}}if(extension===\"pdf\"&&!cl){var body={fileName:filename,user:_this2.props.user};console.log(body);fetch('http://localhost:5000/uploadHis',{// content-type header should not be specified!\nmethod:'POST',headers:{\"Content-Type\":\"application/json\",\"Accept\":\"application/json\"},body:JSON.stringify(body)}).catch(function(error){return message.error(error);});}}else{var _iterator2=_createForOfIteratorHelper(file.values()),_step2;try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){var _value=_step2.value;var joined=_this2.state.errorAlerts.concat(_value.name);_this2.setState({errorAlerts:joined,error:true});}}catch(err){_iterator2.e(err);}finally{_iterator2.f();}}var max=_this2.state.max-1;_this2.setState({max:max});console.log(max);if(max===0){_this2.setState({uploaded:true,uploading:false});}}).catch(function(error){return message.error(error);});case 2:this.props.uploaded();case 3:case\"end\":return _context3.stop();}}},_callee3,this);}));function uploadFile(_x4){return _uploadFile.apply(this,arguments);}return uploadFile;}()},{key:\"updateFile\",value:function(){var _updateFile=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(file){var _this3=this;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.next=2;return fetch('http://localhost:5000/update',{// content-type header should not be specified!\nmethod:'POST',body:file}).then(function(response){// Do something with the successful response\nif(response.status===200){if(!_this3.state.success){_this3.setState({success:true});}var filename=null;var _iterator3=_createForOfIteratorHelper(file.values()),_step3;try{for(_iterator3.s();!(_step3=_iterator3.n()).done;){var value=_step3.value;filename=value.name;}}catch(err){_iterator3.e(err);}finally{_iterator3.f();}var extension=\"\";var i=filename.lastIndexOf('.');if(i>0){extension=filename.substring(i+1);}if(extension===\"pdf\"){var body={file:filename,user:_this3.props.user};console.log(body);fetch('http://localhost:5000/updateHis',{// content-type header should not be specified!\nmethod:'POST',headers:{\"Content-Type\":\"application/json\"},body:JSON.stringify(body)}).then(function(response){return console.log(response.json());}).catch(function(error){return message.error(error);});}}else{var _iterator4=_createForOfIteratorHelper(file.values()),_step4;try{for(_iterator4.s();!(_step4=_iterator4.n()).done;){var _value2=_step4.value;var joined=_this3.state.errorAlerts.concat(_value2.name);_this3.setState({errorAlerts:joined,error:true});}}catch(err){_iterator4.e(err);}finally{_iterator4.f();}}var max=_this3.state.max-1;_this3.setState({max:max});if(max===0){_this3.setState({uploaded:true,uploading:false});}}).catch(function(error){return message.error(error);});case 2:case\"end\":return _context4.stop();}}},_callee4);}));function updateFile(_x5){return _updateFile.apply(this,arguments);}return updateFile;}()},{key:\"render\",value:function render(){var errorAlerts=this.state.errorAlerts;var pipeErrorAlerts=this.state.pipeErrorAlerts;var errors=[];var pipeErrors=[];if(errorAlerts.length>0){for(var i=0;i<errorAlerts.length;i++){if(this.props.mode===\"upload\"){errors.push(/*#__PURE__*/_jsxs(Alert,{severity:\"error\",children:[\"The file \",errorAlerts[i],\" already exists!\"]}));}else{errors.push(/*#__PURE__*/_jsxs(Alert,{severity:\"error\",children:[\"The file \",errorAlerts[i],\" doesn't belong to this isometric!\"]}));}}}if(pipeErrorAlerts.length>0){for(var _i=0;_i<pipeErrorAlerts.length;_i++){pipeErrors.push(/*#__PURE__*/_jsxs(Alert,{severity:\"error\",children:[\"The file \",pipeErrorAlerts[_i],\" doesn't belong to this project!\"]}));}}var inputContent=null;var styles=null;if(this.props.mode===\"upload\"){inputContent=\"Drop isometrics here\";styles={dropzone:{maxHeight:'400px'}};}else{inputContent=\"Drop the files to update\";styles={dropzone:{height:'250px'},dropzoneActive:{height:'300px'},previewContainer:{height:'2px'}};}return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Dropzone,{LayoutComponent:Layout,onSubmit:this.handleSubmit,inputContent:inputContent,styles:styles}),/*#__PURE__*/_jsx(Collapse,{in:this.state.success,children:/*#__PURE__*/_jsx(Collapse,{in:this.state.uploaded,children:/*#__PURE__*/_jsx(Alert,{children:\"The files have been uploaded!\"})})}),/*#__PURE__*/_jsx(Collapse,{in:this.state.error,children:/*#__PURE__*/_jsx(Collapse,{in:this.state.uploaded,children:errors})}),/*#__PURE__*/_jsx(Collapse,{in:this.state.pipeError,children:/*#__PURE__*/_jsx(Collapse,{in:this.state.uploaded,children:pipeErrors})}),/*#__PURE__*/_jsx(Collapse,{in:this.state.uploading,children:/*#__PURE__*/_jsx(Alert,{severity:\"info\",children:\"The files are uploading...\"})})]});}}]);return DragAndDrop;}(React.Component);export default DragAndDrop;","map":{"version":3,"sources":["C:/xampp/htdocs/isotracker-dev/isotracker-react/src/components/dragAndDrop/dragAndDrop.js"],"names":["Dropzone","React","message","Alert","Collapse","Layout","input","previews","submitButton","dropzoneProps","files","maxFiles","extra","length","DragAndDrop","state","fileList","success","error","pipeError","uploaded","errorAlerts","pipeErrorAlerts","max","uploadingPreview","uploading","handleSubmit","allFiles","setState","counter","forEach","file","formData","FormData","append","props","mode","process","env","REACT_APP_PROGRESS","uploadFile","fetch","name","then","response","json","exists","joined","concat","String","iso","trim","split","slice","console","log","updateFile","remove","method","body","status","filename","values","value","extension","i","lastIndexOf","cl","substring","fileName","user","headers","JSON","stringify","catch","errors","pipeErrors","push","inputContent","styles","dropzone","maxHeight","height","dropzoneActive","previewContainer","Component"],"mappings":"ohCAAA,MAAO,yCAAP,CACA,MAAOA,CAAAA,QAAP,KAAqB,yBAArB,CACA,MAAOC,CAAAA,KAAP,KAAkB,OAAlB,CACA,OAAQC,OAAR,KAAqB,MAArB,CACA,MAAOC,CAAAA,KAAP,KAAkB,wBAAlB,CACA,MAAOC,CAAAA,QAAP,KAAqB,4BAArB,C,wFAEA,GAAMC,CAAAA,MAAM,CAAG,QAATA,CAAAA,MAAS,MAAkF,IAA/EC,CAAAA,KAA+E,MAA/EA,KAA+E,CAAxEC,QAAwE,MAAxEA,QAAwE,CAA9DC,YAA8D,MAA9DA,YAA8D,CAAhDC,aAAgD,MAAhDA,aAAgD,CAAjCC,KAAiC,MAAjCA,KAAiC,CAAjBC,QAAiB,MAA1BC,KAA0B,CAAjBD,QAAiB,CAC/F,mBACE,uBAEGH,YAFH,cAGE,2CAASC,aAAT,gBAECF,QAFD,CAGCG,KAAK,CAACG,MAAN,CAAeF,QAAf,EAA2BL,KAH5B,IAHF,GADF,CAcD,CAfD,C,GAiBMQ,CAAAA,W,2VAEJC,K,CAAQ,CACNC,QAAQ,CAAE,EADJ,CAENC,OAAO,CAAE,KAFH,CAGNC,KAAK,CAAE,KAHD,CAINC,SAAS,CAAE,KAJL,CAKNC,QAAQ,CAAE,KALJ,CAMNC,WAAW,CAAE,EANP,CAONC,eAAe,CAAE,EAPX,CAQNC,GAAG,CAAE,CARC,CASNC,gBAAgB,CAAE,KATZ,CAUNC,SAAS,CAAE,KAVL,C,OAwJRC,Y,2FAAe,kBAAOhB,KAAP,CAAciB,QAAd,sHAEb,MAAKC,QAAL,CAAc,CACZX,OAAO,CAAE,KADG,CAEZG,QAAQ,CAAE,KAFE,CAGZF,KAAK,CAAE,KAHK,CAIZC,SAAS,CAAE,KAJC,CAKZE,WAAW,CAAE,EALD,CAMZC,eAAe,CAAE,EANL,CAOZO,OAAO,CAAE,CAPG,CAQZN,GAAG,CAAEb,KAAK,CAACG,MARC,CASZY,SAAS,CAAE,IATC,CAAd,EAFa,uBAcPE,CAAAA,QAAQ,CAACG,OAAT,CAAiB,SAAAC,IAAI,CAAI,CAC7B,GAAMC,CAAAA,QAAQ,CAAI,GAAIC,CAAAA,QAAJ,EAAlB,CACAD,QAAQ,CAACE,MAAT,CAAgB,MAAhB,CAAwBH,IAAI,CAACA,IAA7B,EACA,GAAG,MAAKI,KAAL,CAAWC,IAAX,GAAoB,QAAvB,CAAgC,CAC9B,GAAGC,OAAO,CAACC,GAAR,CAAYC,kBAAZ,GAAmC,GAAtC,CAA0C,CACxC,MAAKC,UAAL,CAAgBR,QAAhB,EACD,CAFD,IAEK,CACHS,KAAK,CAAC,mCAAmCV,IAAI,CAACA,IAAL,CAAUW,IAA9C,CAAL,CACCC,IADD,CACM,SAAAC,QAAQ,QAAIA,CAAAA,QAAQ,CAACC,IAAT,EAAJ,EADd,EAECF,IAFD,2FAEM,iBAAME,IAAN,iIACJ,GAAGA,IAAI,CAACC,MAAR,CAAe,CACb,MAAKN,UAAL,CAAgBR,QAAhB,EACD,CAFD,IAEK,CACCe,MADD,CACU,MAAKhC,KAAL,CAAWO,eAAX,CAA2B0B,MAA3B,CAAkCjB,IAAI,CAACA,IAAL,CAAUW,IAA5C,CADV,CAEH,MAAKd,QAAL,CAAc,CACZN,eAAe,CAAGyB,MADN,CAEZ5B,SAAS,CAAE,IAFC,CAAd,EAIII,GAND,CAMO,MAAKR,KAAL,CAAWQ,GAAX,CAAiB,CANxB,CAOH,MAAKK,QAAL,CAAc,CACZL,GAAG,CAAEA,GADO,CAAd,EAGA,GAAIA,GAAG,GAAK,CAAZ,CAAc,CACZ,MAAKK,QAAL,CAAc,CACZR,QAAQ,CAAE,IADE,CAEZK,SAAS,CAAE,KAFC,CAAd,EAID,CACF,CAnBG,sDAFN,kEAuBD,CACF,CA5BD,IA4BK,CACH,GAAGwB,MAAM,CAAC,MAAKd,KAAL,CAAWe,GAAZ,CAAN,CAAuBC,IAAvB,KAAkCF,MAAM,CAAClB,IAAI,CAACA,IAAL,CAAUW,IAAV,CAAeU,KAAf,CAAqB,GAArB,EAA0BC,KAA1B,CAAgC,CAAhC,CAAmC,CAAC,CAApC,CAAD,CAAN,CAA+CF,IAA/C,EAAlC,EACAF,MAAM,CAAC,MAAKd,KAAL,CAAWe,GAAX,CAAe,KAAhB,CAAN,CAA6BC,IAA7B,KAAwCF,MAAM,CAAClB,IAAI,CAACA,IAAL,CAAUW,IAAV,CAAeU,KAAf,CAAqB,GAArB,EAA0BC,KAA1B,CAAgC,CAAhC,CAAmC,CAAC,CAApC,CAAD,CAAN,CAA+CF,IAA/C,EAD3C,CACkG,CAChGG,OAAO,CAACC,GAAR,CAAY,aAAexB,IAAI,CAACA,IAAL,CAAUW,IAArC,EACA,MAAKc,UAAL,CAAgBxB,QAAhB,EACD,CAJD,IAIK,CACH,GAAIe,CAAAA,MAAM,CAAG,MAAKhC,KAAL,CAAWM,WAAX,CAAuB2B,MAAvB,CAA8BjB,IAAI,CAACA,IAAL,CAAUW,IAAxC,CAAb,CACE,MAAKd,QAAL,CAAc,CACZP,WAAW,CAAG0B,MADF,CAEZ7B,KAAK,CAAE,IAFK,CAAd,EAIH,CACF,CACDa,IAAI,CAAC0B,MAAL,GACD,CA7CK,CAdO,QA6Db,MAAKtB,KAAL,CAAWf,QAAX,GA7Da,wD,uNA3If,kBAAiBW,IAAjB,6JACQU,CAAAA,KAAK,CAAC,8BAAD,CAAiC,CAC1C;AACAiB,MAAM,CAAE,MAFkC,CAG1CC,IAAI,CAAE5B,IAHoC,CAAjC,CAAL,CAKHY,IALG,CAKE,SAAAC,QAAQ,CAAI,CAChB;AACA,GAAIA,QAAQ,CAACgB,MAAT,GAAoB,GAAxB,CAA4B,CAC1B,GAAG,CAAC,MAAI,CAAC7C,KAAL,CAAWE,OAAf,CAAuB,CACnB,MAAI,CAACW,QAAL,CAAc,CACZX,OAAO,CAAG,IADE,CAAd,EAGH,CAED,GAAI4C,CAAAA,QAAQ,CAAG,IAAf,CAP0B,yCAQR9B,IAAI,CAAC+B,MAAL,EARQ,YAQ1B,+CAAgC,IAAvBC,CAAAA,KAAuB,aAC9BF,QAAQ,CAAGE,KAAK,CAACrB,IAAjB,CACD,CAVyB,qDAW1B,GAAIsB,CAAAA,SAAS,CAAG,EAAhB,CACA,GAAIC,CAAAA,CAAC,CAAGJ,QAAQ,CAACK,WAAT,CAAqB,GAArB,CAAR,CACA,GAAIC,CAAAA,EAAE,CAAG,KAAT,CACA,GAAIF,CAAC,CAAG,CAAR,CAAW,CACTD,SAAS,CAAGH,QAAQ,CAACO,SAAT,CAAmBH,CAAC,CAAC,CAArB,CAAZ,CACA,GAAGJ,QAAQ,CAACO,SAAT,CAAmBH,CAAC,CAAC,CAArB,GAA2B,QAA9B,CAAuC,CACrCE,EAAE,CAAG,IAAL,CACD,CACF,CACD,GAAGH,SAAS,GAAK,KAAd,EAAuB,CAACG,EAA3B,CAA8B,CAC5B,GAAIR,CAAAA,IAAI,CAAI,CACVU,QAAQ,CAAER,QADA,CAEVS,IAAI,CAAE,MAAI,CAACnC,KAAL,CAAWmC,IAFP,CAAZ,CAIAhB,OAAO,CAACC,GAAR,CAAYI,IAAZ,EACAlB,KAAK,CAAC,iCAAD,CAAoC,CACvC;AACAiB,MAAM,CAAE,MAF+B,CAGvCa,OAAO,CAAE,CACP,eAAgB,kBADT,CAEP,SAAU,kBAFH,CAH8B,CAOvCZ,IAAI,CAAEa,IAAI,CAACC,SAAL,CAAed,IAAf,CAPiC,CAApC,CAAL,CAQGe,KARH,CAQS,SAAAxD,KAAK,QAAIhB,CAAAA,OAAO,CAACgB,KAAR,CAAcA,KAAd,CAAJ,EARd,EASD,CACF,CApCD,IAoCK,2CACea,IAAI,CAAC+B,MAAL,EADf,aACH,kDAAiC,IAAxBC,CAAAA,MAAwB,cAC/B,GAAIhB,CAAAA,MAAM,CAAG,MAAI,CAAChC,KAAL,CAAWM,WAAX,CAAuB2B,MAAvB,CAA8Be,MAAK,CAACrB,IAApC,CAAb,CACA,MAAI,CAACd,QAAL,CAAc,CACZP,WAAW,CAAG0B,MADF,CAEZ7B,KAAK,CAAE,IAFK,CAAd,EAID,CAPE,uDAQJ,CACD,GAAIK,CAAAA,GAAG,CAAG,MAAI,CAACR,KAAL,CAAWQ,GAAX,CAAiB,CAA3B,CACA,MAAI,CAACK,QAAL,CAAc,CACZL,GAAG,CAAEA,GADO,CAAd,EAGA+B,OAAO,CAACC,GAAR,CAAYhC,GAAZ,EACA,GAAIA,GAAG,GAAK,CAAZ,CAAc,CACZ,MAAI,CAACK,QAAL,CAAc,CACZR,QAAQ,CAAE,IADE,CAEZK,SAAS,CAAE,KAFC,CAAd,EAID,CAEF,CAhEG,EAiEHiD,KAjEG,CAiEG,SAAAxD,KAAK,QAAIhB,CAAAA,OAAO,CAACgB,KAAR,CAAcA,KAAd,CAAJ,EAjER,CADR,QAoEE,KAAKiB,KAAL,CAAWf,QAAX,GApEF,6D,wMAuEA,kBAAiBW,IAAjB,6JAGQU,CAAAA,KAAK,CAAC,8BAAD,CAAiC,CAC1C;AACAiB,MAAM,CAAE,MAFkC,CAG1CC,IAAI,CAAE5B,IAHoC,CAAjC,CAAL,CAKHY,IALG,CAKE,SAAAC,QAAQ,CAAI,CAChB;AACA,GAAIA,QAAQ,CAACgB,MAAT,GAAoB,GAAxB,CAA4B,CAC1B,GAAG,CAAC,MAAI,CAAC7C,KAAL,CAAWE,OAAf,CAAuB,CACnB,MAAI,CAACW,QAAL,CAAc,CACZX,OAAO,CAAG,IADE,CAAd,EAGH,CAED,GAAI4C,CAAAA,QAAQ,CAAG,IAAf,CAP0B,0CAQR9B,IAAI,CAAC+B,MAAL,EARQ,aAQ1B,kDAAgC,IAAvBC,CAAAA,KAAuB,cAC9BF,QAAQ,CAAGE,KAAK,CAACrB,IAAjB,CACD,CAVyB,uDAW1B,GAAIsB,CAAAA,SAAS,CAAG,EAAhB,CACA,GAAIC,CAAAA,CAAC,CAAGJ,QAAQ,CAACK,WAAT,CAAqB,GAArB,CAAR,CACA,GAAID,CAAC,CAAG,CAAR,CAAW,CACTD,SAAS,CAAGH,QAAQ,CAACO,SAAT,CAAmBH,CAAC,CAAC,CAArB,CAAZ,CACD,CACD,GAAGD,SAAS,GAAK,KAAjB,CAAuB,CACrB,GAAIL,CAAAA,IAAI,CAAI,CACV5B,IAAI,CAAE8B,QADI,CAEVS,IAAI,CAAE,MAAI,CAACnC,KAAL,CAAWmC,IAFP,CAAZ,CAIAhB,OAAO,CAACC,GAAR,CAAYI,IAAZ,EACAlB,KAAK,CAAC,iCAAD,CAAoC,CACvC;AACAiB,MAAM,CAAE,MAF+B,CAGvCa,OAAO,CAAE,CACP,eAAgB,kBADT,CAH8B,CAMvCZ,IAAI,CAAEa,IAAI,CAACC,SAAL,CAAed,IAAf,CANiC,CAApC,CAAL,CAOGhB,IAPH,CAOQ,SAAAC,QAAQ,QAAIU,CAAAA,OAAO,CAACC,GAAR,CAAYX,QAAQ,CAACC,IAAT,EAAZ,CAAJ,EAPhB,EAQC6B,KARD,CAQO,SAAAxD,KAAK,QAAIhB,CAAAA,OAAO,CAACgB,KAAR,CAAcA,KAAd,CAAJ,EARZ,EASD,CACF,CAhCD,IAgCK,2CACea,IAAI,CAAC+B,MAAL,EADf,aACH,kDAAiC,IAAxBC,CAAAA,OAAwB,cAC/B,GAAIhB,CAAAA,MAAM,CAAG,MAAI,CAAChC,KAAL,CAAWM,WAAX,CAAuB2B,MAAvB,CAA8Be,OAAK,CAACrB,IAApC,CAAb,CACA,MAAI,CAACd,QAAL,CAAc,CACZP,WAAW,CAAG0B,MADF,CAEZ7B,KAAK,CAAE,IAFK,CAAd,EAID,CAPE,uDAQJ,CACD,GAAIK,CAAAA,GAAG,CAAG,MAAI,CAACR,KAAL,CAAWQ,GAAX,CAAiB,CAA3B,CACA,MAAI,CAACK,QAAL,CAAc,CACZL,GAAG,CAAEA,GADO,CAAd,EAGA,GAAIA,GAAG,GAAK,CAAZ,CAAc,CACZ,MAAI,CAACK,QAAL,CAAc,CACZR,QAAQ,CAAE,IADE,CAEZK,SAAS,CAAE,KAFC,CAAd,EAID,CAEF,CA3DG,EA4DHiD,KA5DG,CA4DG,SAAAxD,KAAK,QAAIhB,CAAAA,OAAO,CAACgB,KAAR,CAAcA,KAAd,CAAJ,EA5DR,CAHR,yD,iHAqIA,iBAAQ,CAEN,GAAMG,CAAAA,WAAW,CAAG,KAAKN,KAAL,CAAWM,WAA/B,CACA,GAAMC,CAAAA,eAAe,CAAG,KAAKP,KAAL,CAAWO,eAAnC,CACA,GAAIqD,CAAAA,MAAM,CAAG,EAAb,CACA,GAAIC,CAAAA,UAAU,CAAG,EAAjB,CACA,GAAGvD,WAAW,CAACR,MAAZ,CAAqB,CAAxB,CAA0B,CACxB,IAAI,GAAIoD,CAAAA,CAAC,CAAG,CAAZ,CAAeA,CAAC,CAAG5C,WAAW,CAACR,MAA/B,CAAuCoD,CAAC,EAAxC,CAA2C,CAEzC,GAAI,KAAK9B,KAAL,CAAWC,IAAX,GAAoB,QAAxB,CAAiC,CAC/BuC,MAAM,CAACE,IAAP,cAAY,MAAC,KAAD,EAAO,QAAQ,CAAC,OAAhB,uBAEAxD,WAAW,CAAC4C,CAAD,CAFX,sBAAZ,EAKD,CAND,IAMK,CACHU,MAAM,CAACE,IAAP,cAAY,MAAC,KAAD,EAAO,QAAQ,CAAC,OAAhB,uBAEAxD,WAAW,CAAC4C,CAAD,CAFX,wCAAZ,EAKD,CACF,CACF,CAED,GAAG3C,eAAe,CAACT,MAAhB,CAAyB,CAA5B,CAA8B,CAC5B,IAAI,GAAIoD,CAAAA,EAAC,CAAG,CAAZ,CAAeA,EAAC,CAAG3C,eAAe,CAACT,MAAnC,CAA2CoD,EAAC,EAA5C,CAA+C,CAE3CW,UAAU,CAACC,IAAX,cAAgB,MAAC,KAAD,EAAO,QAAQ,CAAC,OAAhB,uBAEJvD,eAAe,CAAC2C,EAAD,CAFX,sCAAhB,EAKH,CACF,CAGD,GAAIa,CAAAA,YAAY,CAAG,IAAnB,CACA,GAAIC,CAAAA,MAAM,CAAG,IAAb,CAEA,GAAG,KAAK5C,KAAL,CAAWC,IAAX,GAAoB,QAAvB,CAAgC,CAC9B0C,YAAY,CAAG,sBAAf,CACAC,MAAM,CAAG,CACPC,QAAQ,CAAE,CACRC,SAAS,CAAE,OADH,CADH,CAAT,CAKD,CAPD,IAOK,CACHH,YAAY,CAAG,0BAAf,CACAC,MAAM,CAAG,CACPC,QAAQ,CAAE,CACRE,MAAM,CAAE,OADA,CADH,CAIPC,cAAc,CAAE,CACdD,MAAM,CAAE,OADM,CAJT,CAOPE,gBAAgB,CAAC,CACfF,MAAM,CAAE,KADO,CAPV,CAAT,CAYH,CAEC,mBACE,oCACE,KAAC,QAAD,EACE,eAAe,CAAE7E,MADnB,CAEE,QAAQ,CAAE,KAAKqB,YAFjB,CAGE,YAAY,CAAGoD,YAHjB,CAIE,MAAM,CAAEC,MAJV,EADF,cAQE,KAAC,QAAD,EAAU,EAAE,CAAE,KAAKhE,KAAL,CAAWE,OAAzB,uBACE,KAAC,QAAD,EAAU,EAAE,CAAE,KAAKF,KAAL,CAAWK,QAAzB,uBACE,KAAC,KAAD,4CADF,EADF,EARF,cAkBE,KAAC,QAAD,EAAU,EAAE,CAAE,KAAKL,KAAL,CAAWG,KAAzB,uBACE,KAAC,QAAD,EAAU,EAAE,CAAE,KAAKH,KAAL,CAAWK,QAAzB,UACGuD,MADH,EADF,EAlBF,cAwBE,KAAC,QAAD,EAAU,EAAE,CAAE,KAAK5D,KAAL,CAAWI,SAAzB,uBACE,KAAC,QAAD,EAAU,EAAE,CAAE,KAAKJ,KAAL,CAAWK,QAAzB,UACGwD,UADH,EADF,EAxBF,cA8BE,KAAC,QAAD,EAAU,EAAE,CAAE,KAAK7D,KAAL,CAAWU,SAAzB,uBACE,KAAC,KAAD,EAAO,QAAQ,CAAC,MAAhB,wCADF,EA9BF,GADF,CAyCD,C,yBAnUuBxB,KAAK,CAACoF,S,EAsUhC,cAAevE,CAAAA,WAAf","sourcesContent":["import 'react-dropzone-uploader/dist/styles.css'\r\nimport Dropzone from 'react-dropzone-uploader'\r\nimport React from 'react'\r\nimport {message} from'antd'\r\nimport Alert from '@material-ui/lab/Alert';\r\nimport Collapse from '@material-ui/core/Collapse'\r\n\r\nconst Layout = ({ input, previews, submitButton, dropzoneProps, files, extra: { maxFiles } }) => {\r\n  return (\r\n    <div>\r\n      \r\n      {submitButton}\r\n      <div {...dropzoneProps}>\r\n      \r\n      {previews}\r\n      {files.length < maxFiles && input}\r\n        \r\n      </div>\r\n\r\n      \r\n    </div>\r\n  )\r\n}\r\n\r\nclass DragAndDrop extends React.Component{\r\n\r\n  state = {\r\n    fileList: [],\r\n    success: false,\r\n    error: false,\r\n    pipeError: false,\r\n    uploaded: false,\r\n    errorAlerts: [],\r\n    pipeErrorAlerts: [],\r\n    max: 0,\r\n    uploadingPreview: false,\r\n    uploading: false\r\n  };\r\n\r\n  async uploadFile(file) {\r\n    await fetch('http://localhost:5000/upload', {\r\n      // content-type header should not be specified!\r\n      method: 'POST',\r\n      body: file,\r\n    })\r\n      .then(response => {\r\n        // Do something with the successful response\r\n        if (response.status === 200){\r\n          if(!this.state.success){\r\n              this.setState({\r\n                success : true,\r\n              })\r\n          }\r\n\r\n          let filename = null;\r\n          for (let value of file.values()){\r\n            filename = value.name\r\n          }\r\n          let extension = \"\";\r\n          let i = filename.lastIndexOf('.');\r\n          let cl = false\r\n          if (i > 0) {\r\n            extension = filename.substring(i+1);\r\n            if(filename.substring(i-2) == 'CL.pdf'){\r\n              cl = true\r\n            }\r\n          }\r\n          if(extension === \"pdf\" && !cl){\r\n            let body =  {\r\n              fileName: filename,\r\n              user: this.props.user,\r\n            }\r\n            console.log(body)\r\n            fetch('http://localhost:5000/uploadHis', {\r\n              // content-type header should not be specified!\r\n              method: 'POST',\r\n              headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n              },\r\n              body: JSON.stringify(body)\r\n            }).catch(error => message.error(error))\r\n          }\r\n        }else{\r\n          for (let value of file.values()) {\r\n            let joined = this.state.errorAlerts.concat(value.name);\r\n            this.setState({\r\n              errorAlerts : joined,\r\n              error: true\r\n            })\r\n          }\r\n        }\r\n        let max = this.state.max - 1\r\n        this.setState({\r\n          max: max\r\n        })\r\n        console.log(max)\r\n        if (max === 0){\r\n          this.setState({\r\n            uploaded: true,\r\n            uploading: false\r\n          })\r\n        }\r\n        \r\n      })\r\n      .catch(error => message.error(error)\r\n    );\r\n    this.props.uploaded()\r\n  }\r\n\r\n  async updateFile(file) {\r\n\r\n    \r\n    await fetch('http://localhost:5000/update', {\r\n      // content-type header should not be specified!\r\n      method: 'POST',\r\n      body: file,\r\n    })\r\n      .then(response => {\r\n        // Do something with the successful response\r\n        if (response.status === 200){\r\n          if(!this.state.success){\r\n              this.setState({\r\n                success : true,\r\n              })\r\n          }\r\n\r\n          let filename = null;\r\n          for (let value of file.values()){\r\n            filename = value.name\r\n          }\r\n          let extension = \"\";\r\n          let i = filename.lastIndexOf('.');\r\n          if (i > 0) {\r\n            extension = filename.substring(i+1);\r\n          }\r\n          if(extension === \"pdf\"){\r\n            let body =  {\r\n              file: filename,\r\n              user: this.props.user,\r\n            }\r\n            console.log(body)\r\n            fetch('http://localhost:5000/updateHis', {\r\n              // content-type header should not be specified!\r\n              method: 'POST',\r\n              headers: {\r\n                \"Content-Type\": \"application/json\"\r\n              },\r\n              body: JSON.stringify(body)\r\n            }).then(response => console.log(response.json()))\r\n            .catch(error => message.error(error))\r\n          }\r\n        }else{\r\n          for (let value of file.values()) {\r\n            let joined = this.state.errorAlerts.concat(value.name);\r\n            this.setState({\r\n              errorAlerts : joined,\r\n              error: true\r\n            })\r\n          }\r\n        }\r\n        let max = this.state.max - 1\r\n        this.setState({\r\n          max: max\r\n        })\r\n        if (max === 0){\r\n          this.setState({\r\n            uploaded: true,\r\n            uploading: false\r\n          })\r\n        }\r\n        \r\n      })\r\n      .catch(error => message.error(error)\r\n    );\r\n  }\r\n\r\n\r\n  handleSubmit = async (files, allFiles) => {\r\n\r\n    this.setState({\r\n      success: false,\r\n      uploaded: false,\r\n      error: false,\r\n      pipeError: false,\r\n      errorAlerts: [],\r\n      pipeErrorAlerts: [],\r\n      counter: 0,\r\n      max: files.length,\r\n      uploading: true\r\n    })\r\n\r\n    await allFiles.forEach(file => {\r\n      const formData  = new FormData(); \r\n      formData.append('file', file.file);  \r\n      if(this.props.mode === \"upload\"){\r\n        if(process.env.REACT_APP_PROGRESS === \"0\"){\r\n          this.uploadFile(formData);\r\n        }else{\r\n          fetch('http://localhost:5000/checkPipe/'+file.file.name)\r\n          .then(response => response.json())\r\n          .then(async json =>{\r\n            if(json.exists){\r\n              this.uploadFile(formData);\r\n            }else{\r\n              let joined = this.state.pipeErrorAlerts.concat(file.file.name);\r\n              this.setState({\r\n                pipeErrorAlerts : joined,\r\n                pipeError: true\r\n              })\r\n              let max = this.state.max - 1\r\n              this.setState({\r\n                max: max\r\n              })\r\n              if (max === 0){\r\n                this.setState({\r\n                  uploaded: true,\r\n                  uploading: false\r\n                })\r\n              }\r\n            }\r\n          })\r\n        }\r\n      }else{\r\n        if(String(this.props.iso).trim() === String(file.file.name.split('.').slice(0, -1)).trim() || \r\n           String(this.props.iso+'-CL').trim() === String(file.file.name.split('.').slice(0, -1)).trim() ){\r\n          console.log(\"Pertenece \" + file.file.name)\r\n          this.updateFile(formData);\r\n        }else{\r\n          let joined = this.state.errorAlerts.concat(file.file.name);\r\n            this.setState({\r\n              errorAlerts : joined,\r\n              error: true\r\n            })\r\n        }\r\n      }\r\n      file.remove();\r\n    });    \r\n\r\n    this.props.uploaded()\r\n\r\n  }\r\n\r\n  render(){\r\n\r\n    const errorAlerts = this.state.errorAlerts;\r\n    const pipeErrorAlerts = this.state.pipeErrorAlerts;\r\n    let errors = []\r\n    let pipeErrors = []\r\n    if(errorAlerts.length > 0){\r\n      for(let i = 0; i < errorAlerts.length; i++){\r\n        \r\n        if (this.props.mode === \"upload\"){\r\n          errors.push(<Alert severity=\"error\"\r\n          >\r\n            The file {errorAlerts[i]} already exists!\r\n\r\n          </Alert>)\r\n        }else{\r\n          errors.push(<Alert severity=\"error\"\r\n          >\r\n            The file {errorAlerts[i]} doesn't belong to this isometric!\r\n\r\n          </Alert>)\r\n        }\r\n      }\r\n    }\r\n\r\n    if(pipeErrorAlerts.length > 0){\r\n      for(let i = 0; i < pipeErrorAlerts.length; i++){\r\n        \r\n          pipeErrors.push(<Alert severity=\"error\"\r\n          >\r\n            The file {pipeErrorAlerts[i]} doesn't belong to this project!\r\n\r\n          </Alert>)\r\n      }\r\n    }\r\n    \r\n\r\n    let inputContent = null\r\n    let styles = null\r\n\r\n    if(this.props.mode === \"upload\"){\r\n      inputContent = \"Drop isometrics here\"\r\n      styles = {\r\n        dropzone: {\r\n          maxHeight: '400px',\r\n        },\r\n      }\r\n    }else{\r\n      inputContent = \"Drop the files to update\"\r\n      styles = {\r\n        dropzone: {\r\n          height: '250px'\r\n        },\r\n        dropzoneActive: {\r\n          height: '300px'\r\n        },\r\n        previewContainer:{\r\n          height: '2px'\r\n        }\r\n    }\r\n    \r\n  }\r\n\r\n    return (\r\n      <div>\r\n        <Dropzone\r\n          LayoutComponent={Layout}\r\n          onSubmit={this.handleSubmit}\r\n          inputContent= {inputContent}\r\n          styles={styles}\r\n        />\r\n\r\n        <Collapse in={this.state.success}>\r\n          <Collapse in={this.state.uploaded}>\r\n            <Alert\r\n            >\r\n              The files have been uploaded!\r\n\r\n            </Alert>\r\n          </Collapse>\r\n        </Collapse>\r\n\r\n        <Collapse in={this.state.error}>\r\n          <Collapse in={this.state.uploaded}>\r\n            {errors}\r\n          </Collapse>\r\n          \r\n        </Collapse>\r\n        <Collapse in={this.state.pipeError}>\r\n          <Collapse in={this.state.uploaded}>\r\n            {pipeErrors}\r\n          </Collapse>\r\n          \r\n        </Collapse>\r\n        <Collapse in={this.state.uploading}>\r\n          <Alert severity=\"info\"\r\n            >\r\n              The files are uploading...\r\n\r\n            </Alert>\r\n        </Collapse>\r\n        \r\n      </div>\r\n    )\r\n  }\r\n}\r\n\r\nexport default DragAndDrop;"]},"metadata":{},"sourceType":"module"}