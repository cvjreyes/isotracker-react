{"ast":null,"code":"import _createForOfIteratorHelper from\"C:/xampp/htdocs/isotracker-dev/isotracker-react/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper\";import _regeneratorRuntime from\"C:/xampp/htdocs/isotracker-dev/isotracker-react/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"C:/xampp/htdocs/isotracker-dev/isotracker-react/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"C:/xampp/htdocs/isotracker-dev/isotracker-react/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"C:/xampp/htdocs/isotracker-dev/isotracker-react/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"C:/xampp/htdocs/isotracker-dev/isotracker-react/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"C:/xampp/htdocs/isotracker-dev/isotracker-react/node_modules/@babel/runtime/helpers/esm/createSuper\";import _objectSpread from\"C:/xampp/htdocs/isotracker-dev/isotracker-react/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import'react-dropzone-uploader/dist/styles.css';import Dropzone from'react-dropzone-uploader';import React from'react';import{message}from'antd';import Alert from'@material-ui/lab/Alert';import Collapse from'@material-ui/core/Collapse';import{jsxs as _jsxs}from\"react/jsx-runtime\";import{jsx as _jsx}from\"react/jsx-runtime\";var Layout=function Layout(_ref){var input=_ref.input,previews=_ref.previews,submitButton=_ref.submitButton,dropzoneProps=_ref.dropzoneProps,files=_ref.files,maxFiles=_ref.extra.maxFiles;return/*#__PURE__*/_jsxs(\"div\",{children:[submitButton,/*#__PURE__*/_jsxs(\"div\",_objectSpread(_objectSpread({},dropzoneProps),{},{children:[previews,files.length<maxFiles&&input]}))]});};var UpdateMassive=/*#__PURE__*/function(_React$Component){_inherits(UpdateMassive,_React$Component);var _super=_createSuper(UpdateMassive);function UpdateMassive(){var _this;_classCallCheck(this,UpdateMassive);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.state={fileList:[],success:false,error:false,pipeError:false,uploaded:false,errorAlerts:[],pipeErrorAlerts:[],max:0,uploadingPreview:false,uploading:false,nSuccess:0,userFiles:[]};_this.handleSubmit=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(files,allFiles){var userFiles;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:userFiles=_this.state.userFiles;_this.setState({success:false,uploaded:false,error:false,pipeError:false,errorAlerts:[],pipeErrorAlerts:[],counter:0,max:files.length,uploading:true,nSuccess:0,userFiles:userFiles});_context.next=4;return allFiles.forEach(function(file){var formData=new FormData();formData.append('file',file.file);if(_this.state.userFiles.indexOf(String(file.file.name.split('.').slice(0,-1)).trim())>-1){_this.updateFile(formData);}else{var joined=_this.state.errorAlerts;joined.push(file.file.name);_this.setState({errorAlerts:joined,error:true,uploading:false});}file.remove();});case 4:_context.next=6;return _this.setState({uploaded:true});case 6:case\"end\":return _context.stop();}}},_callee);}));return function(_x,_x2){return _ref2.apply(this,arguments);};}();return _this;}_createClass(UpdateMassive,[{key:\"componentDidMount\",value:function(){var _componentDidMount=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var _this2=this;var body,options;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:body={currentRole:this.props.role,currentUser:this.props.user};options={method:\"POST\",headers:{\"Content-Type\":\"application/json\"},body:JSON.stringify(body)};fetch(\"http://\"+process.env.REACT_APP_SERVER+\":\"+process.env.REACT_APP_NODE_PORT+\"/getFilenamesByUser\",options).then(function(response){return response.json();}).then(function(json){var files=json.files;var isos=[];for(var i=0;i<files.length;i++){isos.push(files[i].isoid);isos.push(files[i].isoid+\"-CL\");}_this2.setState({userFiles:isos});});case 3:case\"end\":return _context2.stop();}}},_callee2,this);}));function componentDidMount(){return _componentDidMount.apply(this,arguments);}return componentDidMount;}()},{key:\"updateFile\",value:function(){var _updateFile=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(file){var _this3=this;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return fetch(\"http://\"+process.env.REACT_APP_SERVER+\":\"+process.env.REACT_APP_NODE_PORT+\"/update\",{// content-type header should not be specified!\nmethod:'POST',body:file}).then(function(response){// Do something with the successful response\nif(response.status===200){if(!_this3.state.success){_this3.setState({success:true});}var filename=null;var _iterator=_createForOfIteratorHelper(file.values()),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var value=_step.value;filename=value.name;}}catch(err){_iterator.e(err);}finally{_iterator.f();}var extension=\"\";var i=filename.lastIndexOf('.');if(i>0){extension=filename.substring(i+1);}if(extension===\"pdf\"){var body={file:filename,user:_this3.props.user,role:_this3.props.role};fetch(\"http://\"+process.env.REACT_APP_SERVER+\":\"+process.env.REACT_APP_NODE_PORT+\"/updateHis\",{// content-type header should not be specified!\nmethod:'POST',headers:{\"Content-Type\":\"application/json\"},body:JSON.stringify(body)}).then(function(response){return console.log(response.json());}).catch(function(error){return message.error(error);});}}else{var _iterator2=_createForOfIteratorHelper(file.values()),_step2;try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){var _value=_step2.value;var joined=_this3.state.errorAlerts.concat(_value.name);_this3.setState({errorAlerts:joined,error:true});}}catch(err){_iterator2.e(err);}finally{_iterator2.f();}}var max=_this3.state.max-1;_this3.setState({max:max});if(max===0){_this3.setState({uploaded:true,uploading:false});}}).catch(function(error){return message.error(error);});case 2:case\"end\":return _context3.stop();}}},_callee3);}));function updateFile(_x3){return _updateFile.apply(this,arguments);}return updateFile;}()},{key:\"render\",value:function render(){var errorAlerts=this.state.errorAlerts;var pipeErrorAlerts=this.state.pipeErrorAlerts;var errors=[];var pipeErrors=[];if(errorAlerts.length>0){for(var i=0;i<errorAlerts.length;i++){if(this.props.mode===\"upload\"){errors.push(/*#__PURE__*/_jsxs(Alert,{severity:\"error\",children:[\"The file \",errorAlerts[i],\" already exists!\"]}));}else{errors.push(/*#__PURE__*/_jsxs(Alert,{severity:\"error\",children:[\"The file \",errorAlerts[i],\" doesn't belong to any of your isometrics!\"]}));}}}if(pipeErrorAlerts.length>0){for(var _i=0;_i<pipeErrorAlerts.length;_i++){pipeErrors.push(/*#__PURE__*/_jsxs(Alert,{severity:\"error\",children:[\"The file \",pipeErrorAlerts[_i],\" doesn't belong to any of your isometrics!\"]}));}}var inputContent=null;var styles=null;if(this.props.mode===\"upload\"){inputContent=\"Drop isometrics here\";styles={dropzone:{maxHeight:'400px'}};}else{inputContent=\"Drop the files to update\";styles={dropzone:{height:'250px'},dropzoneActive:{height:'300px'},previewContainer:{height:'2px'}};}return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Dropzone,{LayoutComponent:Layout,onSubmit:this.handleSubmit,inputContent:inputContent,styles:styles}),/*#__PURE__*/_jsx(Collapse,{in:this.state.success,children:/*#__PURE__*/_jsx(Collapse,{in:this.state.uploaded,children:/*#__PURE__*/_jsx(Alert,{children:\"The files have been uploaded!\"})})}),/*#__PURE__*/_jsx(Collapse,{in:this.state.error,children:/*#__PURE__*/_jsx(Collapse,{in:this.state.uploaded,children:errors})}),/*#__PURE__*/_jsx(Collapse,{in:this.state.pipeError,children:/*#__PURE__*/_jsx(Collapse,{in:this.state.uploaded,children:pipeErrors})}),/*#__PURE__*/_jsx(Collapse,{in:this.state.uploading,children:/*#__PURE__*/_jsx(Alert,{severity:\"info\",children:\"The files are uploading...\"})})]});}}]);return UpdateMassive;}(React.Component);export default UpdateMassive;","map":{"version":3,"sources":["C:/xampp/htdocs/isotracker-dev/isotracker-react/src/components/updateMassive/updateMassive.js"],"names":["Dropzone","React","message","Alert","Collapse","Layout","input","previews","submitButton","dropzoneProps","files","maxFiles","extra","length","UpdateMassive","state","fileList","success","error","pipeError","uploaded","errorAlerts","pipeErrorAlerts","max","uploadingPreview","uploading","nSuccess","userFiles","handleSubmit","allFiles","setState","counter","forEach","file","formData","FormData","append","indexOf","String","name","split","slice","trim","updateFile","joined","push","remove","body","currentRole","props","role","currentUser","user","options","method","headers","JSON","stringify","fetch","process","env","REACT_APP_SERVER","REACT_APP_NODE_PORT","then","response","json","isos","i","isoid","status","filename","values","value","extension","lastIndexOf","substring","console","log","catch","concat","errors","pipeErrors","mode","inputContent","styles","dropzone","maxHeight","height","dropzoneActive","previewContainer","Component"],"mappings":"ohCAAA,MAAO,yCAAP,CACA,MAAOA,CAAAA,QAAP,KAAqB,yBAArB,CACA,MAAOC,CAAAA,KAAP,KAAkB,OAAlB,CACA,OAAQC,OAAR,KAAqB,MAArB,CACA,MAAOC,CAAAA,KAAP,KAAkB,wBAAlB,CACA,MAAOC,CAAAA,QAAP,KAAqB,4BAArB,C,wFAEA,GAAMC,CAAAA,MAAM,CAAG,QAATA,CAAAA,MAAS,MAAkF,IAA/EC,CAAAA,KAA+E,MAA/EA,KAA+E,CAAxEC,QAAwE,MAAxEA,QAAwE,CAA9DC,YAA8D,MAA9DA,YAA8D,CAAhDC,aAAgD,MAAhDA,aAAgD,CAAjCC,KAAiC,MAAjCA,KAAiC,CAAjBC,QAAiB,MAA1BC,KAA0B,CAAjBD,QAAiB,CAC/F,mBACE,uBAEGH,YAFH,cAGE,2CAASC,aAAT,gBAECF,QAFD,CAGCG,KAAK,CAACG,MAAN,CAAeF,QAAf,EAA2BL,KAH5B,IAHF,GADF,CAcD,CAfD,C,GAiBMQ,CAAAA,a,mWAEJC,K,CAAQ,CACNC,QAAQ,CAAE,EADJ,CAENC,OAAO,CAAE,KAFH,CAGNC,KAAK,CAAE,KAHD,CAINC,SAAS,CAAE,KAJL,CAKNC,QAAQ,CAAE,KALJ,CAMNC,WAAW,CAAE,EANP,CAONC,eAAe,CAAE,EAPX,CAQNC,GAAG,CAAE,CARC,CASNC,gBAAgB,CAAE,KATZ,CAUNC,SAAS,CAAE,KAVL,CAWNC,QAAQ,CAAE,CAXJ,CAYNC,SAAS,CAAE,EAZL,C,OA4GRC,Y,2FAAe,iBAAOlB,KAAP,CAAcmB,QAAd,gIACTF,SADS,CACG,MAAKZ,KAAL,CAAWY,SADd,CAEb,MAAKG,QAAL,CAAc,CACZb,OAAO,CAAE,KADG,CAEZG,QAAQ,CAAE,KAFE,CAGZF,KAAK,CAAE,KAHK,CAIZC,SAAS,CAAE,KAJC,CAKZE,WAAW,CAAE,EALD,CAMZC,eAAe,CAAE,EANL,CAOZS,OAAO,CAAE,CAPG,CAQZR,GAAG,CAAEb,KAAK,CAACG,MARC,CASZY,SAAS,CAAE,IATC,CAUZC,QAAQ,CAAE,CAVE,CAWZC,SAAS,CAAEA,SAXC,CAAd,EAFa,sBAgBPE,CAAAA,QAAQ,CAACG,OAAT,CAAiB,SAAAC,IAAI,CAAI,CAC7B,GAAMC,CAAAA,QAAQ,CAAI,GAAIC,CAAAA,QAAJ,EAAlB,CACAD,QAAQ,CAACE,MAAT,CAAgB,MAAhB,CAAwBH,IAAI,CAACA,IAA7B,EAEE,GAAG,MAAKlB,KAAL,CAAWY,SAAX,CAAqBU,OAArB,CAA6BC,MAAM,CAACL,IAAI,CAACA,IAAL,CAAUM,IAAV,CAAeC,KAAf,CAAqB,GAArB,EAA0BC,KAA1B,CAAgC,CAAhC,CAAmC,CAAC,CAApC,CAAD,CAAN,CAA+CC,IAA/C,EAA7B,EAAsF,CAAC,CAA1F,CAA4F,CAC1F,MAAKC,UAAL,CAAgBT,QAAhB,EACD,CAFD,IAEK,CAEH,GAAIU,CAAAA,MAAM,CAAG,MAAK7B,KAAL,CAAWM,WAAxB,CACAuB,MAAM,CAACC,IAAP,CAAYZ,IAAI,CAACA,IAAL,CAAUM,IAAtB,EACE,MAAKT,QAAL,CAAc,CACZT,WAAW,CAAGuB,MADF,CAEZ1B,KAAK,CAAE,IAFK,CAGZO,SAAS,CAAE,KAHC,CAAd,EAML,CACDQ,IAAI,CAACa,MAAL,GACD,CAlBK,CAhBO,8BAmCP,OAAKhB,QAAL,CAAc,CAClBV,QAAQ,CAAE,IADQ,CAAd,CAnCO,uD,uOA7Ff,yKACQ2B,IADR,CACc,CACRC,WAAW,CAAG,KAAKC,KAAL,CAAWC,IADjB,CAERC,WAAW,CAAE,KAAKF,KAAL,CAAWG,IAFhB,CADd,CAKUC,OALV,CAKoB,CACdC,MAAM,CAAE,MADM,CAEdC,OAAO,CAAE,CACL,eAAgB,kBADX,CAFK,CAKdR,IAAI,CAAES,IAAI,CAACC,SAAL,CAAeV,IAAf,CALQ,CALpB,CAYIW,KAAK,CAAC,UAAUC,OAAO,CAACC,GAAR,CAAYC,gBAAtB,CAAuC,GAAvC,CAA2CF,OAAO,CAACC,GAAR,CAAYE,mBAAvD,CAA2E,qBAA5E,CAAmGT,OAAnG,CAAL,CACCU,IADD,CACM,SAAAC,QAAQ,QAAIA,CAAAA,QAAQ,CAACC,IAAT,EAAJ,EADd,EAECF,IAFD,CAEM,SAAAE,IAAI,CAAG,CACX,GAAIvD,CAAAA,KAAK,CAAGuD,IAAI,CAACvD,KAAjB,CACA,GAAIwD,CAAAA,IAAI,CAAG,EAAX,CACA,IAAI,GAAIC,CAAAA,CAAC,CAAG,CAAZ,CAAeA,CAAC,CAAGzD,KAAK,CAACG,MAAzB,CAAiCsD,CAAC,EAAlC,CAAqC,CACjCD,IAAI,CAACrB,IAAL,CAAUnC,KAAK,CAACyD,CAAD,CAAL,CAASC,KAAnB,EACAF,IAAI,CAACrB,IAAL,CAAUnC,KAAK,CAACyD,CAAD,CAAL,CAASC,KAAT,CAAiB,KAA3B,EACH,CACD,MAAI,CAACtC,QAAL,CAAc,CAACH,SAAS,CAAEuC,IAAZ,CAAd,EACD,CAVD,EAZJ,6D,0NAyBA,kBAAiBjC,IAAjB,6JAEQyB,CAAAA,KAAK,CAAC,UAAUC,OAAO,CAACC,GAAR,CAAYC,gBAAtB,CAAuC,GAAvC,CAA2CF,OAAO,CAACC,GAAR,CAAYE,mBAAvD,CAA2E,SAA5E,CAAuF,CAChG;AACAR,MAAM,CAAE,MAFwF,CAGhGP,IAAI,CAAEd,IAH0F,CAAvF,CAAL,CAKH8B,IALG,CAKE,SAAAC,QAAQ,CAAI,CAChB;AACA,GAAIA,QAAQ,CAACK,MAAT,GAAoB,GAAxB,CAA4B,CAC1B,GAAG,CAAC,MAAI,CAACtD,KAAL,CAAWE,OAAf,CAAuB,CACnB,MAAI,CAACa,QAAL,CAAc,CACZb,OAAO,CAAG,IADE,CAAd,EAGH,CAED,GAAIqD,CAAAA,QAAQ,CAAG,IAAf,CAP0B,yCAQRrC,IAAI,CAACsC,MAAL,EARQ,YAQ1B,+CAAgC,IAAvBC,CAAAA,KAAuB,aAC9BF,QAAQ,CAAGE,KAAK,CAACjC,IAAjB,CACD,CAVyB,qDAW1B,GAAIkC,CAAAA,SAAS,CAAG,EAAhB,CACA,GAAIN,CAAAA,CAAC,CAAGG,QAAQ,CAACI,WAAT,CAAqB,GAArB,CAAR,CACA,GAAIP,CAAC,CAAG,CAAR,CAAW,CACTM,SAAS,CAAGH,QAAQ,CAACK,SAAT,CAAmBR,CAAC,CAAC,CAArB,CAAZ,CACD,CACD,GAAGM,SAAS,GAAK,KAAjB,CAAuB,CACrB,GAAI1B,CAAAA,IAAI,CAAI,CACVd,IAAI,CAAEqC,QADI,CAEVlB,IAAI,CAAE,MAAI,CAACH,KAAL,CAAWG,IAFP,CAGVF,IAAI,CAAE,MAAI,CAACD,KAAL,CAAWC,IAHP,CAAZ,CAKAQ,KAAK,CAAC,UAAUC,OAAO,CAACC,GAAR,CAAYC,gBAAtB,CAAuC,GAAvC,CAA2CF,OAAO,CAACC,GAAR,CAAYE,mBAAvD,CAA2E,YAA5E,CAA0F,CAC7F;AACAR,MAAM,CAAE,MAFqF,CAG7FC,OAAO,CAAE,CACP,eAAgB,kBADT,CAHoF,CAM7FR,IAAI,CAAES,IAAI,CAACC,SAAL,CAAeV,IAAf,CANuF,CAA1F,CAAL,CAOGgB,IAPH,CAOQ,SAAAC,QAAQ,QAAIY,CAAAA,OAAO,CAACC,GAAR,CAAYb,QAAQ,CAACC,IAAT,EAAZ,CAAJ,EAPhB,EAQCa,KARD,CAQO,SAAA5D,KAAK,QAAIhB,CAAAA,OAAO,CAACgB,KAAR,CAAcA,KAAd,CAAJ,EARZ,EASD,CACF,CAhCD,IAgCK,2CACee,IAAI,CAACsC,MAAL,EADf,aACH,kDAAiC,IAAxBC,CAAAA,MAAwB,cAC/B,GAAI5B,CAAAA,MAAM,CAAG,MAAI,CAAC7B,KAAL,CAAWM,WAAX,CAAuB0D,MAAvB,CAA8BP,MAAK,CAACjC,IAApC,CAAb,CACA,MAAI,CAACT,QAAL,CAAc,CACZT,WAAW,CAAGuB,MADF,CAEZ1B,KAAK,CAAE,IAFK,CAAd,EAID,CAPE,uDAQJ,CACD,GAAIK,CAAAA,GAAG,CAAG,MAAI,CAACR,KAAL,CAAWQ,GAAX,CAAiB,CAA3B,CACA,MAAI,CAACO,QAAL,CAAc,CACZP,GAAG,CAAEA,GADO,CAAd,EAIA,GAAIA,GAAG,GAAK,CAAZ,CAAc,CACZ,MAAI,CAACO,QAAL,CAAc,CACZV,QAAQ,CAAE,IADE,CAEZK,SAAS,CAAE,KAFC,CAAd,EAID,CAEF,CA5DG,EA6DHqD,KA7DG,CA6DG,SAAA5D,KAAK,QAAIhB,CAAAA,OAAO,CAACgB,KAAR,CAAcA,KAAd,CAAJ,EA7DR,CAFR,yD,iHA6GA,iBAAQ,CACN,GAAMG,CAAAA,WAAW,CAAG,KAAKN,KAAL,CAAWM,WAA/B,CACA,GAAMC,CAAAA,eAAe,CAAG,KAAKP,KAAL,CAAWO,eAAnC,CACA,GAAI0D,CAAAA,MAAM,CAAG,EAAb,CACA,GAAIC,CAAAA,UAAU,CAAG,EAAjB,CACA,GAAG5D,WAAW,CAACR,MAAZ,CAAqB,CAAxB,CAA0B,CACxB,IAAI,GAAIsD,CAAAA,CAAC,CAAG,CAAZ,CAAeA,CAAC,CAAG9C,WAAW,CAACR,MAA/B,CAAuCsD,CAAC,EAAxC,CAA2C,CAEzC,GAAI,KAAKlB,KAAL,CAAWiC,IAAX,GAAoB,QAAxB,CAAiC,CAC/BF,MAAM,CAACnC,IAAP,cAAY,MAAC,KAAD,EAAO,QAAQ,CAAC,OAAhB,uBAEAxB,WAAW,CAAC8C,CAAD,CAFX,sBAAZ,EAKD,CAND,IAMK,CACHa,MAAM,CAACnC,IAAP,cAAY,MAAC,KAAD,EAAO,QAAQ,CAAC,OAAhB,uBAEAxB,WAAW,CAAC8C,CAAD,CAFX,gDAAZ,EAKD,CACF,CACF,CAED,GAAG7C,eAAe,CAACT,MAAhB,CAAyB,CAA5B,CAA8B,CAC5B,IAAI,GAAIsD,CAAAA,EAAC,CAAG,CAAZ,CAAeA,EAAC,CAAG7C,eAAe,CAACT,MAAnC,CAA2CsD,EAAC,EAA5C,CAA+C,CAE3Cc,UAAU,CAACpC,IAAX,cAAgB,MAAC,KAAD,EAAO,QAAQ,CAAC,OAAhB,uBAEJvB,eAAe,CAAC6C,EAAD,CAFX,gDAAhB,EAKH,CACF,CAGD,GAAIgB,CAAAA,YAAY,CAAG,IAAnB,CACA,GAAIC,CAAAA,MAAM,CAAG,IAAb,CAEA,GAAG,KAAKnC,KAAL,CAAWiC,IAAX,GAAoB,QAAvB,CAAgC,CAC9BC,YAAY,CAAG,sBAAf,CACAC,MAAM,CAAG,CACPC,QAAQ,CAAE,CACRC,SAAS,CAAE,OADH,CADH,CAAT,CAKD,CAPD,IAOK,CACHH,YAAY,CAAG,0BAAf,CACAC,MAAM,CAAG,CACPC,QAAQ,CAAE,CACRE,MAAM,CAAE,OADA,CADH,CAIPC,cAAc,CAAE,CACdD,MAAM,CAAE,OADM,CAJT,CAOPE,gBAAgB,CAAC,CACfF,MAAM,CAAE,KADO,CAPV,CAAT,CAYH,CACC,mBACE,oCACE,KAAC,QAAD,EACE,eAAe,CAAElF,MADnB,CAEE,QAAQ,CAAE,KAAKuB,YAFjB,CAGE,YAAY,CAAGuD,YAHjB,CAIE,MAAM,CAAEC,MAJV,EADF,cAQE,KAAC,QAAD,EAAU,EAAE,CAAE,KAAKrE,KAAL,CAAWE,OAAzB,uBACE,KAAC,QAAD,EAAU,EAAE,CAAE,KAAKF,KAAL,CAAWK,QAAzB,uBACE,KAAC,KAAD,4CADF,EADF,EARF,cAkBE,KAAC,QAAD,EAAU,EAAE,CAAE,KAAKL,KAAL,CAAWG,KAAzB,uBACE,KAAC,QAAD,EAAU,EAAE,CAAE,KAAKH,KAAL,CAAWK,QAAzB,UACG4D,MADH,EADF,EAlBF,cAwBE,KAAC,QAAD,EAAU,EAAE,CAAE,KAAKjE,KAAL,CAAWI,SAAzB,uBACE,KAAC,QAAD,EAAU,EAAE,CAAE,KAAKJ,KAAL,CAAWK,QAAzB,UACG6D,UADH,EADF,EAxBF,cA8BE,KAAC,QAAD,EAAU,EAAE,CAAE,KAAKlE,KAAL,CAAWU,SAAzB,uBACE,KAAC,KAAD,EAAO,QAAQ,CAAC,MAAhB,wCADF,EA9BF,GADF,CAyCD,C,2BA7PyBxB,KAAK,CAACyF,S,EAgQlC,cAAe5E,CAAAA,aAAf","sourcesContent":["import 'react-dropzone-uploader/dist/styles.css'\r\nimport Dropzone from 'react-dropzone-uploader'\r\nimport React from 'react'\r\nimport {message} from'antd'\r\nimport Alert from '@material-ui/lab/Alert';\r\nimport Collapse from '@material-ui/core/Collapse'\r\n\r\nconst Layout = ({ input, previews, submitButton, dropzoneProps, files, extra: { maxFiles } }) => {\r\n  return (\r\n    <div>\r\n      \r\n      {submitButton}\r\n      <div {...dropzoneProps}>\r\n      \r\n      {previews}\r\n      {files.length < maxFiles && input}\r\n        \r\n      </div>\r\n\r\n      \r\n    </div>\r\n  )\r\n}\r\n\r\nclass UpdateMassive extends React.Component{\r\n\r\n  state = {\r\n    fileList: [],\r\n    success: false,\r\n    error: false,\r\n    pipeError: false,\r\n    uploaded: false,\r\n    errorAlerts: [],\r\n    pipeErrorAlerts: [],\r\n    max: 0,\r\n    uploadingPreview: false,\r\n    uploading: false,\r\n    nSuccess: 0,\r\n    userFiles: []\r\n  };\r\n\r\n  async componentDidMount(){\r\n    const body ={\r\n        currentRole : this.props.role,\r\n        currentUser: this.props.user\r\n      }\r\n      const options = {\r\n        method: \"POST\",\r\n        headers: {\r\n            \"Content-Type\": \"application/json\"\r\n        },\r\n        body: JSON.stringify(body)\r\n    }\r\n      fetch(\"http://\"+process.env.REACT_APP_SERVER+\":\"+process.env.REACT_APP_NODE_PORT+\"/getFilenamesByUser\", options)\r\n      .then(response => response.json())\r\n      .then(json =>{\r\n        let files = json.files\r\n        let isos = []\r\n        for(let i = 0; i < files.length; i++){\r\n            isos.push(files[i].isoid)\r\n            isos.push(files[i].isoid + \"-CL\")\r\n        }\r\n        this.setState({userFiles: isos})\r\n      })\r\n  }\r\n\r\n  async updateFile(file) {\r\n\r\n    await fetch(\"http://\"+process.env.REACT_APP_SERVER+\":\"+process.env.REACT_APP_NODE_PORT+\"/update\", {\r\n      // content-type header should not be specified!\r\n      method: 'POST',\r\n      body: file,\r\n    })\r\n      .then(response => {\r\n        // Do something with the successful response\r\n        if (response.status === 200){\r\n          if(!this.state.success){\r\n              this.setState({\r\n                success : true,\r\n              })\r\n          }\r\n\r\n          let filename = null;\r\n          for (let value of file.values()){\r\n            filename = value.name\r\n          }\r\n          let extension = \"\";\r\n          let i = filename.lastIndexOf('.');\r\n          if (i > 0) {\r\n            extension = filename.substring(i+1);\r\n          }\r\n          if(extension === \"pdf\"){\r\n            let body =  {\r\n              file: filename,\r\n              user: this.props.user,\r\n              role: this.props.role\r\n            }\r\n            fetch(\"http://\"+process.env.REACT_APP_SERVER+\":\"+process.env.REACT_APP_NODE_PORT+\"/updateHis\", {\r\n              // content-type header should not be specified!\r\n              method: 'POST',\r\n              headers: {\r\n                \"Content-Type\": \"application/json\"\r\n              },\r\n              body: JSON.stringify(body)\r\n            }).then(response => console.log(response.json()))\r\n            .catch(error => message.error(error))\r\n          }\r\n        }else{\r\n          for (let value of file.values()) {\r\n            let joined = this.state.errorAlerts.concat(value.name);\r\n            this.setState({\r\n              errorAlerts : joined,\r\n              error: true\r\n            })\r\n          }\r\n        }\r\n        let max = this.state.max - 1\r\n        this.setState({\r\n          max: max\r\n        })\r\n\r\n        if (max === 0){\r\n          this.setState({\r\n            uploaded: true,\r\n            uploading: false\r\n          })\r\n        }\r\n        \r\n      })\r\n      .catch(error => message.error(error)\r\n    );\r\n  }\r\n\r\n\r\n  handleSubmit = async (files, allFiles) => {\r\n    let userFiles = this.state.userFiles\r\n    this.setState({\r\n      success: false,\r\n      uploaded: false,\r\n      error: false,\r\n      pipeError: false,\r\n      errorAlerts: [],\r\n      pipeErrorAlerts: [],\r\n      counter: 0,\r\n      max: files.length,\r\n      uploading: true,\r\n      nSuccess: 0,\r\n      userFiles: userFiles\r\n    })\r\n\r\n    await allFiles.forEach(file => {\r\n      const formData  = new FormData(); \r\n      formData.append('file', file.file);  \r\n     \r\n        if(this.state.userFiles.indexOf(String(file.file.name.split('.').slice(0, -1)).trim()) > -1){\r\n          this.updateFile(formData);\r\n        }else{\r\n          \r\n          let joined = this.state.errorAlerts;\r\n          joined.push(file.file.name)\r\n            this.setState({\r\n              errorAlerts : joined,\r\n              error: true,\r\n              uploading: false\r\n            })\r\n        \r\n      }\r\n      file.remove();\r\n    });    \r\n    await this.setState({\r\n      uploaded: true,\r\n    })\r\n\r\n  }\r\n\r\n  render(){\r\n    const errorAlerts = this.state.errorAlerts;\r\n    const pipeErrorAlerts = this.state.pipeErrorAlerts;\r\n    let errors = []\r\n    let pipeErrors = []\r\n    if(errorAlerts.length > 0){\r\n      for(let i = 0; i < errorAlerts.length; i++){\r\n        \r\n        if (this.props.mode === \"upload\"){\r\n          errors.push(<Alert severity=\"error\"\r\n          >\r\n            The file {errorAlerts[i]} already exists!\r\n\r\n          </Alert>)\r\n        }else{\r\n          errors.push(<Alert severity=\"error\"\r\n          >\r\n            The file {errorAlerts[i]} doesn't belong to any of your isometrics!\r\n\r\n          </Alert>)\r\n        }\r\n      }\r\n    }\r\n\r\n    if(pipeErrorAlerts.length > 0){\r\n      for(let i = 0; i < pipeErrorAlerts.length; i++){\r\n        \r\n          pipeErrors.push(<Alert severity=\"error\"\r\n          >\r\n            The file {pipeErrorAlerts[i]} doesn't belong to any of your isometrics!\r\n\r\n          </Alert>)\r\n      }\r\n    }\r\n    \r\n\r\n    let inputContent = null\r\n    let styles = null\r\n\r\n    if(this.props.mode === \"upload\"){\r\n      inputContent = \"Drop isometrics here\"\r\n      styles = {\r\n        dropzone: {\r\n          maxHeight: '400px',\r\n        },\r\n      }\r\n    }else{\r\n      inputContent = \"Drop the files to update\"\r\n      styles = {\r\n        dropzone: {\r\n          height: '250px'\r\n        },\r\n        dropzoneActive: {\r\n          height: '300px'\r\n        },\r\n        previewContainer:{\r\n          height: '2px'\r\n        }\r\n    }\r\n    \r\n  }\r\n    return (\r\n      <div>\r\n        <Dropzone\r\n          LayoutComponent={Layout}\r\n          onSubmit={this.handleSubmit}\r\n          inputContent= {inputContent}\r\n          styles={styles}\r\n        />\r\n\r\n        <Collapse in={this.state.success}>\r\n          <Collapse in={this.state.uploaded}>\r\n            <Alert\r\n            >\r\n              The files have been uploaded!\r\n\r\n            </Alert>\r\n          </Collapse>\r\n        </Collapse>\r\n\r\n        <Collapse in={this.state.error}>\r\n          <Collapse in={this.state.uploaded}>\r\n            {errors}\r\n          </Collapse>\r\n          \r\n        </Collapse>\r\n        <Collapse in={this.state.pipeError}>\r\n          <Collapse in={this.state.uploaded}>\r\n            {pipeErrors}\r\n          </Collapse>\r\n          \r\n        </Collapse>\r\n        <Collapse in={this.state.uploading}>\r\n          <Alert severity=\"info\"\r\n            >\r\n              The files are uploading...\r\n\r\n            </Alert>\r\n        </Collapse>\r\n        \r\n      </div>\r\n    )\r\n  }\r\n}\r\n\r\nexport default UpdateMassive;"]},"metadata":{},"sourceType":"module"}