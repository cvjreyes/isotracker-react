{"ast":null,"code":"var _jsxFileName = \"C:\\\\xampp\\\\htdocs\\\\isotracker-dev\\\\isotracker-react\\\\src\\\\components\\\\estimatedPipesExcel\\\\estimatedPipesExcel.js\";\nimport React from 'react';\nimport 'antd/dist/antd.css';\nimport { HotTable } from '@handsontable/react';\nimport 'handsontable/dist/handsontable.full.css';\nimport \"./estimatedPipesExcel.css\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nclass EstimatedPipesExcel extends React.Component {\n  constructor(...args) {\n    super(...args);\n    this.state = {\n      searchText: '',\n      searchedColumn: '',\n      data: [],\n      tab: this.props.currentTab,\n      selectedRows: [],\n      selectedRowsKeys: [],\n      updateData: this.props.updateData,\n      username: \"\",\n      acronyms: null,\n      diameters: [],\n      areas: [],\n      trains: [\"01\", \"02\", \"03\", \"04\", \"05\"],\n      line_refs: [],\n      new_data: []\n    };\n\n    this.handleChange = async (changes, source) => {\n      if (source !== 'loadData') {\n        let row = this.state.data[changes[0][0]];\n        let data_aux = this.state.data;\n\n        if (changes[0][1] === 'Line reference') {\n          const options = {\n            method: \"GET\",\n            headers: {\n              \"Content-Type\": \"application/json\"\n            }\n          };\n          await fetch(\"http://\" + process.env.REACT_APP_SERVER + \":\" + process.env.REACT_APP_NODE_PORT + \"/getDataByRef/\" + changes[0][3], options).then(response => response.json()).then(async json => {\n            if (json.pipe) {\n              data_aux[changes[0][0]].Unit = json.pipe[0].unit;\n              data_aux[changes[0][0]].Fluid = json.pipe[0].fluid;\n              data_aux[changes[0][0]].Seq = json.pipe[0].seq;\n              data_aux[changes[0][0]].Spec = json.pipe[0].spec_code;\n              data_aux[changes[0][0]].Insulation = json.pipe[0].insulation;\n              await this.setState({\n                data: data_aux\n              });\n            }\n          });\n        } else if (row.Area && row.Diameter && row.Train && row[\"Line reference\"]) {\n          let tag_order = process.env.REACT_APP_TAG_ORDER.split(/[ -]+/);\n          data_aux[changes[0][0]].Tag = row[tag_order[0]] + \"-\" + row[tag_order[1]] + \"-\" + row[tag_order[2]] + \"-\" + row[tag_order[3]] + \"-\" + row[tag_order[4]] + \"-\" + row[tag_order[5]] + \"-\" + row[tag_order[6]] + \"_\" + row[tag_order[7]];\n          data_aux[changes[0][0]].Status = \"ESTIMATED\";\n          let new_data = this.state.new_data;\n          new_data.push(row);\n          await this.setState({\n            data: data_aux,\n            new_data: new_data\n          });\n        }\n      }\n    };\n\n    this.setReadOnly = async (row, column) => {\n      /*\r\n      if(row){\r\n        console.log(this.state.data[row].Status)\r\n        let settings = {}\r\n        if(this.state.data[row].Status !== \"Estimated\"){\r\n          settings.readOnly = true\r\n          console.log(settings)\r\n        }\r\n        return settings\r\n      }else{\r\n        return null\r\n      }*/\n      return {\n        readOnly: true\n      };\n    };\n  }\n\n  async componentDidMount() {\n    const options = {\n      method: \"GET\",\n      headers: {\n        \"Content-Type\": \"application/json\"\n      }\n    };\n    fetch(\"http://\" + process.env.REACT_APP_SERVER + \":\" + process.env.REACT_APP_NODE_PORT + \"/api/areas\", options).then(response => response.json()).then(json => {\n      let areas_options = [];\n\n      for (let i = 0; i < json.length; i++) {\n        areas_options.push(json[i].name);\n      }\n\n      this.setState({\n        areas: areas_options\n      });\n    });\n    await fetch(\"http://\" + process.env.REACT_APP_SERVER + \":\" + process.env.REACT_APP_NODE_PORT + \"/api/diameters\", options).then(response => response.json()).then(json => {\n      let diameters = [];\n\n      for (let i = 0; i < json.diameters.length; i++) {\n        diameters.push(json.diameters[i].diameter);\n      }\n\n      this.setState({\n        diameters: diameters\n      });\n    });\n    await fetch(\"http://\" + process.env.REACT_APP_SERVER + \":\" + process.env.REACT_APP_NODE_PORT + \"/api/lineRefs\", options).then(response => response.json()).then(json => {\n      let line_refs = [];\n\n      for (let i = 0; i < json.line_refs.length; i++) {\n        line_refs.push(json.line_refs[i].line_ref);\n      }\n\n      this.setState({\n        line_refs: line_refs\n      });\n    });\n    await fetch(\"http://\" + process.env.REACT_APP_SERVER + \":\" + process.env.REACT_APP_NODE_PORT + \"/modelledEstimatedPipes\", options).then(response => response.json()).then(async json => {\n      let rows = [];\n\n      for (let i = 0; i < json.rows.length; i++) {\n        rows.push({\n          \"Line reference\": json.rows[i].line_reference,\n          \"Tag\": json.rows[i].tag,\n          \"Unit\": json.rows[i].unit,\n          \"Area\": json.rows[i].area,\n          \"Fluid\": json.rows[i].fluid,\n          \"Seq\": json.rows[i].seq,\n          \"Spec\": json.rows[i].spec,\n          \"Diameter\": json.rows[i].diameter,\n          \"Insulation\": json.rows[i].insulation,\n          \"Train\": json.rows[i].train,\n          \"Status\": json.rows[i].status,\n          \"id\": json.rows[i].id\n        });\n      }\n\n      await this.setState({\n        data: rows\n      });\n    });\n  }\n\n  addRow() {\n    let rows = this.state.data;\n    rows.push({\n      \"Line reference\": \"\",\n      \"Tag\": \"\",\n      \"Unit\": \"\",\n      \"Area\": \"\",\n      \"Fluid\": \"\",\n      \"Seq\": \"\",\n      \"Spec\": \"\",\n      \"Diameter\": \"\",\n      \"Insulation\": \"\",\n      \"Train\": \"\",\n      \"Status\": \"\"\n    });\n    this.setState({\n      data: rows\n    });\n  }\n\n  submitChanges() {\n    const body = {\n      rows: this.state.data\n    };\n    const options = {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\"\n      },\n      body: JSON.stringify(body)\n    };\n    console.log(this.state.new_data);\n    this.props.success();\n  }\n\n  render() {\n    const settings = {\n      licenseKey: 'non-commercial-and-evaluation',\n      colWidths: [300, 400, 110, 210, 140, 130, 140, 110, 130, 110, 143],\n      fontSize: 24,\n      cells: function (row, col, prop) {\n        if (this.state.data) {\n          console.log(row, col, prop);\n        }\n      } //... other options\n\n    };\n    const container = document.querySelector('#ho');\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        id: \"hot-app\",\n        children: [/*#__PURE__*/_jsxDEV(HotTable, {\n          id: \"mytable\",\n          data: this.state.data,\n          colHeaders: [\"<b className='header'>Line reference</b>\", \"<b>Tag</b>\", \"<b>Unit</b>\", \"<b>Area</b>\", \"<b>Fluid</b>\", \"<b>Seq</b>\", \"<b>Spec</b>\", \"<b>Diameter</b>\", \"<b>Insulation</b>\", \"<b>Train</b>\", \"<b>Status</b>\"],\n          rowHeaders: true,\n          rowHeights: \"30px\",\n          columnHeaderHeight: 30,\n          width: \"100%\",\n          height: \"520\",\n          settings: settings,\n          manualColumnResize: true,\n          manualRowResize: true,\n          columns: [{\n            data: \"Line reference\",\n            type: 'dropdown',\n            source: this.state.line_refs,\n            strict: true\n          }, {\n            data: \"Tag\",\n            type: 'text',\n            readOnly: true\n          }, {\n            data: \"Unit\",\n            type: 'text',\n            readOnly: true\n          }, {\n            data: \"Area\",\n            type: 'dropdown',\n            source: this.state.areas,\n            strict: true\n          }, {\n            data: \"Fluid\",\n            type: 'text',\n            readOnly: true\n          }, {\n            data: \"Seq\",\n            type: 'text',\n            readOnly: true\n          }, {\n            data: \"Spec\",\n            type: 'text',\n            readOnly: true\n          }, {\n            data: \"Diameter\",\n            type: 'dropdown',\n            source: this.state.diameters,\n            strict: true\n          }, {\n            data: \"Insulation\",\n            type: 'text',\n            readOnly: true\n          }, {\n            data: \"Train\",\n            type: 'dropdown',\n            source: this.state.trains,\n            strict: true\n          }, {\n            data: \"Status\",\n            type: 'text',\n            readOnly: true\n          }],\n          filters: true,\n          dropdownMenu: ['alignment', '---------', 'filter_by_condition', '---------', 'filter_operators', '---------', 'filter_by_condition2', '---------', 'filter_by_value', '---------', 'filter_action_bar']\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 173,\n          columnNumber: 15\n        }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 202,\n          columnNumber: 15\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            marginLeft: \"803px\"\n          },\n          children: [/*#__PURE__*/_jsxDEV(\"button\", {\n            class: \"btn btn-sm btn-info\",\n            onClick: () => this.addRow(),\n            style: {\n              marginRight: \"5px\",\n              fontSize: \"16px\",\n              width: \"60px\",\n              borderRadius: \"10px\"\n            },\n            children: \"Add\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 204,\n            columnNumber: 19\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            class: \"btn btn-sm btn-success\",\n            onClick: () => this.submitChanges(),\n            style: {\n              marginRight: \"5px\",\n              fontSize: \"16px\",\n              width: \"60px\",\n              borderRadius: \"10px\"\n            },\n            children: \"Save\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 205,\n            columnNumber: 19\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 203,\n          columnNumber: 15\n        }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 207,\n          columnNumber: 15\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 172,\n        columnNumber: 13\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 171,\n      columnNumber: 11\n    }, this);\n  }\n\n}\n\nexport default EstimatedPipesExcel;","map":{"version":3,"sources":["C:/xampp/htdocs/isotracker-dev/isotracker-react/src/components/estimatedPipesExcel/estimatedPipesExcel.js"],"names":["React","HotTable","EstimatedPipesExcel","Component","state","searchText","searchedColumn","data","tab","props","currentTab","selectedRows","selectedRowsKeys","updateData","username","acronyms","diameters","areas","trains","line_refs","new_data","handleChange","changes","source","row","data_aux","options","method","headers","fetch","process","env","REACT_APP_SERVER","REACT_APP_NODE_PORT","then","response","json","pipe","Unit","unit","Fluid","fluid","Seq","seq","Spec","spec_code","Insulation","insulation","setState","Area","Diameter","Train","tag_order","REACT_APP_TAG_ORDER","split","Tag","Status","push","setReadOnly","column","readOnly","componentDidMount","areas_options","i","length","name","diameter","line_ref","rows","line_reference","tag","area","spec","train","status","id","addRow","submitChanges","body","JSON","stringify","console","log","success","render","settings","licenseKey","colWidths","fontSize","cells","col","prop","container","document","querySelector","type","strict","marginLeft","marginRight","width","borderRadius"],"mappings":"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","sourcesContent":["import React from 'react';\r\nimport 'antd/dist/antd.css';\r\nimport { HotTable } from '@handsontable/react';\r\nimport 'handsontable/dist/handsontable.full.css';\r\nimport \"./estimatedPipesExcel.css\"\r\n\r\nclass EstimatedPipesExcel extends React.Component{\r\n  state = {\r\n    searchText: '',\r\n    searchedColumn: '',\r\n    data: [],\r\n    tab: this.props.currentTab,\r\n    selectedRows: [],\r\n    selectedRowsKeys: [],\r\n    updateData: this.props.updateData,\r\n    username: \"\",\r\n    acronyms : null,\r\n    diameters: [],\r\n    areas: [],\r\n    trains: [\"01\", \"02\", \"03\", \"04\", \"05\"],\r\n    line_refs: [],\r\n    new_data: []\r\n  };\r\n\r\n  async componentDidMount(){\r\n\r\n    const options = {\r\n        method: \"GET\",\r\n        headers: {\r\n            \"Content-Type\": \"application/json\"\r\n        },\r\n    }\r\n\r\n\r\n  fetch(\"http://\"+process.env.REACT_APP_SERVER+\":\"+process.env.REACT_APP_NODE_PORT+\"/api/areas\", options)\r\n    .then(response => response.json())\r\n    .then(json => {\r\n      let areas_options = []\r\n      for(let i = 0; i < json.length; i++){\r\n        areas_options.push(json[i].name)\r\n      }\r\n      this.setState({areas : areas_options});\r\n\r\n  })\r\n\r\n  await fetch(\"http://\"+process.env.REACT_APP_SERVER+\":\"+process.env.REACT_APP_NODE_PORT+\"/api/diameters\", options)\r\n  .then(response => response.json())\r\n  .then(json => {\r\n    let diameters = []\r\n    for(let i = 0; i < json.diameters.length; i++){\r\n      diameters.push(json.diameters[i].diameter)\r\n    }\r\n    this.setState({diameters : diameters});\r\n\r\n  })\r\n\r\n  await fetch(\"http://\"+process.env.REACT_APP_SERVER+\":\"+process.env.REACT_APP_NODE_PORT+\"/api/lineRefs\", options)\r\n  .then(response => response.json())\r\n  .then(json => {\r\n    let line_refs = []\r\n    for(let i = 0; i < json.line_refs.length; i++){\r\n      line_refs.push(json.line_refs[i].line_ref)\r\n    }\r\n    this.setState({line_refs : line_refs});\r\n\r\n  })\r\n\r\n  await fetch(\"http://\"+process.env.REACT_APP_SERVER+\":\"+process.env.REACT_APP_NODE_PORT+\"/modelledEstimatedPipes\", options)\r\n  .then(response => response.json())\r\n  .then(async json => {\r\n    let rows = [] \r\n    for(let i = 0; i < json.rows.length; i++){\r\n      rows.push({\"Line reference\": json.rows[i].line_reference, \"Tag\": json.rows[i].tag, \"Unit\": json.rows[i].unit, \"Area\": json.rows[i].area, \"Fluid\": json.rows[i].fluid, \"Seq\": json.rows[i].seq, \"Spec\": json.rows[i].spec, \"Diameter\": json.rows[i].diameter, \"Insulation\": json.rows[i].insulation, \"Train\": json.rows[i].train, \"Status\": json.rows[i].status, \"id\":json.rows[i].id})\r\n    }\r\n    await this.setState({data: rows})\r\n  })\r\n}\r\n\r\n  addRow(){\r\n    let rows = this.state.data\r\n    rows.push({\"Line reference\": \"\", \"Tag\": \"\", \"Unit\": \"\", \"Area\": \"\", \"Fluid\": \"\", \"Seq\": \"\", \"Spec\": \"\", \"Diameter\": \"\", \"Insulation\": \"\", \"Train\": \"\", \"Status\": \"\"})\r\n    this.setState({data: rows})\r\n  }\r\n  \r\n  submitChanges(){\r\n    const body = {\r\n      rows: this.state.data,\r\n    }\r\n    const options = {\r\n        method: \"POST\",\r\n        headers: {\r\n            \"Content-Type\": \"application/json\"\r\n        },\r\n        body: JSON.stringify(body)\r\n    }\r\n    console.log(this.state.new_data)\r\n\r\n    this.props.success()\r\n  }\r\n\r\n  handleChange = async(changes, source) =>{\r\n    if (source !== 'loadData'){\r\n      let row = this.state.data[changes[0][0]]\r\n      let data_aux = this.state.data\r\n      if (changes[0][1] === 'Line reference'){\r\n        const options = {\r\n          method: \"GET\",\r\n          headers: {\r\n              \"Content-Type\": \"application/json\"\r\n          },\r\n        }\r\n      \r\n        await fetch(\"http://\"+process.env.REACT_APP_SERVER+\":\"+process.env.REACT_APP_NODE_PORT+\"/getDataByRef/\" + changes[0][3], options)\r\n          .then(response => response.json())\r\n          .then(async json => {\r\n            if(json.pipe){\r\n              data_aux[changes[0][0]].Unit = json.pipe[0].unit\r\n              data_aux[changes[0][0]].Fluid = json.pipe[0].fluid\r\n              data_aux[changes[0][0]].Seq = json.pipe[0].seq\r\n              data_aux[changes[0][0]].Spec = json.pipe[0].spec_code\r\n              data_aux[changes[0][0]].Insulation = json.pipe[0].insulation\r\n            await this.setState({data : data_aux})\r\n            }\r\n        })\r\n\r\n      }else if(row.Area && row.Diameter && row.Train && row[\"Line reference\"]){\r\n        let tag_order = process.env.REACT_APP_TAG_ORDER.split(/[ -]+/)        \r\n        data_aux[changes[0][0]].Tag = row[tag_order[0]] + \"-\" + row[tag_order[1]] + \"-\" + row[tag_order[2]] + \"-\" + row[tag_order[3]] + \"-\" + row[tag_order[4]] + \"-\" + row[tag_order[5]] + \"-\" + row[tag_order[6]] + \"_\" + row[tag_order[7]]\r\n        data_aux[changes[0][0]].Status = \"ESTIMATED\"\r\n        let new_data = this.state.new_data\r\n        new_data.push(row)\r\n        await this.setState({data : data_aux, new_data: new_data})\r\n\r\n      }\r\n    }\r\n  }\r\n\r\n  setReadOnly = async(row, column) =>{\r\n    /*\r\n    if(row){\r\n      console.log(this.state.data[row].Status)\r\n      let settings = {}\r\n      if(this.state.data[row].Status !== \"Estimated\"){\r\n        settings.readOnly = true\r\n        console.log(settings)\r\n      }\r\n      return settings\r\n    }else{\r\n      return null\r\n    }*/\r\n    return {readOnly: true}\r\n  }\r\n\r\n  render() {\r\n\r\n    const settings = {\r\n        licenseKey: 'non-commercial-and-evaluation',\r\n        colWidths: [300, 400, 110, 210, 140, 130, 140, 110, 130, 110, 143],\r\n        fontSize: 24,\r\n        cells: function(row, col, prop) {\r\n          if(this.state.data){\r\n          console.log(row, col, prop)\r\n          }\r\n        },\r\n        //... other options\r\n      }\r\n\r\n      const container = document.querySelector('#ho');\r\n      \r\n      return (\r\n          <div>\r\n            <div id=\"hot-app\">\r\n              <HotTable\r\n                id=\"mytable\"\r\n                data={this.state.data}\r\n                colHeaders={[\"<b className='header'>Line reference</b>\", \"<b>Tag</b>\", \"<b>Unit</b>\", \"<b>Area</b>\", \"<b>Fluid</b>\", \"<b>Seq</b>\", \"<b>Spec</b>\", \"<b>Diameter</b>\", \"<b>Insulation</b>\", \"<b>Train</b>\", \"<b>Status</b>\"]}\r\n                rowHeaders={true}\r\n                rowHeights=\"30px\"\r\n                columnHeaderHeight={30}\r\n                width=\"100%\"\r\n                height=\"520\"\r\n                settings={settings}\r\n                manualColumnResize={true}\r\n                manualRowResize={true}\r\n                columns= {[{ data: \"Line reference\", type:'dropdown', source: this.state.line_refs, strict: true},{ data: \"Tag\", type:'text', readOnly: true},{ data: \"Unit\", type:'text', readOnly: true},{ data: \"Area\", type:'dropdown', source: this.state.areas, strict: true }, { data: \"Fluid\", type:'text', readOnly: true}, { data: \"Seq\", type:'text', readOnly: true}, { data: \"Spec\", type:'text', readOnly: true}, { data: \"Diameter\", type:'dropdown', source: this.state.diameters, strict: true}, { data: \"Insulation\", type:'text', readOnly: true},{ data: \"Train\", type:'dropdown', source: this.state.trains, strict: true},{ data: \"Status\", type:'text', readOnly: true}]}\r\n                filters={true}\r\n                dropdownMenu= {[\r\n                    'alignment',\r\n                    '---------',\r\n                    'filter_by_condition',\r\n                    '---------',\r\n                    'filter_operators',\r\n                    '---------',\r\n                    'filter_by_condition2',\r\n                    '---------',\r\n                    'filter_by_value',\r\n                    '---------',\r\n                    'filter_action_bar',\r\n                  ]}\r\n                  \r\n              />\r\n              <br></br>\r\n              <div style={{marginLeft:\"803px\"}}>\r\n                  <button class=\"btn btn-sm btn-info\" onClick={() => this.addRow()} style={{marginRight:\"5px\", fontSize:\"16px\", width:\"60px\", borderRadius:\"10px\"}}>Add</button>\r\n                  <button class=\"btn btn-sm btn-success\" onClick={() => this.submitChanges()} style={{marginRight:\"5px\", fontSize:\"16px\", width:\"60px\", borderRadius:\"10px\"}}>Save</button>\r\n              </div>\r\n              <br></br>\r\n            </div>\r\n          </div>\r\n      );\r\n  }\r\n}\r\n\r\nexport default EstimatedPipesExcel;"]},"metadata":{},"sourceType":"module"}